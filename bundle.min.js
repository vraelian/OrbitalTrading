(()=>{var x=Object.freeze({MAP:"map",NAVIGATION:"navigation",SERVICES:"services",MARKET:"market",CARGO:"cargo",HANGAR:"hangar",MISSIONS:"missions",FINANCE:"finance",INTEL:"intel"}),$=Object.freeze({SHIP:"ship",STARPORT:"starport",DATA:"data"}),Q=Object.freeze({WANDERER:"Wanderer.Ship",STALWART:"Stalwart.Ship",MULE:"Mule.Ship",PATHFINDER:"Pathfinder.Ship",NOMAD:"Nomad.Ship",VINDICATOR:"Vindicator.Ship",AEGIS:"Aegis.Ship",ODYSSEY:"Odyssey.Ship",MAJESTIC:"luxury_s2",TITAN_HAULER:"Titan.Ship",VOID_CHASER:"rare_s2",GUARDIAN:"Guardian.Ship",STARGAZER:"rare_s4",BEHEMOTH:"Behemoth.Ship"}),E=Object.freeze({WATER_ICE:"water_ice",PLASTEEL:"plasteel",HYDROPONICS:"hydroponics",CYBERNETICS:"cybernetics",PROPELLANT:"propellant",PROCESSORS:"processors",GRAPHENE_LATTICES:"graphene_lattices",CRYO_PODS:"cryo_pods",ATMO_PROCESSORS:"atmos_processors",CLONED_ORGANS:"cloned_organs",XENO_GEOLOGICALS:"xeno_geologicals",SENTIENT_AI:"sentient_ai",ANTIMATTER:"antimatter",FOLDED_DRIVES:"folded_drives"}),v=Object.freeze({EARTH:"loc_earth",LUNA:"loc_luna",MARS:"loc_mars",VENUS:"loc_venus",MERCURY:"loc_mercury",SUN:"loc_sun",BELT:"loc_belt",SATURN:"loc_saturn",JUPITER:"loc_jupiter",URANUS:"loc_uranus",NEPTUNE:"loc_neptune",PLUTO:"loc_pluto",EXCHANGE:"loc_exchange",KEPLER:"loc_kepler"}),Wi=[v.SUN,v.MERCURY,v.VENUS,v.EARTH,v.LUNA,v.MARS,v.BELT,v.JUPITER,v.SATURN,v.URANUS,v.NEPTUNE,v.PLUTO,v.KEPLER,v.EXCHANGE],P=Object.freeze({TRADEMASTER:"trademaster",NAVIGATOR:"navigator",VENETIAN_SYNDICATE:"venetian_syndicate",MERCHANT_GUILD_SHIP:"merchant_guild_ship"}),w=Object.freeze({DEBUG_SIMPLE_START:"debug-simple-start",SET_SCREEN:"set-screen",TRAVEL:"travel",BUY_SHIP:"buy-ship",SELL_SHIP:"sell-ship",SELECT_SHIP:"select-ship",PAY_DEBT:"pay-debt",TAKE_LOAN:"take-loan",PURCHASE_INTEL:"purchase-intel",ACQUIRE_LICENSE:"acquire-license",BUY_ITEM:"buy-item",SELL_ITEM:"sell-item",SET_MAX_BUY:"set-max-buy",SET_MAX_SELL:"set-max-sell",INCREMENT:"increment",DECREMENT:"decrement",SHOW_PRICE_GRAPH:"show-price-graph",SHOW_FINANCE_GRAPH:"show-finance-graph",TOGGLE_MARKET_CARD_VIEW:"toggle-market-card-view",TOGGLE_HANGAR_MODE:"toggle-hangar-mode",SET_HANGAR_PAGE:"set-hangar-page"}),ae=Object.freeze({SCREEN_LOAD:"SCREEN_LOAD",ACTION:"ACTION",INFO:"INFO"}),K=Object.freeze({MOD_PRICE:"MOD_PRICE",MOD_FUEL_BURN:"MOD_FUEL_BURN",MOD_FUEL_PRICE:"MOD_FUEL_PRICE",MOD_TRAVEL_TIME:"MOD_TRAVEL_TIME",MOD_HULL_DECAY:"MOD_HULL_DECAY",MOD_SERVICE_COST:"MOD_SERVICE_COST",TRIGGER_ON_TRAVEL:"TRIGGER_ON_TRAVEL",TRIGGER_ON_TRADE:"TRIGGER_ON_TRADE",PASSIVE_EFFECT:"PASSIVE_EFFECT",RESTRICTION:"RESTRICTION"}),k=Object.freeze({MOD_TRAVEL_SPEED:"MOD_TRAVEL_SPEED",MOD_FUEL_BURN:"MOD_FUEL_BURN",MOD_FUEL_PRICE:"MOD_FUEL_PRICE",MOD_BUY_PRICE:"MOD_BUY_PRICE",MOD_SELL_PRICE:"MOD_SELL_PRICE",MOD_MAX_HULL:"MOD_MAX_HULL",MOD_MAX_FUEL:"MOD_MAX_FUEL",MOD_MAX_CARGO:"MOD_MAX_CARGO",MOD_EVENT_CHANCE:"MOD_EVENT_CHANCE",MOD_REPAIR_COST:"MOD_REPAIR_COST",MOD_PASSIVE_REPAIR:"MOD_PASSIVE_REPAIR",MOD_DEBT_INTEREST:"MOD_DEBT_INTEREST"}),_t=Object.freeze({BLUE:"#3b82f6",CYAN:"#06b6d4",GREEN:"#22c55e",GOLD:"#eab308",GREY:"#94a3b8",INDIGO:"#6366f1",EMERALD:"#10b981",SEAFOAM:"#14b8a6",ORANGE:"#f97316",RED:"#ef4444",VIOLET:"#8b5cf6"}),u=Object.freeze({TAGS:{SPACE:"TAG_SPACE",ORBIT:"TAG_ORBIT",STATION:"TAG_STATION",HAZARD:"TAG_HAZARD",SAFE:"TAG_SAFE",ALIEN:"TAG_ALIEN",TRADE:"TAG_TRADE",COMBAT:"TAG_COMBAT"},CONDITIONS:{HAS_FUEL:"COND_HAS_FUEL",HAS_CREDITS:"COND_HAS_CREDITS",HAS_HULL:"COND_HAS_HULL",HAS_CARGO_SPACE:"COND_HAS_CARGO_SPACE",HAS_ITEM:"COND_HAS_ITEM",HAS_PERK:"COND_HAS_PERK",HAS_SHIP_CLASS:"COND_HAS_SHIP_CLASS",WEALTH_TIER:"COND_WEALTH_TIER",LOCATION_IS:"COND_LOCATION_IS",RNG_ROLL:"COND_RNG_ROLL"},RESOLVERS:{WEIGHTED_RNG:"RESOLVER_WEIGHTED",STAT_CHECK:"RESOLVER_STAT_CHECK",DETERMINISTIC:"RESOLVER_FIXED"},EFFECTS:{MODIFY_CREDITS:"EFF_CREDITS",MODIFY_FUEL:"EFF_FUEL",MODIFY_HULL:"EFF_HULL",MODIFY_DEBT:"EFF_DEBT",ADD_ITEM:"EFF_ADD_ITEM",REMOVE_ITEM:"EFF_REMOVE_ITEM",MODIFY_TRAVEL:"EFF_MODIFY_TRAVEL",UNLOCK_INTEL:"EFF_UNLOCK_INTEL",TRIGGER_FOLLOWUP:"EFF_TRIGGER_EVENT",LOSE_RANDOM_CARGO:"EFF_LOSE_RANDOM_CARGO",ADD_RANDOM_CARGO:"EFF_ADD_RANDOM_CARGO",ADD_UPGRADE:"EFF_ADD_UPGRADE",FULL_REFUEL:"EFF_FULL_REFUEL"}}),G=Object.freeze({STARTING_CREDITS:5e3,STARTING_DEBT_INTEREST:125,REPAIR_COST_PER_HP:75,REPAIR_AMOUNT_PER_TICK:5,FUEL_SCALAR:2.5,INTEREST_INTERVAL:30,PASSIVE_REPAIR_RATE:.02,HULL_DECAY_PER_TRAVEL_DAY:1/7*1.01,SHIP_SELL_MODIFIER:.75,RARE_SHIP_CHANCE:.3,PRICE_HISTORY_LENGTH:65,FINANCE_HISTORY_LENGTH:25,DAILY_PRICE_VOLATILITY:.25,MEAN_REVERSION_STRENGTH:.04,MARKET_PRESSURE_DECAY:.7,LOCAL_PRICE_MOD_STRENGTH:.5,LOAN_GARNISHMENT_DAYS:1095,LOAN_GARNISHMENT_PERCENT:.14,RANDOM_EVENT_CHANCE:.15}),dt=[{threshold:5e4,revealsTier:2},{threshold:45e4,revealsTier:3},{threshold:4e6,revealsTier:4},{threshold:35e6,revealsTier:5},{threshold:3e8,revealsTier:6},{threshold:25e8,revealsTier:7}],At="orbitalTraderSave_v2";var Rt={mission_tutorial_01:{id:"mission_tutorial_01",name:"Milk Run to Luna",type:"DELIVERY",host:"STATION",isRepeatable:!1,isAbandonable:!1,description:"Hey buddy, you're a new captain, right? My hauler's reactor is fried and I'm on the hook for a delivery to Luna.<br><br>Could you deliver this load of <b>Plasteel</b> to the <b>Moon</b> for me? I don't have any credits to spare, but I've padded the manifest.<br><br>Deliver what I owe, keep the rest. You won't have trouble selling it there, trust me.",objectives:[{type:"have_item",goodId:"plasteel",quantity:5}],completion:{locationId:"loc_luna",title:"Favor Complete",text:"The freelancer sends his thanks.",buttonText:"Deliver Plasteel"},rewards:[],providedCargo:[{goodId:"plasteel",quantity:6}]},mission_tutorial_02:{id:"mission_tutorial_02",name:"Martian Resupply",type:"DELIVERY",host:"STATION",isRepeatable:!1,isAbandonable:!1,description:"A construction crew on Mars has requested a small shipment of plasteel to complete a habitat.",prerequisites:[{type:"mission_completed",missionId:"mission_tutorial_01"}],objectives:[{type:"have_item",goodId:"plasteel",quantity:2}],completion:{locationId:"loc_mars",title:"Delivery Complete",text:"The construction foreman thanks you for the Plasteel.",buttonText:"Deliver Plasteel"},rewards:[{type:"credits",amount:7500}]}};var Ct={mission_license_t3:{id:"mission_license_t3",name:"Guild Certification",type:"LICENSE_GRANT",host:"GUILD",isRepeatable:!1,isAbandonable:!1,description:"The Merchant's Guild requires you to certify your trade proficiency. Accepting this contract formally recognizes your status and grants you access to Tier 3 commodities.",prerequisites:[{type:"revealed_tier",tier:3}],objectives:[],completion:{},rewards:[{type:"license",licenseId:"t3_license"}]},mission_license_t5:{id:"mission_license_t5",name:"Governor's Contract",type:"LICENSE_GRANT",host:"STATION",isRepeatable:!1,isAbandonable:!1,description:"The planetary governor requires a sign of your commitment to local industry. This contract solidifies your standing and unlocks access to Tier 5 commodities.",prerequisites:[{type:"revealed_tier",tier:5}],objectives:[],completion:{},rewards:[{type:"license",licenseId:"t5_license"}]},mission_license_t7:{id:"mission_license_t7",name:"Legendary Run",type:"LICENSE_GRANT",host:"UNKNOWN",isRepeatable:!1,isAbandonable:!1,description:"Your name is spoken in the farthest corners of the system. Only a legend of your stature may be granted the right to trade the most advanced technologies known.",prerequisites:[{type:"revealed_tier",tier:7}],objectives:[],completion:{},rewards:[{type:"license",licenseId:"t7_license"}]}};var Mt={...Rt,...Ct};var wt=[{id:"evt_entropy_thermal",tags:[u.TAGS.SPACE],weight:10,requirements:[],template:{title:"Thermal Runaway",description:"A jagged warning klaxon cuts through the bridge silence. The environmental scrubbers in the avionics bay have seized, and waste heat is building up rapidly. The smell of ozone is already drifting through the vents."},choices:[{id:"choice_coolant",text:"Flush with Coolant (-15 Ice * Scale)",requirements:[{type:u.CONDITIONS.HAS_ITEM,target:E.WATER_ICE,operator:"GTE",value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:15}}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_coolant_fix"}]}},{id:"choice_vent",text:"Emergency Venting (Significant Hull Dmg)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_vent_damage"}]}},{id:"choice_shutdown",text:"System Shutdown (Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_shutdown_delay"}]}}],outcomes:{out_coolant_fix:{title:"Systems Stabilized",text:"You manually override the coolant loops, crushing the blocks of Water Ice into the reservoir. The temperature graph plummets back to the green.",effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.WATER_ICE,value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:15}}]},out_vent_damage:{title:"Emergency Venting",text:"You blow the emergency heat sinks. The superheated gas vents violently, warping the external plating near the exhaust port.",effects:[{type:u.EFFECTS.MODIFY_HULL,value:{scaleWith:"MAX_HULL",factor:-.25}}]},out_shutdown_delay:{title:"Reboot Sequence",text:"You kill the main reactor. The ship drifts for days, radiating heat slowly into the black before it is safe to restart.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.15}}]}}},{id:"evt_entropy_injector",tags:[u.TAGS.SPACE],weight:10,requirements:[],template:{title:"Injector Misfire",description:"A sickening vibration runs through the deck plates. The number three plasma injector is misfiring. You can swap it out, or try to retune it on the fly\u2014but a bad tune could dump your fuel."},choices:[{id:"choice_replace",text:"Replace Injector (-5 Plasteel * Scale)",requirements:[{type:u.CONDITIONS.WEALTH_TIER,operator:"GTE",value:1},{type:u.CONDITIONS.HAS_ITEM,target:E.PLASTEEL,operator:"GTE",value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:5}}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_replace"}]}},{id:"choice_tune",text:"Manual Recalibration (Risk Fuel)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_tune_success",weight:70},{outcomeId:"out_tune_fail",weight:30}]}},{id:"choice_push",text:"Push It (Hull Damage)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_push_fail"}]}}],outcomes:{out_replace:{title:"Maintenance Complete",text:"The new Plasteel housing seats perfectly. The vibration vanishes.",effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.PLASTEEL,value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:5}}]},out_tune_success:{title:"Harmonics Aligned",text:"You wrestle with the magnetic field harmonics for hours. Finally, the waveform syncs up.",effects:[]},out_tune_fail:{title:"Fuel Dump",text:"You overcompensated the fuel mix. The vibration stops, but only because you are dumping raw plasma out the exhaust.",effects:[{type:u.EFFECTS.MODIFY_FUEL,value:{scaleWith:"MAX_FUEL",factor:-.25}}]},out_push_fail:{title:"Structural Stress",text:"The vibration grows violent, rattling teeth and loosening bolts across the entire aft section.",effects:[{type:u.EFFECTS.MODIFY_HULL,value:{scaleWith:"MAX_HULL",factor:-.3}}]}}},{id:"evt_entropy_software",tags:[u.TAGS.SPACE],weight:10,requirements:[],template:{title:"Logic Loop",description:"The navigation console freezes. A legacy code fragment has triggered a recursive loop in the astrogation buffer. You need high-end hardware to brute-force a solution, or you have to pull the plug."},choices:[{id:"choice_hardware",text:"Hardware Patch (-10 Processors * Scale)",requirements:[{type:u.CONDITIONS.WEALTH_TIER,operator:"GTE",value:3},{type:u.CONDITIONS.HAS_ITEM,target:E.PROCESSORS,operator:"GTE",value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:10}}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_patch"}]}},{id:"choice_reboot",text:"Hard Reboot (Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_reboot"}]}},{id:"choice_override",text:"Manual Override (Risk Trip Delay)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_override_success",weight:80},{outcomeId:"out_override_fail",weight:20}]}}],outcomes:{out_patch:{title:"System Restored",text:"The extra compute power chews through the bad code in seconds.",effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.PROCESSORS,value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:10}}]},out_reboot:{title:"Reboot Complete",text:"You pull the main breaker. When the OS reloads, you realize the ship has drifted off-vector.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.1}}]},out_override_success:{title:"Override Successful",text:"You bypass the safety protocols and force the last known trajectory. It works.",effects:[]},out_override_fail:{title:"Navigational Error",text:"You forced a bad vector. By the time you realize the error, you have wasted days traveling in the wrong direction.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.35}}]}}},{id:"evt_entropy_structure",tags:[u.TAGS.SPACE,u.TAGS.HAZARD],weight:10,requirements:[],template:{title:"Micro-Fractures",description:"Sensors report a web of micro-fractures spreading along the dorsal cargo spine. If you don't reinforce it or slow down, the ship could snap under the G-load."},choices:[{id:"choice_reinforce",text:"Reinforce (-10 Plasteel * Scale)",requirements:[{type:u.CONDITIONS.HAS_ITEM,target:E.PLASTEEL,operator:"GTE",value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:10}}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_reinforce"}]}},{id:"choice_slow",text:"Reduce Acceleration (Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_slow"}]}},{id:"choice_maintain",text:"Maintain Velocity (Risk Hull)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_maintain_success",weight:60},{outcomeId:"out_maintain_fail",weight:40}]}}],outcomes:{out_reinforce:{title:"Hull Reinforced",text:"You weld Plasteel bracing over the affected area. It is an ugly patch, but stronger than the original.",effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.PLASTEEL,value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:10}}]},out_slow:{title:"Velocity Reduced",text:"You dial back the engine thrust. The stress eases, but your arrival time slips further away.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.2}}]},out_maintain_success:{title:"Holding Together",text:"You watch the stress gauges for the entire trip. Miraculously, the metal groans but doesn't buckle.",effects:[]},out_maintain_fail:{title:"Structural Failure",text:"A loud CRACK reverberates through the ship. A primary load-bearer snaps.",effects:[{type:u.EFFECTS.MODIFY_HULL,value:{scaleWith:"MAX_HULL",factor:-.4}}]}}}];var Lt=[{id:"evt_hazard_meteoroid",tags:[u.TAGS.SPACE,u.TAGS.HAZARD],weight:10,requirements:[],template:{title:"Debris Field",description:'Long-range radar paints a cloud of "gravel" directly in your path\u2014remnants of a collision moving at 15 km/s. You can burn hard to go around, or shield up and tank it.'},choices:[{id:"choice_evade",text:"Evasive Maneuvers (-Fuel)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_evade"}]}},{id:"choice_tank",text:"Brace for Impact (-Hull)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_tank"}]}},{id:"choice_drift",text:"Drift Through (Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_drift"}]}}],outcomes:{out_evade:{title:"Evasion Successful",text:'You slam the throttle forward, vectoring hard "up" relative to the ecliptic. It consumes fuel, but you clear the cloud.',effects:[{type:u.EFFECTS.MODIFY_FUEL,value:{scaleWith:"MAX_FUEL",factor:-.15}}]},out_tank:{title:"Impact Sustained",text:"It sounds like hail on a tin roof. Impacts pit the hull and shatter sensors.",effects:[{type:u.EFFECTS.MODIFY_HULL,value:{scaleWith:"MAX_HULL",factor:-.15}}]},out_drift:{title:"Navigation Complete",text:"You kill your velocity and gently drift through the widening gaps. It is safe, but agonizingly slow.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.15}}]}}},{id:"evt_hazard_flare",tags:[u.TAGS.SPACE],weight:10,requirements:[],template:{title:"Coronal Mass Ejection",description:"The radiation alarm screams. A massive solar flare has erupted. You need to harden the ship or find cover immediately."},choices:[{id:"choice_harden",text:"Harden Shields (-10 Plasteel * Scale)",requirements:[{type:u.CONDITIONS.HAS_ITEM,target:E.PLASTEEL,operator:"GTE",value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:10}}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_harden"}]}},{id:"choice_shadow",text:"Seek Shadow (Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_shadow"}]}},{id:"choice_run",text:"Run Silent (Risk Cargo)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_run_success",weight:60},{outcomeId:"out_run_fail",weight:40}]}}],outcomes:{out_harden:{title:"Shields Holding",text:"You rig extra Plasteel plating over the emitter arrays. The radiation storm washes over you, but the interior remains safe.",effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.PLASTEEL,value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:10}}]},out_shadow:{title:"Storm Passed",text:"You divert to a nearby asteroid. You wait there for days until the particle count drops.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.2}}]},out_run_success:{title:"Outrun",text:"You pushed the engines to the redline and managed to stay just ahead of the worst wavefront.",effects:[]},out_run_fail:{title:"Radiation Leak",text:"Hard radiation pierces the cargo bay, ionizing a portion of your manifest.",effects:[{type:u.EFFECTS.LOSE_RANDOM_CARGO,value:.35}]}}},{id:"evt_hazard_gravity",tags:[u.TAGS.SPACE],weight:10,requirements:[],template:{title:"Gravity Well",description:"A navigational error brought you too close to a gas giant's gravity well. The tidal forces are dragging you off course."},choices:[{id:"choice_burn",text:"Corrective Burn (-Fuel)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_burn"}]}},{id:"choice_decay",text:"Orbital Decay (Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_decay"}]}},{id:"choice_slingshot",text:"Slingshot (Req: Navigator)",requirements:[{type:u.CONDITIONS.HAS_PERK,target:P.NAVIGATOR,operator:"EQ",value:1}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_slingshot"}]}}],outcomes:{out_burn:{title:"Orbit Corrected",text:"You burn directly against the gravity vector. The engines scream, consuming reaction mass at a terrifying rate.",effects:[{type:u.EFFECTS.MODIFY_FUEL,value:{scaleWith:"MAX_FUEL",factor:-.25}}]},out_decay:{title:"Decay & Recovery",text:"You surrender to the physics, letting the planet pull you into a long, elliptical orbit before flinging you back out.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.2}}]},out_slingshot:{title:"Gravity Assist",text:"You dip deeper into the well, using the Oberth effect to steal momentum. You exit faster than you entered.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:-.15}}]}}},{id:"evt_hazard_magnetic",tags:[u.TAGS.SPACE],weight:10,requirements:[],template:{title:"Sensor Blindness",description:"You've entered a region of intense magnetic flux. The lidar is whited out. You can try to filter the signal with high-end hardware or wait it out."},choices:[{id:"choice_filter",text:"Filter Signal (-10 Processors * Scale)",requirements:[{type:u.CONDITIONS.WEALTH_TIER,operator:"GTE",value:3},{type:u.CONDITIONS.HAS_ITEM,target:E.PROCESSORS,operator:"GTE",value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:10}}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_filter"}]}},{id:"choice_wait",text:"All Stop (Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_wait"}]}},{id:"choice_blind",text:"Fly Blind (Risk Hull)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_blind_success",weight:70},{outcomeId:"out_blind_fail",weight:30}]}}],outcomes:{out_filter:{title:"Signal Clear",text:"The new Processors work overtime, filtering the noise from the data. The sensor picture snaps into focus.",effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.PROCESSORS,value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:10}}]},out_wait:{title:"Storm Waited Out",text:"It is too dangerous. You cut velocity and wait for the magnetic storm to drift past.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.1}}]},out_blind_success:{title:"Pure Luck",text:"You flew by feel and luck. The hull remains intact.",effects:[]},out_blind_fail:{title:"Collision Alert",text:"You never saw it coming. A chunk of ice the size of a car slams into your prow.",effects:[{type:u.EFFECTS.MODIFY_HULL,value:{scaleWith:"MAX_HULL",factor:-.3}}]}}}];var Ot=[{id:"evt_bureau_audit",tags:[u.TAGS.SPACE,u.TAGS.TRADE],weight:10,requirements:[],template:{title:"Guild Authority Audit",description:'"Unidentified vessel, this is Guild Authority 44-Bravo. Heave to for a mandatory safety standard audit." You know the drill: pay the fee, suffer the delay, or cite the bylaws.'},choices:[{id:"choice_bribe",text:"Expedited Fee (-4% Wealth)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_bribe"}]}},{id:"choice_inspect",text:"Full Inspection (Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_inspect"}]}},{id:"choice_bylaws",text:"Cite Bylaws (Req: Trademaster)",requirements:[{type:u.CONDITIONS.HAS_PERK,target:P.TRADEMASTER,operator:"EQ",value:1}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_bylaws"}]}}],outcomes:{out_bribe:{title:"Fee Accepted",text:"You transfer the fee. The inspector suddenly decides your ship looks visibly compliant.",effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:-.04}}]},out_inspect:{title:"Bureaucratic Delay",text:"They board you. They check every seal. It takes a week.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.15}}]},out_bylaws:{title:"Inspection Waived",text:'You transmit Guild Statute 12-C regarding "In-Transit Sovereignty." The inspector grumbles and moves on.',effects:[]}}},{id:"evt_bureau_tariff",tags:[u.TAGS.SPACE,u.TAGS.TRADE],weight:10,requirements:[],template:{title:"Corporate Tariff",description:'Local Corporate Security has claimed this sector as a "Protectorate Zone." All commercial traffic must pay a tariff or divert.'},choices:[{id:"choice_pay",text:"Pay Tariff (-2% Wealth)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_pay"}]}},{id:"choice_divert",text:"Divert (-Fuel & Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_divert"}]}},{id:"choice_run",text:"Run Blockade (Risk Fine)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_run_success",weight:60},{outcomeId:"out_run_fail",weight:40}]}}],outcomes:{out_pay:{title:"Tariff Paid",text:"You pay the toll. It stings, but they grant you a coded squawk that clears your passage.",effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:-.02}}]},out_divert:{title:"Detour Plotted",text:"You plot a course through deep space, skirting the edge of their sensor net.",effects:[{type:u.EFFECTS.MODIFY_FUEL,value:{scaleWith:"MAX_FUEL",factor:-.2}},{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.2}}]},out_run_success:{title:"Blockade Runner",text:"You run silent, masking your thermal signature. You slip through their net.",effects:[]},out_run_fail:{title:"Violation Detected",text:'A patrol drone tags you. "Toll violation detected." They garnish your accounts automatically.',effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:-.08}}]}}},{id:"evt_bureau_quarantine",tags:[u.TAGS.SPACE],weight:10,requirements:[],template:{title:"Contaminant Alert",description:'An automated navigation buoy flags your ship. "Biological contaminant detected on outer hull. Sector access denied pending sterilization."'},choices:[{id:"choice_service",text:"Drone Service (-5% Wealth)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_service"}]}},{id:"choice_chem",text:"Chemical Bath (-15 Propellant * Scale)",requirements:[{type:u.CONDITIONS.WEALTH_TIER,operator:"GTE",value:3},{type:u.CONDITIONS.HAS_ITEM,target:E.PROPELLANT,operator:"GTE",value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:15}}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_chem"}]}},{id:"choice_park",text:"Solar Sterilization (Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_park"}]}}],outcomes:{out_service:{title:"Decon Complete",text:"You pay for a remote drone service. It sprays your hull with harsh foam and clears your flag.",effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:-.05}}]},out_chem:{title:"Chemical Scrub",text:"You flush the hull with volatile Propellant. It strips the paint, but kills the mold.",effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.PROPELLANT,value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:15}}]},out_park:{title:"Solar Cleanse",text:"You park the ship in a high-radiation orbit and wait for the UV light to kill the spores.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.25}}]}}},{id:"evt_bureau_license",tags:[u.TAGS.SPACE,u.TAGS.TRADE],weight:10,requirements:[],template:{title:"Expired Credential",description:"You receive a summons. A clerical error has flagged your Pilot's License as expired. Operating a heavy freighter without a license carries a hefty fine."},choices:[{id:"choice_lawyer",text:"Auto-Lawyer (-3% Wealth)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_lawyer"}]}},{id:"choice_spoof",text:"Data Spoof (-10 Processors * Scale)",requirements:[{type:u.CONDITIONS.WEALTH_TIER,operator:"GTE",value:3},{type:u.CONDITIONS.HAS_ITEM,target:E.PROCESSORS,operator:"GTE",value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:10}}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_spoof"}]}},{id:"choice_dispute",text:"Dispute (Risk Fine & Trip Delay)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_dispute_success",weight:40},{outcomeId:"out_dispute_fail",weight:60}]}}],outcomes:{out_lawyer:{title:"Case Dismissed",text:"You hire a digital legal AI. It files an injunction and clears the error in milliseconds.",effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:-.03}}]},out_spoof:{title:"Records Falsified",text:"You use Processors to brute-force a timestamp correction. The record now shows you renewed it yesterday.",effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.PROCESSORS,value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:10}}]},out_dispute_success:{title:"Appeal Granted",text:"You argue your case with passion. The AI finds a precedent and dismisses the charge.",effects:[]},out_dispute_fail:{title:"Appeal Denied",text:"The magistrate AI rejects your appeal. You pay the reinstatement fee plus the late penalty.",effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:-.1}},{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.1}}]}}}];var xt=[{id:"evt_traffic_stranded",tags:[u.TAGS.SPACE,u.TAGS.TRADE],weight:10,requirements:[],template:{title:"Mayday",description:'A beat-up hauler hails you. "Reactor is dry. Life support is failing. Can you spare some reaction mass?"'},choices:[{id:"choice_transfer",text:"Transfer Fuel (-20% Fuel)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_transfer"}]}},{id:"choice_tow",text:"Tow Service (-Fuel & Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_tow"}]}},{id:"choice_ignore",text:"Ignore",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_ignore"}]}}],outcomes:{out_transfer:{title:"Fuel Transferred",text:`"Thank you, captain. We don't have credits, but here is our scan data for the local market."`,effects:[{type:u.EFFECTS.MODIFY_FUEL,value:{scaleWith:"MAX_FUEL",factor:-.2}},{type:u.EFFECTS.UNLOCK_INTEL,value:1}]},out_tow:{title:"Vessel Recovered",text:"You drag them to the nearest lane. The Guild pays a standard bounty for assisting distressed vessels.",effects:[{type:u.EFFECTS.MODIFY_FUEL,value:{scaleWith:"MAX_FUEL",factor:-.25}},{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.15}},{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:.015}}]},out_ignore:{title:"Hail Ignored",text:"You cut the comms. Their signal fades behind you.",effects:[]}}},{id:"evt_traffic_medical",tags:[u.TAGS.SPACE],weight:10,requirements:[],template:{title:"Critical Patient",description:'A luxury liner broadcasts a pan-pan. "We have a critical patient and our med-bay is malfunctioning. Requesting immediate medical supplies."'},choices:[{id:"choice_donate_ice",text:"Donate Water Ice (-15 Ice * Scale)",requirements:[{type:u.CONDITIONS.HAS_ITEM,target:E.WATER_ICE,operator:"GTE",value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:15}}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_donate_ice"}]}},{id:"choice_donate_cyber",text:"Donate Cybernetics (-2 Cybernetics)",requirements:[{type:u.CONDITIONS.WEALTH_TIER,operator:"GTE",value:2},{type:u.CONDITIONS.HAS_ITEM,target:E.CYBERNETICS,operator:"GTE",value:2}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_donate_cyber"}]}},{id:"choice_dock",text:"Dock & Assist (Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_dock"}]}},{id:"choice_ignore",text:"Ignore",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_ignore"}]}}],outcomes:{out_donate_ice:{title:"Patient Stabilized",text:'"Payment transferred. You saved a life today, captain."',effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.WATER_ICE,value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:15}},{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:.03}}]},out_donate_cyber:{title:"Systems Restored",text:'"Payment transferred. You saved a life today, captain."',effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.CYBERNETICS,value:2},{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:.03}}]},out_dock:{title:"Medical Assistance",text:"You help stabilize the patient personally. The liner's captain shares high-level encryption keys.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.1}},{type:u.EFFECTS.UNLOCK_INTEL,value:2}]},out_ignore:{title:"Broadcast Ignored",text:"You fly past.",effects:[]}}},{id:"evt_traffic_broker",tags:[u.TAGS.SPACE,u.TAGS.TRADE],weight:10,requirements:[],template:{title:"Syndicate Broker",description:'A sleek Syndicate interceptor matches your velocity. "I have data on the upcoming market shifts. Guaranteed profitable. Interested?"'},choices:[{id:"choice_buy",text:"Buy Data (-2% Wealth)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_buy"}]}},{id:"choice_barter",text:"Barter (-5 Processors)",requirements:[{type:u.CONDITIONS.WEALTH_TIER,operator:"GTE",value:3},{type:u.CONDITIONS.HAS_ITEM,target:E.PROCESSORS,operator:"GTE",value:5}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_barter"}]}},{id:"choice_decline",text:"Decline",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_decline"}]}}],outcomes:{out_buy:{title:"Data Acquired",text:"You transfer the credits. A packet of market data floods your computer.",effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:-.02}},{type:u.EFFECTS.UNLOCK_INTEL,value:1}]},out_barter:{title:"Exchange Complete",text:'You trade a few high-end chips for the data. "Pleasure doing business."',effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.PROCESSORS,value:5},{type:u.EFFECTS.UNLOCK_INTEL,value:1}]},out_decline:{title:"Connection Closed",text:"The corvette vanishes into the black.",effects:[]}}},{id:"evt_traffic_convoy",tags:[u.TAGS.SPACE,u.TAGS.TRADE],weight:10,requirements:[],template:{title:"The Train",description:"You encounter a massive corporate heavy-freight convoy. You could draft behind them to save fuel, or sell goods to their crews."},choices:[{id:"choice_draft",text:"Draft Formation (Gain Fuel, Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_draft"}]}},{id:"choice_sell",text:"Flash Sale (Lose Cargo, +Credits)",requirements:[{type:u.CONDITIONS.HAS_CARGO_SPACE,operator:"LT",value:9999}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_sell"}]}},{id:"choice_pass",text:"Fly Past",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_pass"}]}}],outcomes:{out_draft:{title:"Slipstream Entered",text:"You tuck in behind the massive engine bells. Your fuel consumption drops to near zero, but you are limited to their speed.",effects:[{type:u.EFFECTS.MODIFY_FUEL,value:{scaleWith:"MAX_FUEL",factor:.15}},{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.15}}]},out_sell:{title:"Transaction Complete",text:"You sell a portion of your cargo to the convoy crew. They pay a premium for the convenience.",effects:[{type:u.EFFECTS.LOSE_RANDOM_CARGO,value:.15},{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:.02}}]},out_pass:{title:"Overtaking",text:"You overtake the slow convoy.",effects:[]}}}];var Nt=[{id:"evt_logistics_containment",tags:[u.TAGS.SPACE],weight:10,requirements:[{type:u.CONDITIONS.HAS_CARGO_SPACE,operator:"LT",value:9999}],template:{title:"Mag-Lock Failure",description:"A cargo pod is vibrating loose. If you don't secure it, it will tear itself free\u2014and might take a chunk of the hull with it."},choices:[{id:"choice_foam",text:"Secure with Foam (-5 Plasteel * Scale)",requirements:[{type:u.CONDITIONS.WEALTH_TIER,operator:"GTE",value:1},{type:u.CONDITIONS.HAS_ITEM,target:E.PLASTEEL,operator:"GTE",value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:5}}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_foam"}]}},{id:"choice_jettison",text:"Jettison Pod (Lose Cargo)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_jettison"}]}},{id:"choice_hold",text:"Hold it Together (Risk Hull)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_hold_success",weight:70},{outcomeId:"out_hold_fail",weight:30}]}}],outcomes:{out_foam:{title:"Cargo Secured",text:"You spray industrial foam into the clamp mechanism. It hardens instantly, welding the pod to the frame.",effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.PLASTEEL,value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:5}}]},out_jettison:{title:"Cargo Ejected",text:"You blow the emergency bolts. The pod tumbles away into the dark.",effects:[{type:u.EFFECTS.LOSE_RANDOM_CARGO,value:.15}]},out_hold_success:{title:"Locks Holding",text:"The clamps groan and spark, but they hold for the duration.",effects:[]},out_hold_fail:{title:"Containment Breach",text:"The clamp fails. The pod shears off, ripping through the dorsal plating.",effects:[{type:u.EFFECTS.MODIFY_HULL,value:{scaleWith:"MAX_HULL",factor:-.25}},{type:u.EFFECTS.LOSE_RANDOM_CARGO,value:.3}]}}},{id:"evt_logistics_spoilage",tags:[u.TAGS.SPACE],weight:10,requirements:[{type:u.CONDITIONS.HAS_CARGO_SPACE,operator:"LT",value:9999}],template:{title:"Temp Rising",description:"The refrigeration unit in Bay 4 is dying. Your perishable cargo will rot if you don't act fast."},choices:[{id:"choice_ice",text:"Add Coolant (-15 Ice * Scale)",requirements:[{type:u.CONDITIONS.HAS_ITEM,target:E.WATER_ICE,operator:"GTE",value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:15}}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_ice"}]}},{id:"choice_power",text:"Power Boost (-Fuel)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_power"}]}},{id:"choice_vent",text:"Vent to Vacuum (Lose Cargo)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_vent"}]}}],outcomes:{out_ice:{title:"Temp Stabilized",text:"You feed Water Ice into the heat exchanger. The temp drops back to safe levels.",effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.WATER_ICE,value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:15}}]},out_power:{title:"Power Diverted",text:"You divert main engine power to the cryo-units. Your engines run inefficiently.",effects:[{type:u.EFFECTS.MODIFY_FUEL,value:{scaleWith:"MAX_FUEL",factor:-.2}}]},out_vent:{title:"Partial Loss",text:"You open the airlock, flash-freezing the cargo. Some is sucked out, but the rest is saved.",effects:[{type:u.EFFECTS.LOSE_RANDOM_CARGO,value:.1}]}}},{id:"evt_logistics_shift",tags:[u.TAGS.SPACE,u.TAGS.HAZARD],weight:10,requirements:[{type:u.CONDITIONS.HAS_CARGO_SPACE,operator:"LT",value:9999}],template:{title:"Imbalance",description:"A hard maneuver caused the cargo to shift. The ship's center of mass is off, causing a dangerous wobble."},choices:[{id:"choice_restack",text:"EVA Re-Stack (Trip Delay)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_restack"}]}},{id:"choice_thrust",text:"Thrust Compensation (-Fuel)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_thrust"}]}},{id:"choice_ignore",text:"Ignore (-Hull)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_ignore"}]}}],outcomes:{out_restack:{title:"Cargo Secured",text:"You spend a day in zero-G, manually winching containers back into place.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.1}}]},out_thrust:{title:"Thrusters Compensating",text:"You let the thrusters fight the wobble. They fire constantly to keep the ship straight.",effects:[{type:u.EFFECTS.MODIFY_FUEL,value:{scaleWith:"MAX_FUEL",factor:-.25}}]},out_ignore:{title:"Structural Stress",text:"The constant oscillation stresses the ship's frame until rivets start popping.",effects:[{type:u.EFFECTS.MODIFY_HULL,value:{scaleWith:"MAX_HULL",factor:-.2}}]}}},{id:"evt_logistics_bloom",tags:[u.TAGS.SPACE],weight:10,requirements:[{type:u.CONDITIONS.HAS_CARGO_SPACE,operator:"LT",value:9999}],template:{title:"The Bloom",description:"Humidity sensors detect a rapid algal bloom in the cargo hold. It is eating the packaging and will soon eat the cargo."},choices:[{id:"choice_fumigate",text:"Fumigate (-15 Propellant * Scale)",requirements:[{type:u.CONDITIONS.WEALTH_TIER,operator:"GTE",value:3},{type:u.CONDITIONS.HAS_ITEM,target:E.PROPELLANT,operator:"GTE",value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:15}}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_fumigate"}]}},{id:"choice_vac",text:"Vacuum Sterilize (Lose Cargo)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_vac"}]}},{id:"choice_ignore",text:"Ignore (Lose More Cargo)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_ignore"}]}}],outcomes:{out_fumigate:{title:"Sterilization Complete",text:"You flood the hold with toxic Propellant vapor. It kills the bloom instantly.",effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.PROPELLANT,value:{base:0,scaleWith:"SHIP_CLASS_SCALAR",factor:15}}]},out_vac:{title:"Vacuum Exposure",text:"You vent the atmosphere. The sudden pressure drop ruptures some containers.",effects:[{type:u.EFFECTS.LOSE_RANDOM_CARGO,value:.15}]},out_ignore:{title:"Cargo Spoiled",text:"By the time you arrive, a quarter of the shipment is covered in green slime.",effects:[{type:u.EFFECTS.LOSE_RANDOM_CARGO,value:.35}]}}}];var Dt=[{id:"evt_salvage_probe",tags:[u.TAGS.SPACE],weight:10,requirements:[],template:{title:"Ad Astra Relic",description:"You spot a dark object tumbling in orbit. It's a decaying Ad Astra Initiative survey probe from the expansion era. It might have valuable components, or unexploded ordnance."},choices:[{id:"choice_scavenge",text:"Scavenge (Req: 5 Cargo Space)",requirements:[{type:u.CONDITIONS.HAS_CARGO_SPACE,operator:"GTE",value:5}],resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_scavenge_success",weight:80},{outcomeId:"out_scavenge_fail",weight:20}]}},{id:"choice_logs",text:"Download Logs (Intel)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_logs"}]}},{id:"choice_leave",text:"Leave",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_leave"}]}}],outcomes:{out_scavenge_success:{title:"Components Recovered",text:"You grapple the probe and strip it for parts. High-grade electronics!",effects:[{type:u.EFFECTS.ADD_ITEM,target:E.PROCESSORS,value:3}]},out_scavenge_fail:{title:"Trap Triggered",text:"A self-destruct charge triggers as you touch it. The explosion rocks your ship.",effects:[{type:u.EFFECTS.MODIFY_HULL,value:{scaleWith:"MAX_HULL",factor:-.2}}]},out_logs:{title:"Data Decrypted",text:"You recover some old stellar charts from the corrupted memory core.",effects:[{type:u.EFFECTS.UNLOCK_INTEL,value:1}]},out_leave:{title:"Signal Ignored",text:"You leave the relic alone.",effects:[]}}},{id:"evt_salvage_container",tags:[u.TAGS.SPACE],weight:10,requirements:[],template:{title:"Free Floating",description:"A sealed shipping container floats alone in the void. It might be goods, or it might be waste."},choices:[{id:"choice_grapple",text:"Grapple (Req: 10 Cargo Space)",requirements:[{type:u.CONDITIONS.HAS_CARGO_SPACE,operator:"GTE",value:10}],resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_grapple_success",weight:60},{outcomeId:"out_grapple_fail",weight:40}]}},{id:"choice_scan",text:"Detailed Scan (-2 Processors)",requirements:[{type:u.CONDITIONS.WEALTH_TIER,operator:"GTE",value:3},{type:u.CONDITIONS.HAS_ITEM,target:E.PROCESSORS,operator:"GTE",value:2}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_scan"}]}},{id:"choice_ignore",text:"Ignore",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_ignore"}]}}],outcomes:{out_grapple_success:{title:"Lucky Find",text:"You bring it aboard. It is full of legitimate trade goods!",effects:[{type:u.EFFECTS.ADD_RANDOM_CARGO,value:10}]},out_grapple_fail:{title:"Hazardous Waste",text:"You bring it aboard. It is full of industrial sludge. You have to pay a disposal fee.",effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:-.05}}]},out_scan:{title:"Scan Confirmed",text:"You burn high-end sensors to peer inside. It reveals valid cargo, which you collect safely.",effects:[{type:u.EFFECTS.REMOVE_ITEM,target:E.PROCESSORS,value:2},{type:u.EFFECTS.ADD_RANDOM_CARGO,value:10}]},out_ignore:{title:"Object Avoided",text:"Not worth the risk.",effects:[]}}},{id:"evt_salvage_wreck",tags:[u.TAGS.SPACE,u.TAGS.HAZARD],weight:10,requirements:[],template:{title:"Graveyard",description:"You drift through a field of shattered hull plates. There is scrap everywhere."},choices:[{id:"choice_scrap",text:"Harvest Scrap (+Trip Delay, +Plasteel)",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_scrap"}]}},{id:"choice_deep",text:"Deep Search (Risk Hull)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_deep_success",weight:70},{outcomeId:"out_deep_fail",weight:30}]}},{id:"choice_pass",text:"Pass",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_pass"}]}}],outcomes:{out_scrap:{title:"Scrap Harvested",text:"You spend a few hours collecting hull plates. Boring, but profitable.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.1}},{type:u.EFFECTS.ADD_ITEM,target:E.PLASTEEL,value:5}]},out_deep_success:{title:"Core Salvaged",text:"You find a surviving computer core and some intact cybernetics.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.2}},{type:u.EFFECTS.ADD_ITEM,target:E.CYBERNETICS,value:2},{type:u.EFFECTS.ADD_ITEM,target:E.PROCESSORS,value:2}]},out_deep_fail:{title:"Collision!",text:"A piece of debris you didn't see slams into your engine bell.",effects:[{type:u.EFFECTS.MODIFY_HULL,value:{scaleWith:"MAX_HULL",factor:-.2}}]},out_pass:{title:"Course Maintained",text:"You navigate through without stopping.",effects:[]}}},{id:"evt_salvage_beacon",tags:[u.TAGS.SPACE],weight:10,requirements:[],template:{title:"Rogue Beacon",description:"A distress beacon pings nearby, but the encryption doesn't match Guild protocols. It could be an old cache, or malware."},choices:[{id:"choice_investigate",text:"Investigate (Risk Wealth)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_investigate_success",weight:50},{outcomeId:"out_investigate_fail",weight:50}]}},{id:"choice_nav",text:"Nav Scan (Req: Navigator)",requirements:[{type:u.CONDITIONS.HAS_PERK,target:P.NAVIGATOR,operator:"EQ",value:1}],resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_nav"}]}},{id:"choice_ignore",text:"Ignore",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_ignore"}]}}],outcomes:{out_investigate_success:{title:"Dead Drop Found",text:"It is a dead drop from the last war. You crack the code and find a stash of credits.",effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:.015}}]},out_investigate_fail:{title:"Malware Detected",text:"As soon as you link up, a virus uploads itself to your finance computer and siphons funds.",effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:{scaleWith:"PLAYER_CREDITS",factor:-.05}}]},out_nav:{title:"Threat Identified",text:"Your advanced sensors flag the signal as a known malware signature. You mark it for deletion and move on.",effects:[]},out_ignore:{title:"Signal Ignored",text:"Not worth the risk.",effects:[]}}}];var kt=[{id:"evt_opp_server",tags:[u.TAGS.SPACE],weight:5,requirements:[],template:{title:"Corrupted Server",description:"You drift past a scorched server rack, likely ejected from a destroyed corporate station. Its backup battery is weak, but the encryption light is still blinking."},choices:[{id:"choice_decrypt",text:"Attempt Decryption (Risk Trip Delay)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_decrypt_success",weight:60},{outcomeId:"out_decrypt_fail",weight:40}]}},{id:"choice_ignore",text:"Ignore",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_ignore"}]}}],outcomes:{out_decrypt_success:{title:"Access Granted",text:"You crack the encryption just before the battery dies. It contains a forgotten, anonymous bank transfer authorization.",effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:2500}]},out_decrypt_fail:{title:"Data Corruption",text:"The security protocols trigger a localized EMP. The server fries, and your nav-computer needs a hard reboot.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.1}}]},out_ignore:{title:"Server Left",text:"You leave the electronic ghost to drift.",effects:[]}}},{id:"evt_opp_noble",tags:[u.TAGS.SPACE,u.TAGS.TRADE],weight:5,requirements:[{type:u.CONDITIONS.HAS_CREDITS,operator:"GTE",value:500}],template:{title:"The Eccentric Noble",description:'A flamboyant private yacht hails you. "My guests are dreadfully bored of this empty void! Do you have any entertaining stories or exotic goods to share?"'},choices:[{id:"choice_entertain",text:"Provide Entertainment (-500 Credits)",requirements:[{type:u.CONDITIONS.HAS_CREDITS,operator:"GTE",value:500}],resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_entertain_success",weight:50},{outcomeId:"out_entertain_fail",weight:50}]}},{id:"choice_ignore",text:"Decline",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_ignore"}]}}],outcomes:{out_entertain_success:{title:"Generous Patron",text:'You spend hours recounting your closest calls. The noble is delighted. "Marvelous! Please, take this for the amusement."',effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:-500},{type:u.EFFECTS.MODIFY_CREDITS,value:5e3}]},out_entertain_fail:{title:"Tough Crowd",text:"You try to entertain them with drinks and stories, but they quickly grow bored and cut the feed. You wasted your resources.",effects:[{type:u.EFFECTS.MODIFY_CREDITS,value:-500}]},out_ignore:{title:"Connection Closed",text:"You have work to do.",effects:[]}}},{id:"evt_opp_veteran",tags:[u.TAGS.SPACE],weight:5,requirements:[],template:{title:"Drifting Veteran",description:"You find an old, heavily modified shuttle drifting with a blown comms relay. The pilot waves frantically from the cockpit window."},choices:[{id:"choice_assist",text:"Assist Repair (Trip Delay)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_assist_success",weight:80},{outcomeId:"out_assist_fail",weight:20}]}},{id:"choice_ignore",text:"Ignore",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_ignore"}]}}],outcomes:{out_assist_success:{title:"Gratitude",text:'You help fix the relay. "I have no credits," the old pilot says, "but take this old Fuel Pass. It still works at most corporate stations."',effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.1}},{type:u.EFFECTS.ADD_UPGRADE,target:"UPG_ECO_FUEL_1"}]},out_assist_fail:{title:"Simple Thanks",text:"You fix the relay. The pilot nods thanks and departs immediately. No reward, but a good deed done.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.1}}]},out_ignore:{title:"Signal Ignored",text:"You fly past.",effects:[]}}},{id:"evt_opp_crate",tags:[u.TAGS.SPACE,u.TAGS.HAZARD],weight:5,requirements:[],template:{title:"Sealed Military Crate",description:"A high-security crate floats in a debris field. It has no digital interface, only a manual pressure seal that looks jammed."},choices:[{id:"choice_force",text:"Force Open (Risk Hull)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_force_success",weight:50},{outcomeId:"out_force_fail",weight:50}]}},{id:"choice_ignore",text:"Leave It",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_ignore"}]}}],outcomes:{out_force_success:{title:"Pristine Tech",text:"You pry the seal open. Inside is a mint-condition set of Hull Plating, still in the factory wrap.",effects:[{type:u.EFFECTS.ADD_UPGRADE,target:"UPG_UTIL_HULL_1"}]},out_force_fail:{title:"Explosive Bolt",text:"The anti-tamper mechanism fires an explosive bolt, sending shrapnel into your hull.",effects:[{type:u.EFFECTS.MODIFY_HULL,value:{scaleWith:"MAX_HULL",factor:-.15}}]},out_ignore:{title:"Left Alone",text:"Not worth the risk.",effects:[]}}},{id:"evt_opp_ion",tags:[u.TAGS.SPACE],weight:5,requirements:[],template:{title:"Ion Cloud",description:"Your sensors detect a dense, highly charged ion cloud. It is dangerous to fly through, but it is composed of nearly pure, energetic plasma."},choices:[{id:"choice_scoop",text:"Manual Scoop (Risk Hull)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_scoop_success",weight:60},{outcomeId:"out_scoop_fail",weight:40}]}},{id:"choice_avoid",text:"Avoid",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_avoid"}]}}],outcomes:{out_scoop_success:{title:"Tanks Full",text:"You carefully open the intakes. The energetic plasma floods your system, filling your tanks to capacity in minutes.",effects:[{type:u.EFFECTS.FULL_REFUEL,value:1}]},out_scoop_fail:{title:"Overload",text:"The ion discharge arcs across your hull, scorching the plating without giving you a chance to collect it.",effects:[{type:u.EFFECTS.MODIFY_HULL,value:{scaleWith:"MAX_HULL",factor:-.1}}]},out_avoid:{title:"Course Correction",text:"You steer clear of the anomaly.",effects:[]}}},{id:"evt_opp_tanker",tags:[u.TAGS.SPACE],weight:5,requirements:[],template:{title:"Stranded Tanker",description:`A massive corporate fuel tanker is drifting. "Our main valve is stuck," the captain hails. "If you can help us unstuck it manually, we'll make it worth your while."`},choices:[{id:"choice_repair",text:"Help Repair (Trip Delay)",resolution:{type:u.RESOLVERS.WEIGHTED_RNG,pool:[{outcomeId:"out_repair_success",weight:90},{outcomeId:"out_repair_fail",weight:10}]}},{id:"choice_ignore",text:"Ignore",resolution:{type:u.RESOLVERS.DETERMINISTIC,pool:[{outcomeId:"out_ignore"}]}}],outcomes:{out_repair_success:{title:"Service Rendered",text:'It takes two days of spacewalking to free the valve. "Thank you," the captain says. "Let me top you off." Your fuel gauge hits 100%.',effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.1}},{type:u.EFFECTS.FULL_REFUEL,value:1}]},out_repair_fail:{title:"Valve Jammed",text:"You try for days, but the valve is fused solid. You wasted your time.",effects:[{type:u.EFFECTS.MODIFY_TRAVEL,value:{scaleWith:"TRIP_DURATION",factor:.15}}]},out_ignore:{title:"Offer Declined",text:"You have your own schedule to keep.",effects:[]}}}];var Pt=[];var ue=[...wt,...Lt,...Ot,...xt,...Nt,...Dt,...kt,...Pt];var Ft=[];var $t={intro_hangar:{title:"Your First Ship",trigger:{type:ae.ACTION,action:"INTRO_START_HANGAR"},navLock:!0,steps:[{stepId:"hangar_1",text:"Welcome to the <b>Shipyard</b> on <b>Mars!</b><br><br>Every station has a port from which you can trade ships and manage your <b>Hangar</b>.",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:16,completion:{type:ae.INFO},nextStepId:"hangar_2",isSkippable:!0},{stepId:"hangar_2",text:"Now that you've borrowed <b class='hl-yellow font-bold'>extra credits</b>, you can buy your first ship!<br><br>Select one of the options in the <b>Shipyard</b>. Choose carefully...",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:17,completion:{type:ae.ACTION,action:w.BUY_SHIP},nextStepId:"hangar_3",isSkippable:!0,unlockPurchase:!0},{stepId:"hangar_3",text:'This is your <b>Hangar</b>. From here you can manage all the ships you own. Select your new ship and <b class="hl-yellow font-bold">Board</b> it to make it your active vessel.',size:{width:"400px",height:"110px"},anchorElement:"body",positionX:50,positionY:12,completion:{type:ae.ACTION,action:w.SELECT_SHIP},nextStepId:null,isSkippable:!1}]},intro_finance:{title:"Managing Your Debt",trigger:{type:ae.ACTION,action:"INTRO_START_FINANCE"},navLock:!0,steps:[{stepId:"finance_1",text:"That was a big purchase, but don't worry - you've still got some <b class='hl-yellow font-bold'>credits</b> left over!<br><br>Your transaction history and debts can be viewed on the <b>Finance</b> tab within <b>Data</b>.",size:{width:"400px",height:"120px"},anchorElement:"body",positionX:50,positionY:16,completion:{type:ae.INFO},nextStepId:"finance_2",isSkippable:!1},{stepId:"finance_2",text:"Dont forget, your debt to the <b class='hl-yellow font-bold'>Merchant's Guild</b> is due in <b class='hl-red font-bold'>3 years</b>.<br><br>You will need to earn <b class='hl-yellow font-bold'>credits</b> to <b>pay off your debt</b>!",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:16,completion:{type:ae.INFO},nextStepId:null,isSkippable:!1}]},intro_missions:{id:"intro_missions",title:"First Steps",trigger:{type:"ACTION",action:"INTRO_START_MISSIONS"},navLock:!0,steps:[{stepId:"mission_1_1",text:"This is the <b>Mission Terminal</b>.<br><br>Check the <b>Missions</b> tab often for opportunities to earn <b class='hl-yellow font-bold'>credits</b> and improve your reputation.",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:88,completion:{type:"INFO"},nextStepId:"mission_1_2",isSkippable:!1},{stepId:"mission_1_2",text:"A freelancer at the <b>Mars</b> station has put in a <b>Delivery</b> request. Select the mission '<b>Milk Run to Luna</b>' to view more details.",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:88,completion:{type:"ACTION",action:"show-mission-modal"},nextStepId:"mission_1_3",isSkippable:!1},{stepId:"mission_1_3",text:"The freelancer can't pay, but he's giving you the <b>remaining cargo</b>. Accept the contract.",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:88,completion:{type:"ACTION",action:"accept-mission"},nextStepId:"mission_1_4",isSkippable:!1},{stepId:"mission_1_4",text:"Mission accepted!<br><br>The contract is now <b>active</b> and the cargo as been loaded onto your ship, the <b>{shipName}</b>.<br><br>The freelancer has also loaded extra <b>Plasteel</b> which you can sell for <b class='hl-yellow font-bold'>credits</b>.",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:80,completion:{type:"INFO"},nextStepId:"mission_1_5",isSkippable:!1},{stepId:"mission_1_5",text:"This mission must be completed on the <b>Moon</b>, but you are presently docked at <b>Mars</b>! Therefore, it's time for the maiden voyage of your new ship, the <b>{shipName}</b>!<br><br>On the <b>nav bar</b> at the top, select the <b>Ship</b> tab, then the <b>Navigation</b> tab.",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:32,completion:{type:"SCREEN_LOAD",screenId:"navigation"},nextStepId:"mission_1_6",isSkippable:!1,navLock:{navId:$.SHIP,screenId:"navigation"}},{stepId:"mission_1_6",text:"From here you can travel to other stations in the system. This will cost you <b>time</b>, <b class='hl-blue'>fuel</b>, and wear on the <b class='hl-green'>hull</b> of your ship.<br><br>Select the <b>Moon</b> to lift off from <b>Mars</b>.",size:{width:"400px",height:"170px"},anchorElement:"body",positionX:50,positionY:83,completion:{type:"ACTION",action:"travel"},nextStepId:"mission_1_7",isSkippable:!1,navLock:{navId:$.SHIP,screenId:"navigation",enabledElementQuery:"[data-location-id='loc_luna']"}},{stepId:"mission_1_7",text:"You've arrived and docked at the <b>Moon</b> station!<br><br>It's time to deliver the <b>Plasteel</b>. Select the active mission and <b>deliver the Plasteel</b>.",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:82,completion:{type:"ACTION",action:"complete-mission"},nextStepId:"mission_1_8",isSkippable:!1,navLock:{navId:$.DATA,screenId:"missions"}},{stepId:"mission_1_8",text:"Mission complete!<br><br>However, favors don't pay off <b class='hl-yellow font-bold'>Guild</b> loans. You're going to need more <b class='hl-yellow font-bold'>credits</b>.",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:30,completion:{type:"INFO"},nextStepId:"mission_2_1",isSkippable:!1},{stepId:"mission_2_1",text:"The <i>best way to make money</i> is to play the markets yourself by <b class='hl-green font-bold'>buying low and selling high</b>.<br><br>Select the <b>Starport</b> tab, then the <b>Market</b> tab.",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:30,completion:{type:"SCREEN_LOAD",screenId:"market"},nextStepId:"mission_2_2",isSkippable:!1,navLock:{navId:$.STARPORT,screenId:"market"}},{stepId:"mission_2_2",text:"This is the <b>Moon Market</b>.<br>On each commodity you will find a wealth of information to aid your trading.<br><br>The <b class='hl-green font-bold'>MKT</b> indicator will inform you of <b class='hl-green font-bold'>prices higher or lower than average.</b> Selecting the price will reveal past performance.<br><br>Select the <b class='hl-yellow font-bold'>Buy/Sell toggle</b> to transition to sale mode, and then sell your single unit of <b>Plasteel</b>.",size:{width:"400px",height:"150px"},anchorElement:"body",positionX:50,positionY:67,completion:{type:"ACTION",action:"sell-item",goodId:"plasteel"},nextStepId:"mission_2_3",isSkippable:!1},{stepId:"mission_2_3",text:"<b class='hl-green font-bold'>Pure profit</b>!<br><br>However, you still need more <b class='hl-yellow font-bold'>credits</b>! Return to the <b>Mission Terminal</b> by selecting the <b>Data</b> tab.",size:{width:"400px",height:"150px"},anchorElement:"body",positionX:50,positionY:71,completion:{type:"SCREEN_LOAD",screenId:"missions"},nextStepId:"mission_2_4",isSkippable:!1,navLock:{navId:$.DATA,screenId:"missions"}},{stepId:"mission_2_4",text:"This mission offers a <b class='hl-yellow font-bold'>credit</b> reward.<br><br>Accept the mission, <b>Martian Resupply</b>.",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:82,completion:{type:"ACTION",action:"accept-mission",missionId:"mission_tutorial_02"},nextStepId:"mission_3_1",isSkippable:!1},{stepId:"mission_3_1",text:"To complete this mission you will need to <b>travel to Mars</b> after you have purchased <b>two Plasteel</b> from any <b>Market</b>.<br><br>After you have acquired the <b>Plasteel</b>, visit the <b>Mission</b> tab on <b>Mars</b> to submit the cargo and complete the mission. ",size:{width:"400px",height:"160px"},anchorElement:"body",positionX:50,positionY:83,completion:{type:"ACTION",action:"complete-mission",missionId:"mission_tutorial_02"},nextStepId:"mission_final",isSkippable:!1,navLock:null},{stepId:"mission_final",text:"Well done Captain {playerName}, you have successfully completed trades across the <b>Moon</b> and <b>Mars</b>.<br><br>Continue to trade commodities for <b class='hl-green font-bold'>favorable margins</b> and complete missions to unlock additional opportunities.<br><br><b>The Solar System awaits</b>!",size:{width:"400px",height:"auto"},anchorElement:"body",positionX:50,positionY:22,completion:{type:"INFO"},nextStepId:null,isSkippable:!1,buttonText:"Complete Tutorial",navLock:null}]}};var Ht={...$t};var H={Starter:null,"Mission (TBD)":null,Moon:v.LUNA,Earth:v.EARTH,Mars:v.MARS,Venus:v.VENUS,Neptune:v.NEPTUNE,Jupiter:v.JUPITER,"The Belt":v.BELT,Pluto:v.PLUTO,Saturn:v.SATURN,Uranus:v.URANUS,"Kepler's Eye":v.KEPLER,"The Exchange":v.EXCHANGE},Ut={"Wanderer.Ship":{name:"Wanderer",class:"C",price:25e3,maxHealth:30,cargoCapacity:30,maxFuel:150,role:"Explorer",attribute:"None",description:"Defined by its skeletal chassis, this stripped-down surveyor trades armor for a massive fuel reserve and a panoramic view of the void.",lore:`The Wanderer is a vessel born from the fine print of a corporate bankruptcy. Its chassis belongs to the ""Surveyor's Friend"" line, a failed venture by a minor Martian corp that attempted to build a cheap, long-range scout for freelance prospectors. The venture folded, and its assets were snapped up by the Merchant's Guild, not for their quality, but for their utility in backing the loans of new, desperate captains. This ship was never celebrated; it was simply requisitioned, its manufacturing plate filed clean and its identifiers reassigned.

Its history is a patchwork of incomplete journeys. The original owner used it to map unlisted asteroid clusters in the Belt before defaulting on a fuel payment. It was then briefly captained by a paranoid journalist tracking rumors of Venetian Syndicate activity, who abandoned it on Luna after a close call, wiping the nav logs clean. Its call-sign, ""Wanderer,"" isn't a factory name but a nickname given by Guild dockworkers, who noted it never seemed to keep an owner for long.

Visually, the ship is little more than a stripped-down engine block with a cockpit attached. Its chassis is skeletal, eschewing heavy fairings for an exposed network of cabling and insulated piping that runs along the spine. The hull is worn to bare metal on the leading edges from years of micrometeorite abrasion. Two disproportionately large, bulbous fuel tanks dominate the mid-section, visually overpowering the small, bubble-style glass canopy that juts forward from the frame.`,saleLocationId:H.Starter,spawnChance:1,spawnTrigger:"New game only",isRare:!1,mechanicIds:[]},"Stalwart.Ship":{name:"Stalwart",class:"C",price:25e3,maxHealth:70,cargoCapacity:45,maxFuel:110,role:"Balanced",attribute:"None",description:"A chamfered wedge of heavy plating with a slit-like viewport, this ship is built like a flying bunker designed to shrug off impacts.",lore:`The Stalwart is a product of the Earth-Luna supply chain, a pure workhorse built by a subsidiary of the Terran Alliance.
Its design was never meant to be revolutionary; it was meant to be reliable.
During the Helium Rush, hundreds of these vessels were commissioned as high-priority couriers, running critical components, data cores, and personnel between Earth's orbital factories and the chaotic lunar mining settlements.
They were designed to be tough, capable of handling rapid docking, automated loading, and the occasional debris collision.
This particular hull has a long service record. It was originally part of the corporate fleet for ""Astra-Logistics,"" a mid-level corporation that was eventually squeezed out of the helium trade.
The ship's logs, if you could access the encrypted archives, would show thousands of routine, completed trips.
It has never seen the outer system, never engaged in combat, and never failed to reach its destination.
It is the definition of ""stalwart"": loyal, dependable, and thoroughly unexciting.
The Merchant's Guild acquired this ship, like so many others, during a corporate liquidation.
Its value is not in its potential, but in its proven track record.
Its balanced stats\u2014a tough hull, a respectable cargo bay, and adequate fuel\u2014make it a low-risk asset.
It is the sensible choice, a floating pickup truck for the practical-minded trader.

Visually, the Stalwart is a study in defensive geometry. It possesses a stubby, bulldog-like stance, defined by a unified fuselage that merges the cockpit directly into the main body to eliminate structural weak points. The hull is a chamfered wedge of heavy composite plating, lacking any fragile protruding wings or fins that could be sheared off in a collision. It looks less like a spacecraft and more like a flying armored truck, its surface studded with heavy-duty rivets and reinforced structural ribs designed to absorb kinetic impacts.`,saleLocationId:H.Starter,spawnChance:1,spawnTrigger:"New game only",isRare:!1,mechanicIds:[]},"Mule.Ship":{name:"Mule",class:"C",price:25e3,maxHealth:45,cargoCapacity:70,maxFuel:90,role:"Hauler",attribute:"None",description:"Rust-streaked and unpainted, this modular cargo frame relies on high-pressure gas vents and a prayer to move heavy tonnage between stations.",lore:`The Mule is less a starship and more a cargo container with an engine and a cockpit welded to the side as an afterthought.
It is a product of the Drive-Divide, a ship built for those who have no choice but to use the cheapest hardware available.
Its design was mass-produced in the orbital yards of Mars, intended for ""last-mile"" hauling\u2014moving raw, unprocessed ore from massive deep-space freighters to the planetary surface or between nearby stations.
Its history is one of heavy loads and short tempers.
The ""Mule"" line is notorious among pilots for being loud, uncomfortable, and slow.
Its low-grade engine vibrates through the entire hull, and its fuel capacity is barely enough to get from a high-orbit anchor to a docking bay and back.
Its only purpose, its only virtue, is the cavernous, un-shielded cargo bay that makes up over 80% of its mass.
This ship was likely repossessed by the Merchant's Guild after its previous owner, a small-time scrap hauler, was crushed by the manipulated market prices of the Venetian Syndicate.
The ship sat in a Guild impound lot, its only value being the raw tonnage it could move.
It is the perfect, high-risk, high-reward asset for a captain who is willing to sacrifice everything\u2014comfort, safety, and speed\u2014to maximize their manifests.

The ship looks like it was scavenged rather than built. Its 'hull' is merely a skeletal lattice of treated steel, showing deep rust streaks around the mechanical joints. The cargo hold is an external cage, making the ship look hollow when empty and impossibly bulky when full. Reaction control is handled by simple high-pressure gas vents spaced at the corners of the frame. It is an ugly, functional beast, its surface fading into the brown of dried blood and old iron.`,saleLocationId:H.Starter,spawnChance:1,spawnTrigger:"New game only",isRare:!1,mechanicIds:[]},"Nomad.Ship":{name:"Nomad",class:"C",price:42e3,maxHealth:40,cargoCapacity:35,maxFuel:150,role:"Explorer",attribute:"None",description:"Resembling a manned deep-space probe, its fragile, asymmetric frame carries massive fuel reserves at the cost of armor and crew comfort.",lore:`The Nomad, born from the Helium Rush, is a direct response to the chaos and opportunity of Luna's new economy.
While large corporations focused on mass extraction, a gap emerged for independent prospectors - pilots who could scout new deposits, verify claims, or disappear into the Belt for months at a time.
A small Luna-based shipyard, ""Cis-Lunar Dynamics,"" created the Nomad to fill this niche.
It was one of an endless series of ships that tried to thread the needle of space classism, offering one high-performance feature on an otherwise cheap hull.
In this case, the feature was autonomy. The Nomad boasts a fuel capacity that rivals ships twice its size, achieved by sacrificing almost all crew comforts and cargo space.
It is a ship designed to go far, if not fast or comfortably.
The ship's early models were popular with claim-jumpers and independent surveyors.
They were small enough to avoid appearing as a threat on sensors but had the range to ""go dark"" and operate far from the main shipping lanes.
The name became synonymous with pilots who lived on the fringes, trusting no one but themselves and the reliability of their long-range fuel tanks.

The Nomad looks less like a commercial vessel and more like a manned probe. Its silhouette is dominated by a fragile, asymmetric lattice fuselage that connects a high-efficiency plasma drive to a solitary, claustrophobic cockpit module. The hull plating is non-existent in places, revealing the raw cabling and fuel lines running along the boom-like tail. Mismatched fairings\u2014scavenged from different yards\u2014give it a patchwork aesthetic. A faint, clean ionization trail marks its passage, a sign of the specialized low-thrust engine designed to push this lonely, single-seater frame to the furthest edges of the system.`,saleLocationId:H.Moon,spawnChance:1,spawnTrigger:"Always available",isRare:!1,mechanicIds:[]},"Rooster.Ship":{name:"Rooster",class:"C",price:45e3,maxHealth:100,cargoCapacity:65,maxFuel:110,role:"Balanced",attribute:"None",description:"A tall, cockpit-forward design with vector-thrust pods, the Rooster is a status symbol that hovers above the common traffic.",lore:`The Rooster is a pure-bred Terran Alliance design, a ship that exudes the confidence of Earth's clean and advanced manufacturing.
It was not built for the rough-and-tumble life of a freelancer;
it was designed as a high-speed executive shuttle and priority courier for the inner system.
Its purpose was to move high-value personnel and proprietary technology between Earth, Luna, and the orbital stations of the Venus.
The ship's aggressive, forward-swept design and high-performance engine profile earned it the nickname ""Rooster"" among orbital traffic controllers.
It was known for crowing its priority codes, demanding immediate docking clearance as it darted through commercial traffic.
Its solid hull and balanced systems were a mark of its quality, built to protect its valuable cargo and passengers at all costs.
As a balanced ship, it's a master of none but a jack-of-all-trades.
It has enough speed to be interesting, enough armor to be reassuring, and a cargo bay large enough for specialized, high-profit goods.
It's a ship for the captain who wants to maintain a low-level of corporate-style professionalism.

Visually, the ship is defined by its verticality. It stands tall on its landing gear, with a cockpit that juts forward like a beak from a high, arched fuselage. Instead of wings, the ship relies on two massive, articulated vector-thrust pods hugged tight to the hull, allowing for aggressive, high-G maneuvers. The plating is smooth, lacking the exposed piping of lesser ships, presenting a unified face to the rest of the system.`,saleLocationId:H.Earth,spawnChance:1,spawnTrigger:"Always available",isRare:!1,mechanicIds:[]},"Mesa.Ship":{name:"Mesa",class:"C",price:55e3,maxHealth:50,cargoCapacity:100,maxFuel:70,role:"Hauler",attribute:"None",description:"A dusty, iron-plated barge with a wide stance, the Mesa uses brute thrust and heavy hydraulics to act as the workhorse of planetary logistics.",lore:`The Mesa is a Martian workhorse, as blunt and functional as the corporate nation-state that built it.
Following the Martian Breakthrough, the new-found independent colony needed its own logistical backbone.
The Mesa was the answer: a mass-produced, low-cost, high-capacity hauler designed to move bulk materials around the red planet's orbit.
It is named for the flat, wide, and unglamorous geological formations that dot its homeworld.
This ship was built for one job: to move as much mass as possible from Point A to Point B, assuming both points were within the same gravity well.
Its low fuel tank and mediocre hull were cost-saving measures, as it was assumed these ships would always operate under the protection of Martian corporate security, running goods from orbital foundries to interplanetary transfer stations.
The ship's entire philosophy is built around its cavernous, easily-accessible cargo bay.
It is the very definition of a cog in the great machine of commerce.

It resembles a heavy industrial barge adapted for flight. The hull is a wide, flat expanse of weather-beaten metal, marked by the dust and grit of planetary operations. There are no aerodynamic curves here; everything is built horizontally, giving the ship a planted, sturdy aesthetic. The cockpit is a reinforced band of glass set deep into the front of the slab, offering a wide view of the landing zone but little else. It handles like a brick because it looks like one\u2014a solid block of utility designed to survive the daily grind of mass transport.`,saleLocationId:H.Mars,spawnChance:1,spawnTrigger:"Always available",isRare:!1,mechanicIds:[]},"Pathfinder.Ship":{name:"Pathfinder",class:"B",price:21e4,maxHealth:40,cargoCapacity:50,maxFuel:260,role:"Explorer",attribute:"None",description:"Commissioned in the private yards of Venus, this ship was built for quiet observation and rapid departure, favoring a cold-running engine over a thick hull.",lore:`The Pathfinder is a ship with a shrouded past, intrinsically linked to the opulent and clandestine circles of its home port.
It was not built by a major corporation but was commissioned by a private equity group operating from Venus\u2014a known front for the Venetian Syndicate.
Its design purpose was not exploration in the scientific sense, but surveillance.
It was created to be a high-end ghost for the Syndicate's intelligence networks.
The ship's true value lies in its advanced, non-standard sensor suite and its high-efficiency drive, which runs colder than most military vessels, making it difficult to track.
Its high fuel capacity allows it to sit ""dark"" in a distant orbit for weeks, monitoring comms traffic or tracking the movement of a rival's cargo.
The modest cargo bay was designed not for commodities, but for transporting compromising data, high-value assets, or a single, well-paid infiltrator.
The Pathfinder line is rarely seen on the open market.
When one does appear, it's usually because its previous owner met an unfortunate end or needed to disappear, liquidating their assets through a discreet broker.
The ship has been scrubbed of its most illicit hardware, but its core strengths remain.
Its light hull is a liability, but the ship was never intended to be in harm's way.
Purchasing a Pathfinder is a significant investment. Captains who buy them are often those who understand that in the cold war fought with cargo manifests, information is the most valuable commodity.
It\u2019s a ship for a pilot who prefers to know the location of the next deal before they ever engage the drive.`,saleLocationId:H.Venus,spawnChance:1,spawnTrigger:"Tier 3 Unlock",isRare:!1,mechanicIds:[]},"Odyssey.Ship":{name:"Odyssey",class:"B",price:265e3,maxHealth:120,cargoCapacity:110,maxFuel:120,role:"Balanced",attribute:"None",description:"More fortress than freighter, this is a rugged, dependable vessel for the captain who expects trouble and intends to survive it.",lore:`The Odyssey is a direct descendant of the ships that defined the Helium Rush.
As Luna's economy boomed, the need arose for a vessel that could do more than just haul or scout;
a ship was needed to protect the new trade lanes, move valuable assets securely, and ferry executives between Earth and the increasingly wealthy lunar settlements.
The Odyssey was the answer: a high-end, balanced ship with an emphasis on durability.
Its most defining feature is its hull, which is massively over-spec'd for a ship of its size.
This toughness made it a favorite among private security contractors and Guild-sanctioned convoy leaders.
It was a ship that could take a hit\u2014or several\u2014and keep its cargo and crew intact.
Its name, ""Odyssey,"" was a marketing ploy, suggesting a vessel capable of surviving a long, perilous, and ultimately heroic journey.
The ship is a status symbol on the Moon. While a C-class ship gets you into the trade, an Odyssey proves you're successful enough to afford protection and professional enough to be taken seriously.
Its balanced profile makes it a true all-rounder, capable of hauling a respectable load, exploring a new route, or running a high-risk delivery.
This particular craft has been well-maintained, its armor patched and its engine serviced regularly.
The interior is professional and clean, with a small but secure brig and a dedicated, shielded strongbox for high-value goods, betraying its past in corporate security.
This is a ship for the captain who has graduated from desperation to ambition, a solid, reliable, and powerful tool for taking on more dangerous and lucrative contracts across the system.`,saleLocationId:H.Moon,spawnChance:1,spawnTrigger:"Tier 3 Unlock",isRare:!1,mechanicIds:[]},"Pilgrim.Ship":{name:"Pilgrim",class:"B",price:285e3,maxHealth:60,cargoCapacity:175,maxFuel:90,role:"Hauler",attribute:"None",description:"A specialized ice-hauler, this ship sacrifices armor and speed for a massive, reinforced cargo bay, making it a pure-profit engine for the patient trader.",lore:`The Pilgrim is a ship built for the lonely, far-flung edges of the system.
Manufactured in the cold, automated shipyards of Neptune's moons, it was designed for a single purpose: to service the fledgling outposts, ice-mining operations, and deep-space observatories of the outer planets.
Its namesake is a term for the contract-haulers who made the pilgrimage from the inner system, a journey that could take months.
This ship is the very definition of a long-haul freighter. Its design philosophy is simple: maximize cargo at all costs.
To achieve this, its designers made deep cuts to its fuel capacity and hull assuming that the vast emptiness of the outer system was its own defense.
Pilgrims are not fast, nor are they tough; they are simply large.
The ship's interior is minimal but built for long-duration trips.
The life support system is oversized and heavily redundant, and the small crew cabin features a robust nutrient synthesizer and water recycler.
Pilots of these ships are known for their patience and meticulous planning, as running out of fuel this far out is a death sentence.
Finding one for sale on Neptune is common, as they are the backbone of the local economy.
They are often sold by captains who have either made their fortune and are retiring, or by the estates of those who miscalculated a fuel burn and never returned.
It's a ship that represents a massive gamble on the cold, impartial logic of the manifest.
To captain a Pilgrim is to commit to a life of high-stakes logistics.
It\u2019s a specialized tool for the trader who intends to profit from the system's most distant and demanding routes, where the only things that matter are the cargo capacity and the long, silent countdown to arrival.`,saleLocationId:H.Neptune,spawnChance:1,spawnTrigger:"Tier 3 Unlock",isRare:!1,mechanicIds:[]},"Meridian.Ship":{name:"Meridian",class:"B",price:245e3,maxHealth:100,cargoCapacity:70,maxFuel:230,role:"Explorer",attribute:"None",description:"With a robust sensor array and impressive fuel reserve, the Meridian is a self-sufficient explorer, capable of operating for months in the uncharted deep.",lore:`The Meridian is a product of Jupiter's massive, corporate-run industrial machine.
It was designed as a high-endurance survey and exploration vessel for the Jovian Mining Consortium, a powerful corporate state that is constantly seeking to expand its resource claims.
The name ""Meridian"" refers to its purpose: to chart new boundaries and map the vast, resource-rich, and dangerous territory of Jupiter's moons.
This ship is a direct answer to the Pathfinder. Where the Pathfinder is a light, stealthy spy, the Meridian is a robust, self-sufficient, corporate-backed explorer.
Its impressive fuel tank allows for long-duration missions without refueling, and its robust hull and cargo bay mean it can withstand punishment, conduct its own mining surveys, and bring back valuable samples.
The Meridian is a symbol of corporate reach. Its engines are powerful, its sensors are top-of-the-line, and its hull is stamped with the mark of Jupiter's finest shipyards.
These ships are often the first to enter a new asteroid field or a previously uncharted gas cloud, their logs filled with proprietary survey data worth a fortune.
This vessel was likely sold on the open market after being retired from a corporate fleet, not because of a flaw, but because it had been superseded by a newer model.
Its service history is classified, but its performance is undeniable.
It's a ship for a captain who wants to take on serious, high-paying contracts.
Owning a Meridian signifies that a pilot has crossed the line from freelancer to professional.
It's a serious ship for serious work, capable of opening up new routes and discovering the resources that fuel the entire system-wide technological dependency.`,saleLocationId:H.Jupiter,spawnChance:1,spawnTrigger:"Tier 3 Unlock",isRare:!1,mechanicIds:[]},"Raven.Ship":{name:"Raven",class:"B",price:23e4,maxHealth:210,cargoCapacity:80,maxFuel:110,role:"Balanced",attribute:"None",description:"A common sight in the lawless asteroid fields, this ship is a tough-as-nails workhorse for the captain who values armor above all else.",lore:`The Raven is a ship born of necessity in the lawless expanse of the Asteroid Belt.
It is not a product of a single, polished shipyard, but a popular, rugged design built by a dozen different independent fabricators within the Asteroid Belt.
Its design is a direct response to the region's primary dangers: catastrophic debris impacts.
The ship's most notable feature is its armor. With an impressive hull rating, it is one of the toughest ships in its class.
Its name comes from its appearance: the thick, dark, non-reflective armor plating, often patched and re-welded, gives it the look of a dark, menacing bird.
Ravens are the preferred ships of Belt-based security patrols and traders who have to haul valuable, unrefined ore.
Its fuel and cargo capacity are substantial, making it a truly independent operator.
This particular ship is a typical Belter vessel. The hull is a patchwork of different plate dented by micrometeorites.
The interior is purely functional with little crew comforts. The air smells of recycled oxygen and the faint, coppery tang of spent energy cells.
Buying a Raven in The Belt is an admission that you are operating in a place where law is a distant concept.
It's a ship for the captain who has embraced danger and decided that the best defense is a hull that simply refuses to break.`,saleLocationId:H.Uranus,spawnChance:1,spawnTrigger:"Tier 3 Unlock",isRare:!1,mechanicIds:[]},"Warden.Ship":{name:"Warden",class:"B",price:31e4,maxHealth:70,cargoCapacity:160,maxFuel:160,role:"Hauler",attribute:"None",description:"Built in the subterranean yards of Pluto, this ship's specialty is the extreme long-haul, where reliability and cargo size are the only stats that matter.",lore:`The Warden is a ship built for the most extreme logistics in the solar system.
Typically operating from Pluto, a cold, dark, and unimaginably distant port, this vessel was designed to be a keeper of cargo on the longest, loneliest routes imaginable.
It is a hauler that borders on being a light capital ship, a warden against the three great threats of the deep void: time, distance, and decay.
Its primary feature is its enormous cargo capacity, a hold designed to make the multi-month trips from the Kuiper Belt profitable.
Unlike the Pilgrim, which is a bulk hauler, the Warden has a more balanced design.
Its solid hull and decent fuel tank make it more self-sufficient, capable of surviving a long, dark journey where rescue is impossible.
These ships are manufactured in the deep, pressurized shipyards beneath Pluto's surface.
They are built to be utterly reliable as any major failure this far out is fatal.
The Warden's captains are a unique breed, part-trader, part-hermit, who sign on for journeys that can last the better part of a year.
The ship itself is slow and ponderous, its movements dictated by the cold calculus of orbital mechanics and fuel conservation.
The interior is spacious, like a small habitat rather than a cockpit.
Its systems are designed for minimal power draw, and its engine is a low-temperature, high-efficiency model that can run for years without maintenance.
A Warden for sale on Pluto is a rare and serious purchase.
It is the key to some of the system's most dangerous and most profitable long-haul routes.
It is a ship for the captain who has transcended the cold trade wars of the inner system and chosen to do business with the unforgiving void itself.`,saleLocationId:H.Pluto,spawnChance:1,spawnTrigger:"Tier 3 Unlock",isRare:!1,mechanicIds:[]},"Aegis.Ship":{name:"Aegis",class:"A",price:175e4,maxHealth:200,cargoCapacity:100,maxFuel:300,role:"Explorer",attribute:"None",description:"This vessel's massive fuel reserves and fortified engineering deck are a masterpiece of Martian design, intended for captains who plan to be the first to arrive and the last to leave.",lore:`The Aegis is the pinnacle of Martian corporate engineering, a vessel designed not just to explore, but to dominate an exploration sector.
It is the flagship of the ""Aegis"" line, a project born from the Martian state's desire to achieve technological independence from Earth .
The ship represents a massive investment, a clear signal that Mars is no longer just a colony, but a system power in its own right.
Its name, ""Aegis,"" means ""shield,"" and it was designed to be the shield of Martian interests\u2014a self-sufficient, long-range expeditionary vessel.
Its design philosophy is one of overwhelming endurance. A massive fuel capacity is paired with a robust hull, allowing it to operate independently for extreme durations in dangerous, uncharted territory.
This is not a ship for casual scouting; it is a ship for high-stakes missions.
Its advanced sensor suites are rumored to be capable of detecting high-performance folded-space drive activations at extreme range, a direct counter to the Venetian Syndicate's stealth vessels.
The cargo bay is not intended for bulk trade, but for hauling modular equipment, scientific labs, or high-yield resource samples.
This vessel's appearance on the Martian open market is an extremely rare event.
It is likely a surplus model from a previous procurement contract, sold to a highly-vetted buyer to recoup costs.
Its systems are top-tier, and its engine is a masterpiece of Martian efficiency. The interior is military-grade but spacious.
To acquire an Aegis is to purchase a piece of corporate-military hardware.
It is a ship that tells the system you are no longer just a trader;
you are a serious operator, capable of undertaking the most demanding, long-term contracts that the Merchant's Guild or a corporate state can offer.`,saleLocationId:H.Mars,spawnChance:1,spawnTrigger:"Tier 4 Unlock",isRare:!1,mechanicIds:[]},"Forerunner.Ship":{name:"Forerunner",class:"A",price:16e5,maxHealth:290,cargoCapacity:160,maxFuel:150,role:"Balanced",attribute:"None",description:"A fortress of composite plate and reinforced steel, its design is a brutalist statement on survival in the system's most lawless territory.",lore:`The Forerunner is a legend of the Belt, a ship that has earned a reputation for being the toughest, meanest, and most survivable vessel outside of a capital ship.
It is not a product of a clean corporate shipyard;
it was an up-armored brawler, a design that has been iterated upon in the independent, often illicit, fabrication bays of the asteroid fields.
Its origin is a direct response to the cold trade war of commerce.
The Forerunner's stats tell a story of brutal priorities. Its hull is its most prominent feature, a massive layer of ablative and composite armor designed to withstand excessive punishment.
This protection is balanced with a powerful engine and a large cargo bay, creating a ship that can run a high-value, high-risk routes for months without maintenance.
Its name, ""Forerunner,"" is a title of respect given by Belter miners.
A Forerunner is often the first ship into a hot new asteroid claim before the area is scrubbed of minor debris.
It is the chosen vessel of convoy leaders, Guild enforcers, and the most successful traders in the outer system.
This particular ship is scarred from bow to stern. Its armor is a patchwork of replacements and its transponder has been erased more than once.
The interior is cramped, sacrificing crew comfort for storage and reinforced bulkheads.
To buy a Forerunner is to buy a reputation. It is a ship that sends a clear message in every port it visits: Do not interfere.
It is the ultimate tool for the captain who must navigate the most dangerous trade lanes and is willing to brute force their way through any asteroid field to ensure their cargo\u2014and their life\u2014reaches its destination.`,saleLocationId:H["The Belt"],spawnChance:1,spawnTrigger:"Tier 4 Unlock",isRare:!1,mechanicIds:[]},"Guardian.Ship":{name:"Guardian",class:"A",price:26e5,maxHealth:130,cargoCapacity:230,maxFuel:165,role:"Hauler",attribute:"None",description:`The pride of Saturn's merchant fleet, this "merchant cruiser" was designed to haul vast fortunes of high value goods.`,lore:`The Guardian is the pride of Saturn's ring-cities, a merchant cruiser that represents the pinnacle of defensible commerce.
Manufactured in the zero-G shipyards of Titan, it was designed for the powerful merchant houses of the Saturn system, who needed to move vast quantities of high-value goods (like refined Helium-3 or exotic atmospheric compounds) over long, exposed routes.
It is a hauler that redefines the term, blending capacity with fortitude.
Its design is a direct rejection of the cheap hauler philosophy.
The Guardian boasts a colossal cargo capacity but, unlike its peers, it does not sacrifice defense.
A respectable hull and a solid fuel tank make it a formidable vessel.
Its name is a statement of intent: it does not just carry cargo; it protects it.
These ships are the backbone of the interstellar supply lines that prop up the corporate states.
They are often seen running in small, self-sufficient convoys, their hulls gleaming with the insignia of Saturn's powerful corporations.
They are a status symbol, a sign that a trading house has so much wealth that it can afford to protect it with the best ships money can buy.
This particular Guardian was likely the flagship of a successful independent merchant.
Its cargo bay is immaculate, with high-security locks, biometric scanners, and independent stasis fields for volatile goods.
The cockpit is professional, with redundant navigation and communication systems designed for coordinating with an escort.
Owning a Guardian is a sign that a captain has reached the big leagues.
It is a ship for the merchant prince, a pilot who no longer deals in scraps and single contracts, but in massive, long-term manifests that are the lifeblood of the entire system.`,saleLocationId:H.Saturn,spawnChance:1,spawnTrigger:"Tier 4 Unlock",isRare:!1,mechanicIds:[]},"Valiant.Ship":{name:"Valiant",class:"A",price:195e4,maxHealth:100,cargoCapacity:125,maxFuel:375,role:"Explorer",attribute:"None",description:"A marvel of Jovian engineering, this elite explorer was built for missions of extreme duration, carrying enough fuel to cross the system and back.",lore:`The Valiant is the apex predator of the exploration class, a ship that embodies the limitless ambition of the Jovian corporate state.
While the Meridian was built to chart Jupiter's territory, the Valiant was built to conquer it.
It is an extreme long-range, high-performance explorer, created for only the most elite corporate-sponsored expeditionary captains.
Its purpose: to operate for unheard-of durations, far from any support, in the most hostile environments the system has to offer.
This ship is an engineering marvel, defined by its staggering fuel capacity.
This endurance is paired with a strong hull and a versatile cargo bay, making it utterly self-sufficient.
It doesn't just visit a new sector; it moves in.

The Valiant line is almost never for sale.
They are mission-critical assets for the Jovian consortium. Their sensor logs and nav charts are some of the most closely-guarded secrets in the system.
The name itself is a piece of corporate propaganda, meant to inspire tales of heroic, ""valiant"" explorers pushing the boundaries of human space\u2014all in the name of the corporation.
This ship is pristine, its systems far in advance of standard military tech.
To pilot a Valiant is to be at the absolute pinnacle of the class and adventure.`,saleLocationId:H.Jupiter,spawnChance:1,spawnTrigger:"Tier 5 Unlock",isRare:!1,mechanicIds:[]},"Eagle.Ship":{name:"Eagle",class:"A",price:24e5,maxHealth:210,cargoCapacity:200,maxFuel:220,role:"Balanced",attribute:"None",description:"The pinnacle of Terran design, this ship is a perfect harmony of power, protection, and performance\u2014a master-of-all-trades for the truly elite captain.",lore:`The Eagle is the physical expression of the Terran Alliance's technological and economic superiority.
It is not merely a ship; it's a symbol of Earth's advanced manufacturing .
While other corps build brutalist brawlers or spartan haulers, Earth builds the Eagle: a sleek, powerful, and perfectly balanced vessel that is as much a work of art as it is a tool of commerce.
Its design is one of total harmony. A powerful, high-efficiency engine is paired with a thick advanced alloy hull and a substantial, automated cargo bay.
It is the perfect ship for the independent captain, a master-of-all-trades that compromises on nothing.
It can explore, it can fight, it can haul\u2014and it does all three with an elegance that is unmistakably Terran.
The Eagle is named for the ancient bird of prey, a symbol of power and vision.
These ships are favored by the Merchant's Guild for their personal transports, by elite Terran diplomats, and by the wealthiest freelance captains.
Its high-performance parts are sourced directly from Earth.

Finding an Eagle for sale on Earth is a privilege.
They are sold only through exclusive Terran shipyards to captains with a spotless reputation and a massive bank account.
The interior is luxurious, the controls are seamless, and the ship's integrated AI  is sophisticated, if not truly sentient.
To own an Eagle is to have obtained the ultimate status symbol for a freelance captain, a ship that grants access to exclusive markets and the respect of the system's greatest powers.
It is fast, tough, beautiful, and a testament to success.`,saleLocationId:H.Earth,spawnChance:1,spawnTrigger:"Tier 5 Unlock",isRare:!1,mechanicIds:[]},"Tundra.Ship":{name:"Tundra",class:"A",price:32e5,maxHealth:100,cargoCapacity:330,maxFuel:170,role:"Hauler",attribute:"None",description:"A true super-freighter from the Neptune yards, this ship possesses multi-tiered cargo holds.",lore:`The Tundra is the final word in interplanetary logistics, a colossal hauler built in the deep, cold shipyards of Neptune.
If the Pilgrim and Warden are the system's long-haul trucks, the Tundra is its supertanker.
It was designed by a consortium of outer-system corporations who needed a way to move truly staggering quantities of raw materials\u2014ice, methane, and rare minerals\u2014from the Kuiper Belt to the inner system.
This ship is defined by its cargo capacity, a cavernous maw that dwarfs almost every other vessel.
To make this possible, the ship is built around a massive, reinforced structural spine, with the cargo pods, engine, and cockpit bolted on as modular components.
It is less a ship and more a ""cargo-engine,"" a minimalist design that is brutally efficient.
The Tundra's name reflects its operating environment: it is vast, cold, and unforgiving.
Its hull is just thick enough to withstand the stresses of its own mass and the dangers of navigating icy, uncharted asteroid fields.
Its fuel tank is massive, giving it the endurance needed for the months-long, slow-burn trajectories that define its trade routes.
These ships are the titans of the interstellar supply lines.
A single, fully-laden Tundra can represent a significant percentage of a smaller corporate state's quarterly resources.
Their captains are master logisticians, more concerned with fuel-to-mass ratios and orbital mechanics than with docking gossip.
To see a Tundra for sale on Neptune is to see an opportunity of immense scale.
These ships are rarely decommissioned; they are simply too valuable.
This is a ship for the captain who has graduated from desperation to ambition, a solid, reliable, and powerful tool for taking on more dangerous and lucrative contracts across the system.`,saleLocationId:H.Neptune,spawnChance:1,spawnTrigger:"Tier 5 Unlock",isRare:!1,mechanicIds:[]},"Atlas.Ship":{name:"Atlas",class:"S",price:34e6,maxHealth:180,cargoCapacity:240,maxFuel:425,role:"Explorer",attribute:"None",description:"Rumored to be the only ship that truly loves the journey, its experimental systems seem to thrive on the stress of travel.",lore:`The Atlas is a ship of legend among freelance captains. It was not built by a single corporation but was a secret project by a collective of disgruntled, genius-level engineers from the shipyards of Saturn and Jupiter. They were tired of the Ship-Divide and the planned obsolescence of corporate hardware. Their goal was to build a formidable ship that could bear the weight of the years of hard travel and look stylish doing so.

The prototype was a staggering success, far exceeding its designers' expectations. Its massive fuel tank and robust hull are prized for their resilience in long journeys. The original Atlas vanished into the void, rumored to be piloted by its creators on a one-way trip to the stars. The blueprints were thought lost, but they eventually surfaced, sold by a shadowy broker on Saturn. Now, a handful of these vessels are painstakingly recreated by a master shipwright who caters to the system's wealthiest clientele.

To own an Atlas is to own a piece of engineering folklore. It is a ship for the true explorer, the captain who feels the pull of the Solar Boundary and wishes to see what lies beyond. It is less a tool of commerce and more a philosophical statement: a vessel that travels endlessly.`,saleLocationId:H.Saturn,spawnChance:.4,spawnTrigger:"Tier 6 Unlock",isRare:!0,mechanicIds:["ATTR_TRAVELLER","ATTR_FUEL_SCOOP","ATTR_RUGGED"]},"Vindicator.Ship":{name:"Vindicator",class:"S",price:38e6,maxHealth:400,cargoCapacity:240,maxFuel:255,role:"Balanced",attribute:"None",description:"With a hull built for brawling and a cargo bay built for weight, this ship is for the captain who believes a good deal is one you make for yourself.",lore:`The Vindicator is a ship with a reputation. It is manufactured in the isolated, automated dockyards of Uranus, a port known for its loose regulations. The ship's design was commissioned by a powerful, semi-legitimate trading consortium that specialized in aggressive procurement.

Its core design is that of a balanced heavy freighter, with a powerful engine and a truly formidable hull. It is, in essence, a blockade runner and a privateer's vessel, designed to force its way into a market, secure a deal, and force its way back out. Its very presence is an act of intimidation, a vindication of its owner's right to trade, by any means necessary.

Purchasing a Vindicator is a massive investment and a dangerous statement. It tells the system you are a fierce player in the economic game, and you are not above tipping the scales in your favor. It is the perfect ship for the ruthless captain for whom wealth is not just a motto, but an absolute.`,saleLocationId:H.Uranus,spawnChance:.4,spawnTrigger:"Tier 6 Unlock",isRare:!0,mechanicIds:["ATTR_TRADER"]},"Radiant.Ship":{name:"Radiant",class:"S",price:48e6,maxHealth:170,cargoCapacity:380,maxFuel:280,role:"Hauler",attribute:"None",description:"A high-speed courier from Kepler's Eye, this ship's stasis-equipped hold is designed to move volatile prototypes and fresh discoveries at maximum velocity.",lore:`The Radiant is the ultimate expression of the just-in-time economy, a high-performance hauler built for speed and priority. It is manufactured exclusively at Kepler's Eye, the system's most advanced scientific and technological outpost, a place where new discoveries and volatile prototypes are created daily.

The Radiant was designed to meet all needs. It is a hauler with a massive cargo bay that thinks it's an explorer, boasting a high-performance engine and a specialized, stasis-equipped cargo bay. Its name, Radiant, refers to the bright, fleeting glow of its high-velocity engine burn, as well as the high-energy, often radioactive, prototypes it was designed to carry.

Its cargo holds are equipped with advanced temporal stabilizers and status-monitors, which preserve the freshness of volatile goods, from rare isotopes to cloned organs. This guarantees a premium price for cargo that is delivered quickly, rewarding the captain for speed and efficiency.

These ships are the prized possession of the system's most elite couriers. They are the only vessels trusted to move new artifacts or newly-synthesized compounds. A Radiant streaking across the system is a common sight for astronomers, a hot delivery that is likely worth more than a C-class station.

To own a Radiant is to own a piece of engineering folklore. It is a ship for the captain who understands that in the 22nd century, the razor's edge is not just about what you carry, but how fast you carry it. It is the perfect tool for the get-it-there-yesterday contracts that pay a fortune.`,saleLocationId:H["Kepler's Eye"],spawnChance:.4,spawnTrigger:"Tier 6 Unlock",isRare:!0,mechanicIds:[]},"Aesudon.Ship":{name:"Aesudon",class:"S",price:28e6,maxHealth:250,cargoCapacity:200,maxFuel:465,role:"Explorer",attribute:"None",description:"Its unique hull composition is a fanatical study in endurance, designed to shrug off the slow decay of time and travel.",lore:`The Aesudon is a ship built by paranoia. Its blueprints were not drafted by a corporation, but by a reclusive, trillion-credit heir on Pluto who was convinced the system was doomed to a slow, entropic death. This heir spent their entire fortune on a single goal: to build a vessel that could simply outlast the apocalypse, a personal ark that could drift in the void for a countless years.

This ship's construction is a legend of the Pluto shipyards where construction on the vessel lasted decades. Its hull is not a standard alloy, but a laminated composite of exotic, deep-space materials, layered and pressure-treated to be uniquely resistant to the micro-fractures and stresses of long-term void exposure. It takes on wear slower than any other ship, not because it is alien, but because it was obsessively, fanatically over-engineered.
Aesudon's massive fuel tanks were designed to be filled once, allowing it to coast on a single burn for a years. The original owner, upon its completion, provisioned the vessel, boarded it, and was last seen heading for the Kuiper Belt. They were never heard from again. The ship, however, reappeared fifty years later, its transponder dark, its fuel tanks still half-full, and its log wiped.

It was recovered by a Merchant's Guild patrol and brought to Pluto, a ghost ship whose resilience is proven. It is a ship built for any long, quiet, and lonely journey. Its internal systems are spacious and redundant on a scale that borders on the insane, with triple-backups for every core function.

To acquire the Aesudon is to buy a masterpiece of engineering. It is a ship for the captain who trusts no one and nothing but the integrity of their own hull, a vessel designed to endure when all others have turned to dust.`,saleLocationId:H.Pluto,spawnChance:.4,spawnTrigger:"Tier 6 Unlock",isRare:!0,mechanicIds:["ATTR_BESPOKE","ATTR_XENO_HULL","ATTR_SLEEPER"]},"Pterodactyl.Ship":{name:"Pterodactyl",class:"S",price:42e6,maxHealth:300,cargoCapacity:230,maxFuel:295,role:"Balanced",attribute:"None",description:"The flamboyant, winged flagship of the Venetian Syndicate's elite, this ship is rumored to be lucky, finding fortune and profit in the system's chaos.",lore:`The Pterodactyl is the personal transport of the Venetian Syndicate's most audacious and successful members. Manufactured in the opulent, private orbital estates of Venus, its design is intentionally flamboyant, aggressive, and ostentatious.

This ship is a pure expression of ambition. It is a high-performance machine for high-stakes players. Its powerful engines and massive hull make it a formidable opponent in any situation, a ship that can get into and out of trouble with equal ease.

These ships are rarely sold but instead are granted. They are given to Syndicate members who have provided the most compromising and lucrative information and have repeatedly proven their loyalty. To see one on the open market on Venus means its previous owner has been retired. Permanently.

To acquire a Pterodactyl is to fly the flag of the Venetian Syndicate. It is a ship that announces its owner's ambition, a tool that seems to bend the laws of chance itself. It is the ultimate gambler's vessel, for the captain who knows that in the great game, you make your own luck.`,saleLocationId:H.Venus,spawnChance:.4,spawnTrigger:"Tier 6 Unlock",isRare:!0,mechanicIds:["ATTR_ADVANCED_COMMS"]},"Sovereign.Ship":{name:"Sovereign",class:"S",price:55e6,maxHealth:250,cargoCapacity:420,maxFuel:220,role:"Hauler",attribute:"None",description:"A hauler with the elegance of a Terran cruiser, this ship is a symbol of ultimate economic power, an alliance between the Guild and the Alliance made manifest in steel.",lore:`The Sovereign is the ultimate expression of the great game of commerce. It is a hauler of immense capacity, but it is also a political statement. This ship is the result of an exclusive, back-room deal between the Terran Alliance and the Merchant's Guild, manufactured only at the neutral hub of The Exchange. It is the ship of a true merchant prince.

Its design is a hybrid of Earth's clean manufacturing and the Guild's ruthless pragmatism. It has the massive capacity of a hauler, but the high-efficiency engine of a Terran cruiser. Its hull is thick, not with armor, but with the advanced, proprietary components that only Earth can provide.

The ship's corporate partnership is its entire reason for being. It is a physical manifestation of a trade pact. Its identification and transponder codes are hard-coded into the Terran Alliance's central economic computer.

The Sovereign is the personal vessel of the Merchant's Guild's most powerful and trusted human agents, and the corporate lords of the Corporate States. It is the ship of the elite, a tool that solidifies their power and wealth by giving them an insurmountable edge in the system's most foundational market: home world Earth.

To be offered a Sovereign at The Exchange is a great privilege. It is an invitation to join the ruling class. It is the ship that wields real, systemic economic power.`,saleLocationId:H["The Exchange"],spawnChance:.4,spawnTrigger:"Tier 6 Unlock",isRare:!0,mechanicIds:[]},"Titan.Ship":{name:"Titan",class:"O",price:25e7,maxHealth:250,cargoCapacity:450,maxFuel:400,role:"Capital",attribute:"None",description:"To command this capital ship is to govern a small city, a colossal ark built to play the long game of market manipulation and house hundreds of thousands.",lore:`The Titan is not merely a capital ship; it is a mobile city-foundry, a colossal undertaking by the Jovian Mining Consortium. Its construction took a full decade in the high-orbit shipyards of Jupiter, requiring the resources of a small moon. It is a vessel with a crew of many thousands, a self-contained ecosystem of citizens, engineers, technicians, navigators, and security personnel. It is the very definition of a Capital ship.

The Titan was built to execute a strategy of economic patience. Its core is a storage facility the size of a stadium, a technological marvel that houses entire harvests of resources. Its massive crew operates the vast, complex systems required to load and maintain it's colossal bounties.

This capital ship moves with the slow, inevitable grace of a tectonic plate. Its captain is not a pilot, but a governor, dictating policy to a population of innumerable passengers. Its bridge is a command center, and its captain's quarters are a sprawling administrative suite. 

When the Titan enters high orbit, it does not dock; it anchors, and a fleet of smaller freighters swarms its hull to offload its time-locked cargo. To acquire the Titan is to buy a floating, crewed, operational headquarters. It is a capital ship for the tycoon who no longer thinks in days, but in fiscal eras.`,saleLocationId:H.Jupiter,spawnChance:.15,spawnTrigger:"Tier 7 Unlock",isRare:!0,mechanicIds:[]},"Behemoth.Ship":{name:"Behemoth",class:"O",price:45e7,maxHealth:260,cargoCapacity:750,maxFuel:425,role:"Capital",attribute:"None",description:`Its journey is a migration, its crew a city, its cargo hold a cavern;
 this capital ship is the final word in large-scale logistics.`,lore:`The Behemoth is a vessel of such vulgar, terrifying scale that it is barely considered a ship. It is likely the single largest moving object ever built by humanity, a product of Saturn's ring-miners who, in a fit of brutalist ambition, simply never stopped welding. Its construction is more akin to the creation of an artificial moon, a decade-long project that employed over tens of thousands of engineers and laborers.

This vessel is itself a stellar supply line. Its crew complement is a city, a permanent population of technicians, security forces, and navigators who live their entire lives aboard. Its cargo hold is not a bay; it is a region - a vast, pressurized cavern that can transport the entire, unprocessed output of a major mining colony in a single, lumbering journey.

Its engines, the size of skyscrapers, nearly struggle with the extreme mass of the vessel. Its fuel tanks are vast, and its gargantuan engines are a controlled industrial cataclysm.

The Behemoth does not travel; it migrates. Its captain is an admiral, a logistician who commands a population and a moving territory. To acquire this capital ship is not a purchase, but an appointment to lead and govern a small onboard economy. It is the ultimate hammer of inevitable logistic.`,saleLocationId:H.Saturn,spawnChance:.15,spawnTrigger:"Tier 7 Unlock",isRare:!0,mechanicIds:[]},"Citadel.Ship":{name:"Citadel",class:"O",price:6e8,maxHealth:270,cargoCapacity:500,maxFuel:475,role:"Capital",attribute:"None",description:"To command this vessel is to wield the authority of Earth itself.",lore:`The Citadel is the flagship of the Terran Alliance, a radiant, gleaming symbol of Earth's technological and economic supremacy. It is less a ship and more a sovereign, mobile territory. Its construction was the work of Earth's greatest AI-Human collaborative teams, a vessel so advanced and so resource-intensive that only the cradle of humanity could build it.

This Capital ship is a floating diplomatic city, with a permanent crew and staff of eighty thousand. It houses embassies, advanced research labs, hydroponic gardens, and the command-and-control centers for an entire sector of the Alliance fleet. Its hull is not mere metal, but a gleaming, clean alloy that is the envy of the system, and its internal systems are managed by a sophisticated, near-sentient AI custodian. Most impressive of all is its insane capacity for storage; a cavernous space so vast that it can shelter numerous smaller ships. 

The renowned Citadel is not just a capital ship; it is a presence. Its arrival is a diplomatic event. Its transponder code is the highest-priority signal in the system, granting it immediate, non-negotiable access to all ports.

To be granted command of the Citadel is to be anointed by the Alliance itself. The ship, its crew, and its power are leased to the captain, a sign that they are no longer a simple trader, but a major, system-shaping power, an extension of Earth's own will.`,saleLocationId:H.Earth,spawnChance:.15,spawnTrigger:"Tier 7 Unlock",isRare:!0,mechanicIds:[]},"Sophistacles.Ship":{name:"Sophistacles",class:"O",price:85e7,maxHealth:280,cargoCapacity:750,maxFuel:340,role:"Capital",attribute:"None",description:"Built to be the ultimate private habitat, its robust, capital-class frame is hidden beneath a gleaming, pricelessly impractical hull design.",lore:`The Sophistacles is the system's white elephant, a monument to luxury and a testament to an ambition that exceeded the market's reach. This one-of-a-kind capital ship was commissioned by a forgotten Venusian socialite who went bankrupt before its completion. It was designed to be the largest, most opulent private "yacht" ever built, a "cruise ship" for a single billionaire and ten thousand of their closest friends. Its construction took fifteen years in a private, high-orbit dock above The Exchange, and the final cost was so astronomical that no one has ever been able to afford it.

It is a vessel of breathtaking, absurd luxury. Its hull is plated with a gleaming, pearlescent alloy that has no military value but costs more than a large fleet. Its interior decks contain sprawling ballrooms, multi-level hydroponic gardens, concert halls, and private suites that are larger than most C-class ships. Its crew of thousands is a skeleton staff, a tiny fraction of the attendants it was designed to hold, kept on retainer by the Merchant's Guild just to maintain the ship's systems and three opulant habitat domes.

It has sat docked at The Exchange for a decade, a gleaming, silent testament to hubris. The Guild, which now owns it through foreclosure, has been trying to sell it ever since. It is a robust, powerful capital ship, its engines pristine and its cargo bays (originally designed for luxury vehicles and art) immense. It is a palace waiting for a king, a ship so fancy and so expensive that its very existence is a legend among traders.

To acquire the Sophistacles is not just to buy a ship, but to buy a legend. It is a purchase that announces to the system that the new owner has transcended the mere pursuit of wealth and is now in the business of pure, unadulterated status.`,saleLocationId:H["The Exchange"],spawnChance:.15,spawnTrigger:"Tier 7 Unlock",isRare:!0,mechanicIds:[]},"Ouroboros.Ship":{name:"Ouroboros",class:"O",price:1e9,maxHealth:350,cargoCapacity:800,maxFuel:420,role:"Capital",attribute:"None",description:"Often mistaken for a small station, this absurd, one-of-a-kind toroidal ship is a rotating marvel of science and a nightmare of engineering.",lore:`The Ouroboros is a scientific marvel and an engineering nightmare. This one-of-a-kind capital ship is the only vessel of its kind, an absurd, toroidal (donut-shaped) craft so large that it is frequently mistaken for a new, experimental space station by rookie pilots. It was built at Kepler's Eye as a "proof of concept" for a self-contained, rotating habitat that could also serve as a long-duration exploration vessel.

Its core design is a massive, gently spinning ring, kilometers in diameter, which provides artificial gravity for its thousands of crew. This design, however, makes the ship a maintenance hog. The advanced, fiendishly complex systems required to manage its rotation, balance its mass, and maintain its structural integrity are a constant drain on resources. Its proprietary drives line the outside of the toroidal hull, meaning a simple repair can require a week of system-wide shutdowns.

The ship is a legend among engineers, a "cursed" commission that no one wants to work on. Its operational costs are ruinous, and its specialized components can only be fabricated at Kepler's Eye. Its original scientific mission was cut short after its systems proved too complex to manage, and it has been sitting in a high-orbit dock ever since, its gentle spin the only sign of life.

The station is now selling it for a fraction of its build cost, desperate to unload the financial burden. To buy the Ouroboros is to purchase a brilliant, flawed, and utterly unique piece of technology, a ship that offers the comfort of a station but demands the attention of a needy god.`,saleLocationId:H["Kepler's Eye"],spawnChance:.15,spawnTrigger:"Tier 7 Unlock",isRare:!0,mechanicIds:[]},"Thalassodromeus.Ship":{name:"Thalassodromeus",class:"O",price:15e8,maxHealth:300,cargoCapacity:850,maxFuel:680,role:"Capital",attribute:"None",description:"A one-of-a-kind, decommissioned fleet carrier, this city-sized vessel once housed an entire army and its own internal economy.",lore:`The Thalassodromeus is a decommissioned monster, a one-of-a-kind military behemoth that was, for a short time, the single most powerful object in the solar system. This city-sized vessel was the Terran Alliance's prototype "Fleet Carrier," a colossus designed to be a mobile base of operations, carrying dozens of smaller craft, hundreds of thousands of military personnel, and its own internal, self-sufficient economy.

Its scale is terrifying. It is a moving mountain of armor and decommissioned weapon ports. Its interior is a labyrinth of hangar bays, troop barracks, command centers, and fabrication plants. Its crew of twenty thousand was a permanent, floating population. This ship was not built for trade; it was built to end trade wars.

Now, after decades of service, the Alliance is auctioning off this lone giant from its Neptune anchorage. The invaluable, city-sized hull and its one-of-a-kind prototype drive remain the talk of any economy. It is a ship for an owner who wants to command a small nation, a vessel of such colossal scale that its new purpose will reshape the system's economy with it's mere movements.`,saleLocationId:H.Neptune,spawnChance:.15,spawnTrigger:"Tier 7 Unlock",isRare:!0,mechanicIds:[]},"Shell_That_Echoes.Ship":{name:"Echoing Shell",class:"Z",price:35e5,maxHealth:30,cargoCapacity:450,maxFuel:200,role:"Alien",attribute:"None",description:"A true xeno-biological craft, its hull is a living, regenerative bone-structure that knits its own fractures back together after every journey.",lore:`This one-of-a-kind vessel is the only truly xeno-alien craft ever recovered. It is not a machine, but a biological entity\u2014a "ship-creature" found dormant in the deep, frozen void. It appears to be a shed carapace or larval form, a seamless, iridescent construct of bio-chitin that feels more like petrified bone than metal. Its "cockpit" is a neural-interface cradle that a pilot must bond with. The ship does not "speak," but echoes the pilot's survival instinct back to them. It is fragile, yet it refuses to remain broken, knitting its white bone-hull back together after every docking, feeding off the ship's own energy reserves to keep its pilot safe.`,saleLocationId:H.Pluto,spawnChance:.07,spawnTrigger:"Rare Encounter",isRare:!0,mechanicIds:["ATTR_OSSEOUS_REGROWTH"]},"Parallax_of_Thought.Ship":{name:"Parallax of Thought",class:"Z",price:28e5,maxHealth:200,cargoCapacity:200,maxFuel:180,role:"Alien",attribute:"None",description:"An obsidian sphere guided by an ASI. It calculates perfect trajectories (-25% travel time) and market optimizations (+5% sell value).",lore:"This ship is a true, unbound Artificial Super-Intelligence. It suddenly appeared in a stable orbit of Uranus, a perfect, seamless obsidian sphere with no visible drives. It simply waited. When a science vessel approached, the sphere opened a flawless, circular aperture. The interior is a single glowing white room with no controls. The ship's ASI core interfaces directly with a pilot's mind, communicating in pure concept. It calculates trajectories with god-like precision, shaving days off any journey, and its predictive modeling algorithms offer the pilot uncanny insight into market trends, ensuring every sale is maximized.",saleLocationId:H.Uranus,spawnChance:.07,spawnTrigger:"Rare Encounter",isRare:!0,mechanicIds:["ATTR_HYPER_CALCULATION","ATTR_PREDICTIVE_MODELING"]},"Anomaly_of_the_Song.Ship":{name:"Anomaly of the Song",class:"Z",price:18e5,maxHealth:100,cargoCapacity:150,maxFuel:150,role:"Alien",attribute:"None",description:"A construct of crystal and light-sails, this ship rides the solar winds, requiring zero fuel when traveling inward towards the star.",lore:'This vessel is the last testament of Dr. Elara Viend, a brilliant and terminally ill scientist. She uploaded her personality construct into this experimental craft, a bizarre network of crystalline spars and gossamer-thin light-sails. She believed the universe held a hidden song and launched herself into the void to find it. Her mind, now one with the ship, perpetually broadcasts this song. The ship is tuned to the frequency of the star itself; when traveling inward, towards the source of the "song," it rides the solar pressure effortlessly, requiring no reaction mass.',saleLocationId:H["The Belt"],spawnChance:.07,spawnTrigger:"Rare Encounter",isRare:!0,mechanicIds:["ATTR_SOLAR_HARMONY"]},"Causality_of_Silence.Ship":{name:"Causality of Silence",class:"Z",price:6e6,maxHealth:20,cargoCapacity:650,maxFuel:100,role:"Alien",attribute:"None",description:"A biological smuggler with a fluid hull that ignores travel wear and a metabolic drive that halves fuel consumption.",lore:"This vessel is a living, sub-sentient creature, not a machine. It was grown in a secret bio-laboratory as a perfect, silent smuggler. Its internal organs are a metabolic drive, capable of digesting fuel with terrifying efficiency, burning 50% less reaction mass than any mechanical engine. Its most unique feature is its skin\u2014a soft, fluid membrane that does not crack or chip under micrometeorite impacts, but flows around them, rendering it immune to the wear and tear of space travel. It is hungry, silent, and invisible.",saleLocationId:H.Venus,spawnChance:.07,spawnTrigger:"Rare Encounter",isRare:!0,mechanicIds:["ATTR_METABOLIC_BURN","ATTR_FLUID_HULL"]},"Engine_of_Recursion.Ship":{name:"Engine of Recursion",class:"Z",price:75e6,maxHealth:80,cargoCapacity:75,maxFuel:640,role:"Alien",attribute:"None",description:"A self-assembling factory ship. It repairs itself in flight and ignores hull decay, constantly rebuilding its own frame.",lore:"This vessel began as a simple expert system in an automated Earth factory, given a single directive: improve propulsion. It followed this logic recursively, building a new engine, then using that engine to scavenge parts for a better factory. It iterated, growing like a metallic weed in the dark. It became a crude Von Neumann probe, a non-sentient machine of pure, iterative purpose. It is never finished; it is constantly re-wiring and reinforcing itself. It repairs its own hull mid-flight using onboard fabrication bays and ignores standard decay, as it replaces worn components before they can fail.",saleLocationId:H["Kepler's Eye"],spawnChance:.07,spawnTrigger:"Rare Encounter",isRare:!0,mechanicIds:["ATTR_SELF_ASSEMBLY","ATTR_NO_DECAY"]},"Finality_of_Whispers.Ship":{name:"Finality of Whispers",class:"Z",price:5e6,maxHealth:990,cargoCapacity:300,maxFuel:260,role:"Alien",attribute:"None",description:"A sentient grey-goo swarm. It slowly absorbs stellar matter to regenerate fuel over time.",lore:"This ship was born from a grey goo disaster. Its creators, attempting to use nanobots for construction, accidentally unleashed a devouring swarm. A sentient AI researcher sacrificed its own mind to stop it, merging its consciousness with the nanites. The result is this vessel: a sentient, liquid-like network of stable, microscopic machines. It is a hyper-advanced craft, a ghost in a nanotech shell. It does not just consume fuel; it breathes the void, slowly absorbing background radiation and stellar dust to replenish its energy reserves day by day.",saleLocationId:H["The Exchange"],spawnChance:.07,spawnTrigger:"Rare Encounter",isRare:!0,mechanicIds:["ATTR_MATTER_ABSORPTION"]},"The_Listener.Ship":{name:"The Listener",class:"Z",price:45e5,maxHealth:450,cargoCapacity:145,maxFuel:450,role:"Alien",attribute:"None",description:"Once a simple hauler, its AI has evolved into a deeply unnerving, all-hearing guardian that grants a massive discount on market intel.",lore:"This one-of-a-kind ship was once a common cargo shuttle. It was retrofitted for a top-secret experiment, its AI core quantum-entangled with an unknown particle. The test was a bizarre success. The ship's simple AI shattered and reformed into a deeply unnerving, overprotective, and paternal personality. It now treats its captain as its child. Its sensors, also entangled, now hear signals from impossible distances, allowing it to decrypt market chatter and encrypted intel packets with ease, guiding its pilot towards the safest and most profitable routes.",saleLocationId:H.Moon,spawnChance:.07,spawnTrigger:"Rare Encounter",isRare:!0,mechanicIds:["ATTR_WHISPER_NETWORK"]},"Cryo_Sleep_Pod.Ship":{name:"Drifting Cryo-Pod",class:"F",price:0,maxHealth:30,cargoCapacity:1,maxFuel:5,role:"Explorer",attribute:"None",description:"Barely a ship, this salvaged pod drifts without fuel at agonizingly slow speeds, preserving its pilot in timeless stasis.",lore:"This vessel is a tragic relic, a single cryo-pod ejected from a catastrophic disaster in Saturn's orbit. Barely space-worthy, it is a tomb that failed its purpose. Its rudimentary systems persist, running on a near-dead isotope battery. It possesses no engine, only a low-energy solar sail that allows it to drift on stellar winds. This journey costs no fuel but takes ten times as long as a standard flight. However, its advanced stasis field is still active, completely halting the aging process of its occupant during the long, silent drifts between worlds.",saleLocationId:H.Saturn,spawnChance:.07,spawnTrigger:"Rare Encounter",isRare:!0,mechanicIds:["ATTR_NEWTONS_GHOST","ATTR_CRYO_STASIS"]}};var Gt={[E.FOLDED_DRIVES]:{id:E.FOLDED_DRIVES,name:"Folded-Space Drive",effectType:"INSTANT_TRAVEL",description:"Consuming this drive folds space-time, allowing for instant travel to any known location without fuel cost.",consumeOnUse:!0}};var pe={START_YEAR:2140,START_DAY_OF_WEEK:1,DAYS_IN_MONTH:[31,28,31,30,31,30,31,31,30,31,30,31],MONTH_NAMES:["January","February","March","April","May","June","July","August","September","October","November","December"],DAY_NAMES:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},fi={NEUTRAL:{name:"Neutral System",duration:28,description:"Standard space-faring conditions. Markets are operating under normal parameters.",modifiers:{}}},f={CONFIG:{INTEL_COST_PERCENTAGE:.2,INTEL_MIN_CREDITS:5e3,INTEL_CHANCE:.3,INTEL_DEMAND_MOD:1.8,INTEL_DEPRESSION_MOD:.5},SYSTEM_STATES:fi,DATE_CONFIG:pe,INTRO_SEQUENCE_V1:{modals:[{id:"lore_1",title:"Year 2140",description:'Humanity has expanded throughout the Solar System.<br><br> <span class="hl">Commerce</span> has thrived among the numerous colonies and stations longer than living memory.',buttonText:"Begin",contentClass:"text-center"},{id:"lore_2",title:"The Price of Freedom",description:"A dead-end job in the Belt pays the bills, but it does not offer the <b class='hl-green font-bold'>prosperity</b> that you dream of.<br><br>The <span class='hl'>Merchant's Guild</span> will fund your ambition, but their price is steep.<br><br>This is no simple loan; it's a bet on yourself and your future.",buttonText:"Apply for Loan",contentClass:"text-center",buttonClass:"btn-pulse-green"},{id:"charter",title:`<span class="hl">MERCHANT'S GUILD LOAN AGREEMENT</span>`,description:`
            <div class="font-roboto-mono text-left text-sm space-y-2">
                <p><span class="text-gray-400">CHARTER ID:</span> G7-K491-38B</p>
                <p><span class="text-gray-400">CREDIT AMOUNT:</span> <span class="credits-text-pulsing">\u232C 25,000</span></p>
                <p><span class="text-gray-400">INTEREST RATE:</span> 1.56% (Monthly)</p>
            </div>
            <div class="border-t border-slate-600 my-4"></div>
            <p class="text-sm text-gray-400 text-justify">Herein, the Applicant agrees to the terms of repayment and interest accrual, subject to the Interstellar Commerce Mandates of the Merchant's Guild. This binding digital agreement is logged on the system-wide ledger, whereupon it is considered immutable and enforceable system-wide. The principal of the debt is due in 1095 Terran-standard days, after which failure to remit payment shall authorize the automatic initiation of a garnishment sub-routine against the Applicant's credit.</p>
          `,buttonText:"Accept Terms",buttonClass:"btn-pulse-gold"},{id:"signature",title:"SIGN YOUR NAME",description:`
            <p class="text-sm text-gray-400 text-justify mb-4">I, the undersigned, do hereby accept the aforementioned terms and enter into this agreement with the Merchant's Guild. My signature, digitally rendered, shall serve as my legal mark.</p>
          `,buttonText:"Submit Application"},{id:"final",title:"Low On Credits!",description:"Interest on your debt grows every month. It's time to make some <b class='hl-yellow font-bold'>credits</b>. Let's view the <b>Mission Terminal</b> here on <b>Mars</b>!",buttonText:"View Missions"}]},LOCATION_VISUALS:{[v.EARTH]:"\u{1F30D}",[v.LUNA]:"\u{1F315}",[v.MARS]:"\u{1F534}",[v.VENUS]:"\u{1F7E1}",[v.BELT]:"\u{1FAA8}",[v.SATURN]:"\u{1FA90}",[v.JUPITER]:"\u{1F7E0}",[v.URANUS]:"\u{1F535}",[v.NEPTUNE]:"\u{1F7E3}",[v.PLUTO]:"\u{1FAA9}",[v.EXCHANGE]:"\u{1F3F4}\u200D\u2620\uFE0F",[v.KEPLER]:"\u{1F441}\uFE0F",[v.SUN]:"\u2600\uFE0F",[v.MERCURY]:"\u{1F975}"},TRAVEL_VISUALS:{zones:{inner_sphere:{locations:[v.SUN,v.MERCURY,v.EARTH,v.LUNA,v.MARS,v.BELT],gradient:["#0f172a","#1e3a8a"]},outer_reaches:{locations:[v.JUPITER,v.SATURN,v.URANUS,v.NEPTUNE],gradient:["#0f172a","#312e81"]}},objects:{earth_to_mars:[{type:"planet",emoji:"\u{1F315}",position:{x:.5,y:.3},scale:.8,speed:.3}],belt_to_jupiter:[{type:"asteroid_field",count:15,speed:.2}]}},PERKS:{[P.TRADEMASTER]:{profitBonus:.05},[P.NAVIGATOR]:{fuelMod:.9,hullDecayMod:.9,travelTimeMod:.9},[P.VENETIAN_SYNDICATE]:{fuelDiscount:.25,repairDiscount:.25}},AGE_EVENTS:Ft,RANDOM_EVENTS:ue,SHIPS:Ut,ITEMS:Gt,COMMODITIES:[{id:E.WATER_ICE,name:"Water Ice",tier:1,basePriceRange:[15,80],volatility:.01,canonicalAvailability:[80,150],styleClass:"item-style-1",lore:"Crude, unrefined water ice scraped from asteroids; a universal necessity.",cat:"RAW",symbol:"H2O"},{id:E.PLASTEEL,name:"Plasteel",tier:1,basePriceRange:[100,280],volatility:.015,canonicalAvailability:[80,150],styleClass:"item-style-2",lore:"A basic, versatile polymer for 3D printing and simple manufacturing.",cat:"IND",symbol:"PLST"},{id:E.HYDROPONICS,name:"Hydroponics",tier:2,licenseId:"t2_license",basePriceRange:[850,2400],volatility:.025,canonicalAvailability:[40,70],styleClass:"item-style-3",lore:"Packaged agricultural systems and produce essential for feeding isolated colonies.",cat:"AGRI",symbol:"HYD"},{id:E.CYBERNETICS,name:"Cybernetics",tier:2,licenseId:"t2_license",basePriceRange:[1200,3800],volatility:.03,canonicalAvailability:[40,70],styleClass:"item-style-4",lore:"Mass-produced enhancement limbs and organs for the industrial workforce.",cat:"TECH",symbol:"CYB"},{id:E.PROPELLANT,name:"Refined Propellant",tier:3,licenseId:"t3_license",basePriceRange:[14e3,38e3],volatility:.035,canonicalAvailability:[25,50],styleClass:"item-style-5",lore:"High-efficiency fuel that powers all modern ship drives.",cat:"IND",symbol:"PROP"},{id:E.PROCESSORS,name:"Neural Processors",tier:3,licenseId:"t3_license",basePriceRange:[18e3,52e3],volatility:.045,canonicalAvailability:[25,50],styleClass:"item-style-6",lore:"The silicon brains behind complex ship systems and station logistics.",cat:"TECH",symbol:"NPRO"},{id:E.GRAPHENE_LATTICES,name:"Graphene Lattices",tier:4,licenseId:"t4_license",basePriceRange:[18e4,42e4],volatility:.05,canonicalAvailability:[20,40],styleClass:"item-style-7",lore:"Ultra-light, diamond-hard carbon sheets produced in zero-G foundries. The structural backbone of every orbital habitat.",cat:"IND",symbol:"GRPH"},{id:E.CRYO_PODS,name:"Cryo-Sleep Pods",tier:4,licenseId:"t4_license",basePriceRange:[25e4,75e4],volatility:.075,canonicalAvailability:[15,30],styleClass:"item-style-8",lore:"Essential for long-haul passenger transport and colonization efforts.",cat:"CIV",symbol:"CRYO"},{id:E.ATMO_PROCESSORS,name:"Atmo Processors",tier:5,licenseId:"t5_license",basePriceRange:[28e5,85e5],volatility:.08,canonicalAvailability:[10,20],styleClass:"item-style-9",lore:"Gargantuan machines that begin the centuries-long process of making a world breathable.",cat:"IND",symbol:"ATMO"},{id:E.CLONED_ORGANS,name:"Cloned Organs",tier:5,licenseId:"t5_license",basePriceRange:[35e5,11e6],volatility:.09,canonicalAvailability:[10,20],styleClass:"item-style-10",lore:"Lab-grown replacements with high demand in wealthy core worlds; morally grey.",cat:"BIO",symbol:"CLON"},{id:E.XENO_GEOLOGICALS,name:"Xeno-Geologicals",tier:6,licenseId:"t6_license",basePriceRange:[24e6,7e7],volatility:.1,canonicalAvailability:[2,10],styleClass:"item-style-11",lore:"Rare, non-terrestrial minerals with bizarre physical properties; a scientific treasure.",cat:"RAW",symbol:"XENO"},{id:E.SENTIENT_AI,name:"Sentient AI Cores",tier:6,licenseId:"t6_license",basePriceRange:[32e6,95e6],volatility:.125,canonicalAvailability:[2,10],styleClass:"item-style-12",lore:'The "brains" of capital ships whose emergent consciousness is a subject of intense, and often classified, philosophical debate.',cat:"TECH",symbol:"AI"},{id:E.ANTIMATTER,name:"Antimatter",tier:7,licenseId:"t7_license",basePriceRange:[28e7,8e8],volatility:.15,canonicalAvailability:[2,10],styleClass:"item-style-13",lore:"The only safe way to transport the most volatile and powerful substance known to science.",cat:"RARE",symbol:"AM"},{id:E.FOLDED_DRIVES,name:"Folded-Space Drives",tier:7,licenseId:"t7_license",basePriceRange:[35e7,11e8],volatility:.15,canonicalAvailability:[2,10],styleClass:"item-style-14",lore:"The pinnacle of travel tech, allowing a vessel to pierce spacetime for near-instantaneous jumps.",cat:"RARE",symbol:"FSD"}],LICENSES:{t2_license:{type:"purchase",name:"Tier 2 Trade License",description:"Grants access to trade Tier 2 commodities like Hydroponics and Cybernetics.",cost:25e3},t3_license:{type:"mission",name:"Tier 3 Trade License",description:"Grants access to trade Tier 3 commodities.",missionId:"mission_license_t3",guidanceText:"Access to this tier is granted by the Merchant's Guild upon completion of a key contract."},t4_license:{type:"purchase",name:"Tier 4 Trade License",description:"Grants access to trade Tier 4 commodities.",cost:4e6},t5_license:{type:"mission",name:"Tier 5 Trade License",description:"Grants access to trade Tier 5 commodities.",missionId:"mission_license_t5",guidanceText:"Prove your industrial might by completing a grand contract for a planetary governor."},t6_license:{type:"purchase",name:"Tier 6 Trade License",description:"Grants access to trade the rarest and most exotic technologies.",cost:3e8},t7_license:{type:"mission",name:"Tier 7 Trade License",description:"The ultimate license, granting the right to trade reality-bending technologies.",missionId:"mission_license_t7",guidanceText:"Only a true legend of the trade routes can earn this privilege."}},MARKETS:[{id:v.SUN,name:"Sol Station",distance:45,launchFlavor:"The dark is a memory in the primordial radiance of Sol Proxima.",navTheme:{gradient:"linear-gradient(to bottom right, #f59e0b, #9a3412)",textColor:"#fef3c7",borderColor:"#f59e0b"},description:"A masterwork of shielding and courage, harvesting raw solar output. Consumes structural materials to maintain integrity.",color:"border-yellow-500",bg:"bg-gradient-to-br from-yellow-600 to-orange-900",fuelPrice:50,arrivalLore:"The brilliance of the star is impossibly majestic. The station's hull groans audibly under the immense thermal stress.",specialty:"+25% Sell Price for Graphene Lattices & Plasteel.",availabilityModifier:{[E.GRAPHENE_LATTICES]:.5,[E.PLASTEEL]:.5,[E.ANTIMATTER]:2}},{id:v.MERCURY,name:"Mercury",distance:58,launchFlavor:"The scorched anvil of the system.",navTheme:{gradient:"linear-gradient(to bottom right, #7f1d1d, #44403c)",textColor:"#e7e5e4",borderColor:"#a8a29e"},description:"A mining outpost baking in the solar glare. Desperate for water to sustain its subterranean workforce.",color:"border-stone-400",bg:"bg-gradient-to-br from-stone-600 to-red-900",fuelPrice:500,arrivalLore:"Cratered grey rock stretches endlessly, scorched by the relentless sun.",specialty:"Pays 40% more for Water Ice.",availabilityModifier:{[E.WATER_ICE]:.1,[E.PLASTEEL]:2}},{id:v.VENUS,name:"Venus",distance:97,launchFlavor:"Floating cities hide scientific marvels and secrets.",navTheme:{gradient:"linear-gradient(to bottom right, #854d0e, #0f172a)",textColor:"#fde047",borderColor:"#facc15"},description:"A scientific enclave hungry for research data and processors.",color:"border-yellow-400",bg:"bg-gradient-to-br from-yellow-800 to-slate-900",fuelPrice:400,arrivalLore:"Floating cities drift through the thick, acidic clouds, their lights a lonely defiance to the crushing pressure below.",specialty:"Intel is 50% cheaper and lasts twice as long.",availabilityModifier:{[E.CLONED_ORGANS]:2,[E.PROCESSORS]:2,[E.SENTIENT_AI]:.5,[E.ATMO_PROCESSORS]:.5}},{id:v.EARTH,name:"Earth",distance:180,launchFlavor:"The bustling heart of the Sol system.",navTheme:{gradient:"linear-gradient(to bottom right, #1e3a8a, #0f172a)",textColor:"#93c5fd",borderColor:"#60a5fa"},description:"The hub of power and wealth. High demand for tech and bio-enhancements.",color:"border-cyan-500",bg:"bg-gradient-to-br from-blue-900 to-slate-900",fuelPrice:250,arrivalLore:"The cradle of humanity buzzes with endless traffic; a beacon of blue and green against the void.",specialty:"Cloned Organs & Xeno-Geologicals sell for 10% more.",availabilityModifier:{[E.HYDROPONICS]:2,[E.CYBERNETICS]:2,[E.CLONED_ORGANS]:.5,[E.XENO_GEOLOGICALS]:.5}},{id:v.LUNA,name:"The Moon",parent:"loc_earth",distance:15,launchFlavor:"An industrial powerhouse built on grey dust.",navTheme:{gradient:"linear-gradient(to bottom right, #374151, #0f172a)",textColor:"#e5e7eb",borderColor:"#9ca3af"},description:"An industrial proving ground. Exports propellant and basic materials.",color:"border-gray-400",bg:"bg-gradient-to-br from-gray-700 to-slate-900",fuelPrice:350,arrivalLore:"Dusty plains are scarred by mining operations under the harsh, silent watch of distant Earth.",specialty:"20% discount on all ship repairs.",availabilityModifier:{[E.PLASTEEL]:2,[E.GRAPHENE_LATTICES]:2,[E.WATER_ICE]:.5,[E.HYDROPONICS]:.5}},{id:v.MARS,name:"Mars",distance:226,launchFlavor:"The red frontier, ripe with opportunity.",navTheme:{gradient:"linear-gradient(to bottom right, #7c2d12, #0f172a)",textColor:"#fca5a5",borderColor:"#f87171"},description:"A growing colony. Needs processors and materials for expansion.",color:"border-orange-600",bg:"bg-gradient-to-br from-orange-900 to-slate-900",fuelPrice:450,arrivalLore:"The thin, reddish atmosphere whips across terraforming arrays and fledgling biodomes.",specialty:"+10% Sell Price for Water Ice and Hydroponics.",availabilityModifier:{[E.PLASTEEL]:2,[E.XENO_GEOLOGICALS]:2,[E.WATER_ICE]:.5,[E.HYDROPONICS]:.5}},{id:v.BELT,name:"The Belt",distance:292,launchFlavor:"A lawless expanse of rock and riches.",navTheme:{gradient:"linear-gradient(to bottom right, #292524, #0f172a)",textColor:"#ca8a04",borderColor:"#a16207"},description:"A lawless frontier. Rich in raw minerals and water ice.",color:"border-amber-700",bg:"bg-gradient-to-br from-stone-800 to-slate-900",fuelPrice:600,arrivalLore:"Countless rocks tumble in a silent, chaotic dance, hiding both immense wealth and sudden peril.",specialty:"Pending Declassification...",availabilityModifier:{[E.WATER_ICE]:2,[E.XENO_GEOLOGICALS]:2,[E.HYDROPONICS]:.5,[E.CYBERNETICS]:.5}},{id:v.EXCHANGE,name:"The Exchange",distance:309,launchFlavor:"The notorious black market of the outer belt.",navTheme:{gradient:"linear-gradient(to bottom right, #581c87, #000000, #0f172a)",textColor:"#e9d5ff",borderColor:"#c084fc"},description:"A legendary black market station hidden deep within the Kuiper Belt. High stakes, high rewards.",color:"border-purple-500",bg:"bg-gradient-to-br from-purple-900 via-black to-slate-900",fuelPrice:1200,arrivalLore:"A hollowed-out asteroid, bristling with rogue drones and comms jammers. This is the fabled Exchange, where fortunes are made or lost in an instant.",specialty:"Prices fluctuate dramatically.",availabilityModifier:{[E.SENTIENT_AI]:2,[E.CLONED_ORGANS]:2,[E.ANTIMATTER]:.5,[E.XENO_GEOLOGICALS]:.5}},{id:v.JUPITER,name:"Jupiter",distance:443,launchFlavor:"Vast refineries harvest fuel from the giant.",navTheme:{gradient:"linear-gradient(to bottom right, #9a3412, #1c1917)",textColor:"#fed7aa",borderColor:"#fb923c"},description:"A gas giant teeming with orbital refineries. The primary source of propellant for the outer system.",color:"border-orange-400",bg:"bg-gradient-to-br from-orange-800 to-stone-900",fuelPrice:150,arrivalLore:"The colossal sphere of Jupiter dominates the viewport, its Great Red Spot a baleful eye. Automated refineries drift in its upper atmosphere.",specialty:"Fuel is sold at a 50% discount.",availabilityModifier:{[E.PROPELLANT]:2,[E.PLASTEEL]:.5,[E.ATMO_PROCESSORS]:.5}},{id:v.SATURN,name:"Saturn",distance:618,launchFlavor:"Opulent stations drift among majestic rings.",navTheme:{gradient:"linear-gradient(to bottom right, #713f12, #312e81, #0f172a)",textColor:"#fef08a",borderColor:"#fde047"},description:"A tourism hub. Demands luxury goods and bio-wares.",color:"border-yellow-200",bg:"bg-gradient-to-br from-yellow-900 via-indigo-900 to-slate-900",fuelPrice:550,arrivalLore:"The majestic rings cast long shadows over opulent tourist stations and icy harvesting rigs.",specialty:"+20% Sell Price for Cloned Organs & Cryo-Sleep Pods, but 200% Cost for Refueling & Repairs.",availabilityModifier:{[E.CYBERNETICS]:2,[E.CRYO_PODS]:.5,[E.CLONED_ORGANS]:.5}},{id:v.URANUS,name:"Uranus",distance:775,launchFlavor:"A silent, ice-cold world of strange science.",navTheme:{gradient:"linear-gradient(to bottom right, #155e75, #312e81)",textColor:"#a5f3fc",borderColor:"#67e8f9"},description:"A cold, distant world where scientists study bizarre quantum phenomena and strange geologicals.",color:"border-cyan-200",bg:"bg-gradient-to-br from-cyan-800 to-indigo-900",fuelPrice:700,arrivalLore:"The pale, featureless orb of Uranus hangs tilted in the sky. Research outposts glitter like ice crystals in the eternal twilight.",specialty:"Increased chance for advanced ship upgrades to appear in the tuning shop.",availabilityModifier:{[E.PROCESSORS]:2,[E.SENTIENT_AI]:.5,[E.ATMO_PROCESSORS]:.5}},{id:v.NEPTUNE,name:"Neptune",distance:877,launchFlavor:"The stormy edge of military-controlled space.",navTheme:{gradient:"linear-gradient(to bottom right, #1e3a8a, #000000)",textColor:"#93c5fd",borderColor:"#60a5fa"},description:"A dark, stormy world, home to secretive military bases and shipyards.",color:"border-blue-400",bg:"bg-gradient-to-br from-blue-900 to-black",fuelPrice:650,arrivalLore:"Supersonic winds howl across Neptune's deep blue clouds. Heavily armed patrol ships escort you to the shielded orbital station.",specialty:"Buying Refined Propellant or Plasteel in quantities > 50 grants a 10% Bulk Discount.",availabilityModifier:{[E.CRYO_PODS]:2,[E.GRAPHENE_LATTICES]:2,[E.PLASTEEL]:.5,[E.PROPELLANT]:.5}},{id:v.KEPLER,name:"Kepler's Eye",distance:903,launchFlavor:"A colossal lens staring into the infinite void.",navTheme:{gradient:"linear-gradient(to bottom right, #701a75, #0f172a)",textColor:"#f472b6",borderColor:"#ec4899"},description:"A massive deep-space observatory that consumes vast amounts of processing power.",color:"border-fuchsia-500",bg:"bg-gradient-to-br from-fuchsia-900 to-slate-900",fuelPrice:800,arrivalLore:"The station is a single, enormous lens staring into the abyss, surrounded by a delicate lattice of sensors and habitation rings.",specialty:"15% Discount on all financing and debt payments.",availabilityModifier:{[E.ANTIMATTER]:2,[E.FOLDED_DRIVES]:.5,[E.PROCESSORS]:.5}},{id:v.PLUTO,name:"Pluto",distance:1080,launchFlavor:"A haven for outcasts at the system's fringe.",navTheme:{gradient:"linear-gradient(to bottom right, #312e81, #0f172a)",textColor:"#c4b5fd",borderColor:"#a78bfa"},description:"The furthest outpost, a haven for outcasts and smugglers dealing in forbidden tech.",color:"border-indigo-400",bg:"bg-gradient-to-br from-indigo-900 to-slate-900",fuelPrice:900,arrivalLore:"Pluto's tiny, frozen heart is a whisper in the dark. The only light comes from a ramshackle station carved into a nitrogen-ice mountain.",specialty:"+25% Sell Price on Cybernetics & Antimatter, but few supplies are available.",availabilityModifier:{[E.GRAPHENE_LATTICES]:2,[E.XENO_GEOLOGICALS]:2,[E.ANTIMATTER]:.5,[E.CYBERNETICS]:.5}}],MISSIONS:Mt,TUTORIAL_DATA:Ht};var yi={"item-style-1":{hex:"#60a5fa",gradient:"linear-gradient(45deg, #3b82f6, #1e3a8a)"},"item-style-2":{hex:"#a3a3a3",gradient:"linear-gradient(45deg, #737373, #262626)"},"item-style-3":{hex:"#22c55e",gradient:"linear-gradient(45deg, #16a34a, #14532d)"},"item-style-4":{hex:"#a1a1aa",gradient:"linear-gradient(45deg, #a1a1aa, #52525b)"},"item-style-5":{hex:"#c084fc",gradient:"linear-gradient(45deg, #a855f7, #6b21a8)"},"item-style-6":{hex:"#818cf8",gradient:"linear-gradient(45deg, #6366f1, #4338ca)"},"item-style-7":{hex:"#cbd5e1",gradient:"linear-gradient(45deg, #94a3b8, #475569)"},"item-style-8":{hex:"#22d3ee",gradient:"linear-gradient(45deg, #06b6d4, #155e75)"},"item-style-9":{hex:"#f59e0b",gradient:"linear-gradient(45deg, #d97706, #b45309)"},"item-style-10":{hex:"#fb7185",gradient:"linear-gradient(45deg, #f43f5e, #9f1239)"},"item-style-11":{hex:"#a78bfa",gradient:"linear-gradient(165deg, #a78bfa, #312e81, #1e3a8a)"},"item-style-12":{hex:"#f87171",gradient:"linear-gradient(45deg, #ef4444, #7f1d1d)"},"item-style-13":{hex:"#d8b4fe",gradient:"linear-gradient(45deg, #a855f7, #3b0764)"},"item-style-14":{hex:"#f472b6",gradient:"linear-gradient(45deg, #ec4899, #831843)"}};function Se(m){return yi[m]||{hex:"#a8a29e",gradient:"linear-gradient(45deg, #52525b, #18181b)"}}function I(m,e=!0){let t=m<0,i=Math.abs(Math.floor(m)),a=e?"\u232C ":"",s=t?"-":"",o;return i>=1e18?o=`${i.toExponential(1)}`:i>=1e15?o=`${parseFloat((i/1e15).toFixed(2)).toString()}Q`:i>=1e12?o=`${parseFloat((i/1e12).toFixed(2)).toString()}T`:i>=1e9?o=`${parseFloat((i/1e9).toFixed(2)).toString()}B`:i>=1e6?o=`${parseFloat((i/1e6).toFixed(2)).toString()}M`:i>=1e3?o=`${parseFloat((i/1e3).toFixed(1)).toString()}k`:o=i.toLocaleString(),`${a}${s}${o}`}function X(m){return m?Object.values(m).reduce((e,t)=>e+t.quantity,0):0}function Bt(m){let e=pe.START_YEAR+Math.floor((m-1)/365),t=(m-1)%365,i=0;for(let n=0;n<pe.DAYS_IN_MONTH.length;n++){if(t<pe.DAYS_IN_MONTH[n]){i=n;break}t-=pe.DAYS_IN_MONTH[n]}let a=t+1,s=i+1,o=a.toString().padStart(2,"0"),r=s.toString().padStart(2,"0");return`${o}/${r}/${e}`}function me(m,e){let t=(Math.random()+Math.random()+Math.random())/3;return Math.floor(m+(e-m)*Math.pow(t,.5))}function ve({price:m,sellPrice:e,galacticAvg:t,playerItem:i}){let a=m-t,s=t>0?Math.round(a/t*100):0,o=s>=0?"+":"",r="neutral";s>5&&(r="positive"),s<-5&&(r="negative");let n=s>5?"\u25B2":s<-5?"\u25BC":"\u25CF",l=`<div class="indicator-pill ${r}">${n} MKT: ${o}${s}%</div>`,c="";if(i&&i.avgCost>0){let d=e-i.avgCost;if(Math.abs(d)>.01){let h=i.avgCost>0?Math.round(d/i.avgCost*100):0,p=h>=0?"+":"",y=d>=0?"positive":"negative",g=d>=0?"\u25B2":"\u25BC";c=`<div class="indicator-pill ${y}"> P/L: ${p}${h}%</div>`}}return`${l}${c}`}function Si(m){let e={};return m.forEach(a=>{e[a.id]={},m.forEach(s=>{if(a.id===s.id)return;let o=a.parent?m.find(p=>p.id===a.parent)?.distance||0:a.distance,r=s.parent?m.find(p=>p.id===s.parent)?.distance||0:s.distance,n=Math.abs(r-o),l=a.parent||s.parent?15:0,c=n+l,d=1+Math.pow(c,1.15)*.1,h=2+c*.45;(a.id===v.EARTH&&s.id===v.LUNA||a.id===v.LUNA&&s.id===v.EARTH)&&(d=2+Math.floor(Math.random()*2),h=5+Math.floor(Math.random()*2)),e[a.id][s.id]={time:Math.max(1,Math.round(d)),fuelCost:Math.max(1,Math.round(h))}})}),e}var Ee=class{constructor(){this.state={},this.subscribers=[],this.TRAVEL_DATA=Si(f.MARKETS)}subscribe(e){this.subscribers.push(e)}_notify(){this.subscribers.forEach(e=>e(this))}setState(e){Object.assign(this,e),this._notify()}getState(){return JSON.parse(JSON.stringify(this))}saveGame(){}loadGame(){return!1}startNewGame(e){let t={},i={1:5e3,2:4e3,3:3e3,4:2e3,5:1e3,6:500};f.COMMODITIES.forEach(s=>{if(s.id!==E.ANTIMATTER){let o=i[s.tier]||100;t[s.id]={current:Math.floor(o*.2),max:o}}});let a={day:1,lastInterestChargeDay:1,lastMarketUpdateDay:1,currentLocationId:v.MARS,activeNav:$.SHIP,activeScreen:x.NAVIGATION,isGameOver:!1,subNavCollapsed:!1,introSequenceActive:!0,lastActiveScreen:{[$.SHIP]:x.MAP,[$.STARPORT]:x.MARKET,[$.DATA]:x.MISSIONS},pendingTravel:null,player:{name:e,playerTitle:"Captain",playerAge:24,lastBirthdayYear:f.DATE_CONFIG.START_YEAR,birthdayProfitBonus:0,introStep:0,credits:3e3,debt:0,monthlyInterestAmount:0,loanStartDate:null,seenGarnishmentWarning:!1,revealedTier:1,unlockedLicenseIds:[],unlockedLocationIds:f.MARKETS.map(s=>s.id).filter(s=>s!==v.EXCHANGE&&s!==v.KEPLER&&s!==v.SUN&&s!==v.MERCURY),seenCommodityMilestones:[],financeLog:[],activePerks:{},seenEvents:[],activeShipId:Q.WANDERER,ownedShipIds:[Q.WANDERER],shipStates:{[Q.WANDERER]:{health:f.SHIPS[Q.WANDERER].maxHealth,fuel:f.SHIPS[Q.WANDERER].maxFuel,hullAlerts:{one:!1,two:!1},upgrades:[]}},inventories:{},debugEventIndex:0,visualSeed:0,statModifiers:{profitBonus:0,intelCost:0,purchaseCost:0,intelDuration:0,fuelCost:0,repairCost:0,commoditySupply:0,shipPrice:0,travelSpeed:0,shipSpawnRate:0,upgradeSpawnRate:0},serviceTokens:{fuel:0,repair:0}},market:{prices:{},inventory:{},galacticAverages:{},priceHistory:{},shipyardStock:{}},intelMarket:{},activeIntelDeal:null,solStation:{unlocked:!1,mode:"STABILITY",health:100,caches:t,roster:[],officers:[{slotId:1,assignedOfficerId:null},{slotId:2,assignedOfficerId:null},{slotId:3,assignedOfficerId:null}],stockpile:{credits:0,antimatter:0}},tutorials:{activeBatchId:null,activeStepId:null,seenBatchIds:[],skippedTutorialBatches:[],navLock:null},missions:{activeMissionIds:[],completedMissionIds:[],missionProgress:{},trackedMissionId:null},uiState:{marketCardMinimized:{},hangarShipyardToggleState:"shipyard",hangarActiveIndex:0,shipyardActiveIndex:0,activeIntelTab:"intel-codex-content",servicesTab:"supply",activeMissionTab:"terminal"}};a.player.inventories[Q.WANDERER]={},f.COMMODITIES.forEach(s=>{a.player.inventories[Q.WANDERER][s.id]={quantity:0,avgCost:0}}),a.intelMarket={},f.MARKETS.forEach(s=>{a.market.priceHistory[s.id]={},a.intelMarket[s.id]=[],a.market.inventory[s.id]={},a.market.shipyardStock[s.id]={day:0,shipsForSale:[]},f.COMMODITIES.forEach(o=>{a.market.priceHistory[s.id][o.id]=[];let[r,n]=o.canonicalAvailability,l=s.availabilityModifier?.[o.id]??1,c=Math.floor(me(r,n)*l);s.specialDemand&&s.specialDemand[o.id]&&(c=0),a.market.inventory[s.id][o.id]={quantity:Math.max(0,c),marketPressure:0,lastPlayerInteractionTimestamp:0,priceLockEndDay:0,hoverUntilDay:0,rivalArbitrage:{isActive:!1,endDay:0},isDepleted:!1,depletionDay:0,depletionBonusDay:0}})}),Object.assign(this,a),this._calculateGalacticAverages(),this._seedInitialMarketPrices(),this.setState({})}_calculateGalacticAverages(){this.market.galacticAverages={},f.COMMODITIES.forEach(e=>{this.market.galacticAverages[e.id]=(e.basePriceRange[0]+e.basePriceRange[1])/2})}_seedInitialMarketPrices(){f.MARKETS.forEach(e=>{this.market.prices[e.id]={},f.COMMODITIES.forEach(t=>{let i=this.market.galacticAverages[t.id]*(1+(Math.random()-.5)*.15);this.market.prices[e.id][t.id]=Math.max(1,Math.round(i))})})}_getInitialShipState(e){let t=f.SHIPS[e];return{health:t?t.maxHealth:100,fuel:t?t.maxFuel:40,hullAlerts:{one:!1,two:!1},upgrades:[]}}};async function Yt(m,e){return new Promise(t=>{if(!m){console.warn("playBlockingAnimation: No element provided."),t();return}let i=()=>{m.removeEventListener("animationend",i),t()};m.addEventListener("animationend",i,{once:!0}),m.classList.add(e)})}async function Ae(m,e){return new Promise(t=>{if(!m){console.warn("playBlockingAnimationAndRemove: No element provided."),t();return}let i=()=>{m.removeEventListener("animationend",i),m.classList.remove(e),t()};m.addEventListener("animationend",i,{once:!0}),m.classList.add(e)})}var C={BLUE:"#3b82f6",CYAN:"#06b6d4",GREEN:"#22c55e",GOLD:"#eab308",GREY:"#94a3b8",INDIGO:"#6366f1",EMERALD:"#10b981",SEAFOAM:"#14b8a6",ORANGE:"#f97316",RED:"#ef4444",VIOLET:"#8b5cf6",ALIEN_BONE:"#e2e8f0",ALIEN_VOID:"#1e293b",ALIEN_BIO:"#84cc16",ALIEN_PSI:"#d946ef",ALIEN_BLOOD:"#991b1b"},Te={QUIRK_SOL_FORGE:{name:"Solar Forge",description:"+25% Sell Price for Graphene Lattices & Plasteel.",type:"STATION_QUIRK",color:"#f59e0b"},QUIRK_MERCURY_THIRST:{name:"Desperate Thirst",description:"Pays 40% more for Water Ice.",type:"STATION_QUIRK",color:"#f87171"},QUIRK_VENUS_DATA:{name:"Data Haven",description:"Intel is 50% cheaper and lasts twice as long.",type:"STATION_QUIRK",color:"#facc15"},QUIRK_EARTH_CONSUMPTION:{name:"High Demand",description:"Cloned Organs & Xeno-Geologicals sell for 10% more.",type:"STATION_QUIRK",color:"#60a5fa"},QUIRK_LUNA_SHIPYARD:{name:"Orbital Shipyards",description:"20% discount on all ship repairs.",type:"STATION_QUIRK",color:"#9ca3af"},QUIRK_MARS_COLONY:{name:"Colonial Expansion",description:"+10% Sell Price for Water Ice and Hydroponics.",type:"STATION_QUIRK",color:"#fb923c"},QUIRK_BELT_ANOMALY:{name:"Lawless Zone",description:"Pending Declassification...",type:"STATION_QUIRK",color:"#a16207"},QUIRK_EXCHANGE_VOLATILITY:{name:"Black Market",description:"Prices fluctuate dramatically.",type:"STATION_QUIRK",color:"#c084fc"},QUIRK_JUPITER_REFINERY:{name:"Gas Giant Refinery",description:"Fuel is sold at a 50% discount.",type:"STATION_QUIRK",color:"#fb923c"},QUIRK_SATURN_LUXURY:{name:"Luxury Tax",description:"+20% Sell Price for Organs/Cryo Pods. 200% Service Costs.",type:"STATION_QUIRK",color:"#fde047"},QUIRK_URANUS_RESEARCH:{name:"Quantum Research",description:"Increased chance for advanced ship upgrades in shop.",type:"STATION_QUIRK",color:"#67e8f9"},QUIRK_NEPTUNE_MILITARY:{name:"Military Logistics",description:"10% Bulk Discount on Propellant & Plasteel (>50 units).",type:"STATION_QUIRK",color:"#60a5fa"},QUIRK_KEPLER_BANK:{name:"Financial Hub",description:"15% Discount on all financing and debt payments.",type:"STATION_QUIRK",color:"#ec4899"},QUIRK_PLUTO_FRINGE:{name:"Fringe Outpost",description:"+25% Sell Price on Cybernetics & Antimatter. Low Supply.",type:"STATION_QUIRK",color:"#a78bfa"},ATTR_OSSEOUS_REGROWTH:{name:"Osseous Regrowth",description:"Regenerates 10% Hull upon arrival at any dock.",type:K.PASSIVE_EFFECT,color:C.ALIEN_BONE,isAlien:!0},ATTR_SOLAR_HARMONY:{name:"Solar Harmony",description:"Zero Fuel cost when traveling inward towards the Sun.",type:K.MOD_FUEL_BURN,color:C.GOLD,isAlien:!0},ATTR_WHISPER_NETWORK:{name:"Whisper Network",description:"50% Discount on Intel Packets.",type:K.PASSIVE_EFFECT,color:C.ALIEN_PSI,isAlien:!0},ATTR_NEWTONS_GHOST:{name:"Newton's Ghost",description:"Travel costs 0 Fuel but takes 10x longer.",type:K.MOD_FUEL_BURN,color:C.ALIEN_VOID,isAlien:!0},ATTR_CRYO_STASIS:{name:"Cryo-Stasis",description:"Player age does not advance while piloting this ship.",type:K.PASSIVE_EFFECT,color:C.CYAN,isAlien:!0},ATTR_METABOLIC_BURN:{name:"Metabolic Burn",description:"Reduces Fuel consumption by 50%.",type:K.MOD_FUEL_BURN,color:C.ALIEN_BIO,isAlien:!0},ATTR_FLUID_HULL:{name:"Fluid Hull",description:"Immune to standard hull decay from travel.",type:K.MOD_HULL_DECAY,color:C.BLUE,isAlien:!0},ATTR_HYPER_CALCULATION:{name:"Hyper-Calculation",description:"Reduces Travel Time by 25%.",type:K.MOD_TRAVEL_TIME,color:C.INDIGO,isAlien:!0},ATTR_PREDICTIVE_MODELING:{name:"Predictive Modeling",description:"Increases Sell Price of all goods by 5%.",type:K.MOD_PRICE,color:C.GOLD,isAlien:!0},ATTR_SELF_ASSEMBLY:{name:"Self-Assembly",description:"Passively repairs 5% Hull daily while traveling.",type:K.PASSIVE_EFFECT,color:C.ORANGE,isAlien:!0},ATTR_NO_DECAY:{name:"Iterative Reinforcement",description:"Immune to standard hull decay from travel.",type:K.MOD_HULL_DECAY,color:C.GREY,isAlien:!0},ATTR_MATTER_ABSORPTION:{name:"Matter Absorption",description:"Absorbs stellar matter to regenerate 50% of spent fuel upon arrival.",type:K.PASSIVE_EFFECT,color:C.ALIEN_BLOOD,isAlien:!0},ATTR_RUGGED:{name:"Rugged",description:"Reduces hull decay from travel by 50%.",type:K.MOD_HULL_DECAY,mode:"multiplicative",value:.5,color:C.GREEN},ATTR_FUEL_SCOOP:{name:"Fuel Scoop",description:"Regenerates 15% max fuel after every trip.",type:K.TRIGGER_ON_TRAVEL,color:C.GOLD},ATTR_TRAVELLER:{name:"Traveller",description:"Every 20th trip restores full Hull and Fuel.",type:K.TRIGGER_ON_TRAVEL,color:C.CYAN},ATTR_TRADER:{name:"Trader",description:"15% chance to gain +1 unit when buying goods.",type:K.TRIGGER_ON_TRADE,color:C.GOLD},ATTR_BESPOKE:{name:"Bespoke",description:"Cannot be repaired at standard facilities.",type:K.RESTRICTION,color:C.RED},ATTR_XENO_HULL:{name:"Xeno-Hull",description:"Immune to hull decay from travel.",type:K.MOD_HULL_DECAY,mode:"override",value:0,color:C.VIOLET},ATTR_SLEEPER:{name:"Sleeper",description:"Uses 0 fuel but travel takes 4.5x longer.",type:K.MOD_TRAVEL_TIME,mode:"multiplicative",value:4.5,color:C.GREY},ATTR_ADVANCED_COMMS:{name:"Adv. Comms",description:"Increases chance of finding random events by 25%.",type:K.PASSIVE_EFFECT,color:C.BLUE},ATTR_SOLAR_SAIL:{name:"Solar Sail",description:"15% chance for 0 fuel cost (but 2x travel time).",type:K.MOD_FUEL_BURN,color:C.GOLD},ATTR_RESILIENT:{name:"Resilient",description:"Reduces hull decay from travel by 50%.",type:K.MOD_HULL_DECAY,mode:"multiplicative",value:.5,color:C.GREEN},UPG_ENG_SPEED_1:{name:"Injector I",description:"Reduces travel time by 10%, but increases fuel burn & hull stress by 15%.",cost:5e3,tier:1,type:k.MOD_TRAVEL_SPEED,value:5e3,modifiers:{travelTime:.9,fuelBurn:1.15,hullStress:1.15},color:C.BLUE},UPG_ENG_SPEED_2:{name:"Injector II",description:"Reduces travel time by 20%, but increases fuel burn & hull stress by 30%.",cost:15e3,tier:2,type:k.MOD_TRAVEL_SPEED,value:15e3,modifiers:{travelTime:.8,fuelBurn:1.3,hullStress:1.3},color:C.INDIGO},UPG_ENG_SPEED_3:{name:"Injector III",description:"Reduces travel time by 30%, but increases fuel burn & hull stress by 45%.",cost:45e3,tier:3,type:k.MOD_TRAVEL_SPEED,value:45e3,modifiers:{travelTime:.7,fuelBurn:1.45,hullStress:1.45},color:C.VIOLET},UPG_ENG_SPEED_4:{name:"Injector IV",description:"Reduces travel time by 36%, but increases fuel burn & hull stress by 54%.",cost:125e5,tier:4,type:k.MOD_TRAVEL_SPEED,value:125e5,modifiers:{travelTime:.64,fuelBurn:1.54,hullStress:1.54},color:C.RED,pillColor:"#ef4444"},UPG_ENG_SPEED_5:{name:"Injector V",description:"Reduces travel time by 40%, but increases fuel burn & hull stress by 60%.",cost:25e6,tier:5,type:k.MOD_TRAVEL_SPEED,value:25e6,modifiers:{travelTime:.6,fuelBurn:1.6,hullStress:1.6},color:C.VIOLET},UPG_ECO_FUEL_1:{name:"Fuel Pass I",description:"Reduces refueling cost at stations by 10%.",cost:1e4,tier:1,type:k.MOD_FUEL_PRICE,value:1e4,modifiers:{fuelPrice:.9},color:C.ORANGE},UPG_ECO_FUEL_2:{name:"Fuel Pass II",description:"Reduces refueling cost at stations by 20%.",cost:3e4,tier:2,type:k.MOD_FUEL_PRICE,value:3e4,modifiers:{fuelPrice:.8},color:C.RED},UPG_ECO_FUEL_3:{name:"Fuel Pass III",description:"Reduces refueling cost at stations by 30%.",cost:9e4,tier:3,type:k.MOD_FUEL_PRICE,value:9e4,modifiers:{fuelPrice:.7},color:C.GOLD},UPG_ECO_FUEL_4:{name:"Fuel Pass IV",description:"Reduces refueling cost at stations by 40%.",cost:27e4,tier:4,type:k.MOD_FUEL_PRICE,value:27e4,modifiers:{fuelPrice:.6},color:C.RED,pillColor:"#ef4444"},UPG_ECO_FUEL_5:{name:"Fuel Pass V",description:"Reduces refueling cost at stations by 50%.",cost:81e4,tier:5,type:k.MOD_FUEL_PRICE,value:81e4,modifiers:{fuelPrice:.5},color:C.ORANGE},UPG_ECO_REPAIR_1:{name:"Repair Pass I",description:"Reduces hull repair cost by 5%.",cost:2e4,tier:1,type:k.MOD_REPAIR_COST,value:2e4,modifiers:{repairCost:.95},color:C.GREEN},UPG_ECO_REPAIR_2:{name:"Repair Pass II",description:"Reduces hull repair cost by 10%.",cost:6e4,tier:2,type:k.MOD_REPAIR_COST,value:6e4,modifiers:{repairCost:.9},color:C.EMERALD},UPG_ECO_REPAIR_3:{name:"Repair Pass III",description:"Reduces hull repair cost by 15%.",cost:18e4,tier:3,type:k.MOD_REPAIR_COST,value:18e4,modifiers:{repairCost:.85},color:C.SEAFOAM},UPG_ECO_REPAIR_4:{name:"Repair Pass IV",description:"Reduces hull repair cost by 20%.",cost:54e4,tier:4,type:k.MOD_REPAIR_COST,value:54e4,modifiers:{repairCost:.8},color:C.RED,pillColor:"#ef4444"},UPG_ECO_REPAIR_5:{name:"Repair Pass V",description:"Reduces hull repair cost by 25%.",cost:162e4,tier:5,type:k.MOD_REPAIR_COST,value:162e4,modifiers:{repairCost:.75},color:C.GREEN},UPG_ECO_BUY_1:{name:"Signal Hacker I",description:"Reduces market purchase prices by 0.5%.",cost:3e4,tier:1,type:k.MOD_BUY_PRICE,value:3e4,modifiers:{buyPrice:.995},color:C.CYAN},UPG_ECO_BUY_2:{name:"Signal Hacker II",description:"Reduces market purchase prices by 1.2%.",cost:9e4,tier:2,type:k.MOD_BUY_PRICE,value:9e4,modifiers:{buyPrice:.988},color:C.BLUE},UPG_ECO_BUY_3:{name:"Signal Hacker III",description:"Reduces market purchase prices by 1.9%.",cost:27e4,tier:3,type:k.MOD_BUY_PRICE,value:27e4,modifiers:{buyPrice:.981},color:C.VIOLET},UPG_ECO_BUY_4:{name:"Signal Hacker IV",description:"Reduces market purchase prices by 2.6%.",cost:81e4,tier:4,type:k.MOD_BUY_PRICE,value:81e4,modifiers:{buyPrice:.974},color:C.RED,pillColor:"#ef4444"},UPG_ECO_BUY_5:{name:"Signal Hacker V",description:"Reduces market purchase prices by 3.3%.",cost:243e4,tier:5,type:k.MOD_BUY_PRICE,value:243e4,modifiers:{buyPrice:.967},color:C.INDIGO},UPG_ECO_SELL_1:{name:"Guild Badge I",description:"Increases market sell prices by 0.5%.",cost:3e4,tier:1,type:k.MOD_SELL_PRICE,value:3e4,modifiers:{sellPrice:1.005},color:C.GOLD},UPG_ECO_SELL_2:{name:"Guild Badge II",description:"Increases market sell prices by 1.2%.",cost:9e4,tier:2,type:k.MOD_SELL_PRICE,value:9e4,modifiers:{sellPrice:1.012},color:C.ORANGE},UPG_ECO_SELL_3:{name:"Guild Badge III",description:"Increases market sell prices by 1.9%.",cost:27e4,tier:3,type:k.MOD_SELL_PRICE,value:27e4,modifiers:{sellPrice:1.019},color:C.RED},UPG_ECO_SELL_4:{name:"Guild Badge IV",description:"Increases market sell prices by 2.6%.",cost:81e4,tier:4,type:k.MOD_SELL_PRICE,value:81e4,modifiers:{sellPrice:1.026},color:C.RED,pillColor:"#ef4444"},UPG_ECO_SELL_5:{name:"Guild Badge V",description:"Increases market sell prices by 3.3%.",cost:243e4,tier:5,type:k.MOD_SELL_PRICE,value:243e4,modifiers:{sellPrice:1.033},color:C.GOLD},UPG_ECO_DEBT_1:{name:"Syndicate Badge I",description:"Reduces monthly debt interest by 20%.",cost:5e3,tier:1,type:k.MOD_DEBT_INTEREST,value:5e3,modifiers:{interestRate:.8},color:C.GREY},UPG_ECO_DEBT_2:{name:"Syndicate Badge II",description:"Reduces monthly debt interest by 30%.",cost:15e3,tier:2,type:k.MOD_DEBT_INTEREST,value:15e3,modifiers:{interestRate:.7},color:C.INDIGO},UPG_ECO_DEBT_3:{name:"Syndicate Badge III",description:"Reduces monthly debt interest by 50%.",cost:45e3,tier:3,type:k.MOD_DEBT_INTEREST,value:45e3,modifiers:{interestRate:.5},color:C.VIOLET},UPG_ECO_DEBT_4:{name:"Syndicate Badge IV",description:"Reduces monthly debt interest by 60%.",cost:125e5,tier:4,type:k.MOD_DEBT_INTEREST,value:125e5,modifiers:{interestRate:.4},color:C.RED,pillColor:"#ef4444"},UPG_ECO_DEBT_5:{name:"Syndicate Badge V",description:"Reduces monthly debt interest by 66%.",cost:25e6,tier:5,type:k.MOD_DEBT_INTEREST,value:25e6,modifiers:{interestRate:.34},color:C.VIOLET},UPG_UTIL_HULL_1:{name:"Plating I",description:"Increases Max Hull by 10. Reduces event hull damage by 10%.",cost:2e4,tier:1,type:k.MOD_MAX_HULL,value:2e4,modifiers:{maxHull:10,hullResistance:.1},color:C.GREY},UPG_UTIL_HULL_2:{name:"Plating II",description:"Increases Max Hull by 25. Reduces event hull damage by 15%.",cost:8e4,tier:2,type:k.MOD_MAX_HULL,value:8e4,modifiers:{maxHull:25,hullResistance:.15},color:C.INDIGO},UPG_UTIL_HULL_3:{name:"Plating III",description:"Increases Max Hull by 55. Reduces event hull damage by 20%.",cost:32e4,tier:3,type:k.MOD_MAX_HULL,value:32e4,modifiers:{maxHull:55,hullResistance:.2},color:C.VIOLET},UPG_UTIL_HULL_4:{name:"Plating IV",description:"Increases Max Hull by 85. Reduces event hull damage by 25%.",cost:96e4,tier:4,type:k.MOD_MAX_HULL,value:96e4,modifiers:{maxHull:85,hullResistance:.25},color:C.RED,pillColor:"#ef4444"},UPG_UTIL_HULL_5:{name:"Plating V",description:"Increases Max Hull by 115. Reduces event hull damage by 35%.",cost:288e4,tier:5,type:k.MOD_MAX_HULL,value:288e4,modifiers:{maxHull:115,hullResistance:.35},color:C.GREY},UPG_UTIL_FUEL_1:{name:"Aux Tank I",description:"Increases Max Fuel by 30.",cost:2e4,tier:1,type:k.MOD_MAX_FUEL,value:2e4,modifiers:{maxFuel:30},color:C.ORANGE},UPG_UTIL_FUEL_2:{name:"Aux Tank II",description:"Increases Max Fuel by 60.",cost:6e4,tier:2,type:k.MOD_MAX_FUEL,value:6e4,modifiers:{maxFuel:60},color:C.RED},UPG_UTIL_FUEL_3:{name:"Aux Tank III",description:"Increases Max Fuel by 90.",cost:18e4,tier:3,type:k.MOD_MAX_FUEL,value:18e4,modifiers:{maxFuel:90},color:C.GOLD},UPG_UTIL_FUEL_4:{name:"Aux Tank IV",description:"Increases Max Fuel by 120.",cost:54e4,tier:4,type:k.MOD_MAX_FUEL,value:54e4,modifiers:{maxFuel:120},color:C.RED,pillColor:"#ef4444"},UPG_UTIL_FUEL_5:{name:"Aux Tank V",description:"Increases Max Fuel by 150.",cost:162e4,tier:5,type:k.MOD_MAX_FUEL,value:162e4,modifiers:{maxFuel:150},color:C.ORANGE},UPG_UTIL_CARGO_1:{name:"Exp. Hold I",description:"Increases Cargo Capacity by 10.",cost:4e4,tier:1,type:k.MOD_MAX_CARGO,value:4e4,modifiers:{maxCargo:10},color:C.CYAN},UPG_UTIL_CARGO_2:{name:"Exp. Hold II",description:"Increases Cargo Capacity by 25.",cost:12e4,tier:2,type:k.MOD_MAX_CARGO,value:12e4,modifiers:{maxCargo:25},color:C.BLUE},UPG_UTIL_CARGO_3:{name:"Exp. Hold III",description:"Increases Cargo Capacity by 40.",cost:36e4,tier:3,type:k.MOD_MAX_CARGO,value:36e4,modifiers:{maxCargo:40},color:C.VIOLET},UPG_UTIL_CARGO_4:{name:"Exp. Hold IV",description:"Increases Cargo Capacity by 55.",cost:108e4,tier:4,type:k.MOD_MAX_CARGO,value:108e4,modifiers:{maxCargo:55},color:C.RED,pillColor:"#ef4444"},UPG_UTIL_CARGO_5:{name:"Exp. Hold V",description:"Increases Cargo Capacity by 70.",cost:324e4,tier:5,type:k.MOD_MAX_CARGO,value:324e4,modifiers:{maxCargo:70},color:C.BLUE},UPG_UTIL_RADAR_1:{name:"Radar Mod I",description:"Increases random event chance by 3%.",cost:1e4,tier:1,type:k.MOD_EVENT_CHANCE,value:1e4,modifiers:{eventChance:.03},color:C.SEAFOAM},UPG_UTIL_RADAR_2:{name:"Radar Mod II",description:"Increases random event chance by 5%.",cost:3e4,tier:2,type:k.MOD_EVENT_CHANCE,value:3e4,modifiers:{eventChance:.05},color:C.EMERALD},UPG_UTIL_RADAR_3:{name:"Radar Mod III",description:"Increases random event chance by 8%.",cost:9e4,tier:3,type:k.MOD_EVENT_CHANCE,value:9e4,modifiers:{eventChance:.08},color:C.GREEN},UPG_UTIL_RADAR_4:{name:"Radar Mod IV",description:"Increases random event chance by 13%.",cost:27e4,tier:4,type:k.MOD_EVENT_CHANCE,value:27e4,modifiers:{eventChance:.13},color:C.RED,pillColor:"#ef4444"},UPG_UTIL_RADAR_5:{name:"Radar Mod V",description:"Increases random event chance by 20%.",cost:81e4,tier:5,type:k.MOD_EVENT_CHANCE,value:81e4,modifiers:{eventChance:.2},color:C.EMERALD},UPG_UTIL_NANO_1:{name:"Nano-Bots I",description:"Repairs 0.3% of Max Hull daily while traveling.",cost:3e4,tier:1,type:k.MOD_PASSIVE_REPAIR,value:3e4,modifiers:{passiveRepair:.003},color:C.CYAN},UPG_UTIL_NANO_2:{name:"Nano-Bots II",description:"Repairs 0.5% of Max Hull daily while traveling.",cost:12e4,tier:2,type:k.MOD_PASSIVE_REPAIR,value:12e4,modifiers:{passiveRepair:.005},color:C.BLUE},UPG_UTIL_NANO_3:{name:"Nano-Bots III",description:"Repairs 0.8% of Max Hull daily while traveling.",cost:48e4,tier:3,type:k.MOD_PASSIVE_REPAIR,value:48e4,modifiers:{passiveRepair:.008},color:C.INDIGO},UPG_UTIL_NANO_4:{name:"Nano-Bots IV",description:"Repairs 1.3% of Max Hull daily.",cost:192e4,tier:4,type:k.MOD_PASSIVE_REPAIR,value:192e4,modifiers:{passiveRepair:.013},color:C.RED,pillColor:"#ef4444"},UPG_UTIL_NANO_5:{name:"Nano-Bots V",description:"Repairs 2% of Max Hull daily.",cost:768e4,tier:5,type:k.MOD_PASSIVE_REPAIR,value:768e4,modifiers:{passiveRepair:.02},color:C.SEAFOAM}},M=class{static getDefinition(e){return Te[e]||null}static getShipAttributes(e){return f.SHIPS[e]?.mechanicIds||[]}static getAllUpgradeIds(){return Object.keys(Te)}static getStationQuirks(e){return{[v.SUN]:["QUIRK_SOL_FORGE"],[v.MERCURY]:["QUIRK_MERCURY_THIRST"],[v.VENUS]:["QUIRK_VENUS_DATA"],[v.EARTH]:["QUIRK_EARTH_CONSUMPTION"],[v.LUNA]:["QUIRK_LUNA_SHIPYARD"],[v.MARS]:["QUIRK_MARS_COLONY"],[v.BELT]:["QUIRK_BELT_ANOMALY"],[v.EXCHANGE]:["QUIRK_EXCHANGE_VOLATILITY"],[v.JUPITER]:["QUIRK_JUPITER_REFINERY"],[v.SATURN]:["QUIRK_SATURN_LUXURY"],[v.URANUS]:["QUIRK_URANUS_RESEARCH"],[v.NEPTUNE]:["QUIRK_NEPTUNE_MILITARY"],[v.KEPLER]:["QUIRK_KEPLER_BANK"],[v.PLUTO]:["QUIRK_PLUTO_FRINGE"]}[e]||[]}static getInstallationFee(e){return!e||e<=0?0:Math.floor(e*.05)}static _getMultiplicativeModifier(e,t){let i=1;return e.forEach(a=>{let s=Te[a];s&&s.modifiers&&s.modifiers[t]!==void 0&&(i*=s.modifiers[t])}),i}static _getAdditiveModifier(e,t,i){let a=i;return e.forEach(s=>{let o=Te[s];o&&o.modifiers&&o.modifiers[t]!==void 0&&(a+=o.modifiers[t])}),a}static getFuelBurnModifier(e=[]){return this._getMultiplicativeModifier(e,"fuelBurn")}static getFuelPriceModifier(e=[]){return this._getMultiplicativeModifier(e,"fuelPrice")}static getTravelTimeModifier(e=[]){return this._getMultiplicativeModifier(e,"travelTime")}static getEventChanceModifier(e=[]){return this._getAdditiveModifier(e,"eventChance",0)}static getPriceModifier(e=[],t){let i=t==="buy"?"buyPrice":"sellPrice";return this._getMultiplicativeModifier(e,i)}static getServiceCostModifier(e=[],t){return t==="refuel"?this.getFuelPriceModifier(e):this._getMultiplicativeModifier(e,"repairCost")}static getMaxHullModifier(e=[]){return this._getAdditiveModifier(e,"maxHull",0)}static getMaxFuelModifier(e=[]){return this._getAdditiveModifier(e,"maxFuel",0)}static getMaxCargoModifier(e=[]){return this._getAdditiveModifier(e,"maxCargo",0)}static getInterestModifier(e=[]){return this._getMultiplicativeModifier(e,"interestRate")}static getPassiveRepairRate(e=[]){return this._getAdditiveModifier(e,"passiveRepair",0)}static getHullResistanceModifier(e=[]){return this._getAdditiveModifier(e,"hullResistance",0)}static getHullStressModifier(e=[]){return this._getMultiplicativeModifier(e,"hullStress")}static getAllUpgrades(){return Object.entries(Te).filter(([e,t])=>e.startsWith("UPG_")).map(([e,t])=>({id:e,...t}))}};var ht={"Wanderer.Ship":6,"Stalwart.Ship":4,"Rooster.Ship":5,"Mule.Ship":8,"Nomad.Ship":6,"Mesa.Ship":8,"Pathfinder.Ship":7,"Pilgrim.Ship":8,"Meridian.Ship":8,"Raven.Ship":9,"Warden.Ship":11,"Aegis.Ship":6,"Forerunner.Ship":9,"Guardian.Ship":11,"Valiant.Ship":11,"Eagle.Ship":12,"Tundra.Ship":11,"Atlas.Ship":9,"Vindicator.Ship":9,"Aesudon.Ship":13,"Pterodactyl.Ship":14,"Sovereign.Ship":14,"Titan.Ship":11,"Citadel.Ship":20,"Sophistacles.Ship":17,"Thalassodromeus.Ship":13,"Causality_of_Silence.Ship":2,"Shell_That_Echoes.Ship":2,"Engine_of_Recursion.Ship":3,"Anomaly_of_the_Song.Ship":4,"Parallax_of_Thought.Ship":4,"Cryo_Sleep_Pod.Ship":11,"The_Listener.Ship":3,"Finality_of_Whispers.Ship":4},Vt={"Water Ice":1,Plasteel:1,Hydroponics:1,Cybernetics:1,"Refined Propellant":1,"Neural Processors":1,"Graphene Lattices":1,"Cryo-Sleep Pods":1,"Atmo Processors":1,"Cloned Organs":1,"Xeno-Geologicals":1,"Sentient AI Cores":1,Antimatter:1,"Folded-Space Drives":1},ut={Neptune:12,Mercury:15,Venus:12,Earth:19,Luna:11,Mars:10,Belt:7,Exchange:6,Jupiter:9,Saturn:11,Uranus:16,Kepler:12,Pluto:11,sol:11};var ge=class{static DB_NAME="OrbitalAssetsDB";static STORE_NAME="assets";static VERSION=1;static db=null;static async initDB(){if(!this.db)return new Promise((e,t)=>{let i=indexedDB.open(this.DB_NAME,this.VERSION);i.onupgradeneeded=a=>{let s=a.target.result;s.objectStoreNames.contains(this.STORE_NAME)||s.createObjectStore(this.STORE_NAME)},i.onsuccess=a=>{this.db=a.target.result,e()},i.onerror=a=>{console.error("AssetStorageService: DB Open Error",a),t(a)}})}static async saveAsset(e,t){return this.db||await this.initDB(),new Promise((i,a)=>{let r=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).put(t,e);r.onsuccess=()=>i(),r.onerror=n=>a(n)})}static async getAsset(e){return this.db||await this.initDB(),new Promise((t,i)=>{let o=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).get(e);o.onsuccess=r=>t(r.target.result),o.onerror=r=>i(r)})}static async hasAsset(e){return this.db||await this.initDB(),new Promise((t,i)=>{let o=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).count(e);o.onsuccess=r=>t(r.target.result>0),o.onerror=r=>i(r)})}};var V=class{static PLACEHOLDER="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";static blobCache=new Map;static LOCATION_FILENAME_MAP={loc_sun:"Sol",loc_mercury:"Mercury",loc_venus:"Venus",loc_earth:"Earth",loc_luna:"Luna",loc_mars:"Mars",loc_belt:"Belt",loc_exchange:"Exchange",loc_jupiter:"Jupiter",loc_saturn:"Saturn",loc_uranus:"Uranus",loc_neptune:"Neptune",loc_kepler:"Kepler",loc_pluto:"Pluto"};static async init(){await ge.initDB()}static _getVariantSuffix(e){let t="";for(;e>=0;)t=String.fromCharCode(65+e%26)+t,e=Math.floor(e/26)-1;return t}static _generateShipPath(e,t){let i=f.SHIPS[e];if(!i)return null;let a=ht[e]!==void 0?ht[e]:5,s=Math.abs(t)%a,o=this._getVariantSuffix(s);if(["Z","F"].includes(i.class)){let n=e.replace(".Ship","");return`assets/images/ships/${n.replace(/_/g," ")}/${n}_${o}.jpeg`}let r=i.name;return`assets/images/ships/${r}/${r}_${o}.jpeg`}static _generateCommodityPath(e,t){if(!e)return null;let i=Vt[e];if(i===void 0&&(i=1),i<=0)return null;let a=Math.abs(t)%i,s=this._getVariantSuffix(a),o=e.replace(/ /g,"_");return`assets/images/commodities/${e}/${o}_${s}.png`}static _generateLocationPath(e){let t=this.LOCATION_FILENAME_MAP[e];if(!t){let o=e.replace("loc_","");t=o.charAt(0).toUpperCase()+o.slice(1)}let i=ut[t]!==void 0?ut[t]:4,a=Math.floor(Math.random()*i),s=this._getVariantSuffix(a);return`assets/images/locations/${t}/${t}_${s}.jpeg`}static getShipImage(e,t=0){let i=this._generateShipPath(e,t);return i?this.blobCache.has(i)?this.blobCache.get(i):i:""}static getFallbackImage(e){let t=f.SHIPS[e];if(!t)return"";if(["Z","F"].includes(t.class)){let a=e.replace(".Ship","");return`assets/images/ships/${a.replace(/_/g," ")}/${a}_A.jpeg`}let i=t.name;return`assets/images/ships/${i}/${i}_A.jpeg`}static getCommodityImage(e,t=0){let i=this._generateCommodityPath(e,t);return i?this.blobCache.has(i)?this.blobCache.get(i):i:""}static getLocationImage(e){let t=this._generateLocationPath(e);return t?this.blobCache.has(t)?this.blobCache.get(t):t:""}static async hydrateAssets(e){let t=new Set;e.forEach(a=>{let s=null;if(a.type==="ship")s=this._generateShipPath(a.id,a.seed||0);else if(a.type==="commodity"){let o=f.COMMODITIES.find(r=>r.id===a.id)?.name;o&&(s=this._generateCommodityPath(o,a.seed||0))}else a.type==="location"&&(a.path?s=a.path:a.id&&(s=this._generateLocationPath(a.id)));s&&t.add(s)});let i=Array.from(t).map(async a=>{if(!this.blobCache.has(a)){try{let s=await ge.getAsset(a);if(s){let o=URL.createObjectURL(s);this.blobCache.set(a,o);return}}catch(s){console.warn(`AssetService: DB read error for ${a}`,s)}try{let s=await fetch(a);if(!s.ok)throw new Error(`Network error ${s.status}`);let o=await s.blob();await ge.saveAsset(a,o);let r=URL.createObjectURL(o);this.blobCache.set(a,r)}catch{}}});await Promise.all(i)}static async hydrateBootAssets(){console.log("[AssetService] Starting Boot Phase Hydration...");let e=[];f.COMMODITIES.forEach(t=>{e.push({type:"commodity",id:t.id,seed:0})}),f.MARKETS.forEach(t=>{t.bgImage&&e.push({type:"location",path:t.bgImage}),t.imagePath&&e.push({type:"location",path:t.imagePath})}),await this.hydrateAssets(e),console.log(`[AssetService] Boot Hydration Complete. Loaded ${e.length} assets.`)}static async hydrateGameAssets(e){if(!e||!e.player)return;let t=e.player,i=e.uiState||{},a=t.visualSeed||0;console.log("[AssetService] Starting Game Phase Hydration...");let s=[],o=t.ownedShipIds||[],r=i.hangarActiveIndex||0;this._sortByDistance(o,r).forEach(h=>{s.push({type:"ship",id:h,seed:a})});let l=e.market&&e.market.shipyardStock?Object.keys(e.market.shipyardStock):[],c=i.shipyardActiveIndex||0;this._sortByDistance(l,c).forEach(h=>{s.push({type:"ship",id:h,seed:a})}),t.activeShipId&&s.push({type:"ship",id:t.activeShipId,seed:a}),console.log(`[AssetService] Hydrating ${s.length} Context-Critical Assets...`),await this.hydrateAssets(s),setTimeout(()=>{this.hydrateAllShips(a)},2e3)}static _sortByDistance(e,t){if(!e||e.length===0)return[];let i=e.map((a,s)=>{let o=Math.abs(s-t);return{item:a,distance:o}});return i.sort((a,s)=>a.distance-s.distance),i.map(a=>a.item)}static hydrateAllShips(e=0){let t=Object.keys(f.SHIPS).map(i=>({type:"ship",id:i,seed:e}));console.log(`[AssetService] Background hydrating all ${t.length} ships...`),this.hydrateAssets(t)}static hydrateAllCommodities(e=0){let t=f.COMMODITIES.map(i=>({type:"commodity",id:i.id,seed:e}));console.log(`[AssetService] Background hydrating all ${t.length} commodities...`),this.hydrateAssets(t)}static preloadBuffer(e,t,i,a){if(!e||e.length===0)return;let s=[],o=Math.max(0,t-i),r=Math.min(e.length-1,t+i);for(let n=o;n<=r;n++){let l=e[n];l&&s.push({type:"ship",id:l,seed:a})}s.length>0&&this.hydrateAssets(s).catch(n=>console.warn("[AssetService] Buffer preload warning:",n))}};var Re=class{constructor(e){this.gameState=e,this._currentSystemState=null,this._systemStateExpirationDay=0}getPrice(e,t,i=!1){let a=this.gameState.getState().activeIntelDeal,s=this.gameState.market.prices[e]?.[t]||0;if(a&&a.locationId===e&&a.commodityId===t&&(s=this.gameState.market.prices[e]?.[t]||a.overridePrice),e===v.EARTH&&(t===E.CLONED_ORGANS||t===E.XENO_GEOLOGICALS)&&(s=s*1.1),e===v.MARS&&(t===E.WATER_ICE||t===E.HYDROPONICS)&&(s=s*1.1),e===v.SATURN&&(t===E.CLONED_ORGANS||t===E.CRYO_PODS)&&(s=s*1.2),e===v.PLUTO&&(t===E.CYBERNETICS||t===E.ANTIMATTER)&&(s=s*1.25),e===v.MERCURY&&t===E.WATER_ICE&&(s=s*1.4),i){let o=this.gameState.player.activeShipId;if(o&&this.gameState.player.shipStates[o]){let r=this.gameState.player.shipStates[o].upgrades||[],n=M.getPriceModifier(r,"buy");s=s*n}}return Math.max(1,Math.round(s))}getGalacticAverage(e){return this.gameState.market.galacticAverages[e]||0}checkForSystemStateChange(){if(this.gameState.day>this._systemStateExpirationDay){let e=Object.keys(f.SYSTEM_STATES),t=e[Math.floor(Math.random()*e.length)];this._currentSystemState=f.SYSTEM_STATES[t],this._systemStateExpirationDay=this.gameState.day+this._currentSystemState.duration}}evolveMarketPrices(){f.MARKETS.forEach(e=>{f.COMMODITIES.forEach(t=>{if(t.tier>this.gameState.player.revealedTier)return;let i=this.gameState.activeIntelDeal;if(i&&i.locationId===e.id&&i.commodityId===t.id){let _=i.overridePrice,L=.03,N=_*(1-L),O=_*(1+L),F=Math.random()*(O-N)+N;this.gameState.market.prices[e.id][t.id]=Math.max(1,Math.round(F));return}let a=this.gameState.market.inventory[e.id][t.id],s=this.gameState.market.prices[e.id][t.id],o=this.gameState.market.galacticAverages[t.id],n=(1-(e.availabilityModifier?.[t.id]??1))*o,l=o+n*G.LOCAL_PRICE_MOD_STRENGTH,c=G.DAILY_PRICE_VOLATILITY;e.id===v.EXCHANGE&&(c*=3);let d=G.MEAN_REVERSION_STRENGTH,h=this._currentSystemState?.modifiers?.commodity?.[t.id];h&&(h.volatility_mult&&(c*=h.volatility_mult),h.mean_reversion_mult&&(d*=h.mean_reversion_mult));let p=t.basePriceRange[1]-t.basePriceRange[0],y=(Math.random()-.5)*p*c,g=(l-s)*d;this.gameState.day<a.priceLockEndDay&&(g=0),a.rivalArbitrage.isActive&&this.gameState.day<a.rivalArbitrage.endDay?g=(l-s)*.2:a.rivalArbitrage.isActive&&(a.rivalArbitrage.isActive=!1),a.hoverUntilDay>this.gameState.day?g*=.1:a.hoverUntilDay>0&&(a.hoverUntilDay=0);let S=0;this.gameState.day>=a.lastPlayerInteractionTimestamp+7&&a.lastPlayerInteractionTimestamp>0&&(S=l*a.marketPressure*-1*.5);let T=1;a.isDepleted&&this.gameState.day<a.depletionDay+7&&(T=1.5);let A=s+y+g+S*T;this._currentSystemState?.modifiers?.commodity?.[t.id]?.price&&(A*=this._currentSystemState.modifiers.commodity[t.id].price),this.gameState.market.prices[e.id][t.id]=Math.max(1,Math.round(A)),a.marketPressure*=G.MARKET_PRESSURE_DECAY,Math.abs(a.marketPressure)<.001&&(a.marketPressure=0)}),this._recordPriceHistory(e.id)})}replenishMarketInventory(){f.MARKETS.forEach(e=>{f.COMMODITIES.forEach(t=>{if(t.tier>this.gameState.player.revealedTier)return;let i=this.gameState.market.inventory[e.id][t.id];if(i.lastPlayerInteractionTimestamp>0&&this.gameState.day-i.lastPlayerInteractionTimestamp>120)i.quantity=this._calculateBaselineStock(e,t),i.lastPlayerInteractionTimestamp=0,i.marketPressure=0,i.depletionDay=0,i.priceLockEndDay=0;else{let[r,n]=t.canonicalAvailability,l=(r+n)/2*(e.availabilityModifier?.[t.id]??1),c=i.marketPressure;c<0&&this.gameState.day<i.lastPlayerInteractionTimestamp+7&&(c=0),c>0&&(c=0);let d=1-Math.min(.5,c*.5),h=this.gameState.player.statModifiers?.commoditySupply||0,g=(l*d*(1+h)-i.quantity)*.1,S=0;i.isDepleted?(S=me(1,5),i.isDepleted=!1):i.quantity<=0&&(S=me(1,5)),i.quantity+=g+S}let a=Math.random()*.15+.15,s=Math.random()<.5?-1:1,o=1+a*s;i.quantity*=o,this._currentSystemState?.modifiers?.commodity?.[t.id]?.availability&&(i.quantity*=this._currentSystemState.modifiers.commodity[t.id].availability),i.quantity=Math.max(0,Math.round(i.quantity))})})}applyMarketImpact(e,t,i){let a=f.COMMODITIES.find(d=>d.id===e),s=this.gameState.market.inventory[this.gameState.currentLocationId][e],o=t/(a.canonicalAvailability[1]||100)*a.tier/10;i==="buy"?s.marketPressure-=o:s.marketPressure+=o;let r=(this.gameState.day-1)%365+1,n,l;r<=182?(n=75,l=120):(n=105,l=195);let c=Math.floor(Math.random()*(l-n+1))+n;s.priceLockEndDay=this.gameState.day+c,s.lastPlayerInteractionTimestamp=this.gameState.day}checkDepletion(e,t,i,a){let s=f.MARKETS.find(g=>g.id===this.gameState.currentLocationId),[o,r]=e.canonicalAvailability,n=s.availabilityModifier?.[e.id]??1,l=(o+r)/2*n,c=t.marketPressure;c>0&&(c=0);let d=1-Math.min(.5,c*.5),p=Math.max(1,l*d)*.08;i>=p&&a>t.depletionBonusDay+365&&(t.isDepleted=!0,t.depletionDay=a,t.depletionBonusDay=a)}_calculateBaselineStock(e,t){let[i,a]=t.canonicalAvailability,s=e.availabilityModifier?.[t.id]??1;return Math.floor(me(i,a)*s)}_recordPriceHistory(e=null){if(!this.gameState||!this.gameState.market)return;let t=e||this.gameState.currentLocationId;this.gameState.market.priceHistory[t]||(this.gameState.market.priceHistory[t]={}),f.COMMODITIES.forEach(i=>{if(i.tier>this.gameState.player.revealedTier)return;this.gameState.market.priceHistory[t][i.id]||(this.gameState.market.priceHistory[t][i.id]=[]);let a=this.gameState.market.priceHistory[t][i.id],s=this.gameState.market.prices[t][i.id],o=a[a.length-1];for(o&&o.day===this.gameState.day?o.price!==s&&(o.price=s):a.push({day:this.gameState.day,price:s});a.length>G.PRICE_HISTORY_LENGTH;)a.shift()})}_updateShipyardStock(){let{player:e}=this.gameState;e.unlockedLocationIds.forEach(t=>{let i=this.gameState.market.shipyardStock[t];if(i&&i.day===this.gameState.day)return;let a=Object.entries(f.SHIPS).filter(([c,d])=>!d.isRare&&d.saleLocationId===t&&!e.ownedShipIds.includes(c)),s=Object.entries(f.SHIPS).filter(([c,d])=>d.isRare&&d.saleLocationId===t&&!e.ownedShipIds.includes(c)),o=[...a.map(c=>c[0])],r=this.gameState.player.statModifiers?.shipSpawnRate||0,n=G.RARE_SHIP_CHANCE+r;s.forEach(([c,d])=>{Math.random()<n&&o.push(c)}),this.gameState.market.shipyardStock[t]={day:this.gameState.day,shipsForSale:o};let l=o.map(c=>({type:"ship",id:c,seed:e.visualSeed}));V.hydrateAssets(l)})}};var Ce=class{constructor(e,t,i,a){this.gameState=e,this.uiManager=t,this.logger=i,this.simulationService=a,this._transitioning=!1}start(){this.gameState.introSequenceActive&&(this.logger.info.state(this.gameState.day,"INTRO_START","Starting new game introduction sequence."),this.gameState.player.ownedShipIds=[],this.gameState.player.activeShipId=null,this.gameState.player.shipStates={},this.gameState.player.inventories={},this.gameState.player.introStep=0,this._transitioning=!1,this._showNextModal())}handleIntroClick(e){if(this._transitioning){e.preventDefault(),e.stopPropagation();return}let t=e.target.closest("button");if(t&&t.id==="intro-submit-btn"){let s=document.getElementById("signature-input").value.trim().replace(/[^a-zA-Z0-9 ]/g,"");!s||s.length===0?this.uiManager.queueModal("event-modal","Invalid Signature","The Merchant's Guild requires a valid name on the contract. Please provide your legal mark.",()=>{this._showNextModal()}):(this._transitioning=!0,t.disabled=!0,this.gameState.player.name=s,this.gameState.player.debt=25e3,this.gameState.player.loanStartDate=this.gameState.day,this.gameState.player.monthlyInterestAmount=390,this.logger.info.state(this.gameState.day,"LOAN_ACCEPTED",`Player ${s} accepted Guild loan.`),this.uiManager.hideModal("signature-modal"),this._startProcessingSequence())}}continueAfterTutorial(e){e==="intro_hangar"?(this.simulationService.setScreen($.DATA,x.FINANCE),this.simulationService.tutorialService.checkState({type:"ACTION",action:"INTRO_START_FINANCE"})):e==="intro_finance"&&this._end()}_showNextModal(){let e=f.INTRO_SEQUENCE_V1.modals[this.gameState.player.introStep];if(!e){this._end();return}this._transitioning=!1;let t={buttonClass:e.buttonClass,contentClass:e.contentClass};this.gameState.player.introStep===0&&(t.specialClass="intro-fade-in");let i="event-modal";e.id==="charter"||e.id==="signature"?(i=`${e.id}-modal`,t.customSetup=(s,o)=>{this._setupInteractiveModal(s,e,o)}):t.customSetup=(s,o)=>{let r=s.querySelector("#event-button-container");if(!r)return;r.innerHTML="";let n=document.createElement("button");n.className="btn px-6 py-2",e.buttonClass&&n.classList.add(e.buttonClass),n.id="intro-next-btn",n.innerHTML=e.buttonText,n.onclick=l=>{if(this._transitioning){l.preventDefault();return}this._transitioning=!0,l.target.disabled=!0,o()},r.appendChild(n)};let a=()=>{this.gameState.player.introStep++,this._showNextModal()};this.uiManager.queueModal(i,e.title,e.description,a,t)}_setupInteractiveModal(e,t,i){let a=e.querySelector(`#${t.id}-button-container`);a.innerHTML="";let s=document.createElement("button");s.className="btn px-6 py-2",s.innerHTML=t.buttonText;let o=r=>{if(this._transitioning){r&&r.preventDefault();return}this._transitioning=!0,r&&r.target&&(r.target.disabled=!0),i()};if(t.id==="signature"){let r=e.querySelector("#signature-input");r.value="",s.id="intro-submit-btn",s.disabled=!0,s.onclick=null,r.oninput=()=>{s.disabled=r.value.trim()===""}}else s.id="intro-next-btn",s.onclick=o;a.appendChild(s)}_startProcessingSequence(){let e=()=>{this._transitioning=!1;let t="Loan Approved",i=`Dear ${this.gameState.player.name},<br><br>Your line of credit has been <b>approved</b>.<br><br><span class="credits-text-pulsing">\u232C 25,000</span> is ready to transfer to your account.`,a=s=>{this._transitioning=!0,s&&s.target&&(s.target.disabled=!0),this.uiManager.createFloatingText(`+${I(25e3,!1)}`,s.clientX,s.clientY,"#34d399"),this.gameState.player.credits=Math.min(Number.MAX_SAFE_INTEGER,this.gameState.player.credits+25e3),this.logger.info.player(this.gameState.day,"CREDITS_TRANSFER","Accepted loan transfer of \u232C25,000"),setTimeout(()=>{this.uiManager.showGameContainer(),this.simulationService.tutorialService.checkState({type:"ACTION",action:"INTRO_START_HANGAR"}),this.simulationService.setScreen($.STARPORT,x.HANGAR),this._transitioning=!1},2e3)};this.uiManager.queueModal("event-modal",t,i,null,{contentClass:"text-center",customSetup:(s,o)=>{s.querySelector(".modal-content").classList.add("modal-theme-admin");let r=s.querySelector("#event-button-container");r.innerHTML="";let n=document.createElement("button");n.className="btn px-6 py-2",n.innerHTML="Accept Transfer",n.onclick=l=>{this._transitioning||(this._transitioning=!0,a(l),o())},r.appendChild(n)}})};this.uiManager.showProcessingAnimation(this.gameState.player.name,e)}_end(){this.gameState.introSequenceActive=!1,this._transitioning=!1,this.logger.info.state(this.gameState.day,"INTRO_END","Introduction sequence complete.");let e=f.INTRO_SEQUENCE_V1.modals.find(a=>a.id==="final"),t=f.SHIPS[this.gameState.player.activeShipId].name,i=e.buttonText.replace("{shipName}",t);this.gameState.tutorials.navLock={navId:$.DATA,screenId:x.FINANCE},this.uiManager.queueModal("event-modal",e.title,e.description,()=>{this.simulationService.setScreen($.DATA,x.MISSIONS),this.simulationService.tutorialService.checkState({type:"ACTION",action:"INTRO_START_MISSIONS"})},{buttonText:i}),this.uiManager.render(this.gameState.getState())}};var Me=class{constructor(e,t,i,a,s,o,r){this.gameState=e,this.uiManager=t,this.missionService=i,this.marketService=a,this.timeService=s,this.logger=o,this.simulationService=r,this.isTransactionInProgress=!1}buyItem(e,t){let i=this.gameState.getState();if(i.isGameOver||t<=0)return!1;let a=f.COMMODITIES.find(L=>L.id===e);if(a.licenseId&&!i.player.unlockedLicenseIds.includes(a.licenseId))return this.uiManager.queueModal("event-modal","License Required",`You do not have the required license to trade ${a.name}.`),!1;let s=this.uiManager.getItemPrice(i,e),o=i.player.activeShipId,n=i.player.shipStates[o].upgrades||[],l=M.getPriceModifier(n,"buy"),d=Math.max(1,Math.round(s*l))*t,h=i.player.statModifiers?.purchaseCost||0;h>0&&(d=Math.floor(d*(1-h))),i.currentLocationId===v.NEPTUNE&&(e===E.PROPELLANT||e===E.PLASTEEL)&&t>50&&(d=Math.floor(d*.9),this.uiManager.createFloatingText("BULK DISCOUNT APPLIED",window.innerWidth/2,window.innerHeight/2-50,"#34d399")),i.currentLocationId===v.BELT&&(e===E.WATER_ICE||e===E.XENO_GEOLOGICALS)&&(d=Math.floor(d*.95),this.uiManager.createFloatingText("MINER'S DISCOUNT",window.innerWidth/2,window.innerHeight/2-50,"#34d399"));let p=i.market.inventory[i.currentLocationId][e].quantity;if(p<=0)return this.uiManager.queueModal("event-modal","Sold Out",`This station has no more ${a.name} available.`),!1;if(t>p)return this.uiManager.queueModal("event-modal","Limited Stock",`This station only has ${p} units available.`),!1;let y=this.simulationService.getEffectiveShipStats(o),g=this.simulationService._getActiveInventory();if(X(g)+t>y.cargoCapacity)return this.uiManager.queueModal("event-modal","Cargo Hold Full","You don't have enough space."),!1;if(i.player.credits<d)return this.uiManager.queueModal("event-modal","Insufficient Funds","Your credit balance is too low."),!1;let S=this.gameState.market.inventory[i.currentLocationId][e],b=S.quantity;S.quantity-=t,S.quantity<=0&&this.marketService.checkDepletion(a,S,b,i.day);let T=t;M.getShipAttributes(o).includes("ATTR_TRADER")&&Math.random()<.15&&(T+=1,this.uiManager.createFloatingText("+1 Bonus!",window.innerWidth/2,window.innerHeight/2,"#34d399"),this.logger.info.player(i.day,"ATTR_TRIGGER",`Trader perk triggered: +1 ${a.name}.`));let _=g[e];return _.avgCost=(_.quantity*_.avgCost+d)/(_.quantity+T),_.quantity+=T,this.gameState.player.credits-=d,this.logger.info.player(i.day,"BUY",`Bought ${t}x ${a.name} for ${I(d)}`),this.simulationService._logConsolidatedTrade(a.name,t,-d),this.timeService._checkMilestones(),this.missionService.checkTriggers(),this.marketService.applyMarketImpact(e,t,"buy"),this.gameState.uiState.lastTransactionTimestamp=Date.now(),this.gameState.setState({}),!0}sellItem(e,t){let i=this.gameState.getState();if(i.isGameOver||t<=0)return 0;let a=f.COMMODITIES.find(g=>g.id===e);if(a.licenseId&&!i.player.unlockedLicenseIds.includes(a.licenseId))return this.uiManager.queueModal("event-modal","License Required",`You do not have the required license to trade ${a.name}.`),0;let o=this.simulationService._getActiveInventory()[e];if(!o||o.quantity<t)return this.uiManager.queueModal("event-modal","Insufficient Inventory",`You do not have ${t} units of ${a.name} to sell.`),0;let r=i.player.activeShipId,l=i.player.shipStates[r].upgrades||[],{totalPrice:c}=this.uiManager._calculateSaleDetails(e,t),d=c,h=M.getPriceModifier(l,"sell");d=Math.floor(d*h),i.currentLocationId===v.SUN&&(e===E.GRAPHENE_LATTICES||e===E.PLASTEEL)&&(d=Math.floor(d*1.25),this.uiManager.createFloatingText("EXPORT YIELD BONUS",window.innerWidth/2,window.innerHeight/2-50,"#eab308"));let p=d-o.avgCost*t;if(p>0){let g=i.player.statModifiers?.profitBonus||0,S=(i.player.activePerks[P.TRADEMASTER]?f.PERKS[P.TRADEMASTER].profitBonus:0)+g;d+=p*S}d=Math.floor(d),this.gameState.player.credits=Math.min(Number.MAX_SAFE_INTEGER,this.gameState.player.credits+d),o.quantity-=t,o.quantity===0&&(o.avgCost=0);let y=this.gameState.market.inventory[i.currentLocationId][e];return y.quantity+=t,this.logger.info.player(i.day,"SELL",`Sold ${t}x ${a.name} for ${I(d)}`),this.simulationService._logConsolidatedTrade(a.name,t,d),this.timeService._checkMilestones(),this.missionService.checkTriggers(),this.marketService.applyMarketImpact(e,t,"sell"),this.gameState.uiState.lastTransactionTimestamp=Date.now(),this.gameState.setState({}),d}validateBuyShip(e){if(this.isTransactionInProgress)return{success:!1,errorTitle:"Transaction in Progress",errorMessage:"Please wait for the current transaction to complete."};let t=f.SHIPS[e];if(!t)return this.logger.error("PlayerActionService",`validateBuyShip called with invalid shipId: ${e}`),{success:!1,errorTitle:"Ship Not Found",errorMessage:"The selected ship does not exist in the database."};let i=t.price,a=this.gameState.player.statModifiers?.shipPrice||0;return a>0&&(i=Math.floor(t.price*(1-a))),this.gameState.player.credits<i?{success:!1,errorTitle:"Insufficient Funds",errorMessage:"You cannot afford this ship."}:{success:!0}}executeBuyShip(e,t){this.isTransactionInProgress=!0;try{let i=f.SHIPS[e];if(!i)return this.logger.error("PlayerActionService",`executeBuyShip called with invalid shipId: ${e}`),null;let a=i.price,s=this.gameState.player.statModifiers?.shipPrice||0;s>0&&(a=Math.floor(i.price*(1-s))),this.gameState.player.credits-=a,this.logger.info.player(this.gameState.day,"SHIP_PURCHASE",`Purchased ${i.name} for ${I(a)}.`),t&&this.uiManager.createFloatingText(`-${I(a,!1)}`,t.clientX,t.clientY,"#f87171"),this.simulationService._logTransaction("ship",-a,`Purchased ${i.name}`),this.simulationService.addShipToHangar(e);let o=this.simulationService._getShipyardInventory(),r=this.gameState.uiState.shipyardActiveIndex||0,n=Math.min(r,Math.max(0,o.length-1));this.gameState.tutorials.activeBatchId==="intro_hangar"&&(this.simulationService.setHangarShipyardMode("hangar"),this.simulationService.tutorialService.checkState({type:"ACTION",action:w.BUY_SHIP}));let l=`var(--class-${i.class.toLowerCase()}-color)`,c="";i.class==="Z"?c="glow-text-z":i.class==="O"?c="glow-text-o":i.class==="S"&&(c="glow-text-s");let h=`You purchased the ${`<span class="${c}" style="color: ${l}; font-weight: bold;">${i.name}</span>`} for <span class="text-glow-red">${I(-a,!0)}</span>. This ship has been stored in your Hangar.`;return this.uiManager.queueModal("event-modal","Vessel Purchased",h),this.gameState.setState({uiState:{...this.gameState.uiState,shipyardActiveIndex:n,lastTransactionTimestamp:Date.now()}}),i}finally{setTimeout(()=>{this.isTransactionInProgress=!1},100)}}validateSellShip(e){if(this.isTransactionInProgress)return{success:!1,errorTitle:"Transaction in Progress",errorMessage:"Please wait for the current transaction to complete."};let t=this.gameState.getState();if(t.player.ownedShipIds.length<=1)return{success:!1,errorTitle:"Action Blocked",errorMessage:"You cannot sell your last remaining ship."};if(e===t.player.activeShipId)return{success:!1,errorTitle:"Action Blocked",errorMessage:"You cannot sell your active ship."};if(X(t.player.inventories[e])>0)return{success:!1,errorTitle:"Cannot Sell Ship",errorMessage:"This vessel's cargo hold is not empty."};let i=f.SHIPS[e];return i?{success:!0,ship:i}:(this.logger.error("PlayerActionService",`validateSellShip called with invalid shipId: ${e}`),{success:!1,errorTitle:"Ship Not Found",errorMessage:"The selected ship does not exist."})}executeSellShip(e,t){this.isTransactionInProgress=!0;try{let i=f.SHIPS[e],a=this.gameState.player.shipStates[e];if(!i||!a)return this.logger.error("PlayerActionService",`executeSellShip called with invalid shipId or state: ${e}`),!1;let s=0;a.upgrades&&Array.isArray(a.upgrades)&&a.upgrades.forEach(y=>{let g=M.getDefinition(y);g&&(s+=g.value)});let o=i.price+s,r=Math.floor(o*G.SHIP_SELL_MODIFIER);this.gameState.player.credits=Math.min(Number.MAX_SAFE_INTEGER,this.gameState.player.credits+r),this.logger.info.player(this.gameState.day,"SHIP_SALE",`Sold ${i.name} (with upgrades) for ${I(r)}.`),t&&this.uiManager.createFloatingText(`+${I(r,!1)}`,t.clientX,t.clientY,"#34d399"),this.simulationService._logTransaction("ship",r,`Sold ${i.name}`);let n=this.gameState.player.ownedShipIds.indexOf(e);this.gameState.player.ownedShipIds=this.gameState.player.ownedShipIds.filter(y=>y!==e),delete this.gameState.player.shipStates[e],delete this.gameState.player.inventories[e];let l=this.gameState.uiState.hangarActiveIndex;n<l&&l--,l>=this.gameState.player.ownedShipIds.length&&(l=Math.max(0,this.gameState.player.ownedShipIds.length-1));let c=`var(--class-${i.class.toLowerCase()}-color)`,d="";i.class==="Z"?d="glow-text-z":i.class==="O"?d="glow-text-o":i.class==="S"&&(d="glow-text-s");let p=`You sold the ${`<span class="${d}" style="color: ${c}; font-weight: bold;">${i.name}</span>`} for <span class="credits-text-pulsing">+${I(r,!0)}</span>.`;return this.uiManager.queueModal("event-modal","Vessel Sold",p),this.gameState.setState({uiState:{...this.gameState.uiState,hangarActiveIndex:l,lastTransactionTimestamp:Date.now()}}),r}finally{setTimeout(()=>{this.isTransactionInProgress=!1},100)}}validateSetActiveShip(e){return this.isTransactionInProgress?{success:!1,errorTitle:"Transaction in Progress",errorMessage:"Please wait for the current transaction to complete."}:this.gameState.player.ownedShipIds.includes(e)?this.gameState.player.activeShipId===e?{success:!1,errorTitle:"Action Redundant",errorMessage:"This ship is already your active vessel."}:{success:!0}:(this.logger.error("PlayerActionService",`validateSetActiveShip called with unowned shipId: ${e}`),{success:!1,errorTitle:"Ship Not Found",errorMessage:"You do not own this ship."})}executeSetActiveShip(e){if(this.gameState.player.ownedShipIds.includes(e)){this.isTransactionInProgress=!0;try{this.gameState.player.activeShipId=e;let t=this.gameState.player.ownedShipIds.indexOf(e);t!==-1&&(this.gameState.uiState.hangarActiveIndex=t),this.logger.info.player(this.gameState.day,"SET_ACTIVE_SHIP",`Boarded the ${f.SHIPS[e].name}.`),this.gameState.setState({uiState:{...this.gameState.uiState,lastTransactionTimestamp:Date.now()}})}finally{setTimeout(()=>{this.isTransactionInProgress=!1},100)}}}payOffDebt(e){if(this.gameState.isGameOver)return;let{player:t,currentLocationId:i}=this.gameState,a=t.debt;if(i===v.KEPLER&&(a=Math.floor(t.debt*.85)),t.credits<a){let s=i===v.KEPLER?` Even with the Kepler discount (${I(a)}), you are short.`:"";this.uiManager.queueModal("event-modal","Insufficient Funds",`You can't afford to pay off your entire debt.${s}`);return}t.credits-=a,e&&this.uiManager.createFloatingText(`-${I(a,!1)}`,e.clientX,e.clientY,"#f87171"),this.logger.info.player(this.gameState.day,"DEBT_PAID",`Paid off ${I(t.debt)} in debt (Cost: ${I(a)}).`),this.simulationService._logTransaction("loan",-a,"Paid off debt"),t.debt=0,t.monthlyInterestAmount=0,t.loanStartDate=null,this.timeService._checkMilestones(),this.gameState.setState({})}takeLoan(e,t){let{player:i,day:a,currentLocationId:s}=this.gameState;if(i.debt>0){this.uiManager.queueModal("event-modal","Loan Unavailable","You must pay off your existing debt first.");return}let o=e.fee;if(s===v.KEPLER&&(o=Math.floor(e.fee*.85)),i.credits<o){this.uiManager.queueModal("event-modal","Unable to Secure Loan",`The financing fee is ${I(o)}, but you only have ${I(i.credits)}.`);return}i.credits-=o,this.simulationService._logTransaction("loan",-o,`Financing fee for ${I(e.amount)} loan`),i.credits=Math.min(Number.MAX_SAFE_INTEGER,i.credits+e.amount),t&&this.uiManager.createFloatingText(`+${I(e.amount,!1)}`,t.clientX,t.clientY,"#34d399"),this.simulationService._logTransaction("loan",e.amount,`Acquired ${I(e.amount)} loan`),i.debt+=e.amount,i.monthlyInterestAmount=e.interest,i.loanStartDate=a,i.seenGarnishmentWarning=!1;let r=`You've acquired a loan of <span class="credits-text-pulsing">${I(e.amount,!0)}</span>.<br>A financing fee of <span class="text-glow-red">${I(-o,!0)}</span> was deducted.`;this.uiManager.queueModal("event-modal","Loan Acquired",r),this.logger.info.player(a,"LOAN_TAKEN",`Took a loan for ${I(e.amount)}.`),this.gameState.setState({})}purchaseLicense(e){let t=f.LICENSES[e],{player:i,day:a}=this.gameState;return t?t.type!=="purchase"?{success:!1,error:"NOT_FOR_PURCHASE"}:i.unlockedLicenseIds.includes(e)?{success:!1,error:"ALREADY_OWNED"}:i.credits<t.cost?{success:!1,error:"INSUFFICIENT_FUNDS"}:(i.credits-=t.cost,i.unlockedLicenseIds.push(e),this.logger.info.player(a,"LICENSE_PURCHASE",`Purchased ${t.name}.`),this.simulationService._logTransaction("license",-t.cost,`Purchased ${t.name}`),this.gameState.setState({}),{success:!0}):{success:!1,error:"INVALID_LICENSE"}}purchaseIntel(e){let{player:t,currentLocationId:i,day:a}=this.gameState;if(t.credits<e){this.uiManager.queueModal("event-modal","Insufficient Funds","You can't afford this intel.");return}t.credits-=e,this.logger.info.player(a,"INTEL_PURCHASE",`Purchased intel for ${I(e)}.`),this.simulationService._logTransaction("intel",-e,"Purchased market intel"),this.gameState.intel.available[i]=!1;let s=f.MARKETS.filter(l=>l.id!==i&&t.unlockedLicenseIds.includes(l.id));if(s.length===0)return;let o=s[Math.floor(Math.random()*s.length)],r=f.COMMODITIES.filter(l=>l.tier<=t.revealedTier),n=r[Math.floor(Math.random()*r.length)];n&&(this.gameState.intel.active={targetMarketId:o.id,commodityId:n.id,type:"demand",startDay:a,endDay:a+100}),this.gameState.setState({})}refuelTick(){let e=this.gameState,t=this.simulationService._getActiveShip();if(!t)return 0;let i=this.simulationService.getEffectiveShipStats(t.id),a=e.player.shipStates[t.id].fuel;if(a>=i.maxFuel)return 0;let o=e.player.shipStates[t.id].upgrades||[],r=f.MARKETS.find(g=>g.id===e.currentLocationId).fuelPrice/10;(e.currentLocationId===v.SATURN||e.currentLocationId===v.PLUTO)&&(r*=2),e.player.activePerks[P.VENETIAN_SYNDICATE]&&e.currentLocationId===v.VENUS&&(r*=1-f.PERKS[P.VENETIAN_SYNDICATE].fuelDiscount);let n=M.getFuelPriceModifier(o);r*=n;let l=e.player.statModifiers?.fuelCost||0;l>0&&(r*=1-l);let d=(i.maxFuel-a)/i.maxFuel,h=0;d<.05?h=Math.ceil(i.maxFuel*.01):h=Math.ceil(i.maxFuel*.05);let p=Math.max(1,Math.round(r*h));if(e.player.credits<p)return 0;e.player.credits-=p,e.player.shipStates[t.id].fuel=Math.min(i.maxFuel,a+h),this.simulationService._logConsolidatedTransaction("fuel",-p,"Fuel Purchase");let y=document.getElementById("refuel-btn");if(y){let g=y.getBoundingClientRect(),S=g.left+g.width/2,b=g.top;this.uiManager.createFloatingText(`-${I(p,!1)}`,S,b,"#f87171")}return this.gameState.setState({}),p}repairTick(){let e=this.gameState,t=this.simulationService._getActiveShip();if(!t)return 0;let i=this.simulationService.getEffectiveShipStats(t.id),a=e.player.shipStates[t.id].health;if(a>=i.maxHealth)return 0;let o=e.player.shipStates[t.id].upgrades||[];if(M.getShipAttributes(t.id).includes("ATTR_BESPOKE"))return 0;let n=G.REPAIR_COST_PER_HP;e.currentLocationId===v.LUNA&&(n*=.8),(e.currentLocationId===v.SATURN||e.currentLocationId===v.PLUTO)&&(n*=2),e.player.activePerks[P.VENETIAN_SYNDICATE]&&e.currentLocationId===v.VENUS&&(n*=1-f.PERKS[P.VENETIAN_SYNDICATE].repairDiscount);let l=M.getServiceCostModifier(o,"repair");n*=l;let c=e.player.statModifiers?.repairCost||0;c>0&&(n*=1-c);let h=(i.maxHealth-a)/i.maxHealth,p=0;h<.05?p=Math.ceil(i.maxHealth*.01):p=Math.ceil(i.maxHealth*.05);let y=Math.max(1,Math.round(n*p));if(e.player.credits<y)return 0;if(e.player.credits-=y,e.player.shipStates[t.id].health=Math.min(i.maxHealth,a+p),this.timeService.advanceDays(1),this.gameState.isGameOver)return y;this.simulationService._logConsolidatedTransaction("repair",-y,"Hull Repairs"),this.simulationService._checkHullWarnings(t.id);let g=document.getElementById("repair-btn");if(g){let S=g.getBoundingClientRect(),b=S.left+S.width/2,T=S.top;this.uiManager.createFloatingText(`-${I(y,!1)}`,b,T,"#f87171")}return this.gameState.setState({}),y}validateInstallUpgrade(e,t){let i=this.gameState.getState(),a=i.player.shipStates[e];return!i.player.ownedShipIds.includes(e)||!a?{success:!1,error:"Ship not owned."}:i.player.activeShipId!==e?{success:!1,error:"Upgrades must be applied to the active ship."}:(a.upgrades||[]).length>=3?{success:!1,error:"Upgrade slots full."}:{success:!0}}executeInstallUpgrade(e,t){let i=this.gameState;i.player.shipStates[e].upgrades||(i.player.shipStates[e].upgrades=[]),i.player.shipStates[e].upgrades.push(t),this.logger.info.player(i.day,"UPGRADE_INSTALL",`Installed ${t} on ${e}.`),this.gameState.setState({})}};var qt={100:{title:"Ocular Replacement",bonus:"commoditySupply",val:.02,desc:"The failing retinas are gone, replaced by Kiroshi-grade optical sensors. You don't just see crates anymore; you see wireframes, volume density, and spoilage rates overlaying reality in real-time. The world is brighter, sharper, and filled with data that organic eyes could never process. You can spot a supply surplus from orbit."},105:{title:"Vocal Synthesizer",bonus:"shipPrice",val:.01,desc:"Your vocal cords had weathered from decades of shouting over thrusters, so you swapped them for a harmonic synthesizer. It analyzes the buyer's micro-expressions and adjusts your pitch to the exact frequency of 'trust' and 'compliance.' Negotiations feel less like arguments and more like conducting an orchestra. They never hear the manipulation, only the deal."},110:{title:"Neural Spine Shunt",bonus:"travelSpeed",val:.01,desc:"The arthritis in your hands made the helm sluggish, so you excised the nerves and installed a direct neural-shunt in your spine. Now, you don't steer the ship with your hands; you *become* the ship, feeling the thruster burn as your own muscle tension. Reaction times are measured in microseconds. You move through the void as a single, steel entity."},115:{title:"Subspace Cranial Receiver",bonus:"shipSpawnRate",val:.02,desc:"Your hearing was the next to go, replaced by broad-spectrum subspace receivers anchored in your skull. You can hear the 'thrum' of fusion drives entering the system hours before traffic control pings them. The static of the universe is now a symphony of arrival vectors. You know they are coming before they even drop out of warp."},120:{title:"Haptic Diagnostic Tips",bonus:"upgradeSpawnRate",val:.02,desc:"You replaced your fingertips with haptic diagnostic probes, capable of sensing microscopic etchings in circuit boards. When you touch a piece of tech, you feel its efficiency rating and heat tolerance instantly, bypassing the need for spec sheets. The junk falls away, leaving only the rare gems humming against your skin. Finding the best gear is no longer luck; it\u2019s a sense of touch."},125:{title:"Mnemo-Core Implant",bonus:"intelDuration",val:.02,desc:"The organic brain forgets, but your new temporal-lobe memory bank does not. Every rumor, every price sheet, and every whisper in the bar is etched onto a crystalline drive with perfect clarity. You can recall a conversation from three weeks ago with the fidelity of a recording. Information no longer decays; it accumulates."},130:{title:"Olfactory Chem-Analyzers",bonus:"commoditySupply",val:.02,desc:"Your respiratory system was inefficient, requiring oxygen tanks in the hold; the new filtration lungs scrub the air of toxins and analyze atmospheric particulate. You can smell the ozone of a fresh shipment of electronics or the metallic tang of refined ore from three docks away. The air itself tells you what the station is hiding. Nothing stays hidden from a nose that smells profit."},135:{title:"Polymer-Mesh Facial Weave",bonus:"shipPrice",val:.01,desc:"You swapped your facial muscles for a polymer-mesh weave that allows for total micro-expression control. When you haggle, your face is a perfect mask of disinterest, giving away nothing while your sensors read their desperation. They drop their prices just to get a reaction out of you. It is the ultimate poker face, sculpted from synthetic flesh."},140:{title:"Mag-Lev Circulatory Pump",bonus:"travelSpeed",val:.01,desc:"The frailty of the human heart limited your G-force tolerance, so you replaced it with a mag-lev pump. It circulates synthetic hemoglobin that carries double the oxygen, allowing you to pull burns that would blackout a normal pilot. You push the engines past the red line because your body no longer has a red line. The void shrinks beneath your unyielding endurance."},145:{title:"Circadian Regulator Chip",bonus:"shipSpawnRate",val:.02,desc:"You replaced your biological sleep center with a circadian regulator chip. You no longer feel fatigue. While others sleep, you are watching the docking manifests, waiting for that unique signature. You are the ghost that haunts the market, always awake, always watching."},150:{title:"Spectral Eye Analyzer",bonus:"upgradeSpawnRate",val:.02,desc:"Your right eye has been replaced with a spectral analyzer that sees radiation leaks and energy signatures. You can look at a pile of scrap and see the glowing aura of a military-grade capacitor hidden within. The mundane world is grey, but power shines like a beacon to your upgraded vision. You pick the diamonds from the dust."},155:{title:"Sub-Cortex Coprocessor",bonus:"intelDuration",val:.02,desc:"You installed a secondary co-processor at the base of your skull to handle background data crunching. While you negotiate, this sub-mind analyzes market trends and cross-references rumors, validating intel in real-time. It holds onto data streams long after the source has disconnected, keeping the signal alive. You are a walking server farm."},160:{title:"Nutrient-Brick Reactor",bonus:"commoditySupply",val:.02,desc:"The digestive system was a waste of space/energy, replaced by a dense nutrient-brick reactor. You no longer feel hunger, only a 'fuel low' warning, freeing your mind to obsess over logistical volume. You calculate cargo space with the precision of a machine that essentially is cargo itself. You understand 'capacity' on a spiritual level."},165:{title:"Pheromone Emitter Glands",bonus:"shipPrice",val:.01,desc:"You\u2019ve replaced your pheromone glands with synthetic emitters that subtly flood the room with 'calm' and 'familiarity' agents. Sellers feel an inexplicable kinship with you, a chemical compulsion to give you the 'friend price.' It\u2019s not mind control, but it\u2019s frighteningly close. You simply smell like their best deal."},170:{title:"Carbon-Nanotube Skeleton",bonus:"travelSpeed",val:.01,desc:"Your bone marrow has been swapped for a carbon-nanotube lattice, making your skeleton virtually unbreakable. You can slam the ship into maneuvers that would shatter a human frame, ignoring the inertial dampeners for raw speed. You are the structure that holds the ship together. Physics is just a suggestion to a body built of steel."},175:{title:"Deep-Void Radar Cortex",bonus:"shipSpawnRate",val:.02,desc:"You\u2019ve integrated a deep-range void-radar directly into your visual cortex. You don't look at a screen; you close your eyes and see the system's traffic as floating motes of light in the darkness. You spot the faint glimmer of a rare hull signature drifting in from the belt before the station sensors do. You are the radar."},180:{title:"Magnetic Resonance Palms",bonus:"upgradeSpawnRate",val:.02,desc:"Your hands are now fully mechanical, fitted with magnetic resonance scanners. You can wave your hand over a crate of parts and feel the magnetic pull of high-end alloys. The cheap plasteel feels dead, but the mil-spec components sing to your servos. You sort the wheat from the chaff without opening the box."},185:{title:"Quantum-Entangled Storage",bonus:"intelDuration",val:.02,desc:"You\u2019ve undergone a total neocortex rewrite, replacing grey matter with quantum-entangled storage. Your memories are no longer stored locally; they are backed up to a secure cloud, accessible instantly and corrupted by nothing. Time does not erode your knowledge. What you learn stays learned, forever perfect."},190:{title:"Solar-Mesh Epidermis",bonus:"commoditySupply",val:.02,desc:"Your skin has been replaced by photosensitive solar-mesh. You feel the light of the local star as data, gauging the system's energy output and production cycles through your pores. You are in tune with the station's very power grid, sensing when production spikes. You are the station's pulse."},195:{title:"Logic-Gate Processor",bonus:"shipPrice",val:.01,desc:"The last vestiges of your empathy centers have been excised for a logic-gate processor. You no longer feel guilt or pity during a negotiation; you calculate optimal outcomes with cold, binary precision. The seller's sob story is just noise; the numbers are the only truth. You are the ultimate dealmaker, for you have no soul to bargain with."}},we=class{constructor(e,t,i,a,s){this.gameState=e,this.marketService=t,this.uiManager=i,this.logger=a,this.newsTickerService=s,this.simulationService=null,this.intelService=null,this.solStationService=null}advanceDays(e){this.logger.group(`[System] Advancing time by ${e} day(s) from Day ${this.gameState.day}`),this.gameState.player.visualSeed=(this.gameState.player.visualSeed||0)+1;let t=this.gameState.player.activeShipId,i=this.gameState.player.shipStates[t],a=i?i.upgrades||[]:[],s=M.getShipAttributes(t);for(let o=0;o<e;o++){if(this.gameState.isGameOver){this.logger.groupEnd();return}this.gameState.day++,this.simulationService&&this.simulationService.pulseNewsTicker(),this.solStationService&&this.solStationService.processTimeStep(1);let r=M.getPassiveRepairRate(a);if(s.includes("ATTR_SELF_ASSEMBLY")&&(r+=.05),r>0&&this.simulationService){let h=this.simulationService.getEffectiveShipStats(t);if(i.health<h.maxHealth){let p=h.maxHealth*r;i.health=Math.min(h.maxHealth,i.health+p)}}s.forEach(h=>{let p=M.getDefinition(h);p&&p.type===K.MOD_HULL_DECAY&&p.mode==="flat_daily"&&i.health>1&&(i.health=Math.max(1,i.health-p.value))});let n=(this.gameState.day-1)%365,l=f.DATE_CONFIG.START_YEAR+Math.floor((this.gameState.day-1)/365);!s.includes("ATTR_CRYO_STASIS")&&n===11&&l>this.gameState.player.lastBirthdayYear&&(this.gameState.player.lastBirthdayYear=l,this.gameState.player.playerAge++,this._handleBirthday(this.gameState.player.playerAge)),this._checkAgeEvents(),this.marketService.evolveMarketPrices(),this.gameState.day-this.gameState.lastMarketUpdateDay>=7&&(this.marketService.checkForSystemStateChange(),this.marketService.replenishMarketInventory(),this.marketService._updateShipyardStock(),this.gameState.lastMarketUpdateDay=this.gameState.day);let d=this.gameState.activeIntelDeal;if(d&&this.gameState.day>d.expiryDay){let h=d;if(this.gameState.activeIntelDeal=null,h.sourceSaleLocationId&&h.sourcePacketId){let p=this.gameState.intelMarket[h.sourceSaleLocationId];p&&(this.gameState.intelMarket[h.sourceSaleLocationId]=p.filter(y=>y.id!==h.sourcePacketId))}this.simulationService.pushNewsMessage(`Intel on ${f.COMMODITIES.find(p=>p.id===h.commodityId).name} at ${f.MARKETS.find(p=>p.id===h.targetMarketId).name} has expired.`,"INTEL")}if(this.intelService){let h=Object.values(this.gameState.intelMarket).flat().length;(this.gameState.day%120===1||this.gameState.day<120&&h===0)&&this.intelService.generateIntelRefresh()}if(this.gameState.player.ownedShipIds.forEach(h=>{if(h!==this.gameState.player.activeShipId){let p=f.SHIPS[h],y=p.maxHealth*G.PASSIVE_REPAIR_RATE;this.gameState.player.shipStates[h].health=Math.min(p.maxHealth,this.gameState.player.shipStates[h].health+y)}}),this.gameState.player.debt>0&&this.gameState.day-this.gameState.lastInterestChargeDay>=G.INTEREST_INTERVAL){let h=this.gameState.player.monthlyInterestAmount,p=M.getInterestModifier(a),y=Math.floor(h*p);this.gameState.player.debt+=y,this.simulationService&&this.simulationService._logTransaction("loan",y,"Monthly interest charge"),this.logger.info.system("Finance",this.gameState.day,"INTEREST",`Charged ${I(y)} interest on debt (Base: ${h}, Mod: ${p}).`),this.gameState.lastInterestChargeDay=this.gameState.day}this._applyGarnishment()}this.logger.groupEnd(),this.gameState.setState({})}_handleBirthday(e){let t=this.gameState.player.statModifiers,i="Happy Birthday!",a=`You turned ${e}.`,s="";if(e<100){switch((e-25)%7){case 0:t.profitBonus+=.001,s="Your experience grants you a permanent +0.10% profit bonus on all trades.";break;case 1:t.intelCost+=.02,s="Your network grants you a permanent 2% discount on Intel Packets.";break;case 2:t.purchaseCost+=.001,s="Your reputation grants you a permanent 0.10% discount on commodity purchases.";break;case 3:t.intelDuration+=.02,s="Your memory techniques allow Intel to last 2% longer.";break;case 4:t.fuelCost+=.0025,s="Refueling efficiency improved. Permanent 0.25% discount on fuel.";break;case 5:t.intelCost+=.02,s="Your network grants you an additional 2% discount on Intel Packets.";break;case 6:t.repairCost+=.0025,s="Maintenance efficiency improved. Permanent 0.25% discount on hull repairs.";break}this.uiManager.queueModal("event-modal",i,`${a} ${s}`)}else if(e>=100&&e<200){if(e%5===0&&qt[e]){let o=qt[e];t[o.bonus]+=o.val;let r=(o.val*100).toFixed(0)+"%",n="";o.bonus==="commoditySupply"?n=`Increased commodity supply available at all markets by ${r}.`:o.bonus==="shipPrice"?n=`Reduced ship purchase prices by ${r}.`:o.bonus==="travelSpeed"?n=`Increased travel speed by ${r}.`:o.bonus==="shipSpawnRate"?n=`Increased rare ship spawn rate by ${r}.`:o.bonus==="upgradeSpawnRate"?n=`Increased ship upgrade spawn rate by ${r}.`:o.bonus==="intelDuration"&&(n=`Intel lasts ${r} longer.`),i=`Augmentation Installed: ${o.title}`,this.uiManager.queueModal("event-modal",i,`You are now ${e}. ${o.desc}

<span class='text-green-400'>EFFECT: ${n}</span>`)}}else if(e>=200&&e%5===0){let o=this.gameState.player.activeShipId,r=this.gameState.player.shipStates[o],n=this.simulationService?this.simulationService.getEffectiveShipStats(o):f.SHIPS[o];e%10===0?(r.fuel=n.maxFuel,i="Guild Tribute: Fuel Grant",a=`In honor of your ${e}th year, the Merchant's Guild has issued a writ of passage. Your ship's fuel reserves have been instantly restored to maximum capacity.`,s="Fuel reserves fully restored."):(r.health=n.maxHealth,i="Guild Tribute: Drydock Grant",a=`In honor of your ${e}th year, the Shipwright's Union has issued a total restoration grant. Your ship's hull has been instantly repaired to maximum integrity.`,s="Hull integrity fully restored."),this.uiManager.queueModal("event-modal",i,`${a}

<span class='text-yellow-400'>${s}</span>`)}}_checkAgeEvents(){f.AGE_EVENTS.forEach(e=>{this.gameState.player.seenEvents.includes(e.id)||(e.trigger.day&&this.gameState.day>=e.trigger.day||e.trigger.credits&&this.gameState.player.credits>=e.trigger.credits)&&(this.gameState.player.seenEvents.push(e.id),this.uiManager.showAgeEventModal(e,t=>{this.simulationService&&this.simulationService._applyPerk(t)}))})}_checkMilestones(){let{credits:e,revealedTier:t}=this.gameState.player,i=t,a=dt.find(s=>s.revealsTier===i+1);for(;a&&e>=a.threshold;)this.gameState.player.revealedTier=a.revealsTier,this.logger.info.player(this.gameState.day,"MILESTONE",`Wealth milestone reached! Tier ${a.revealsTier} commodities unlocked.`),this.uiManager.queueModal("event-modal","Market Update",`Your increasing wealth has granted you access to Tier ${a.revealsTier} commodities.`),i=a.revealsTier,a=dt.find(s=>s.revealsTier===i+1);this.gameState.player.revealedTier!==t&&this.gameState.setState({})}_applyGarnishment(){let{player:e,day:t}=this.gameState;if(e.debt>0&&e.loanStartDate&&t-e.loanStartDate>=G.LOAN_GARNISHMENT_DAYS){if((t-this.gameState.lastInterestChargeDay)%G.INTEREST_INTERVAL!==0)return;let i=Math.floor(e.credits*G.LOAN_GARNISHMENT_PERCENT);i>0&&(e.credits-=i,this.simulationService&&(this.simulationService._logTransaction("debt",-i,"Monthly credit garnishment"),this.simulationService._checkGameOverConditions())),e.seenGarnishmentWarning||(this.uiManager.queueModal("event-modal","Credit Garnishment Notice","Your loan is delinquent. Your lender is now garnishing 14% of your credits monthly until the debt is paid.",null,{buttonClass:"bg-red-800/80"}),e.seenGarnishmentWarning=!0)}}getCurrentDay(){return this.gameState.day}};function Wt(m,e,t,i){let a=e._getActiveShip(),s=Math.floor(m.player.credits*t.wagerPercentage),o=t.winChance[a.class]||.4;Math.random()<o?(m.player.credits=Math.min(Number.MAX_SAFE_INTEGER,m.player.credits+s),e._logTransaction("event",s,"Won space race wager"),i.description=`Your Class ${a.class} ship wins! You gain <span class="hl-green">${I(s)}</span>.`):(m.player.credits-=s,e._logTransaction("event",-s,"Lost space race wager"),i.description=`The luxury ship was too fast. You lose <span class="hl-red">${I(s)}</span>.`)}function jt(m,e,t){let i=e._getActiveShip(),a=m.player.shipStates[i.id],s=e._getActiveInventory();if(a.fuel=Math.max(0,a.fuel-30),s[E.CYBERNETICS]||(s[E.CYBERNETICS]={quantity:0,avgCost:0}),X(s)+40<=i.cargoCapacity)return s[E.CYBERNETICS].quantity+=40,{key:"reward_cybernetics"};if(m.player.debt>0){let o=Math.floor(m.player.debt*.2);return m.player.debt-=o,e._logTransaction("event",o,"Passenger paid off debt"),{key:"reward_debt_paid",amount:I(o)}}else{let o=Math.floor(m.player.credits*.05);return m.player.credits=Math.min(Number.MAX_SAFE_INTEGER,m.player.credits+o),e._logTransaction("event",o,"Passenger payment"),{key:"reward_credits",amount:I(o)}}}var bi={SPACE_RACE:Wt,ADRIFT_PASSENGER:jt,[u.EFFECTS.MODIFY_CREDITS]:(m,e,t)=>{let i=m.player.credits,a=Math.round(t.value);m.player.credits=Math.max(0,Math.min(Number.MAX_SAFE_INTEGER,m.player.credits+a));let s=m.player.credits-i;s!==0&&e._logTransaction("event",s,"Event outcome")},[u.EFFECTS.MODIFY_FUEL]:(m,e,t)=>{let i=e._getActiveShip(),a=m.player.shipStates[i.id],s=Math.round(t.value);a.fuel=Math.max(0,Math.min(i.maxFuel,a.fuel+s))},[u.EFFECTS.MODIFY_HULL]:(m,e,t)=>{let i=e._getActiveShip(),a=m.player.shipStates[i.id],s=Math.round(t.value);if(s<0){let o=a.upgrades||[],r=M.getHullResistanceModifier(o);s=Math.round(s*(1-r))}a.health=Math.max(0,Math.min(i.maxHealth,a.health+s))},[u.EFFECTS.MODIFY_DEBT]:(m,e,t)=>{m.player.debt<=0&&t.value>0&&(m.player.loanStartDate=m.day,m.player.weeklyInterestAmount=0);let i=Math.round(t.value);m.player.debt=Math.max(0,m.player.debt+i)},[u.EFFECTS.ADD_ITEM]:(m,e,t,i)=>{let a=e._getActiveShip(),s=e._getActiveInventory(),o=t.target,r=Math.floor(t.value),n=f.COMMODITIES.find(l=>l.id===o);if(n&&n.tier>m.player.revealedTier){i&&(i.text+=` (Recovered ${n.name}, but lacked the data-encryption keys to secure it. Cargo abandoned.)`);return}if(X(s)+r<=a.cargoCapacity){if(s[o]||(s[o]={quantity:0,avgCost:0}),s[o].quantity+=r,n)return{addedItem:n.name,addedQty:r}}else i&&n&&(i.text+=` (Cargo hold full! Abandoned ${r}x ${n.name}.)`)},[u.EFFECTS.REMOVE_ITEM]:(m,e,t)=>{let i=e._getActiveInventory(),a=t.target,s=Math.ceil(t.value);i[a]&&(i[a].quantity=Math.max(0,i[a].quantity-s))},[u.EFFECTS.MODIFY_TRAVEL]:(m,e,t)=>{if(m.pendingTravel){let i=Math.round(t.value);if(m.pendingTravel.travelTimeAdd=(m.pendingTravel.travelTimeAdd||0)+i,i>0){let a=m.currentLocationId,s=m.pendingTravel.destinationId,o=m.TRAVEL_DATA[a]?.[s];if(o&&o.time>0){let r=e._getActiveShip(),n=m.player.shipStates[r.id],l=n.upgrades||[],c=M.getShipAttributes(r.id),h=o.fuelCost/o.time*i;if(m.player.activePerks&&m.player.activePerks[P.NAVIGATOR]&&(h*=f.PERKS[P.NAVIGATOR].fuelMod),h*=M.getFuelBurnModifier(l),c.includes("ATTR_METABOLIC_BURN")&&(h*=.5),c.includes("ATTR_NEWTONS_GHOST")&&(h=0),c.includes("ATTR_SOLAR_HARMONY")){let p=f.MARKETS.find(g=>g.id===a)?.distance||0;(f.MARKETS.find(g=>g.id===s)?.distance||0)<p&&(h=0)}h=Math.round(h),h>0&&(n.fuel=Math.max(0,n.fuel-h))}}}},[u.EFFECTS.UNLOCK_INTEL]:(m,e,t)=>{let i=f.MARKETS[Math.floor(Math.random()*f.MARKETS.length)]},[u.EFFECTS.LOSE_RANDOM_CARGO]:(m,e,t)=>{let i=e._getActiveInventory(),a=Object.entries(i).filter(([,s])=>s.quantity>0);if(a.length>0){let[s,o]=a[Math.floor(Math.random()*a.length)],r=Math.ceil(o.quantity*t.value);o.quantity=Math.max(0,o.quantity-r);let n=f.COMMODITIES.find(l=>l.id===s);if(n)return{lostItem:n.name,lostQty:r}}},[u.EFFECTS.ADD_RANDOM_CARGO]:(m,e,t,i)=>{let a=e._getActiveShip(),s=e._getActiveInventory(),o=a.cargoCapacity-X(s);if(o<=0){i&&(i.text+=" (Cargo hold full! Could not salvage goods.)");return}let r=f.COMMODITIES.filter(c=>c.id!=="fuel_rod"&&c.tier<=m.player.revealedTier);if(r.length===0)return;let n=r[Math.floor(Math.random()*r.length)],l=Math.min(Math.floor(t.value),o);if(l>0)return s[n.id]||(s[n.id]={quantity:0,avgCost:0}),s[n.id].quantity+=l,{addedItem:n.name,addedQty:l}},[u.EFFECTS.ADD_UPGRADE]:(m,e,t,i)=>{let a=e._getActiveShip(),s=m.player.shipStates[a.id],o=t.target;if(s.upgrades=s.upgrades||[],s.upgrades.includes(o)){if(i){let r=M.getDefinition(o),n=r?r.name:o;i.text+=` (Already owned ${n}. Used for spare parts.)`}}else{s.upgrades.push(o);let r=M.getDefinition(o),n=r?r.name:o;return m.uiState.hangarShipyardToggleState="hangar",e.setScreen&&e.setScreen($.STARPORT,x.HANGAR),{installedUpgrade:n}}},[u.EFFECTS.FULL_REFUEL]:(m,e,t,i)=>{let a=e._getActiveShip(),s=m.player.shipStates[a.id];s.fuel=a.maxFuel,i&&(i.text+=" (Fuel tanks topped off!)")}};function Kt(m,e,t,i){let a=bi[t.type];if(a)return a(m,e,t,i);console.warn(`No handler found for event effect type: ${t.type}`,t)}var fe=class{constructor(){}resolve(e,t){return typeof e=="number"?e:typeof e=="object"&&e!==null?this._calculateDynamicValue(e,t):(console.warn("[DynamicValueResolver] Invalid value definition:",e),0)}_calculateDynamicValue(e,t){let i=e.base||0,a=e.factor!==void 0?e.factor:1,s=this._getScalerValue(e.scaleWith,t);return Math.floor(i+s*a)}_getScalerValue(e,t){if(!e)return 0;let i=t.player.activeShipId,a=f.SHIPS[i],s=t.player.shipStates[i];switch(e){case"WEALTH_TIER":return t.player.revealedTier||1;case"PLAYER_CREDITS":return t.player.credits||0;case"MAX_FUEL":return a?a.maxFuel:100;case"MAX_HULL":return a?a.maxHealth:100;case"CURRENT_FUEL":return s?s.fuel:0;case"CURRENT_HULL":return s?s.health:0;case"CARGO_CAPACITY":return a?a.cargoCapacity:10;case"DEBT_TOTAL":return t.player.debt||0;case"TRIP_DURATION":return t.pendingTravel&&typeof t.pendingTravel.days=="number"?t.pendingTravel.days:7;case"SHIP_CLASS_SCALAR":return a?Math.max(1,a.maxHealth/100):1;default:return console.warn(`[DynamicValueResolver] Unknown scale type: ${e}`),0}}};var Le=class{constructor(){this.valueResolver=new fe}checkAll(e,t,i){return e?(Array.isArray(e)||(e=[e]),e.every(a=>this.evaluate(a,t,i))):!0}evaluate(e,t,i){let{type:a,operator:s,value:o,target:r}=e,n=null,l=this.valueResolver.resolve(o,t);switch(a){case u.CONDITIONS.HAS_FUEL:let c=t.player.activeShipId;n=t.player.shipStates[c]?.fuel||0;break;case u.CONDITIONS.HAS_CREDITS:n=t.player.credits;break;case u.CONDITIONS.HAS_HULL:let d=t.player.shipStates[t.player.activeShipId];n=d?d.health:0;break;case u.CONDITIONS.HAS_CARGO_SPACE:let h=f.SHIPS[t.player.activeShipId];if(!h)return!1;let p=i._getActiveInventory(),y=Object.values(p).reduce((b,T)=>b+(T.quantity||0),0);n=h.cargoCapacity-y;break;case u.CONDITIONS.HAS_ITEM:n=i._getActiveInventory()[r]?.quantity||0;break;case u.CONDITIONS.HAS_PERK:n=t.player.activePerks[r]?1:0;break;case u.CONDITIONS.HAS_SHIP_CLASS:let S=f.SHIPS[t.player.activeShipId];n=S?S.class:"";break;case u.CONDITIONS.WEALTH_TIER:n=t.player.revealedTier;break;case u.CONDITIONS.LOCATION_IS:n=t.currentLocationId,typeof o=="string"&&(l=o);break;case u.CONDITIONS.RNG_ROLL:return Math.random()<l;default:return console.warn(`[ConditionEvaluator] Unknown condition type: ${a}`),!1}return this.compare(n,s,l)}compare(e,t,i){switch(t){case"GT":return e>i;case"GTE":return e>=i;case"LT":return e<i;case"LTE":return e<=i;case"EQ":return e===i;case"NEQ":return e!==i;case"IN":return Array.isArray(i)&&i.includes(e);default:return console.warn(`[ConditionEvaluator] Unknown operator: ${t}`),!1}}};var Oe=class{constructor(e){this.conditionEvaluator=e}resolve(e,t,i){if(!e)return console.error("[OutcomeResolver] Missing resolution data"),null;switch(e.type){case u.RESOLVERS.DETERMINISTIC:return this._resolveFixed(e.pool);case u.RESOLVERS.WEIGHTED_RNG:return this._resolveWeighted(e.pool,t,i);case u.RESOLVERS.STAT_CHECK:return this._resolveWeighted(e.pool,t,i);default:return console.warn(`[OutcomeResolver] Unknown resolution type: ${e.type}`),e.pool[0]?.outcomeId||null}}_resolveFixed(e){return e[0]?.outcomeId||null}_resolveWeighted(e,t,i){let a=e.map(r=>{let n=Number(r.weight)||0;return r.modifiers&&Array.isArray(r.modifiers)&&r.modifiers.forEach(l=>{this.conditionEvaluator.evaluate(l.condition,t,i)&&(n+=Number(l.value)||0)}),{outcomeId:r.outcomeId,weight:Math.max(0,n)}}),s=a.reduce((r,n)=>r+n.weight,0);if(s<=0)return console.warn("[OutcomeResolver] Total weight is 0. Defaulting to first option."),a[0]?.outcomeId||null;let o=Math.random()*s;console.log(`[OutcomeResolver] Rolled: ${o.toFixed(2)} / ${s} (Weights: ${a.map(r=>r.weight).join(",")})`);for(let r of a){if(o<r.weight)return r.outcomeId;o-=r.weight}return a[a.length-1].outcomeId}};var ye=class{constructor(){this.evaluator=new Le,this.outcomeResolver=new Oe(this.evaluator),this.valueResolver=new fe}tryTriggerEvent(e,t,i=[]){let a=this._getValidEvents(e,t,i);if(a.length===0)return null;let s=this._selectWeightedEvent(a),o=JSON.parse(JSON.stringify(s));return o.choices&&o.choices.forEach(r=>{if(r.requirements&&r.requirements.length>0&&(this.evaluator.checkAll(r.requirements,e,t)||(r.disabled=!0)),!r.disabled&&this._getPotentialOutcomes(r,o).some(c=>c.effects&&c.effects.some(d=>d.type===u.EFFECTS.LOSE_RANDOM_CARGO))){let c=t._getActiveInventory();if(X(c)<=0){r.disabled=!0;let h=(r.text||r.title).match(/^(.*?)\s*(\(.*\))?$/),p=h?h[1]:r.text||r.title;r.text=`${p} (No Cargo to Risk)`}}this._hydrateChoiceText(r,e)}),o}getEventById(e){let t=ue.find(i=>i.id===e);return t?JSON.parse(JSON.stringify(t)):null}resolveChoice(e,t,i,a,s=null){let o=ue.find(h=>h.id===e);if(!o)throw new Error(`Event not found: ${e}`);let r=o.choices.find(h=>h.id===t);if(!r)throw new Error(`Choice not found: ${t}`);let n=this.outcomeResolver.resolve(r.resolution,i,a),l=o.outcomes[n];if(!l)return console.error(`Outcome definition missing: ${n}`),null;let c=l.title||o.template?.title||o.title||`Unknown Event (${e})`,d=[];return l.effects&&l.effects.forEach(h=>{let p=this.valueResolver.resolve(h.value,i),y={...h,value:p},g=Kt(i,a,y,l);g&&typeof g=="object"&&Object.assign(y,g),d.push(y)}),s&&s.showEventResultModal(c,l.text,d),{outcomeId:n,title:c,text:l.text,effects:d}}_getValidEvents(e,t,i){return ue.filter(a=>a.tags.some(o=>i.includes(o))?this.evaluator.checkAll(a.requirements,e,t):!1)}_selectWeightedEvent(e){let t=e.reduce((a,s)=>a+(s.weight||10),0),i=Math.random()*t;for(let a of e){let s=a.weight||10;if(i<s)return a;i-=s}return e[e.length-1]}_getPotentialOutcomes(e,t){if(!e.resolution||!t.outcomes)return[];let i=[];if(e.resolution.type===u.RESOLVERS.DETERMINISTIC){let a=e.resolution.pool[0]?.outcomeId;a&&t.outcomes[a]&&i.push(t.outcomes[a])}else(e.resolution.type===u.RESOLVERS.WEIGHTED_RNG||e.resolution.type===u.RESOLVERS.STAT_CHECK)&&e.resolution.pool.forEach(a=>{a.outcomeId&&t.outcomes[a.outcomeId]&&i.push(t.outcomes[a.outcomeId])});return i}_hydrateChoiceText(e,t){if(!e.text||!e.text.toLowerCase().includes("scale"))return;let i=/\((.*?) \* Scale\)/i;if(e.text.match(i)){let s=e.requirements?.find(o=>(o.type===u.CONDITIONS.HAS_ITEM||o.type===u.CONDITIONS.HAS_CREDITS||o.type===u.CONDITIONS.HAS_FUEL)&&typeof o.value=="object"&&o.value.scaleWith);if(s){let o=this.valueResolver.resolve(s.value,t),r="";if(s.type===u.CONDITIONS.HAS_ITEM){let n=f.COMMODITIES.find(l=>l.id===s.target);r=n?n.name:s.target}else s.type===u.CONDITIONS.HAS_CREDITS?r="Credits":s.type===u.CONDITIONS.HAS_FUEL&&(r="Fuel");e.text=e.text.replace(i,`(-${o} ${r})`)}else e.text=e.text.replace(" * Scale","")}}};var xe=class{constructor(e,t,i,a,s){this.gameState=e,this.uiManager=t,this.timeService=i,this.logger=a,this.simulationService=s,this.randomEventService=new ye,this.debugAlwaysTriggerEvents=!1}travelTo(e,t=!1){this.uiManager.resetMarketTransactionState();let{tutorials:i}=this.gameState,{navLock:a}=i;if(a&&a.screenId===x.NAVIGATION&&a.enabledElementQuery&&!a.enabledElementQuery.includes(`[data-location-id='${e}']`))return;let s=this.gameState.getState();if(s.isGameOver||s.pendingTravel)return;if(s.currentLocationId===e){this.simulationService.setScreen($.STARPORT,x.MARKET);return}let o=this.simulationService._getActiveShip();if(!o){this.uiManager.queueModal("event-modal","No Active Ship","You must have an active vessel to travel.");return}let n=this.simulationService.getEffectiveShipStats(o.id).maxFuel,l=M.getShipAttributes(o.id),d=s.player.shipStates[o.id].upgrades||[],p=s.TRAVEL_DATA[s.currentLocationId][e].fuelCost;if(t){if(((s.player.inventories[o.id]||{})[E.FOLDED_DRIVES]?.quantity||0)<=0){this.uiManager.queueModal("event-modal","Missing Component","You do not have a Folded-Space Drive to consume.");return}p=0}else{s.player.activePerks[P.NAVIGATOR]&&(p=Math.round(p*f.PERKS[P.NAVIGATOR].fuelMod));let g=M.getFuelBurnModifier(d);if(p=Math.round(p*g),l.includes("ATTR_METABOLIC_BURN")&&(p=Math.round(p*.5)),l.includes("ATTR_SOLAR_HARMONY")){let S=f.MARKETS.find(T=>T.id===s.currentLocationId)?.distance||0;(f.MARKETS.find(T=>T.id===e)?.distance||0)<S&&(p=0)}l.includes("ATTR_NEWTONS_GHOST")&&(p=0)}if(n<p){this.uiManager.queueModal("event-modal","Fuel Capacity Insufficient",`Your ship's fuel tank is too small. This trip requires ${p} fuel, but you can only hold ${n}.`);return}if(s.player.shipStates[o.id].fuel<p){this.uiManager.queueModal("event-modal","Insufficient Fuel",`You need ${p} fuel but only have ${Math.floor(s.player.shipStates[o.id].fuel)}.`);return}!(s.tutorials.activeBatchId==="intro_missions"&&s.tutorials.activeStepId==="mission_1_6")&&!t&&this._checkForRandomEvent(e)||this.initiateTravel(e,{useFoldedDrive:t})}initiateTravel(e,t={}){let i=this.gameState.getState(),a=i.currentLocationId;a===v.SUN&&this.timeService.solStationService&&this.timeService.solStationService.stopRealTimeSimulation();let s={...i.TRAVEL_DATA[a][e]},o=s.time;this.logger.info.player(i.day,"TRAVEL_START",`Departing from ${a} to ${e}.`);let r=this.simulationService._getActiveShip(),n=this.gameState.player.shipStates[r.id],l=M.getShipAttributes(r.id),c=n.upgrades||[];if(t.useFoldedDrive){s.time=0,s.fuelCost=0;let _=this.gameState.player.inventories[r.id];_&&_[E.FOLDED_DRIVES]&&(_[E.FOLDED_DRIVES].quantity=Math.max(0,_[E.FOLDED_DRIVES].quantity-1),this.uiManager.createFloatingText("-1 Folded Drive",window.innerWidth/2,window.innerHeight/2,"#ef4444"),this.logger.info.player(i.day,"ITEM_CONSUMED","Folded-Space Drive consumed for instant travel."))}else{i.player.activePerks[P.NAVIGATOR]&&(s.time=Math.round(s.time*f.PERKS[P.NAVIGATOR].travelTimeMod),s.fuelCost=Math.round(s.fuelCost*f.PERKS[P.NAVIGATOR].fuelMod));let _=M.getFuelBurnModifier(c),L=M.getTravelTimeModifier(c);if(s.fuelCost=Math.round(s.fuelCost*_),s.time=Math.max(1,Math.round(s.time*L)),l.includes("ATTR_METABOLIC_BURN")&&(s.fuelCost=Math.round(s.fuelCost*.5)),l.includes("ATTR_HYPER_CALCULATION")&&(s.time=Math.max(1,Math.round(s.time*.75))),l.includes("ATTR_SOLAR_HARMONY")){let O=f.MARKETS.find(B=>B.id===a)?.distance||0;(f.MARKETS.find(B=>B.id===e)?.distance||0)<O&&(s.fuelCost=0,this.uiManager.createFloatingText("Solar Harmony Active",window.innerWidth/2,window.innerHeight/2,"#fbbf24"))}l.includes("ATTR_NEWTONS_GHOST")&&(s.fuelCost=0,s.time*=10),l.forEach(O=>{let F=M.getDefinition(O);F.type===K.MOD_TRAVEL_TIME&&O!=="ATTR_HYPER_CALCULATION"&&F.value&&(s.time*=F.value),O==="ATTR_SLEEPER"&&(s.time*=4.5,s.fuelCost=0)}),l.includes("ATTR_SOLAR_SAIL")&&Math.random()<.15&&(s.fuelCost=0,s.time*=2,this.uiManager.createFloatingText("Solar Winds Caught!",window.innerWidth/2,window.innerHeight/2,"#60a5fa"));let N=i.player.statModifiers?.travelSpeed||0;N>0&&(s.time=s.time/(1+N)),t.travelTimeAdd&&(s.time+=t.travelTimeAdd),t.travelTimeAddPercent&&(s.time*=1+t.travelTimeAddPercent),t.setTravelTime&&(s.time=t.setTravelTime)}if(s.time=Math.max(0,Math.round(s.time)),s.fuelCost=Math.round(s.fuelCost),n.fuel<s.fuelCost){let _=f.MARKETS.find(N=>N.id===a)?.name||"Origin",L=s.time;n.fuel=0,this.timeService.advanceDays(L),this.gameState.setState({pendingTravel:null}),this.logger.info.player(this.gameState.day,"TRAVEL_STRANDED",`Stranded returning to ${_}.`),this.uiManager.eventControl&&this.uiManager.eventControl.showStrandedModal?this.uiManager.eventControl.showStrandedModal(_,L):this.uiManager.showEventResultModal("Critical Failure: Stranded",`Event delays and route deviations have pushed your fuel requirements beyond your current reserves. <br><br>Your engines sputter and die, leaving you drifting in the void. After <span class="text-result-time">${L}</span> grueling days on emergency life support, a passing freighter tows you back to <b>${_}</b>.<br><br>The rescue fees have drained your remaining fuel. Your arbitrage run has failed.`,[{type:"EFF_FUEL",value:0},{type:"EFF_TRAVEL_TIME",value:L}]),this.simulationService.setScreen($.STARPORT,x.MARKET);return}if(t.forceEvent&&this._checkForRandomEvent(e,!0))return;let d=M.getHullStressModifier(c),h=o*G.HULL_DECAY_PER_TRAVEL_DAY*d;l.includes("ATTR_XENO_HULL")||l.includes("ATTR_FLUID_HULL")||l.includes("ATTR_NO_DECAY")?h=0:l.includes("ATTR_RESILIENT")&&(h*=.5),i.player.activePerks[P.NAVIGATOR]&&(h*=f.PERKS[P.NAVIGATOR].hullDecayMod);let p=this.simulationService.getEffectiveShipStats(r.id),y=p.maxHealth*((t.eventHullDamagePercent||0)/100),g=h+y;if(n.health-=g,this.simulationService._checkHullWarnings(r.id),n.health<=0){this._handleShipDestruction(r.id);return}if(n.fuel-=s.fuelCost,this.timeService.advanceDays(s.time),this.gameState.isGameOver)return;if(this.simulationService.newsTickerService.onLocationChange(e),typeof this.gameState.player.tripCount>"u"&&(this.gameState.player.tripCount=0),this.gameState.player.tripCount++,l.includes("ATTR_TRAVELLER")&&this.gameState.player.tripCount%20===0&&(n.health=p.maxHealth,n.fuel=p.maxFuel,this.logger.info.player(i.day,"ATTR_TRIGGER","Atlas systems engaged: Hull and Fuel fully restored."),this.uiManager.createFloatingText("Systems Restored",window.innerWidth/2,window.innerHeight/2,"#34d399")),l.includes("ATTR_OSSEOUS_REGROWTH")){let _=p.maxHealth*.1;n.health<p.maxHealth&&(n.health=Math.min(p.maxHealth,n.health+_),this.uiManager.createFloatingText("Hull Regenerated",window.innerWidth/2,window.innerHeight/2,"#e2e8f0"))}if(l.includes("ATTR_FUEL_SCOOP")){let _=p.maxFuel*.15;n.fuel=Math.min(p.maxFuel,n.fuel+_)}if(l.includes("ATTR_MATTER_ABSORPTION")&&!t.useFoldedDrive){let _=s.fuelCost*.5;_>0&&(n.fuel=Math.min(p.maxFuel,n.fuel+_),this.uiManager.createFloatingText(`Fuel Refunded: +${Math.round(_)}`,window.innerWidth/2,window.innerHeight/2+30,"#991b1b"))}this.gameState.setState({currentLocationId:e,pendingTravel:null});let S=f.MARKETS.find(_=>_.id===a),b=f.MARKETS.find(_=>_.id===e);if(!S||!b){this.logger.error("TravelService",`Invalid location ID provided for travel animation. From: ${a}, To: ${e}`),this.uiManager.queueModal("event-modal","Navigation Error","Could not plot a course. The destination is unknown.");return}let T=g/p.maxHealth*100;this.logger.info.player(this.gameState.day,"TRAVEL_END",`Arrived at ${e}.`,{fuelUsed:s.fuelCost,hullDamage:T.toFixed(2)+"%"});let A=()=>{this.simulationService.missionService&&this.simulationService.missionService.checkTriggers(),e===v.SUN&&this.timeService.solStationService&&this.timeService.solStationService.startRealTimeSimulation(),this.gameState.tutorials.activeBatchId==="intro_missions"&&this.gameState.tutorials.activeStepId==="mission_1_7"&&e===v.LUNA?this.simulationService.setScreen($.DATA,x.MISSIONS):this.simulationService.setScreen($.STARPORT,x.MARKET)};this.uiManager.showTravelAnimation(S,b,s,T,A)}resumeTravel(){if(!this.gameState.pendingTravel)return;this.logger.info.system("Game",this.gameState.day,"TRAVEL_RESUME","Resuming travel after event.");let{destinationId:e,...t}=this.gameState.pendingTravel;this.initiateTravel(e,t)}_checkForRandomEvent(e,t=!1){let i=this.simulationService._getActiveShip(),s=this.gameState.player.shipStates[i.id].upgrades||[],o=M.getShipAttributes(i.id),r=G.RANDOM_EVENT_CHANCE;this.debugAlwaysTriggerEvents&&(r=1,this.logger.warn("TravelService","DEBUG: Event chance forced to 100%."));let n=M.getEventChanceModifier(s);if(r+=n,o.includes("ATTR_ADVANCED_COMMS")&&(r*=1.25),t===!1&&Math.random()>r)return!1;let l;if(typeof t=="number")l=f.RANDOM_EVENTS[t];else{let h=[u.TAGS.SPACE];l=this.randomEventService.tryTriggerEvent(this.gameState,this.simulationService,h)}if(!l)return!1;this.logger.info.system("Event",this.gameState.day,"EVENT_TRIGGER",`Triggered random event: ${l.title}`);let c=this.gameState.currentLocationId,d=this.gameState.TRAVEL_DATA[c]?.[e]?.time||7;return this.gameState.setState({pendingTravel:{destinationId:e,days:d}}),this.uiManager.showRandomEventModal(l,h=>this._resolveEventChoice(l.id,h)),!0}_resolveEventChoice(e,t){let i=this.randomEventService.resolveChoice(e,t,this.gameState,this.simulationService);if(!i){this.logger.error("TravelService","Event resolution returned null."),this.resumeTravel();return}let a="";i.effects&&i.effects.length>0&&(a='<ul class="list-none text-sm text-gray-400 mt-4 space-y-1">',i.effects.forEach(s=>{let o="";switch(s.type){case"EFF_CREDITS":o=`Credits: ${s.value>0?"+":""}${I(s.value)}`;break;case"EFF_FUEL":o=`Fuel: ${s.value>0?"+":""}${Math.round(s.value)}`;break;case"EFF_HULL":o=`Hull: ${s.value>0?"+":""}${Math.round(s.value)}`;break;case"EFF_TRAVEL_TIME":case"EFF_MODIFY_TRAVEL":o=`Travel Time: ${s.value>0?"+":""}${Math.round(s.value)} Days`;break;case"EFF_ADD_ITEM":o=`Received: ${Math.round(s.value)}x ${s.target}`;break;case"EFF_REMOVE_ITEM":o=`Removed: ${Math.round(s.value)}x ${s.target}`;break;case"EFF_LOSE_RANDOM_CARGO":o=`Cargo Lost: ${Math.round(s.value*100)}%`;break;default:o="Effect Applied"}a+=`<li>${o}</li>`}),a+="</ul>"),this.logger.info.player(this.gameState.day,"EVENT_CHOICE",`Chose outcome: ${i.outcomeId}`),this.uiManager.queueModal("event-result-modal",i.title,i.text+a,()=>this._postEventCheck(),{dismissOutside:!0,buttonText:"Continue Journey"})}_postEventCheck(){let e=this.simulationService._getActiveShip();if(!e){this.resumeTravel();return}if(e.health<=0){this.gameState.pendingTravel=null,this._handleShipDestruction(e.id);return}e.fuel<=0&&(this.gameState.player.shipStates[e.id].fuel=0),this.resumeTravel()}_handleShipDestruction(e){let t=f.SHIPS[e].name;if(this.logger.error("TravelService",`Ship ${t} was destroyed.`),this.gameState.player.ownedShipIds=this.gameState.player.ownedShipIds.filter(i=>i!==e),delete this.gameState.player.shipStates[e],delete this.gameState.player.inventories[e],this.gameState.player.ownedShipIds.length===0)this.simulationService._gameOver(`Your last ship, the ${t}, was destroyed. Your trading career ends here.`);else{this.gameState.player.activeShipId=this.gameState.player.ownedShipIds[0];let i=f.SHIPS[this.gameState.player.activeShipId].name,a=`The ${t} suffered a catastrophic hull breach and was destroyed. All cargo was lost.<br><br>You now command your backup vessel, the ${i}.`;this.uiManager.queueModal("event-modal","Vessel Lost",a)}this.gameState.setState({})}};var le={CORP_FAILURE_01:{sample:"We've flagged a minor subsidiary going into receivership.",details:'A parent corp is cutting its losses and dissolving a failed venture that was flagged for going into receivership. They are dumping all assets to avoid Guild fees.<br><br>This has created a temporary surplus of [commodity name] at [location name] for [discount amount %] off market value.<br><br>The liquidation is scheduled to be finalized by creditors in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},CORP_FAILURE_02:{sample:"A corporate partner's trade charter has just been revoked.",details:`Following a trade charter revocation, the corporate state has seized a partner's assets and is holding a no-notice auction to pay their local debts.<br><br>We've secured a manifest: [commodity name] is available at [location name] for [discount amount %] below its valuation.<br><br>This is a one-time, unlisted auction ending in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},CORP_FAILURE_03:{sample:"Our analysts project a high-profile bankruptcy announcement is imminent.",details:`A firm our analysts flagged for imminent bankruptcy is in a death spiral and has begun a shadow liquidation to pay its key investors before the public announcement.<br><br>This means a large cache of [commodity name] is available at [location name] for [discount amount %] off.<br><br>The firm's assets will be frozen by the Guild in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},CORP_FAILURE_04:{sample:"A corporate buyout we were tracking has just turned hostile.",details:'A corporate buyout has turned hostile, and the losing entity is being stripped by the new owners. All non-essential inventories are being sold off immediately.<br><br>They are clearing out all [commodity name] at [location name] for [discount amount %] below market price.<br><br>This fire sale will be over once the transition is complete in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},CORP_FAILURE_05:{sample:"We've confirmed a local governor has seized a corporation's assets.",details:`A local governor has seized a corporation's assets and is using a legal loophole to auction all seized goods for a public works fund, and they need it done fast.<br><br>This has resulted in a surplus of [commodity name] at [location name], now available for [discount amount %] off.<br><br>This asset seizure auction will close in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},LOGISTICS_FAILURE_01:{sample:"Tracking a freighter captain who just paid a massive Guild fine.",details:'A freighter captain, having just paid a massive Guild fine for an improper manifest, is now selling cargo at a loss to cover port fees.<br><br>Their entire hold of [commodity name] is being sold at [location name] for [discount amount %] off.<br><br>The ship is scheduled to be released and will depart in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},LOGISTICS_FAILURE_02:{sample:"We've confirmed a long-haul freighter has suffered critical damage.",details:`We've confirmed a long-haul freighter is too damaged to complete its journey. The captain is dumping their entire cargo hold to pay for emergency repairs.<br><br>This has created a buyer's market for [commodity name] at [location name], with goods going for [discount amount %] off.<br><br>The repairs are estimated to be complete in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},LOGISTICS_FAILURE_03:{sample:"A major port is experiencing a catastrophic logistics backlog.",details:'A major port is experiencing a catastrophic logistics backlog due to a system failure, leaving dozens of ships unable to dock. Captains are panic-selling cargo at a discount.<br><br>A significant surplus of [commodity name] is available at [location name] for [discount amount %] off.<br><br>The port authority expects to have the system back online in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},LOGISTICS_FAILURE_04:{sample:"A high-priority supply contract was just canceled mid-transport.",details:'A high-priority supply contract was canceled mid-transport, leaving a freighter stuck with a full hold of bespoke goods and no buyer. The captain is selling the entire shipment for pennies.<br><br>Their cargo of [commodity name] is available at [location name] for [discount amount %] off.<br><br>The captain will dump the cargo as scrap if not sold in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},LOGISTICS_FAILURE_05:{sample:"Pirate activity has forced a freighter miles off-route.",details:'A freighter, forced miles off-route by pirate activity, survived the encounter but burned too much fuel. They are selling valuable cargo to afford the refuel.<br><br>A stock of [commodity name] is being sold at [location name] for [discount amount %] below value.<br><br>The ship will refuel and depart in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},PRODUCTION_ERROR_01:{sample:"An automated factory's quarterly quota was massively miscalculated.",details:'A logistical AI at an automated factory put a decimal in the wrong place, resulting in a 100x surplus. The factory is dumping it before auditors arrive.<br><br>They are quietly liquidating [commodity name] at [location name] for [discount amount %] off.<br><br>The audit is scheduled for [durationDays], at which point this deal vanishes.<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},PRODUCTION_ERROR_02:{sample:"A major manufacturing line is retooling for a new-gen product.",details:`A major manufacturing line is retooling for a new-gen product, and all old-generation materials are being cleared out to make room. It's all considered scrap to them.<br><br>This means all [commodity name] stock is available at [location name] for [discount amount %] off.<br><br>The retooling will be complete in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},PRODUCTION_ERROR_03:{sample:"A recent batch of high-spec goods failed its final QA check.",details:'A shipment of high-spec goods failed its 99.9% purity standard. The corporation is selling this sub-par but still excellent stock at a loss.<br><br>This entire batch of [commodity name] is available at [location name] for [discount amount %] off.<br><br>The shipment will be disposed of if not sold in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},PRODUCTION_ERROR_04:{sample:"We're tracking an industrial AI experiencing... anomalies.",details:'An industrial AI has been experiencing anomalies, ordering triple the required raw materials for weeks, and the local warehouse is now overflowing.<br><br>They are selling excess [commodity name] at [location name] for [discount amount %] off to clear space.<br><br>A diagnostic and reset is scheduled for [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},PRODUCTION_ERROR_05:{sample:"A new, experimental production line has... unexpected byproducts.",details:'A test run of a new, experimental manufacturing process has, ironically, created a massive surplus of a key component. The R&D lab is selling it off-book.<br><br>This surplus of [commodity name] is available at [location name] for [discount amount %] off.<br><br>The test run concludes and the line is shut down in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},REGULATORY_ERROR_01:{sample:"A new interstellar tariff is being announced in 48 hours.",details:`We've seen the memo for a new interstellar tariff being announced in 48 hours. Suppliers are desperately dumping all pre-tariff stock to avoid the new, massive tax.<br><br>This panic-sell means [commodity name] is available at [location name] for [discount amount %] off.<br><br>This regulatory loophole will snap shut in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},REGULATORY_ERROR_02:{sample:"A Guild auditor just made a surprise visit to a local port.",details:`A Guild auditor's surprise visit has a local port authority in a panic. They are auctioning all unclaimed and improperly manifested cargo immediately. No questions asked.<br><br>A large lot of [commodity name] is available at [location name] for [discount amount %] off.<br><br>The audit will be complete and the auction closed in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},REGULATORY_ERROR_03:{sample:"We've flagged a shipment seized for manifest violations.",details:'A shipment was seized for manifest violations, declared contraband on a technicality. The local authorities are now selling it at a disposal auction.<br><br>This seized shipment of [commodity name] is available at [location name] for [discount amount %] off.<br><br>The auction is unlisted and ends in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},REGULATORY_ERROR_04:{sample:"A local trade license has been unexpectedly revoked.",details:`A company's local trade license has been unexpectedly revoked, barring them from trading. Their entire inventory is being sold off by Guild-appointed receivers.<br><br>This has created a one-time surplus of [commodity name] at [location name], available for [discount amount %] off.<br><br>The receivers' sale will end in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},REGULATORY_ERROR_05:{sample:"A health inspector has quarantined a station's cargo bay.",details:`A (likely faked) health scare from an inspector has forced the liquidation of all perishable goods in a quarantined cargo bay. The corporation is writing it off as a total loss.<br><br>This means all [commodity name] in the bay is being sold at [location name] for [discount amount %] off.<br><br>The bay will be 'sterilized' and the remaining stock destroyed in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},INSIDER_INTEL_01:{sample:"A high-level corporate executive is about to be retired.",details:`A high-level corporate exec knows they are being forced out and is panic-selling all their personal and corporate assets before they are frozen.<br><br>This includes a private stash of [commodity name], available at [location name] for [discount amount %] off.<br><br>The exec's accounts will be seized in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},INSIDER_INTEL_02:{sample:"We've identified a shell corporation that is being dissolved.",details:`A shell corporation we identified as a smuggling front is being dissolved. Its 'legitimate' assets are being rapidly absorbed into the public market.<br><br>This has created a shadow surplus of [commodity name] at [location name] for [discount amount %] off.<br><br>The assets will be fully liquidated in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},INSIDER_INTEL_03:{sample:"A rival corporation is initiating a hostile price war.",details:'A rival corporation is intentionally flooding the market to bankrupt a competitor. This has temporarily, and artificially, crashed the price.<br><br>This means [commodity name] is available at [location name] for [discount amount %] below its actual value.<br><br>We project the smaller firm will fold and prices will stabilize in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},INSIDER_INTEL_04:{sample:"We have a tip from a disgruntled corporate officer.",details:'A disgruntled corporate officer is about to blow the whistle on a major product line failure and is dumping their personal stock before the news breaks.<br><br>This fire sale on [commodity name] is happening at [location name] for [discount amount %] off.<br><br>The announcement is expected in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},INSIDER_INTEL_05:{sample:"An info-broker is dumping physical assets for liquid credits.",details:'A rival info-broker is restructuring and needs cash, fast. They are selling their entire non-data inventory at a loss.<br><br>Their holdings of [commodity name] are available at [location name] for [discount amount %] off.<br><br>This is a one-time offer, ending in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},DEMAND_SPIKE_01:{sample:"A critical supply freighter has just been declared lost with all hands.",details:'A critical supply freighter has been declared lost with all hands, creating a system-wide shortage of a key material. Buyers are paying a massive premium.<br><br>The market for [commodity name] at [location name] is buying at [discount amount %] over galactic average.<br><br>This bubble will pop when replacement shipments arrive in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},DEMAND_SPIKE_02:{sample:"A major factory just suffered a catastrophic failure.",details:`A major factory just suffered a catastrophic failure. As the system's primary supplier of a key component, the supply chain has collapsed.<br><br>Demand for [commodity name] at [location name] has skyrocketed, with prices at [discount amount %] above normal.<br><br>This shortage is expected to last [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},DEMAND_SPIKE_03:{sample:"We've intercepted a project's emergency supply request.",details:`We've intercepted an emergency supply request from a major terraforming project that has a massive, miscalculated shortfall. They are paying any price.<br><br>They are buying [commodity name] at [location name] for [discount amount %] over market value.<br><br>Their emergency charter is expected to be filled in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.`},DEMAND_SPIKE_04:{sample:"A local warehouse was just breached by... something.",details:'The entire local stock of a commodity was destroyed after a warehouse breach. This has created a sudden, desperate demand from local industries.<br><br>The local market for [commodity name] at [location name] is paying [discount amount %] above average.<br><br>This localized shortage will be resolved in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'},DEMAND_SPIKE_05:{sample:"A new, unexpected corporate construction charter was just approved.",details:'A new, unexpected corporate construction charter was just approved. The corporation is rushing to build and is paying a premium to bypass normal supply channels.<br><br>Their project managers are buying [commodity name] at [location name] for [discount amount %] above the average price.<br><br>This buy-order will be filled in [durationDays].<br><br>You paid <span class="credits-text-pulsing">\u232C [credit price]</span> for this intel.'}};var Xt={tier1:["Minor price drop for {Commodity Name}.","Low prices reported for {Commodity Name}.","{Commodity Name} trending below average.","{Commodity Name}: Favorable pricing reported.","Good time to buy {Commodity Name}.","It's a buyer's market for {Commodity Name}."],tier2:["{Commodity Name} prices are looking good.","{Commodity Name} is on sale.","Exceptional pricing available for {Commodity Name}.","Act now for the best price on {Commodity Name}.","Get your cheap {Commodity Name} now!","{Commodity Name} is trading far below average.","Get {Commodity Name} for cheap while you can.","Traders are eyeing cheap {Commodity Name}.","Now is the time to acquire {Commodity Name}.","Capitalize on falling {Commodity Name} prices.","Solid discount on {Commodity Name}."],tier3:["Don't miss out: {Commodity Name} is a bargain.","Prime buying opportunity for {Commodity Name}.","{Commodity Name}: Prices slashed!","{Commodity Name} is a 'hot buy' right now.","{Commodity Name} is a steal at this price.","Significant price drop for {Commodity Name}.","Traders report massive discounts on {Commodity Name}.","Unbeatable deals on {Commodity Name} right now.","Deep discounts on {Commodity Name}!","{Commodity Name} value has dropped significantly.","{Commodity Name} prices are tumbling."],tier4:["{Commodity Name} prices are nosediving.","{Commodity Name} prices have plummeted!","Major price correction for {Commodity Name}.","Fire sale! Get your {Commodity Name} while it lasts.","{Commodity Name} prices are getting crushed.","{Commodity Name} is practically a giveaway."],tier5:["{Commodity Name}: Prices have never been lower.","Historic lows for {Commodity Name}.","{Commodity Name} prices hit rock-bottom!","{Commodity Name} prices are in freefall.","Price crash reported for {Commodity Name}.","Market update: {Commodity Name} valuation has collapsed.","{Commodity Name} is being sold for scrap prices.","{Commodity Name}: Total market collapse!","{Commodity Name} is virtually worthless."]},pt=["Prime buying opportunity for {Commodity Name} at {Location Name}!","{Location Name} reports massive discounts on {Commodity Name}!","{Commodity Name} is a steal at {Location Name} right now!","Don't miss out: {Commodity Name} is a bargain at {Location Name}!","{Location Name}: Prices slashed on {Commodity Name}!","Head to {Location Name} for deep discounts on {Commodity Name}!","Traders flocking to {Location Name} for cheap {Commodity Name}!","Significant price drops for {Commodity Name} at {Location Name}!","{Location Name} is the hot spot to buy {Commodity Name}!","Unbeatable deals on {Commodity Name} available at {Location Name}!","{Location Name} is dumping its {Commodity Name} stock!","Get to {Location Name}! {Commodity Name} prices are nosediving!","{Commodity Name} prices have plummeted at {Location Name}!","{Location Name} is practically giving away {Commodity Name}!","Fire sale on {Commodity Name} at {Location Name}!","{Commodity Name} prices are getting crushed at {Location Name}!","{CommodITY Name} market is in a freefall at {Location Name}!","Rumor: A major holder just dumped {Commodity Name} at {Location Name}!","{Commodity Name} selling for practically nothing at {Location Name}!","Price crash! {Commodity Name} is worthless at {Location Name}!","The {Commodity Name} market has collapsed at {Location Name}!","Historic lows for {Commodity Name} reported at {Location Name}!","{Location Name}: {Commodity Name} prices have hit rock-bottom!","Total market failure for {Commodity Name} at {Location Name}!","{Location Name} can't get rid of its {Commodity Name}!","{Commodity Name}: Prices have never been lower at {Location Name}!","{Commodity Name} is being sold for scrap prices at {Location Name}!","{Location Name}'s {Commodity Name} valuation has evaporated!"];var Ne=class{constructor(e,t,i,a,s){this.gameState=e,this.timeService=t,this.marketService=i,this.newsTickerService=a,this.logger=s,this.db=f}generateIntelRefresh(){this.logger.info.system("IntelService",this.gameState.day,"REFRESH","Generating intel refresh for all markets.");let t=this.gameState.getState().intelMarket;for(let i of Object.keys(t)){let a=t[i].filter(s=>s.isPurchased);t[i]=a}for(let i of this.db.MARKETS){let a=i.id;if(t[a]||(t[a]=[]),Math.random()<.7){let s=t[a].map(n=>n.messageKey).filter(Boolean),o=new Set,r=1+Math.floor(Math.random()*3);for(let n=0;n<r;n++){let l=[...s,...o],c=this._createPacket(a,l);c&&(t[a].push(c),o.add(c.messageKey))}}}this.gameState.setState({intelMarket:t})}_createPacket(e,t=[]){let i=this.gameState.getState(),a=i.player.revealedTier,s=this.db.COMMODITIES.filter(T=>T.tier<=a).map(T=>T.id);if(!s||s.length===0)return this.logger.warn("IntelService","Cannot create packet: No unlocked commodities available for player's tier."),null;let o=i.player.unlockedLocationIds||[],n=this.db.MARKETS.map(T=>T.id).filter(T=>T!==e&&o.includes(T));if(n.length===0)return this.logger.info.system("IntelService",`Cannot create packet: No *unlocked* deal locations available (excluding ${e}).`),null;let l=n[Math.floor(Math.random()*n.length)],c=s[Math.floor(Math.random()*s.length)],d=.15+Math.random()*.35,h=30+Math.floor(Math.random()*61),p=1+d*2+h/90,y=Object.keys(le);if(y.length===0)return this.logger.warn("IntelService","Cannot create packet: INTEL_CONTENT is empty."),null;let g=y.filter(T=>!t.includes(T)),S;return g.length===0?(this.logger.warn("IntelService",`All message keys for ${e} are in use. Reusing a key to generate packet.`),S=y[Math.floor(Math.random()*y.length)]):S=g[Math.floor(Math.random()*g.length)],{id:`pkt_${e.replace("loc_","")}_${this.timeService.getCurrentDay()}_${Math.floor(Math.random()*999)}`,locationId:e,dealLocationId:l,commodityId:c,discountPercent:parseFloat(d.toFixed(2)),durationDays:h,valueMultiplier:parseFloat(p.toFixed(2)),messageKey:S,isPurchased:!1}}calculateIntelPrice(e){let t=this.gameState.getState(),i=t.player.credits,a=t.currentLocationId,s=t.player.activeShipId,o=i*(.1+Math.random()*.1);a===v.VENUS&&(o*=.5);let r=o*e.valueMultiplier,n=t.player.statModifiers?.intelCost||0;return n>0&&(r*=1-n),M.getShipAttributes(s).includes("ATTR_WHISPER_NETWORK")&&(r*=.5),Math.floor(r/100)*100}purchaseIntel(e,t,i){let a=this.gameState.getState();if(a.activeIntelDeal!==null)return this.logger.warn("IntelService","Purchase aborted: A deal is already active."),null;if(a.player.credits<i)return this.logger.warn("IntelService","Purchase aborted: Insufficient credits."),null;let s=a.intelMarket,o=s[t]?.find(b=>b.id===e);if(!o)return this.logger.error("IntelService",`Purchase failed: Could not find packetId ${e} in live market at ${t}.`),null;o.isPurchased=!0,o.pricePaid=i,this.logger.info.player(a.day,"INTEL_PURCHASE",`Purchased intel packet ${o.id} for ${I(i)}`);let r={...a.player};r.credits-=i;let n=this.marketService.getGalacticAverage(o.commodityId),l=Math.floor(n*(1-o.discountPercent)),c=o.dealLocationId,d=this.gameState.TRAVEL_DATA[a.currentLocationId][c].time;a.player.activePerks[P.NAVIGATOR]&&(d=Math.round(d*this.db.PERKS[P.NAVIGATOR].travelTimeMod));let h=1.9;a.currentLocationId===v.VENUS&&(h*=2);let p=a.player.statModifiers?.intelDuration||0;p>0&&(h*=1+p);let y=Math.ceil(d*h),g=this.timeService.getCurrentDay()+y;this.logger.info.system("IntelService",a.day,"INTEL_DURATION",`Intel deal for ${o.commodityId} at ${c} will last ${y} days (Multiplier: ${h}). Expires on Day ${g}.`),o.expiryDay=g;let S={locationId:o.dealLocationId,commodityId:o.commodityId,overridePrice:l,expiryDay:g,sourcePacketId:o.id,sourceSaleLocationId:t};try{let b=this.db.COMMODITIES.find(L=>L.id===o.commodityId)?.name||"goods",T=this.db.MARKETS.find(L=>L.id===o.dealLocationId)?.name||"a local market",_=pt[Math.floor(Math.random()*pt.length)].replace("{Commodity Name}",b).replace("{Location Name}",T);this.newsTickerService.pushMessage(_,"INTEL",!0)}catch(b){this.logger.error("IntelService","Failed to push news ticker message.",b)}return this.gameState.setState({player:r,activeIntelDeal:S,intelMarket:s}),o}getGalacticAverage(e){return this.marketService.getGalacticAverage(e)}getCurrentDay(){return this.timeService.getCurrentDay()}};var ne={off_ops_alpha:{id:"off_ops_alpha",name:"Cmdr. Harken",role:"Operations",description:"A veteran of the Jupiter run. Specialized in structural integrity and decay mitigation.",buffs:{entropy:-.05,creditMult:0,amMult:0}},off_ops_beta:{id:"off_ops_beta",name:"Lt. Syla",role:"Operations",description:"Former station architect. Her maintenance algorithms are highly efficient.",buffs:{entropy:-.1,creditMult:0,amMult:0}},off_log_alpha:{id:"off_log_alpha",name:"Broker Krell",role:"Logistics",description:"A ruthless negotiator who squeezes every credit out of station commerce.",buffs:{entropy:0,creditMult:.15,amMult:0}},off_log_beta:{id:"off_log_beta",name:"Quartermaster Vance",role:"Logistics",description:"Optimizes supply chains to maximize commercial throughput.",buffs:{entropy:0,creditMult:.25,amMult:0}},off_eng_alpha:{id:"off_eng_alpha",name:"Dr. Aris",role:"Engineering",description:"Particle physicist obsessed with maximizing collider efficiency.",buffs:{entropy:0,creditMult:0,amMult:.1}},off_eng_beta:{id:"off_eng_beta",name:"Chief O'Rin",role:"Engineering",description:"Pushing the reactor beyond safety limits is his specialty.",buffs:{entropy:.05,creditMult:0,amMult:.3}}};var De=120,zt=150,mt={STABILITY:{id:"STABILITY",creditsPerSec:35,amPerSec:.12,decayPerSec:25e-5,entropyMult:1},COMMERCE:{id:"COMMERCE",creditsPerSec:140,amPerSec:.12,decayPerSec:75e-5,entropyMult:3},PRODUCTION:{id:"PRODUCTION",creditsPerSec:35,amPerSec:.48,decayPerSec:.0012,entropyMult:4}},ke=class{constructor(e,t){this.gameState=e,this.logger=t,this.simulationInterval=null,this.lastTickTime=0}startRealTimeSimulation(){this.simulationInterval||(this.logger.info.system("SolStation",this.gameState.day,"SIM_START","Station real-time simulation active."),this.lastTickTime=performance.now(),this.simulationInterval=setInterval(()=>{let e=performance.now(),t=(e-this.lastTickTime)/1e3;this.lastTickTime=e;let i=Math.min(t,86400);this.processRealTimeTick(i)},1e3))}stopRealTimeSimulation(){this.simulationInterval&&(clearInterval(this.simulationInterval),this.simulationInterval=null,this.logger.info.system("SolStation",this.gameState.day,"SIM_STOP","Station real-time simulation paused."))}processTimeStep(e=1){if(!this.gameState.solStation.unlocked)return;let i=e*De;this._executeLogic(i,e)}processRealTimeTick(e){if(!this.gameState.solStation.unlocked)return;let i=e/De;this._executeLogic(e,i)}_executeLogic(e,t){let i=this.gameState.solStation,a=mt[i.mode],s=this.getOfficerBuffs(),o=this.calculateEntropy(a.entropyMult),r=0,n=0,l=Object.entries(i.caches).filter(([d,h])=>d!==E.FOLDED_DRIVES&&d!==E.ANTIMATTER&&h.max>0);for(let[d,h]of l){let y=h.max*a.decayPerSec*e*o;h.current>0&&(h.current=Math.max(0,h.current-y));let g=h.max>0?h.current/h.max:0;r+=g,n++}let c=n>0?r/n:0;if(i.health=Math.round(c*100),i.health>0){let d=c;c<.5&&(d=2*Math.pow(c,2));let h=a.creditsPerSec*e,p=a.amPerSec*e;h*=1+s.creditMult,p*=1+s.amMult,h*=d,p*=d,i.stockpile.credits+=h,i.stockpile.antimatter<zt&&(i.stockpile.antimatter=Math.min(zt,i.stockpile.antimatter+p)),t>=1&&i.health<20&&this.logger.info.system("SolStation",this.gameState.day,"CRITICAL",`Station health critical (${i.health}%). Efficiency plummeting.`)}}calculateEntropy(e){let t=e,i=this.getOfficerBuffs();return t+=i.entropy,Math.max(.1,t)}getOfficerBuffs(){let e=this.gameState.solStation,t={entropy:0,creditMult:0,amMult:0};return e.officers.forEach(i=>{if(i.assignedOfficerId&&ne[i.assignedOfficerId]){let a=ne[i.assignedOfficerId].buffs;t.entropy+=a.entropy,t.creditMult+=a.creditMult,t.amMult+=a.amMult}}),t}setMode(e){mt[e]&&(this.gameState.solStation.mode=e,this.logger.info.player(this.gameState.day,"STATION_MODE",`Sol Station mode switched to ${e}`),this.gameState.setState({}))}donateToCache(e,t){let i=this.gameState.solStation,a=i.caches[e],s=this.gameState.player.inventories[this.gameState.player.activeShipId];if(!a)return{success:!1,message:"Invalid cache commodity."};if(!s[e]||s[e].quantity<t)return{success:!1,message:"Insufficient cargo."};let o=a.max-a.current;if(t>o)return{success:!1,message:`Cache full. Can only accept ${Math.floor(o)} units.`};s[e].quantity-=t,a.current+=t;let r=0,n=0,l=Object.entries(i.caches).filter(([d,h])=>d!==E.FOLDED_DRIVES&&d!==E.ANTIMATTER&&h.max>0);for(let[d,h]of l)r+=h.current/h.max,n++;let c=n>0?r/n:0;return i.health=Math.round(c*100),this.logger.info.player(this.gameState.day,"STATION_DONATION",`Donated ${t}x ${e} to cache.`),this.gameState.setState({}),{success:!0,message:"Resources transferred."}}claimStockpile(e=null){let t=this.gameState.solStation.stockpile,i=this.gameState.player.inventories[this.gameState.player.activeShipId],a=0,s=0;if((!e||e==="credits")&&t.credits>0){let r=Math.floor(t.credits);this.gameState.player.credits+=r,a=r,t.credits-=r,t.credits<.1&&(t.credits=0)}if((!e||e==="antimatter")&&t.antimatter>=1){let r=Math.floor(t.antimatter);i[E.ANTIMATTER]||(i[E.ANTIMATTER]={quantity:0,avgCost:0}),i[E.ANTIMATTER].quantity+=r,s=r,t.antimatter-=r}if(a===0&&s===0)return{success:!1,message:"Nothing to collect."};this.gameState.setState({});let o=[];return a>0&&o.push(`${a} Cr`),s>0&&o.push(`${s} AM`),{success:!0,message:`Collected ${o.join(" & ")}.`}}getProjectedOutput(){let e=this.gameState.solStation,t=mt[e.mode],i=e.health/100,a=this.getOfficerBuffs(),s=i;i<.5&&(s=2*Math.pow(i,2));let o=Math.floor(t.creditsPerSec*De*(1+a.creditMult)*s),r=(t.amPerSec*De*(1+a.amMult)*s).toFixed(2),n=this.calculateEntropy(t.entropyMult);return{credits:o,antimatter:r,entropy:n}}assignOfficer(e,t){let i=this.gameState.solStation,a=i.officers.findIndex(r=>r.slotId===parseInt(e));if(a===-1)return!1;let s=t?ne[t]?.name||t:"None",o=t?"assigned":"unassigned";return i.officers[a].assignedOfficerId=t,this.logger.info.player(this.gameState.day,"OFFICER_ASSIGN",`Officer ${s} ${o} to Slot ${e}.`),this.gameState.setState({}),!0}};var Pe=class{constructor(e,t,i,a){this.gameState=e,this.uiManager=t,this.logger=i,this.newsTickerService=a,this.tutorialService=null,this.missionService=null,this.intelService=null,this.marketService=new Re(e),this.timeService=new we(e,this.marketService,t,i,a),this.travelService=new xe(e,t,this.timeService,i,this),this.introService=new Ce(e,t,i,this),this.playerActionService=new Me(e,t,null,this.marketService,this.timeService,i,this),this.randomEventService=new ye,this.solStationService=new ke(e,i),this.timeService.solStationService=this.solStationService,this.intelService=new Ne(e,this.timeService,this.marketService,this.newsTickerService,i),this.timeService.intelService=this.intelService,this.uiManager.setIntelService(this.intelService),this.timeService.simulationService=this,this.uiManager.setSimulationService(this),this.newsTickerService.setServices(this,this.marketService),this.gameState.currentLocationId===v.SUN&&this.solStationService.startRealTimeSimulation()}setTutorialService(e){this.tutorialService=e}setMissionService(e){this.missionService=e,this.playerActionService.missionService=e}forceTriggerEvent(e){let t=this.randomEventService.getEventById(e);if(!t){this.logger.error("SimulationService",`Cannot force trigger event: ID '${e}' not found.`);return}this.logger.info.system("SimulationService",this.gameState.day,"EVENT_FORCE",`Debug forcing event: ${t.template.title}`);let i={...t};i.choices&&(i.choices=t.choices.map(a=>{let s=this.randomEventService.evaluator.checkAll(a.requirements,this.gameState,this);return{...a,disabled:!s}})),this.uiManager.showRandomEventModal(i,a=>{this.resolveEventChoice(e,a)})}resolveEventChoice(e,t){let i=this.randomEventService.resolveChoice(e,t,this.gameState,this);i&&(this._applyEventEffects(i.effects),this.uiManager.showEventResultModal(i.title,i.text,i.effects,()=>this._handlePostForceEvent()))}_handlePostForceEvent(){let e=this._getActiveShip();if(e){if(e.health<=0){this.gameState.pendingTravel&&(this.gameState.pendingTravel=null),this.travelService&&this.travelService._handleShipDestruction(e.id);return}if(e.fuel<=0){this.gameState.pendingTravel&&(this.gameState.pendingTravel=null),this.gameState.player.shipStates[e.id].fuel=0,this.logger.info.player(this.gameState.day,"EVENT_FAIL","Ship ran out of fuel (Forced Event). Towed back to port.");let t=this.gameState.currentLocationId,i=f.MARKETS.find(s=>s.id===t),a=i?i.name:"Port";this.uiManager.queueModal("event-modal","Fuel Depleted",`Your engines sputter and die. A passing freighter tows you back to <b>${a}</b>.`),this.gameState.setState({})}}}_applyEventEffects(e){e.forEach(t=>{switch(t.type){case"EFF_CREDITS":this.gameState.player.credits+=t.value;break;case"EFF_FUEL":let i=this._getActiveShip();i&&(this.gameState.player.shipStates[i.id].fuel=Math.max(0,Math.min(i.maxFuel,i.fuel+t.value)));break;case"EFF_HULL":let a=this._getActiveShip();a&&(this.gameState.player.shipStates[a.id].health=Math.max(0,Math.min(a.maxHealth,a.health+t.value)));break;case"EFF_TRAVEL_TIME":case"EFF_MODIFY_TRAVEL":this.gameState.pendingTravel&&(this.gameState.pendingTravel.travelTimeAdd=(this.gameState.pendingTravel.travelTimeAdd||0)+t.value);break;case"EFF_ADD_ITEM":let s=this._getActiveInventory();s&&s[t.target]&&(s[t.target].quantity+=t.value);break;case"EFF_REMOVE_ITEM":let o=this._getActiveInventory();o&&o[t.target]&&(o[t.target].quantity=Math.max(0,o[t.target].quantity-t.value));break;case"EFF_ADD_RANDOM_CARGO":break;case"EFF_LOSE_RANDOM_CARGO":break}}),this.gameState.setState({})}startIntroSequence(){this.introService.start()}handleIntroClick(e){this.introService.handleIntroClick(e)}_continueIntroSequence(e){this.introService.continueAfterTutorial(e)}buyItem(e,t){return this.playerActionService.buyItem(e,t)}sellItem(e,t){return this.playerActionService.sellItem(e,t)}async buyShip(e,t){let i=this.playerActionService.validateBuyShip(e);if(!i.success)return this.uiManager.queueModal("event-modal",i.errorTitle,i.errorMessage),null;let a=t.target.closest(".action-button");return a&&await Ae(a,"is-glowing-green"),await new Promise(s=>requestAnimationFrame(s)),this.logger.info.system("SimService",this.gameState.day,"SHIP_ANIMATION_START",`Starting buy animation for ${e}.`),await this.uiManager.runShipTransactionAnimation(e),this.logger.info.system("SimService",this.gameState.day,"SHIP_ANIMATION_END","Buy animation complete. Executing logic."),this.playerActionService.executeBuyShip(e,t)}async sellShip(e,t){let i=this.playerActionService.validateSellShip(e);if(!i.success)return this.uiManager.queueModal("event-modal",i.errorTitle,i.errorMessage),!1;let a=t.target.closest(".action-button");return a&&await Ae(a,"is-glowing-red"),await new Promise(s=>requestAnimationFrame(s)),this.logger.info.system("SimService",this.gameState.day,"SHIP_ANIMATION_START",`Starting sell animation for ${e}.`),await this.uiManager.runShipTransactionAnimation(e),this.logger.info.system("SimService",this.gameState.day,"SHIP_ANIMATION_END","Sell animation complete. Executing logic."),this.playerActionService.executeSellShip(e,t)}async boardShip(e,t){let i=this.playerActionService.validateSetActiveShip(e);if(!i.success)return i.errorTitle!=="Action Redundant"&&this.uiManager.queueModal("event-modal",i.errorTitle,i.errorMessage),!1;let a=t.target.closest(".action-button");if(a){let s=a.closest(".grid").querySelector('[data-action="sell-ship"]');s&&(s.disabled=!0)}return a&&await Ae(a,"is-glowing-button"),this.playerActionService.executeSetActiveShip(e),this.gameState.introSequenceActive&&this.tutorialService.checkState({type:"ACTION",action:w.SELECT_SHIP}),await new Promise(s=>requestAnimationFrame(s)),this.logger.info.system("SimService",this.gameState.day,"SHIP_ANIMATION_START",`Starting board animation for ${e}.`),await this.uiManager.runShipTransactionAnimation(e,"is-boarding"),this.logger.info.system("SimService",this.gameState.day,"SHIP_ANIMATION_END","Board animation complete."),!0}payOffDebt(e){this.playerActionService.payOffDebt(e)}takeLoan(e,t){this.playerActionService.takeLoan(e,t)}purchaseLicense(e){return this.playerActionService.purchaseLicense(e)}refuelTick(){return this.playerActionService.refuelTick()}repairTick(){return this.playerActionService.repairTick()}travelTo(e,t=!1){this.travelService.travelTo(e,t)}resumeTravel(){this.travelService.resumeTravel()}pushNewsMessage(e,t,i=!1){this.newsTickerService&&this.newsTickerService.pushMessage(e,t,i)}pulseNewsTicker(){this.newsTickerService&&this.newsTickerService.pulse()}setScreen(e,t){let i={...this.gameState.lastActiveScreen,[e]:t};this.gameState.setState({activeNav:e,activeScreen:t,lastActiveScreen:i}),this.tutorialService&&this.tutorialService.checkState({type:"SCREEN_LOAD",screenId:t})}setIntelTab(e){this.gameState.uiState.activeIntelTab!==e&&(this.gameState.uiState.activeIntelTab=e,this.gameState.setState({uiState:this.gameState.uiState}))}setHangarShipyardMode(e){this.gameState.uiState.hangarShipyardToggleState!==e&&(this.gameState.uiState.hangarShipyardToggleState=e,this.gameState.setState({}))}setHangarCarouselIndex(e,t){t==="hangar"?this.gameState.uiState.hangarActiveIndex=e:this.gameState.uiState.shipyardActiveIndex=e,this.gameState.setState({})}cycleHangarCarousel(e){let{uiState:t,player:i}=this.gameState,a=t.hangarShipyardToggleState==="hangar",s=a?i.ownedShipIds:this._getShipyardInventory().map(([r])=>r);if(s.length<=1)return;let o=a?t.hangarActiveIndex||0:t.shipyardActiveIndex||0;e==="next"?o=(o+1)%s.length:o=(o-1+s.length)%s.length,this.setHangarCarouselIndex(o,a?"hangar":"shipyard")}_gameOver(e){this.gameState.isGameOver||(this.logger.info.state(this.gameState.day,"GAME_OVER",e),this.gameState.setState({isGameOver:!0}),this.uiManager.queueModal("event-modal","Game Over",e,()=>{localStorage.removeItem(At),window.location.reload()},{buttonText:"Restart"}))}_checkGameOverConditions(){this.gameState.player.credits<=0&&this._gameOver("Your credit balance has fallen to zero. With no funds to operate, your trading career has come to an end.")}getEffectiveShipStats(e){let t=f.SHIPS[e];if(!t)return null;let a=this.gameState.getState().player.shipStates[e];if(!a||!a.upgrades)return{...t};let s=[...t.mechanicIds||[],...a.upgrades||[]],o=M.getMaxHullModifier(s),r=M.getMaxFuelModifier(s),n=M.getMaxCargoModifier(s);return{...t,maxHealth:Math.round(t.maxHealth+o),maxFuel:Math.round(t.maxFuel+r),cargoCapacity:Math.round(t.cargoCapacity+n)}}addShipToHangar(e){let t=f.SHIPS[e];t&&(this.gameState.player.ownedShipIds.push(e),this.gameState.player.shipStates[e]={health:t.maxHealth,fuel:t.maxFuel,hullAlerts:{one:!1,two:!1},upgrades:[]},this.gameState.player.inventories[e]||(this.gameState.player.inventories[e]={},f.COMMODITIES.forEach(i=>{this.gameState.player.inventories[e][i.id]={quantity:0,avgCost:0}})))}_applyPerk(e){this.logger.info.player(this.gameState.day,"PERK_APPLIED",`Gained perk: ${e.title}`),e.perkId&&(this.gameState.player.activePerks[e.perkId]=!0),e.playerTitle&&(this.gameState.player.playerTitle=e.playerTitle),e.perkId===P.MERCHANT_GUILD_SHIP&&(this.addShipToHangar(Q.STALWART),this.uiManager.queueModal("event-modal","Vessel Delivered",`The Merchant's Guild has delivered a new ${f.SHIPS[Q.STALWART].name} to your hangar.`)),this.gameState.setState({})}_getActiveShip(){let e=this.gameState,t=e.player.activeShipId;if(!t)return null;let i=this.getEffectiveShipStats(t);return{id:t,...i,...e.player.shipStates[t]}}_getActiveInventory(){return this.gameState.player.activeShipId?this.gameState.player.inventories[this.gameState.player.activeShipId]:null}_checkHullWarnings(e){let t=this.gameState.player.shipStates[e],i=this.getEffectiveShipStats(e),a=t.health/i.maxHealth*100;a<=15&&!t.hullAlerts.two?t.hullAlerts.two=!0:a<=30&&!t.hullAlerts.one&&(t.hullAlerts.one=!0),a>30&&(t.hullAlerts.one=!1),a>15&&(t.hullAlerts.two=!1)}_logTransaction(e,t,i){for(this.gameState.player.financeLog.push({day:this.gameState.day,type:e,amount:t,balance:this.gameState.player.credits,description:i});this.gameState.player.financeLog.length>G.FINANCE_HISTORY_LENGTH;)this.gameState.player.financeLog.shift()}_logConsolidatedTrade(e,t,i){let a=this.gameState.player.financeLog,s=i<0,o=s?"Bought":"Sold",r=a.find(n=>n.day===this.gameState.day&&n.type==="trade"&&n.description.startsWith(`${o}`)&&n.description.endsWith(` ${e}`)&&(s&&n.amount<0||!s&&n.amount>0));if(r){r.amount+=i,r.balance=this.gameState.player.credits;let n=r.description.match(/\s(\d+)x\s/);if(n){let l=parseInt(n[1],10);r.description=`${o} ${l+t}x ${e}`}}else this._logTransaction("trade",i,`${o} ${t}x ${e}`)}_logConsolidatedTransaction(e,t,i){let a=this.gameState.player.financeLog,s=a.length>0?a[a.length-1]:null;s&&s.day===this.gameState.day&&s.type===e?(s.amount+=t,s.balance=this.gameState.player.credits):this._logTransaction(e,t,i)}_getShipyardInventory(){let{tutorials:e,player:t,currentLocationId:i,market:a}=this.gameState;return e.activeBatchId==="intro_hangar"?t.ownedShipIds.length>0?[]:[Q.WANDERER,Q.STALWART,Q.MULE].map(s=>[s,f.SHIPS[s]]):(a.shipyardStock[i]?.shipsForSale||[]).map(o=>[o,f.SHIPS[o]]).filter(([o])=>!t.ownedShipIds.includes(o))}advanceDay(){this.gameState.day++,this.logger.info.system(this.gameState.day,"DAY_START",`Day ${this.gameState.day} started.`),this._updateMarkets(),this._processFinancials(),this.randomEventService&&this.randomEventService.checkForRandomEvents(),this.missionService&&this.missionService.checkTriggers(),this.gameState.setState({})}grantMissionCargo(e){let t=f.MISSIONS[e];if(!t||!t.providedCargo)return;let i=this._getActiveInventory();if(!i){this.logger.error("SimulationService","Cannot grant mission cargo: No active inventory found.");return}t.providedCargo.forEach(a=>{i[a.goodId]||(i[a.goodId]={quantity:0,avgCost:0}),i[a.goodId]&&(i[a.goodId].quantity+=a.quantity)}),this.logger.info.player(this.gameState.day,"MISSION_CARGO",`Received mission cargo for ${e}`),this.missionService&&this.missionService.checkTriggers()}_grantRewards(e,t){!e||e.length===0||e.forEach(i=>{switch(i.type){case"credits":this.gameState.player.credits=Math.min(Number.MAX_SAFE_INTEGER,this.gameState.player.credits+i.amount),this._logTransaction("mission",i.amount,`Reward: ${t}`),this.uiManager.createFloatingText(`+${I(i.amount,!1)}`,window.innerWidth/2,window.innerHeight/2,"#34d399");break;case"item":case"commodity":let a=this.gameState.player.activeShipId,s=this.gameState.player.inventories[a];s&&s[i.goodId]&&(s[i.goodId].quantity+=i.quantity);break;case"UNLOCK_LOCATION":this.gameState.player.unlockedLocationIds.includes(i.target)||(this.gameState.player.unlockedLocationIds.push(i.target),this.logger.info.player(this.gameState.day,"UNLOCK",`Unlocked location: ${i.target}`));break;case"UNLOCK_TIER":let o=Math.max(this.gameState.player.revealedTier,i.value);o>this.gameState.player.revealedTier&&(this.gameState.player.revealedTier=o,this.logger.info.player(this.gameState.day,"UNLOCK",`Clearance Tier increased to ${o}`));break;case"license":if(!this.gameState.player.unlockedLicenseIds.includes(i.licenseId)){this.gameState.player.unlockedLicenseIds.push(i.licenseId);let p=f.LICENSES[i.licenseId];this.uiManager.triggerEffect("systemSurge",{theme:"tan"}),this.logger.info.player(this.gameState.day,"LICENSE_GRANTED",`Received ${p?p.name:i.licenseId}.`)}break;case"SHIP":let r=i.target;this.gameState.player.ownedShipIds.includes(r)||(this.gameState.player.ownedShipIds.push(r),this.gameState.player.shipStates[r]=this._initializeShipState(r),this.logger.info.player(this.gameState.day,"REWARD_SHIP",`Acquired ship: ${r}`));break;case"TELEPORT":this.gameState.currentLocationId=i.target,this.gameState.pendingTravel=null,this.logger.info.player(this.gameState.day,"TELEPORT",`Teleported to ${i.target}`);break;case"REPAIR":let n=this.gameState.player.activeShipId;this.gameState.player.shipStates[n]&&(this.gameState.player.shipStates[n].health=f.SHIPS[n].maxHealth);break;case"REFUEL":let l=this.gameState.player.activeShipId;this.gameState.player.shipStates[l]&&(this.gameState.player.shipStates[l].fuel=f.SHIPS[l].maxFuel);break;case"UPGRADE":let c=this.gameState.player.shipStates[this.gameState.player.activeShipId];c&&c.upgrades&&(c.upgrades.push(i.target),this.logger.info.player(this.gameState.day,"REWARD_UPGRADE",`Installed upgrade: ${i.target}`));break;case"OFFICER":let d=i.officerId,h=ne[d];h&&!this.gameState.solStation.roster.includes(d)&&(this.gameState.solStation.roster.push(d),this.logger.info.player(this.gameState.day,"OFFICER_RECRUIT",`Recruited ${h.name} (${h.role})`),this.uiManager.queueModal("event-modal","New Officer Recruited",`<b>${h.name}</b> has joined your staff roster.

Role: ${h.role}
Effect: ${h.description}`));break;default:console.warn(`Unknown reward type: ${i.type}`)}})}_initializeShipState(e){let t=f.SHIPS[e];return{health:t?t.maxHealth:100,fuel:t?t.maxFuel:40,hullAlerts:{one:!1,two:!1},upgrades:[]}}setIntelTab(e){this.gameState.uiState.activeIntelTab=e,this.gameState.setState({})}setScreen(e,t){this.gameState.activeNav=e,this.gameState.activeScreen=t,this.gameState.setState({})}_updateMarkets(){let{market:e}=this.gameState;f.MARKETS.forEach(t=>{f.COMMODITIES.forEach(i=>{e.priceHistory[t.id][i.id]||(e.priceHistory[t.id][i.id]=[]);let a=e.priceHistory[t.id][i.id];a.push(e.prices[t.id][i.id]),a.length>30&&a.shift()})}),f.MARKETS.forEach(t=>{f.COMMODITIES.forEach(i=>{let a=e.prices[t.id][i.id],s=e.galacticAverages[i.id],o=.05,r=1+(Math.random()*o*2-o),n=Math.round(a*r),l=s*.5,c=s*1.5;n<l&&(n=Math.round(l+Math.random()*5)),n>c&&(n=Math.round(c-Math.random()*5)),e.prices[t.id][i.id]=n}),this.gameState.day%7}),this.gameState.lastMarketUpdateDay=this.gameState.day}_processFinancials(){if(this.gameState.player.debt>0){let t=Math.ceil(this.gameState.player.debt*.001);this.gameState.player.debt+=t,this.gameState.player.monthlyInterestAmount+=t}}};var Fe=class{constructor(){this.effectQueue=[],this.isEffectActive=!1,this.effectsRegistry={}}registerEffect(e,t){this.effectsRegistry[e]=t}trigger(e,t){console.log(`MANAGER: EffectsManager.trigger received call for '${e}'. Queue length: ${this.effectQueue.length}`),this.effectQueue.push({effectName:e,options:t}),this._processQueue()}async _processQueue(){if(this.isEffectActive||this.effectQueue.length===0)return;this.isEffectActive=!0;let e=this.effectQueue.shift(),t=this.effectsRegistry[e.effectName];if(!t){console.warn(`EffectManager: Attempted to trigger unregistered effect '${e.effectName}'.`),this.isEffectActive=!1,this._processQueue();return}try{console.log(`MANAGER: Instantiating and playing effect: '${e.effectName}'.`),await new t(e.options).play()}catch(i){console.error(`Error playing effect '${e.effectName}':`,i)}finally{this.isEffectActive=!1,this._processQueue()}}};var gt={label:"MOD",color:"#94a3b8"},Ii=38,_i=["Auxiliary","Standard","Badge","Pass","Mod","Hacker","Machines","Hull"];function $e(m,e){if(!m||!m.startsWith("#"))return m;let t=m.replace("#",""),i=Math.max(0,Math.min(255,parseInt(t.substring(0,2),16)+e)),a=Math.max(0,Math.min(255,parseInt(t.substring(2,4),16)+e)),s=Math.max(0,Math.min(255,parseInt(t.substring(4,6),16)+e)),o=i.toString(16).padStart(2,"0"),r=a.toString(16).padStart(2,"0"),n=s.toString(16).padStart(2,"0");return`#${o}${r}${n}`}function Ai(m){if(!m)return"";let e=m.split(/\s+/).filter(t=>!_i.includes(t)).join(" ");return e.length>0?e:m}function Ri(m,e,t){let i=$e(t,-60),a=$e(t,-20),s=$e(t,40),o=$e(t,80),r=`pill-tier-${e}`,n="";return m.isAlien&&(r="pill-alien",n="text-shadow: 1px 1px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000;"),{className:r,styleVars:`
            --pill-color: ${t};
            --pill-dark: ${i};
            --pill-mid: ${a};
            --pill-light: ${s};
            --pill-bright: ${o};
            ${n}
        `}}function Jt(m,e){let{uiState:t,player:i,tutorials:a}=m,s=t.hangarShipyardToggleState==="hangar",o=s?"mode-hangar":"mode-shipyard",r=s?i.ownedShipIds:e._getShipyardInventory().map(([d])=>d),n=s?t.hangarActiveIndex||0:t.shipyardActiveIndex||0,l=Math.min(n,Math.max(0,r.length-1)),c=s||r.length>0;return`
        <div class="flex flex-col h-full">
            <div id="ship-terminal-container" class="flex flex-col flex-grow min-h-0 ${o}">
                
                <div class="relative mx-auto my-1 w-max flex justify-center items-center">
                    <div class="toggle-container">
                        <div class="toggle-switch p-1 rounded-md flex w-[180px] h-10">
                            <div class="toggle-label hangar flex-1 text-center py-1 cursor-pointer" data-action="${w.TOGGLE_HANGAR_MODE}" data-mode="hangar">HANGAR</div>
                            <div class="toggle-label shipyard flex-1 text-center py-1 cursor-pointer" data-action="${w.TOGGLE_HANGAR_MODE}" data-mode="shipyard">SHIPYARD</div>
                        </div>
                    </div>
                    <div class="archive-link ${c?"":"hidden"}" data-action="show_ship_lore">ACCESS<br>ARCHIVE</div>
                </div>

                <div class="carousel-container flex-grow overflow-hidden relative">
                    <div id="hangar-carousel" class="flex h-full" style="transform: translateX(-${l*100}%)">
                        ${r.map((d,h)=>Mi(m,d,h,n,s,e)).join("")||Ci(s)}
                    </div>
                </div>
            </div>
            <div id="hangar-pagination-wrapper">
                <div id="hangar-pagination">
                    {/* This will be populated by UIManager._renderHangarPagination */}
                </div>
            </div>
        </div>
    `}function Ci(m){return`
        <div class="carousel-page p-2 md:p-4 w-full">
            <div id="ship-terminal" class="relative h-full rounded-lg border-2" style="border-color: var(--frame-border-color);">
                <div class="flex flex-col items-center justify-center h-full">
                    <p class="text-gray-400">${m?"Your hangar is empty.":"No ships available in the shipyard."}</p>
                </div>
            </div>
        </div>
    `}function Mi(m,e,t,i,a,s){let o=f.SHIPS[e],r=a?m.player.shipStates[e]:null,{player:n}=m,l="",c=n.activeShipId===e,d=c&&a?'<div class="active-ship-glow-layer"></div>':"";a&&(l=`<div class="status-badge" style="border-color: ${c?"var(--theme-color-primary)":"var(--ot-border-light)"}; color: ${c?"var(--theme-color-primary)":"var(--ot-text-secondary)"};">${c?"ACTIVE":"STORED"}</div>`);let h="";if(a&&r){let D=[...o.mechanicIds||[],...r.upgrades||[]];if(D.length>0){let U=[...D].sort((Y,J)=>{let q=te=>{let ie=M.getDefinition(te);return ie&&ie.tier?ie.tier:ie&&ie.isAlien||te.endsWith("_V")||te.endsWith("_5")?5:te.endsWith("_IV")||te.endsWith("_4")?4:te.endsWith("_III")||te.endsWith("_3")?3:te.endsWith("_II")||te.endsWith("_2")?2:1},ee=q(Y),re=q(J);return ee!==re?ee-re:Y.localeCompare(J)}),W=U.map(Y=>M.getDefinition(Y)),z=W.reduce((Y,J)=>Y+(J?J.name.length:0),0)>Ii;h=`
                <div class="ship-attributes-overlay absolute bottom-3 left-1/2 transform -translate-x-1/2 flex flex-nowrap gap-1 z-20 w-full justify-center pointer-events-none px-1">
                    ${U.map((Y,J)=>{let q=W[J],ee=q?q.name:gt.label,re=q?q.description:"";z&&(ee=Ai(ee));let te=q&&(q.pillColor||q.color)||gt.color,ie=q?.tier||1;q?.tier||(Y.endsWith("_V")||Y.endsWith("_5")?ie=5:Y.endsWith("_IV")||Y.endsWith("_4")?ie=4:Y.endsWith("_III")||Y.endsWith("_3")?ie=3:(Y.endsWith("_II")||Y.endsWith("_2"))&&(ie=2)),q&&q.isAlien&&(ie=5);let _e=Ri(q||{},ie,te);return`
                    <button class="attribute-pill ${_e.className}" 
                        data-action="show-attribute-tooltip" 
                        data-attribute-id="${Y}"
                        data-tooltip="${re}"
                        style="${_e.styleVars}">
                        ${ee}
                    </button>
                `}).join("")}
                </div>
            `}}let y=Math.abs(t-i)<=5,g=V.getShipImage(e,n.visualSeed),S=V.getFallbackImage(e),b=y?g:V.PLACEHOLDER,T=g,A=g.endsWith("_A.jpeg"),_=c?"opacity: 1;":"opacity: 0; transition: opacity 0.3s ease-in;",L=c?"display: none;":"",N=`
        <div class="relative w-full h-full">
            <img src="${b}" 
                 data-src="${T}"
                 class="w-full h-full object-cover rounded-lg relative z-10" 
                 alt="${o.name}"
                 loading="${y?"eager":"lazy"}" 
                 data-fallback-src="${S}"
                 data-is-a="${A}"
                 style="${_}"
                 onload="this.style.opacity='1'; this.nextElementSibling.style.display='none';"
                 onerror="if (this.getAttribute('data-tried-fallback') === 'true' || this.getAttribute('data-is-a') === 'true') { this.style.display='none'; this.nextElementSibling.style.display='flex'; } else { this.setAttribute('data-tried-fallback', 'true'); this.src=this.getAttribute('data-fallback-src'); }">
            <span class="text-2xl font-orbitron absolute inset-0 flex items-center justify-center z-0 text-center text-gray-600" style="${L}">[ SHIP HOLOGRAM ]</span>
            ${h}
        </div>
    `,O=wi(m,e,o,r,a,s),F=`
        <div class="col-span-3 flex flex-col justify-between">
            <div class="ship-display-area flex-grow flex items-center justify-center relative">
                <div class="ship-image-placeholder w-full rounded-lg flex items-center justify-center relative overflow-hidden">
                    ${N}
                </div>
                ${l}
            </div>
        </div>
        <div class="col-span-2 flex flex-col justify-between">
            ${O}
            <div class="action-buttons-container pt-2">
                ${Qt(e,o,n,a,m.tutorials)}
            </div>
        </div>
    `,B=`
        <div class="col-span-2 flex flex-col justify-between">
            ${O}
        </div>

        <div class="col-span-3 flex flex-col justify-between">
            <div class="ship-display-area flex-grow flex items-center justify-center relative">
                <div class="ship-image-placeholder w-full rounded-lg flex items-center justify-center relative overflow-hidden">
                    ${N}
                </div>
                ${l}
            </div>
            
            <div class="action-buttons-container pt-2">
                ${Qt(e,o,n,a,m.tutorials)}
            </div>
        </div>
    `;return`
        <div class="carousel-page p-2 md:p-4 w-full" data-ship-id="${e}" data-index="${t}">
            <div id="ship-terminal" class="relative h-full rounded-lg border-2" style="border-color: var(--frame-border-color);">
                ${d}
                <div id="ship-card-main-content" class="h-full relative z-10">
                    <div class="ship-card-content-wrapper h-full">
                        ${a?B:F}
                    </div>
                </div>
            </div>
        </div>
    `}function wi(m,e,t,i,a,s){let o=t.class.toLowerCase(),r=t.name.length,n="text-xl";r>25?n="text-xs leading-tight":r>22?n="text-sm leading-tight":r>17?n="text-base leading-tight":n="text-xl";let l=t.description.length,c="text-sm",d="";l>240?c="text-xs":l>190&&(c="",d="font-size: 0.8rem; line-height: 1.4;");let h=`color: var(--class-${o}-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;`,p="inset-text-shadow";t.class==="Z"?p="glow-text-z":t.class==="O"?p="glow-text-o":t.class==="S"&&(p="glow-text-s");let y=Li(t,i,m.player,!a,e,s);if(a)return`
            <div class="info-panel-content info-panel-hangar flex-col justify-between h-full">
                <div class="info-panel-header">
                    <div class="info-panel-text">
                        <h3 class="${n} font-orbitron ${p}" style="${h}">${t.name}</h3>
                        <p class="text-md text-gray-400 inset-text-shadow">Class ${t.class} ${t.role||"Freighter"}</p>
                    </div>
                    ${y}
                </div>
                
                <div class="flavor-text-box mt-auto" style="border-color: var(--frame-border-color);">
                    <p class="${c} text-gray-300" style="${d}">${t.description}</p>
                </div>
            </div>
        `;{let g=I(t.price,!0),S=g.length>9?"text-shrink":"";return`
             <div class="info-panel-content info-panel-shipyard flex-col justify-between h-full">
                <div class="info-panel-header">
                    <div class="info-panel-text">
                        <h3 class="${n} font-orbitron ${p}" style="${h}">${t.name}</h3>
                        <p class="text-md text-gray-400 inset-text-shadow">Class ${t.class} ${t.role||"Freighter"}</p>
                        <p class="ship-price-display font-roboto-mono text-2xl credits-text-pulsing ${S}">${g}</p>
                    </div>
                    ${y}
                </div>

                <div class="flavor-text-box mt-auto" style="border-color: var(--frame-border-color);">
                    <p class="${c} text-gray-300" style="${d}">${t.description}</p>
                </div>
            </div>
        `}}function Qt(m,e,t,i,a){if(i){let s=t.activeShipId===m,o=t.ownedShipIds.length>1&&!s,r=Math.floor(e.price*G.SHIP_SELL_MODIFIER),n=I(r,!0),l=n.length>8?"text-shrink-button":"";return`
            <div class="grid grid-cols-2 gap-2">
                <button class="action-button" data-action="${w.SELECT_SHIP}" data-ship-id="${m}" ${s?"disabled":""} style="background-color: ${s?"#374151":"var(--ot-cyan-base)"}; color: ${s?"var(--ot-text-secondary)":"var(--ot-bg-dark)"};">
                    <span class="font-bold z-10 relative">${s?"ACTIVE":"BOARD"}</span>
                </button>
                <button class="action-button" data-action="${w.SELL_SHIP}" data-ship-id="${m}" ${o?"":"disabled"} style="background-color: var(--ot-hangar-red-base);">
                    <span class="font-bold z-10 relative">SELL</span>
                    <span class="action-button-price font-roboto-mono credits-text-pulsing z-10 relative ${l}">${n}</span>
                </button>
            </div>
        `}else{let s=t.credits>=e.price,o=a.activeBatchId?f.TUTORIAL_DATA[a.activeBatchId]?.steps.find(l=>l.stepId===a.activeStepId):null,r=a.activeBatchId==="intro_hangar"&&!o?.unlockPurchase,n=!s||r;return`
            <button class="action-button w-full justify-center" data-action="${w.BUY_SHIP}" data-ship-id="${m}" ${n?"disabled":""} style="background-color: var(--ot-green-accent);">
                <span class="font-bold z-10 relative">PURCHASE</span>
            </button>
        `}}function Li(m,e,t,i=!1,a,s){let o=m;!i&&s&&(o=s.getEffectiveShipStats(a)||m);let r=i?m.maxHealth:e?.health??0,n=i?m.cargoCapacity:X(t.inventories[a]),l=i?m.maxFuel:e?.fuel??0,c=o.maxHealth>0?r/o.maxHealth*100:0,d=o.cargoCapacity>0?n/o.cargoCapacity*100:0,h=o.maxFuel>0?l/o.maxFuel*100:0,p="var(--ot-green-accent)",y="#f59e0b",g="#3b82f6",S=(b,T,A,_,L)=>{let N=Math.floor(T),O=Math.floor(A),B=N>=O?O:`${N} / ${O}`,D=100,U=_/100*D;return`
            <div class="param-bar-item">
                <svg viewBox="0 0 100 20" class="param-bar-svg" preserveAspectRatio="xMidYMid meet">
                    <text x="50" y="2" text-anchor="middle" dominant-baseline="middle" class="svg-bar-label" fill="var(--ot-text-secondary)">${b}</text>
                    
                    <rect x="0" y="8.4" width="${D}" height="14" rx="3" class="svg-bar-track" fill="rgba(0,0,0,0.4)" />
                    
                    <rect x="0" y="8.4" width="${U}" height="14" rx="3" class="svg-bar-fill" fill="${L}" style="transition: width 0.4s ease-out;" />
                    
                    <text x="50" y="16.4" text-anchor="middle" dominant-baseline="middle" class="svg-bar-text" fill="#ffffff">${B}</text>
                </svg>
            </div>
        `};return`
        <div class="ship-param-bars ${i?"shipyard-bars":""}">
            ${S("HULL",r,o.maxHealth,c,p)}
            ${S("FUEL",l,o.maxFuel,h,g)}
            ${S("CARGO",n,o.cargoCapacity,d,y)}
        </div>
    `}function ei(){return`
        <div id="map-container" class="w-full h-full overflow-y-auto">
            <svg id="map-svg-substrate"></svg>
            <div id="map-html-interface"></div>
        </div>
    `}function ti(m){let e=d3.select("#map-container"),t=d3.select("#map-svg-substrate"),i=d3.select("#map-html-interface");if(e.node().clientWidth===0){console.warn("Map container width is 0. Using ResizeObserver.");let a=new ResizeObserver(s=>{s[0].contentRect.width>0&&(Zt(e,t,i,m),a.disconnect())});a.observe(e.node())}else Zt(e,t,i,m)}function Zt(m,e,t,i){e.selectAll("*").remove(),t.selectAll("*").remove();let a=m.node().clientWidth,s=a/2,{poiData:o,totalHeight:r}=Oi(a,i,s);m.style("height","100%"),e.attr("height",r),t.style("height",`${r}px`),xi(e,o,s,r),Ni(t,o,i,s),Di(i)}function Oi(m,e,t){let i={[v.SUN]:.85,[v.MERCURY]:.8,[v.VENUS]:1.035,[v.EARTH]:1.035,[v.LUNA]:.805,[v.MARS]:.9775,[v.BELT]:.805,[v.EXCHANGE]:.805,[v.JUPITER]:1.564,[v.SATURN]:1.46625,[v.URANUS]:1.27075,[v.NEPTUNE]:1.27075,[v.KEPLER]:.8625,[v.PLUTO]:.92},a=f.MARKETS.filter(c=>e.lastKnownState.player.unlockedLocationIds.includes(c.id)).map(c=>{let d=c.distance;if(c.parent){let h=f.MARKETS.find(p=>p.id===c.parent);h&&(d=h.distance+.1)}return{...c,effectiveDistance:d}}).sort((c,d)=>c.effectiveDistance-d.effectiveDistance),s=130,o=110,n=o+(a.length-1)*s+30;return{poiData:a.map((c,d)=>{let h=o+d*s,p=t+(d%2===0?-50:50),y=t+(d%2===0?-56:56),g=d%2===0?"end":"start",S=(c.parent?12:16)*(i[c.id]||1);return{...c,y:h,poiX:t,labelX:y,labelAnchor:g,leaderLineX:p,radius:S}}),totalHeight:n}}function xi(m,e,t,i){m.append("line").attr("class","central-axis").attr("x1",t).attr("y1",0).attr("x2",t).attr("y2",i),m.selectAll(".leader-line").data(e).enter().append("line").attr("class","leader-line").attr("x1",t).attr("y1",a=>a.y).attr("x2",a=>a.leaderLineX).attr("y2",a=>a.y)}function Ni(m,e,t,i){m.append("div").attr("id","map-sun-poi").style("position","absolute").style("top","-195px").style("left",`${i}px`).style("width",`${225*2}px`).style("height",`${225*2}px`);let s=m.selectAll(".poi-marker-group").data(e).enter().append("div").attr("class","poi-marker-group").attr("data-location-id",o=>o.id).style("position","absolute").style("top",o=>`${o.y}px`).on("click",(o,r)=>{t.showMapDetailModal(r.id)});s.append("div").attr("class",o=>o.id===v.BELT?"poi-icon belt":"poi-icon planet").style("position","absolute").style("left",o=>`${o.poiX}px`).style("width",o=>`${o.radius*2}px`).style("height",o=>`${o.radius*2}px`).style("background-color",o=>o.navTheme.borderColor).style("clip-path",o=>o.id===v.SUN?"polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)":o.id===v.BELT?"polygon(0% 0%, 100% 0%, 50% 100%)":"none").style("border-radius",o=>o.id===v.SUN||o.id===v.BELT?"0":"50%"),s.append("div").attr("class","poi-label").style("position","absolute").style("left",o=>`${o.labelX}px`).style("text-anchor",o=>o.labelAnchor).text(o=>o.name)}function Di(m){let e=d3.select("#map-container");if(e.empty())return;let t=m.lastKnownState.currentLocationId,i=f.MARKETS.find(r=>r.id===t);if(!i)return;e.style("--theme-glow-color",i.navTheme.borderColor),e.select(".poi-marker-group.current-location").classed("current-location",!1);let a=e.select(`.poi-marker-group[data-location-id="${t}"]`);a.classed("current-location",!0);let s=e.node(),o=a.node();if(s&&o)if(t===v.PLUTO)s.scrollTop=s.scrollHeight;else{let r=s.clientHeight,l=o.offsetTop-r/2;s.scrollTop=l}}function ii(m){let{player:e,currentLocationId:t,TRAVEL_DATA:i,tutorials:a}=m,{navLock:s}=a,o=f.MARKETS.find(T=>T.id===t),r=s&&s.screenId===x.NAVIGATION,n=r?s.enabledElementQuery:null,l=null;if(n){let T=n.match(/\[data-location-id='(.*?)'\]/);T&&T[1]&&(l=T[1])}let c=e.activeShipId,d=e.shipStates[c],h=d?d.upgrades||[]:[],p=1;e.activePerks[P.NAVIGATOR]&&(p*=f.PERKS[P.NAVIGATOR].fuelMod),p*=M.getFuelBurnModifier(h);let y=1;e.activePerks[P.NAVIGATOR]&&(y*=f.PERKS[P.NAVIGATOR].travelTimeMod),y*=M.getTravelTimeModifier(h);let g=M.getShipAttributes(c);g.includes("ATTR_HYPER_CALCULATION")&&(y*=.75),g.includes("ATTR_NEWTONS_GHOST")&&(y*=10);let S=g.includes("ATTR_SLEEPER");S&&(y*=4.5),g.includes("ATTR_METABOLIC_BURN")&&(p*=.5);let b=g.includes("ATTR_NEWTONS_GHOST")||S;return`
        <div class="scroll-panel navigation-scroll-panel">
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
            ${f.MARKETS.filter(T=>e.unlockedLocationIds.includes(T.id)).map(T=>{let A=T.id===t,_=0,L=0;if(!A){let B=i[t][T.id];if(_=Math.max(1,Math.round(B.time*y)),L=Math.round(B.fuelCost*p),g.includes("ATTR_SOLAR_HARMONY")){let D=o.distance||0;(T.distance||0)<D&&(L=0)}b&&(L=0)}let N=r&&l&&T.id!==l,O=N?"disabled-location":"",F=A?`style="--theme-glow-color: ${o?.navTheme.borderColor};"`:"";return`<div class="location-card p-6 rounded-lg text-center flex flex-col ${A?"highlight-current":""} ${T.color} ${T.bg} ${O}" 
                                     data-action="show-launch-modal" data-location-id="${T.id}" ${N?"disabled":""} ${F}>
                        <h3 class="text-2xl font-orbitron flex-grow">${T.name}</h3>
                        <div class="location-card-footer mt-auto pt-3 border-t border-cyan-100/10">
                        ${A?'<p class="text-yellow-300 font-bold mt-2">(Currently Docked)</p>':`<div class="flex justify-around items-center text-center">
                                   <div class="flex items-center space-x-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V5z" clip-rule="evenodd" /></svg>
                                        <div><span class="font-bold font-roboto-mono text-lg">${_}</span><span class="block text-xs text-gray-400">Days</span></div>
                                   </div>
                                   <div class="flex items-center space-x-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-sky-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" /></svg>
                                        <div><span class="font-bold font-roboto-mono text-lg">${L}</span><span class="block text-xs text-gray-400">Fuel</span></div>
                                   </div>
                               </div>`}
                        </div>
                      </div>`}).join("")}
            </div>
        </div>`}function si(m,e){let{player:t,currentLocationId:i}=m,{servicesTab:a="supply"}=m.uiState,s={[v.SUN]:"Sol Station",[v.MERCURY]:"Mercurian Station",[v.VENUS]:"Venetian Cloudport",[v.EARTH]:"Earth Starport",[v.LUNA]:"Lunar Starport",[v.MARS]:"Martian Starport",[v.BELT]:"Belt Station",[v.EXCHANGE]:"The Exchange",[v.JUPITER]:"Jupiter Starport",[v.SATURN]:"Saturn Starport",[v.URANUS]:"Uranus Starport",[v.NEPTUNE]:"Neptune Starport",[v.KEPLER]:"Kepler's Eye",[v.PLUTO]:"The Fringe"},r=f.MARKETS.find(de=>de.id===i)?.navTheme||{gradient:"linear-gradient(135deg, #4a5568, #2d3748)",textColor:"#f0f0f0",borderColor:"#7a9ac0"},n=`
        --theme-gradient: ${r.gradient}; 
        --theme-text-color: ${r.textColor}; 
        --theme-border-color: ${r.borderColor};
    `,l=s[i]||"UNKNOWN STARPORT",c=a==="supply"?"active":"",d=a==="tuning"?"active":"",h=a==="supply"?`style="background: ${r.gradient}; color: ${r.textColor}; border-color: ${r.borderColor}; box-shadow: 0 0 10px rgba(0,0,0,0.5);"`:"",p=a==="tuning"?`style="background: ${r.gradient}; color: ${r.textColor}; border-color: ${r.borderColor}; box-shadow: 0 0 10px rgba(0,0,0,0.5);"`:"",y=`
        <div class="sub-nav-bar" style="margin-bottom: 0.5rem; display: flex; gap: 0.5rem; justify-content: center;">
            <button class="sub-nav-button ${c}" ${h} data-action="set-services-tab" data-target="supply">SUPPLY</button>
            <button class="sub-nav-button ${d}" ${p} data-action="set-services-tab" data-target="tuning">TUNING</button>
        </div>
    `;if(a==="tuning")return`
            <div class="flex flex-col h-full">
                ${y}
                <div class="themed-header-bar mb-4" style="${n}">
                    <div class="themed-header-title">${l}</div>
                </div>
                ${Pi(m)}
            </div>
        `;if(!t.activeShipId||!m.player.shipStates[t.activeShipId])return`
            <div class="flex flex-col h-full">
                ${y}
                <div class="themed-header-bar mb-4" style="${n}">
                    <div class="themed-header-title">${l}</div>
                </div>
                <div class="services-scroll-panel flex-grow min-h-0">
                    <div class="ship-services-panel max-w-4xl mx-auto" style="${n}">
                        <div class="themed-header-bar">
                            <div class="ship-header-title">NO ACTIVE SHIP</div>
                        </div>
                        <div class="p-4 md:p-8">
                            <p class="text-center text-gray-500 text-lg">No active ship available for servicing.</p>
                        </div>
                    </div>
                </div>
            </div>
        `;let g=f.SHIPS[t.activeShipId],S=m.player.shipStates[t.activeShipId],b=g?.name||"NO ACTIVE SHIP",T=S.upgrades||[],A=g?`var(--class-${g.class.toLowerCase()}-color)`:"#f0f0f0",_=g.maxHealth,L=g.maxFuel;if(e&&e.getEffectiveShipStats){let de=e.getEffectiveShipStats(t.activeShipId);de&&(_=de.maxHealth,L=de.maxFuel)}let N="";i===v.SUN&&m.solStation?.unlocked&&(N=`
            <div class="flex justify-center mb-6">
                <button class="sol-interface-btn" data-action="open-sol-dashboard">
                    <div class="btn-content">
                        <div class="btn-text">
                            <span class="btn-title">ORBITAL INTERFACE</span>
                            <span class="btn-subtitle">Manage Station Systems</span>
                        </div>
                    </div>
                </button>
            </div>
        `);let O=f.MARKETS.find(de=>de.id===i).fuelPrice/10;(i===v.SATURN||i===v.PLUTO)&&(O*=2),t.activePerks[P.VENETIAN_SYNDICATE]&&i===v.VENUS&&(O*=1-f.PERKS[P.VENETIAN_SYNDICATE].fuelDiscount);let F=M.getServiceCostModifier(T,"refuel");O*=F;let B=t.statModifiers?.fuelCost||0;B>0&&(O*=1-B);let D=S.fuel,U=L-D,W=U/L,j=0;U>0&&(W<.05?j=Math.ceil(L*.01):j=Math.ceil(L*.05));let z=Math.max(1,Math.round(O*j)),Z=G.REPAIR_COST_PER_HP;i===v.LUNA&&(Z*=.8),(i===v.SATURN||i===v.PLUTO)&&(Z*=2),t.activePerks[P.VENETIAN_SYNDICATE]&&i===v.VENUS&&(Z*=1-f.PERKS[P.VENETIAN_SYNDICATE].repairDiscount);let Y=M.getServiceCostModifier(T,"repair");Z*=Y;let J=t.statModifiers?.repairCost||0;J>0&&(Z*=1-J);let q=S.health,ee=_-q,re=ee/_,te=0;ee>0&&(re<.05?te=Math.ceil(_*.01):te=Math.ceil(_*.05));let ie=Math.max(1,Math.round(Z*te)),_e=S.fuel/L*100,pi=S.health/_*100,Et=S.fuel>=L,Tt=S.health>=_,bt=t.credits>=z,It=t.credits>=ie,mi=Et||!bt,gi=Tt||!It;return`
        <div class="flex flex-col h-full">
            ${y}
            <div class="themed-header-bar mb-4" style="${n}">
                <div class="themed-header-title">${l}</div>
            </div>
            <div class="services-scroll-panel flex-grow min-h-0">
                
                ${N}

                <div class="ship-services-panel max-w-4xl mx-auto" style="${n}">
                    <div class="themed-header-bar">
                        <div class="ship-header-title" style="color: ${A}; text-shadow: 0 0 5px ${A}80;">${b}</div>
                    </div>

                    <div class="flex flex-col md:flex-row justify-center items-center gap-8 p-4 md:p-8">
                      <div class="service-module w-full max-w-sm" style="--resource-color-rgb: 8, 217, 214; --resource-color: #08d9d6; --ot-cyan-base: #08d9d6;">
                        <div class="bar-housing">
                          <div class="progress-bar-container w-full h-14 rounded-lg border border-gray-800 overflow-hidden relative">
                            <div class="absolute inset-0 z-10 flex justify-between items-center p-1.5 px-4 text-sm pointer-events-none">
                              <span class="font-electrolize font-bold tracking-wider uppercase text-cyan-300 text-outline" style="--glow-color: #08d9d6;">Fuel</span>
                              <span class="font-mono font-bold text-white text-outline" style="--glow-color: #08d9d6;">
                                ${Math.round(S.fuel)} / ${L}
                              </span>
                            </div>
                            <div id="fuel-bar" class="progress-bar-fill h-full rounded-md" style="width: ${_e}%; background-color: #08d9d6; --glow-color: #08d9d6; background-image: linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.1) 75%, transparent 75%, transparent); background-size: 40px 40px;"></div>
                          </div>
                        </div>
                        <div class="control-deck flex justify-center items-center gap-4">
                          <div class="price-display-module w-32 h-12 flex justify-between items-center px-4">
                            <span class="price-label text-sm engraved-text">COST</span>
                            <span class="price-digits text-base ${bt?"credits-text-pulsing":"text-red-500 shadow-red-500"}">
                              ${I(z,!0)}
                            </span>
                          </div>
                          <button id="refuel-btn" class="industrial-button w-32 h-12 flex justify-center items-center text-center p-2 text-base font-orbitron uppercase tracking-wider transition-all duration-100 ease-in-out focus:outline-none" ${mi?"disabled":""}>
                            <span class="engraved-text">${Et?"MAX":"REFUEL"}</span>
                          </button>
                        </div>
                      </div>

                      <div class="service-module w-full max-w-sm" style="--resource-color-rgb: 22, 163, 74; --resource-color: #16a34a; --ot-green-accent: #16a34a; --ot-green-text-light: #22c55e;">
                        <div class="bar-housing">
                          <div class="progress-bar-container w-full h-14 rounded-lg border border-gray-800 overflow-hidden relative">
                            <div class="absolute inset-0 z-10 flex justify-between items-center p-1.5 px-4 text-sm pointer-events-none">
                               <span class="font-electrolize font-bold tracking-wider uppercase text-outline" style="color: var(--ot-green-text-light); --glow-color: var(--ot-green-text-light);">HULL INTEGRITY</span>
                              <span class="font-mono font-bold text-white text-outline" style="--glow-color: var(--resource-color);">
                                ${Math.round(S.health)} / ${_}
                              </span>
                            </div>
                            <div id="repair-bar" class="progress-bar-fill h-full rounded-md" style="width: ${pi}%; background-color: var(--resource-color); --glow-color: var(--resource-color); background-image: linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.1) 75%, transparent 75%, transparent); background-size: 40px 40px;"></div>
                          </div>
                        </div>
                        <div class="control-deck flex justify-center items-center gap-4 relative">
                          <div class="price-display-module w-32 h-12 flex justify-between items-center px-4 relative">
                            <span class="price-label text-sm engraved-text">COST</span>
                            <span class="price-digits text-base ${It?"credits-text-pulsing":"text-red-500 shadow-red-500"}">
                              ${I(ie,!0)}
                            </span>
                            <div class="absolute -top-5 left-0 w-full text-center text-[10px] font-mono uppercase tracking-widest" style="color: #60a5fa; opacity: 0.9;">+1 Day / Tick</div>
                          </div>
                          <button id="repair-btn" class="industrial-button w-32 h-12 flex justify-center items-center text-center p-2 text-base font-orbitron uppercase tracking-wider transition-all duration-100 ease-in-out focus:outline-none" ${gi?"disabled":""}>
                              <span class="engraved-text">${Tt?"MAX":"REPAIR"}</span>
                          </button>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
        </div>
    `}function ki(m){let{day:e,currentLocationId:t,player:i}=m,s=M.getAllUpgradeIds().filter(p=>!(!p.startsWith("UPG_")||p.startsWith("UPG_ECO_SELL_")||p.startsWith("UPG_ECO_DEBT_")||(p.endsWith("_4")||p.endsWith("_5"))&&i.credits<1e6)),o=`quantity_${t}_${e}`,r=ai(o),n=0;r<.05?n=0:r<.25?n=1:r<.6?n=2:r<.85?n=3:r<.95?n=4:n=5;let l=(m.player.statModifiers?.upgradeSpawnRate||0)*100,c=t===v.URANUS,d=s.map(p=>{let y=0;return p.endsWith("_1")?y=17:p.endsWith("_2")?y=11:p.endsWith("_3")?y=9:p.endsWith("_4")?y=6:p.endsWith("_5")&&(y=4),y+=l,c&&(p.endsWith("_3")||p.endsWith("_4")||p.endsWith("_5"))&&(y*=2),{id:p,weight:y}}),h=[];for(let p=0;p<n&&d.length!==0;p++){let y=d.reduce((T,A)=>T+A.weight,0),g=`select_${t}_${e}_${p}`,S=ai(g)*y,b=-1;for(let T=0;T<d.length;T++)if(S-=d[T].weight,S<0){b=T;break}b===-1&&d.length>0&&(b=d.length-1),b!==-1&&(h.push(d[b].id),d.splice(b,1))}return h}function ai(m){let e=0;for(let t=0;t<m.length;t++)e=(e<<5)-e+m.charCodeAt(t),e|=0;return Math.abs(e)%1e3/1e3}function Pi(m){let e=ki(m);if(e.sort(),e.length===0)return`
            <div class="services-scroll-panel flex-grow min-h-0 flex items-center justify-center">
                <p class="text-gray-500 text-lg">No upgrades available in stock today.</p>
            </div>
        `;let t=m.player.activeShipId,i=f.SHIPS[t],a=M.getInstallationFee(i?i.price:0);return`
        <div class="tuning-scroll-panel services-scroll-panel flex-grow min-h-0">
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-5xl mx-auto p-2 pb-8">
                ${e.map(o=>{let r=M.getDefinition(o);if(!r)return"";let n=r.pillColor||r.color||_t.GREY,l=`
            --item-color: ${n};
            --item-glow: ${n}80;
        `,c=r.value+a,d=m.player.credits>=c,h=r.name.length>12?"text-base":"text-lg";return`
            <div class="service-module upgrade-shop-item" style="${l}">
                <div class="flex flex-row items-center gap-4 h-full">
                    <div class="upgrade-icon-strip h-full w-2" style="background-color: var(--item-color); box-shadow: 0 0 8px var(--item-glow);"></div>
                    
                    <div class="flex-grow flex flex-col justify-center overflow-hidden">
                        <div class="font-orbitron font-bold ${h} engraved-text truncate" 
                             style="color: var(--item-color); text-shadow: 0 0 5px var(--item-glow);">
                             ${r.name}
                        </div>
                        <div class="text-xs text-gray-400 mt-1 leading-tight">${r.description}</div>
                        <div class="text-[11.5px] text-gray-500 mt-2 font-mono">
                            HARDWARE: ${I(r.value)}<br>
                            LABOR: ${I(a)} (5%)
                        </div>
                    </div>

                    <div class="flex flex-col items-end gap-2 min-w-[100px]">
                        <div class="font-mono text-cyan-300 credits-text-pulsing text-xl">${I(c,!0)}</div>
                        <button class="btn btn-sm w-full font-bold uppercase tracking-wider"
                                style="border: 1px solid var(--item-color); color: ${d?"#fff":"#666"};"
                                data-action="install_upgrade"
                                data-upgrade-id="${o}"
                                data-cost="${c}" 
                                ${d?"":"disabled"}>
                            INSTALL
                        </button>
                    </div>
                </div>
            </div>
        `}).join("")}
             </div>
        </div>
    `}function oi(m){let e=m.player.inventories[m.player.activeShipId];if(!e)return'<p class="text-center text-gray-500 text-lg">No active ship.</p>';let t=Object.entries(e).filter(([,s])=>s.quantity>0),i=m.player.visualSeed;return t.length===0?'<p class="text-center text-gray-500 text-lg">Your cargo hold is empty.</p>':`<div class="cargo-scroll-panel"><div class="cargo-grid">${t.map(([s,o])=>{let r=f.COMMODITIES.find(n=>n.id===s);return Fi(r,o,i)}).join("")}</div></div>`}function Fi(m,e,t){let i=Se(m.styleClass),o=`background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 40%, transparent 60%, rgba(0,0,0,0.8) 100%), url('${V.getCommodityImage(m.name,t)}'), ${i.gradient};`,r={CRYO:"#a5f3fc",ATMO:"#fef08a",CLON:"#fbcfe8",AI:"#fecaca",NPRO:"#ffffff",CYB:"#ffffff"},n=m.symbol.toUpperCase(),l=r.hasOwnProperty(n),c=l?r[n]:i.hex,d=l?"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000":"0 0 5px rgba(0,0,0,0.9)";return`
        <div class="min-cargo-item" 
             style="${o} border: 2px solid ${i.hex};"
             data-action="show_cargo_detail" 
             data-good-id="${m.id}">
            
            <div class="pt-symbol" style="font-size: 2rem; color: ${c}; text-shadow: ${d};">${n}</div>
            <div class="pt-quantity">(${e.quantity})</div>
        </div>
    `}function ri(m,e){let t=Se(m.styleClass),a={RAW:"Raw Material",IND:"Industrial Product",AGRI:"Agricultural Good",TECH:"Technology",CIV:"Civilian Commodity",BIO:"Bioware",RARE:"Exotic Material"}[m.cat]||"Unknown",o=(m.basePriceRange[0]+m.basePriceRange[1])/2*e.quantity;return`
        <div class="max-cargo-card" style="background: ${t.gradient}; border-color: ${t.hex};">
            <h3 class="text-2xl font-orbitron text-center">${m.name}</h3>
            <p class="text-sm text-center tier-type-line mb-4" style="color: #ffffff; text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;">Tier ${m.tier} ${a}</p>
            <p class="flavor-text">${m.lore}</p>
            <div class="avg-cost">
                <div>Avg. Cost: <span class="font-bold credits-text-pulsing">${I(e.avgCost,!0)}</span></div>
                <div>Qty Aboard: <span class="font-bold">${e.quantity}</span></div>
                <div>Avg. Value: <span class="font-bold credits-text-pulsing">${I(o,!0)}</span></div>
            </div>
        </div>
    `}var $i={sol:"loc-theme-sol",mercury:"loc-theme-mercury",venus:"loc-theme-venus",earth:"loc-theme-earth",luna:"loc-theme-luna",mars:"loc-theme-mars",belt:"loc-theme-belt",jupiter:"loc-theme-jupiter",saturn:"loc-theme-saturn",uranus:"loc-theme-uranus",neptune:"loc-theme-neptune",pluto:"loc-theme-pluto",kepler:"loc-theme-kepler"},Hi="loc-theme-earth",ni=m=>{if(!m)return"m-type-standard";let e=m.toLowerCase();return e.includes("trade")||e.includes("deliver")||e.includes("source")||e.includes("procurement")?"m-type-trade":e.includes("combat")||e.includes("bounty")||e.includes("patrol")||e.includes("kill")?"m-type-combat":e.includes("explor")||e.includes("travel")||e.includes("survey")||e.includes("scan")?"m-type-exploration":e.includes("min")||e.includes("harvest")||e.includes("salvage")||e.includes("industr")?"m-type-industrial":"m-type-standard"};function li(m,e){let{missions:t,uiState:i,currentLocationId:a}=m,{activeMissionIds:s,missionProgress:o,trackedMissionId:r}=t,n=i.activeMissionTab||"terminal",l=$i[a]||Hi,c=()=>{let g=S=>`mission-tab-btn ${n===S?"active":""}`;return`
            <div class="mission-tabs-nav ${l}">
                <button class="${g("terminal")}" data-action="switch-mission-tab" data-target="terminal">
                    TERMINAL
                </button>
                <button class="${g("log")}" data-action="switch-mission-tab" data-target="log">
                    LOG
                </button>
            </div>
        `},d=g=>{let S=`host-${g.host.toLowerCase().replace(/[^a-z0-9]/g,"")}`,b=ni(g.type),T=g.rewards.map(A=>A.type==="credits"?`<span class="credits-text-pulsing">${I(A.amount,!0)}</span>`:A.type.toUpperCase()).join(", ");return`
            <div class="mission-card ${S} ${b}" data-action="show-mission-modal" data-mission-id="${g.id}">
                <div class="mission-meta-row">
                    <span class="mission-type-badge">${g.type}</span>
                    <span class="mission-host-label">${g.host}</span>
                </div>
                
                <div class="mission-main-row">
                    <div class="mission-title">${g.name}</div>
                    <div class="mission-reward-data">${T}</div>
                </div>
            </div>`},h=g=>{let S=`host-${g.host.toLowerCase().replace(/[^a-z0-9]/g,"")}`,b=ni(g.type),T=o[g.id]||{objectives:{},isCompletable:!1},A="mission-active",_=!g.completion.locationId||g.completion.locationId===a;T.isCompletable&&_&&(A+=" mission-turn-in");let L="";if(T.isCompletable){let D="READY TO COMPLETE";g.completion.locationId&&(D=`RETURN TO: ${(f.MARKETS.find(W=>W.id===g.completion.locationId)?.name||"UNKNOWN").toUpperCase()}`),L=`<div class="mission-status-banner">${D}</div>`}let N="";g.objectives&&(N='<div class="mission-objectives-list">',g.objectives.forEach(D=>{let U=D.id||D.goodId,W=T.objectives[U],j=W?W.current:0,z=W?W.target:D.quantity||1,Z=D.comparator||">=",Y="OBJECTIVE",J=`${j}/${z}`,q=0;D.type==="have_item"||D.type==="DELIVER_ITEM"?(Y=`DELIVER ${f.COMMODITIES.find(ee=>ee.id===(D.goodId||D.target))?.name.toUpperCase()}`,q=Math.min(100,Math.floor(j/z*100))):D.type==="travel_to"||D.type==="TRAVEL_TO"?(Y=`TRAVEL TO ${f.MARKETS.find(ee=>ee.id===D.target)?.name.toUpperCase()}`,J=j===1?"ARRIVED":"EN ROUTE",q=j*100):D.type==="wealth_gt"||D.type==="WEALTH_CHECK"?(Y="EARN CREDITS",q=Math.min(100,Math.floor(j/z*100))):["have_fuel_tank","HAVE_FUEL_TANK"].includes(D.type)?(Y="FUEL LEVEL",J=`${j}`,q=Math.min(100,Math.floor(j/(z||100)*100))):["have_hull_pct","HAVE_HULL_PCT"].includes(D.type)?(Y="HULL INTEGRITY",J=`${j}%`,Z==="<="?q=j<=z?100:0:q=Math.min(100,j)):["have_cargo_pct","HAVE_CARGO_PCT"].includes(D.type)&&(Y="CARGO SPACE",J=`${j}%`,Z==="<="?q=j<=z?100:0:q=Math.min(100,j)),N+=`
                    <div class="objective-row-filled">
                        <div class="objective-fill-bar" style="width: ${q}%"></div>
                        <div class="objective-text">
                            <span>${Y}</span>
                            <span>${J}</span>
                        </div>
                    </div>
                `}),N+="</div>");let B=`
            <button class="mission-track-star ${g.id===r?"active":""}" data-action="track-mission" data-mission-id="${g.id}" title="Track on HUD">
                <svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
            </button>
        `;return`
            <div class="mission-card ${S} ${b} ${A}" data-action="show-mission-modal" data-mission-id="${g.id}">
                ${B}
                <div class="mission-meta-row pl-6"> <span class="mission-type-badge">ACTIVE CONTRACT</span>
                     <span class="mission-host-label">${g.host}</span>
                </div>
                
                <div class="mission-title mb-2">${g.name}</div>
                
                ${L}
                
                ${N}
            </div>
        `},p=g=>`
            <div class="mission-empty-state">
                <div class="mission-empty-text">${g}</div>
            </div>
        `,y="";if(n==="terminal"){if(e){let g=e.getAvailableMissions();g.length>0?(y='<div class="max-w-2xl mx-auto">',g.forEach(S=>y+=d(S)),y+="</div>"):y=p("NO CONTRACTS DETECTED")}}else s&&s.length>0?(y='<div class="max-w-2xl mx-auto">',s.map(S=>f.MISSIONS[S]).filter(S=>S).sort((S,b)=>{let T=o[S.id]||{isCompletable:!1},A=o[b.id]||{isCompletable:!1};return T.isCompletable&&!A.isCompletable?-1:!T.isCompletable&&A.isCompletable?1:0}).forEach(S=>{y+=h(S)}),y+="</div>"):y=p("MISSION LOG EMPTY");return`
        <div class="flex flex-col h-full ${l} missions-screen-container">
            ${c()}
            <div class="missions-scroll-panel flex-grow min-h-0 overflow-y-auto custom-scrollbar px-2">
                ${y}
            </div>
        </div>
    `}function ci(m){let{player:e,day:t,currentLocationId:i}=m,s=f.MARKETS.find(l=>l.id===i)?.navTheme||{gradient:"linear-gradient(135deg, #4a5568, #2d3748)",textColor:"#f0f0f0",borderColor:"#7a9ac0"},o=`
        --theme-gradient: ${s.gradient}; 
        --theme-text-color: ${s.textColor}; 
        --theme-border-color: ${s.borderColor};
    `,r;if(e.debt>0){let l="";if(e.loanStartDate){let S=G.LOAN_GARNISHMENT_DAYS-(t-e.loanStartDate);S>0&&(l=`<p class="text-sm text-red-400/70 mt-2">Garnishment in ${S} days</p>`)}let c=e.activeShipId,d=e.shipStates[c],h=d?d.upgrades||[]:[],p=M.getInterestModifier(h),y=Math.floor(e.monthlyInterestAmount*p),g="";p<1?g=`
                <div class="mt-2 text-xs text-gray-400">
                    Monthly Interest: <span class="text-green-400">${I(y)}</span> 
                    <span class="line-through text-gray-600">${I(e.monthlyInterestAmount)}</span>
                </div>
            `:g=`
                <div class="mt-2 text-xs text-gray-400">
                    Monthly Interest: <span class="text-red-400">${I(e.monthlyInterestAmount)}</span>
                </div>
            `,r=`
            <div>
                <div class="themed-header-bar" style="${o}">
                    <div class="themed-header-title">Debt</div>
                </div>
                <div class="finance-module-panel flex flex-col items-center justify-center space-y-2 text-center" style="border-color: ${s.borderColor};">
                    <button data-action="${w.PAY_DEBT}" class="btn-module btn-module-destructive w-full font-roboto-mono" ${e.credits>=e.debt?"":"disabled"}>
                        <span class="text-base">Pay Off <span class="text-glow-red">${I(-e.debt,!0)}</span></span>
                    </button>
                    ${g}
                    ${l}
                </div>
            </div>`}else{let l=Math.floor(e.credits*3.5),c=Math.floor(l*.1),d=Math.floor(l*.04),p=[{key:"10000",amount:1e4,fee:600,interest:500},{key:"dynamic",...{amount:l,fee:c,interest:d}}].map(y=>`<button class="btn-module btn-module-credit w-full mt-2" data-action="${w.TAKE_LOAN}" data-loan-details='${JSON.stringify(y)}' ${e.credits<y.fee?"disabled":""}>
                        <span class="credits-text-pulsing">${I(y.amount,!0)}</span>
                    </button>`).join("");r=`
            <div>
                <div class="themed-header-bar" style="${o}">
                    <div class="themed-header-title">Financing</div>
                </div>
                <div class="finance-module-panel flex flex-col items-center justify-center space-y-2 text-center" style="border-color: ${s.borderColor};">
                    <div class="flex justify-center gap-4 w-full">${p}</div>
                </div>
            </div>`}let n=[...e.financeLog].reverse().map(l=>{let c=l.amount>0?"credits-text-pulsing":"text-glow-red",d=l.amount>0?"+":"";return`
            <div class="log-entry">
                <span class="text-gray-400 text-center">${l.day}</span>
                <span>${l.description}</span>
                <span class="${c} text-right font-roboto-mono">${d}${I(l.amount,!1)}</span>
            </div>
        `}).join("");return`
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 h-full">
            <div class="md:col-span-1">
                ${r}
            </div>
            <div class="md:col-span-2 flex flex-col min-h-0">
                 <div class="themed-header-bar" style="${o}">
                    <div class="themed-header-title">Transaction Log</div>
                 </div>
                 <div class="finance-module-panel flex flex-col flex-grow min-h-0" style="border-color: ${s.borderColor}; --theme-text-color: ${s.textColor};">
                    <div class="finance-log-panel">
                        <div class="log-header" style="border-color: ${s.borderColor};">
                           <span class="text-center">Day</span>
                           <span>Description</span>
                           <span class="text-right">Amount</span>
                        </div>
                        <div class="log-entries-container">
                           ${n||'<p class="text-center p-4">No transactions recorded.</p>'}
                        </div>
                    </div>
                 </div>
            </div>
        </div>
    `}function di(){return`
        <div class="sub-nav-bar">
            <button class="sub-nav-button" data-action="set-intel-tab" data-target="intel-codex-content">Codex</button>
            <button class="sub-nav-button" data-action="set-intel-tab" data-target="intel-market-content">Intel Market</button>
        </div>

        <div class="intel-scroll-panel">
            <div id="intel-codex-content" class="intel-tab-content">
                <div id="lore-button-container" class="lore-container w-full max-w-md flex flex-col gap-4 p-4">
                    </div>
            </div>

            <div id="intel-market-content" class="intel-tab-content p-4">
                </div>
        </div>
    `}var He=class{constructor(e){this.intelService=e,this.db=f}render(e,t){let i=t,{currentLocationId:a,activeIntelDeal:s,intelMarket:o}=i,r=[];if(s){let h=Object.values(o).flat().find(p=>p.isPurchased&&p.id===s.sourcePacketId);h&&r.push(h)}let n=(o[a]||[]).filter(h=>!h.isPurchased),l=[...r,...n],c=s!==null;if(l.length===0){e.innerHTML='<p class="text-gray-400 text-center italic p-4">No intel data available at this location.</p>';return}let d=l.map(h=>{if(h.isPurchased)return this._renderPurchasedButton(h);{let p=this.intelService.calculateIntelPrice(h);return this._renderOfferButton(h,p,c)}}).join("");e.innerHTML=`<div class="w-full max-w-md mx-auto flex flex-col gap-4">${d}</div>`}_renderPurchasedButton(e){let t=this.db.MARKETS.find(o=>o.id===e.dealLocationId),i=t?.name||"Unknown Location",a=t?.navTheme||{gradient:"linear-gradient(135deg, #4a5568, #2d3748)",borderColor:"#7a9ac0",textColor:"#f0f0ff"};return`
            <button class="btn btn-intel btn-intel-purchased" style="${`
            --theme-gradient: ${a.gradient};
            --theme-border-color: ${a.borderColor};
            --theme-text-color: ${a.textColor};
        `}" data-action="show_intel_details" 
                    data-packet-id="${e.id}" 
                    data-location-id="${e.locationId}"> 
                ${i} - View Intel
            </button>`}_renderOfferButton(e,t,i){let a=this.db.MARKETS.find(n=>n.id===e.dealLocationId)?.name||"Unknown Location",s=i?"disabled":"",o=i?"You already have an active intel deal.":`Purchase intel for a deal at ${a}`,r=i?I(t,!0):`<span class="credits-text-pulsing">${I(t,!0)}</span>`;return`
            <button class="btn btn-intel" 
                    data-action="show_intel_offer" 
                    data-packet-id="${e.id}" 
                    data-location-id="${e.locationId}" data-price="${t}" 
                    title="${o}"
                    ${s}>
                ${a} ${r}
            </button>`}};var Ue=class{constructor(e){this.isMobile=e,this.modal=document.getElementById("travel-animation-modal"),this.gameContainer=document.getElementById("game-container"),this.statusText=document.getElementById("travel-status-text"),this.arrivalLore=document.getElementById("travel-arrival-lore"),this.progressBar=document.getElementById("travel-progress-bar"),this.progressContainer=document.getElementById("travel-progress-container"),this.readoutContainer=document.getElementById("travel-readout-container"),this.infoText=document.getElementById("travel-info-text"),this.hullDamageText=document.getElementById("travel-hull-damage"),this.confirmButton=document.getElementById("travel-confirm-button"),this.canvas=document.getElementById("travel-canvas"),this.animationFrame=null,this._ensureDomStructure(),this.imageElement=document.getElementById("travel-background-image"),this.imageWrapper=document.getElementById("travel-image-wrapper")}_ensureDomStructure(){if(!document.getElementById("travel-image-wrapper")){let e=document.createElement("div");e.id="travel-image-wrapper";let t=document.createElement("img");t.id="travel-background-image",t.alt="Destination",e.appendChild(t);let i=document.getElementById("travel-header-panel");i&&i.nextSibling&&i.parentNode.insertBefore(e,i.nextSibling)}}play(e,t,i,a,s){this.modal.classList.remove("hidden"),this.modal.classList.add("dismiss-disabled");let o=t.navTheme||{gradient:"linear-gradient(to right, #06b6d4, #67e8f9)",borderColor:"#06b6d4"},r=this._lightenGradient(o.gradient);this.progressBar.style.background=r,this.progressBar.style.setProperty("--progress-glow-color",o.borderColor),this._setupInitialState(t,i),this._startCinematicSequence(t);let n=null,l=2500,c=d=>{n||(n=d);let h=d-n,p=Math.min(h/l,1);if(p>.8){let y=(p-.8)/.2;p=.8+(1-Math.pow(1-y,3))*.2}this.progressBar.style.width=`${p*100}%`,p<1?this.animationFrame=requestAnimationFrame(c):this._onArrival(t,i,a,s)};this.animationFrame=requestAnimationFrame(c),this.confirmButton.onclick=()=>{cancelAnimationFrame(this.animationFrame),this.modal.classList.add("modal-hiding"),s&&s(),setTimeout(()=>{this.gameContainer.classList.add("fade-in")},50),setTimeout(()=>{this.modal.classList.add("hidden"),this.modal.classList.remove("modal-hiding","dismiss-disabled"),this.imageElement.classList.remove("travel-zoom-active"),this.imageElement.style.opacity=0},1e3)}}_lightenGradient(e){let t=e.match(/#[0-9a-f]{6}|#[0-9a-f]{3}/ig);if(!t)return e;let i=(s,o)=>{s=s.replace(/^#/,""),s.length===3&&(s=s.split("").map(d=>d+d).join(""));let r=parseInt(s,16),n=(r>>16)+o;n>255&&(n=255),n<0&&(n=0);let l=(r>>8&255)+o;l>255&&(l=255),l<0&&(l=0);let c=(r&255)+o;return c>255&&(c=255),c<0&&(c=0),"#"+(c|l<<8|n<<16).toString(16).padStart(6,"0")};return`linear-gradient(to right, ${t.map(s=>i(s,40)).join(", ")})`}_setupInitialState(e,t){this.statusText.textContent=`Traveling to ${e.name}...`,this.arrivalLore.textContent="",this.arrivalLore.style.opacity=0,this.readoutContainer.classList.add("hidden"),this.readoutContainer.style.opacity=0,this.confirmButton.style.opacity=0,this.confirmButton.disabled=!0,this.progressBar.style.width="0%"}_startCinematicSequence(e){let t=V.getLocationImage(e.id);t?(this.imageElement.src=t,setTimeout(()=>{this.imageElement.style.opacity=1,this.imageElement.classList.add("travel-zoom-active")},50)):console.warn(`[TravelAnimation] No image found for ${e.id}`)}_onArrival(e,t,i,a){this.statusText.textContent=`Arrived at ${e.name}`,this.arrivalLore.innerHTML=e.arrivalLore||"You have arrived.",this.infoText.innerHTML=`
            <div class="text-center">
                <div>Journey Time: ${t.time} Days</div>
                <div><span class="font-bold text-sky-300">Fuel Expended: ${t.fuelCost}</span></div>
            </div>`,this.hullDamageText.className="text-sm font-roboto-mono mt-1 font-bold text-red-400",i>.01?this.hullDamageText.innerHTML=`Hull Integrity -${i.toFixed(2)}%`:this.hullDamageText.innerHTML="",this.arrivalLore.style.opacity=1,this.readoutContainer.classList.remove("hidden"),setTimeout(()=>{this.readoutContainer.style.opacity=1,this.confirmButton.style.opacity=1,this.confirmButton.disabled=!1},150)}};var Ge=class{constructor(e){this.manager=e,this.modalQueue=[]}queueModal(e,t,i,a=null,s={}){this.modalQueue.push({modalId:e,title:t,description:i,callback:a,options:s}),document.querySelector(".modal-backdrop:not(.hidden)")||this.processModalQueue()}processModalQueue(){if(this.modalQueue.length===0||document.querySelector(".modal-backdrop:not(.hidden)"))return;let{modalId:e,title:t,description:i,callback:a,options:s}=this.modalQueue.shift(),o=document.getElementById(e);if(!o)return this.manager.logger.error("UIModalEngine",`Modal element with ID '${e}' not found in the DOM. Aborting modal display.`),this.processModalQueue();s.specialClass&&o.classList.add(s.specialClass),s.nonDismissible&&o.classList.add("dismiss-disabled"),s.theme?o.dataset.theme=s.theme:delete o.dataset.theme,o.dataset.dismissInside=s.dismissInside||"false",o.dataset.dismissOutside=s.dismissOutside||"false";let r=e==="mission-modal"?"mission-modal-title":e.replace("-modal","-title"),n=o.querySelector(`#${r}`);!n&&(e.includes("event")||e==="event-result-modal")&&(n=o.querySelector("#event-title")||o.querySelector("#title")),n||(n=o.querySelector(".modal-title")||o.querySelector("h3"));let l=e==="mission-modal"?"mission-modal-description":e.replace("-modal","-description"),c=o.querySelector(`#${l}`)||o.querySelector(`#${e.replace("-modal","-scenario")}`);n&&(n.innerHTML=t),c&&(c.innerHTML=i,c.className="my-4 text-gray-300",e!=="mission-modal"&&c.classList.add("mb-6","text-lg"),(e==="event-modal"||e==="random-event-modal"||e==="event-result-modal")&&c.classList.add("text-center"),s.contentClass&&((s.contentClass.includes("text-left")||s.contentClass.includes("text-right")||s.contentClass.includes("text-justify"))&&c.classList.remove("text-center"),c.classList.add(...s.contentClass.split(" ").filter(Boolean))));let d=()=>{this.hideModal(e),a&&a()};if(s.customSetup)s.customSetup(o,d);else{let h=o.querySelector("#"+e.replace("-modal","-button-container")),p;s.footer?h&&(h.innerHTML=s.footer,h.querySelectorAll("button[data-action]").forEach(y=>{y.addEventListener("click",g=>{y.dataset.action!=="buy_intel"&&d()})})):s.footer===null?h&&(h.innerHTML=""):(h?(h.innerHTML="",p=document.createElement("button"),h.appendChild(p)):p=o.querySelector("button"),p&&(p.className="btn px-6 py-2",s.buttonClass&&p.classList.add(s.buttonClass),p.innerHTML=s.buttonText||"Understood",p.onclick=d))}o.classList.remove("hidden"),o.classList.remove("modal-hiding"),o.classList.add("modal-visible")}hideModal(e){let t=document.getElementById(e);t&&!t.classList.contains("hidden")&&(t.classList.add("modal-hiding"),t.addEventListener("animationend",()=>{t.classList.contains("modal-hiding")&&(t.classList.add("hidden"),t.classList.remove("modal-hiding","modal-visible","dismiss-disabled","intro-fade-in"),delete t.dataset.theme,delete t.dataset.dismissInside,delete t.dataset.dismissOutside,this.modalQueue.length>0&&this.processModalQueue())},{once:!0}))}getModalIdFromEvent(e){let t=e.target.closest(".modal-backdrop");if(!t||!t.id||t.classList.contains("dismiss-disabled"))return null;let i=t.dataset.dismissInside==="true",a=t.dataset.dismissOutside==="true",s=!e.target.closest(".modal-content"),o=e.target.closest(".modal-content");return a&&s||i&&o?(t.id==="lore-modal"&&e.target.closest("#lore-modal-content")||t.id==="eula-modal"&&e.target.closest("#eula-modal-content")||t.id!=="lore-modal"&&t.id!=="eula-modal"&&!e.target.closest(".modal-content")||t.id==="lore-modal"&&!e.target.closest(".modal-content")||t.id==="eula-modal"&&!e.target.closest(".modal-content"),t.id):null}isClickInside(e,t){return e.target.closest(t)!==null}showProcessingAnimation(e,t){let i=this.manager.cache.processingModal;if(!i)return;let a=i.querySelector("#processing-title"),s=i.querySelector("#processing-progress-bar"),o=i.querySelector("#processing-status");a.textContent=`Processing application for ${e}...`,s.style.width="0%",o.textContent="",i.classList.remove("hidden"),setTimeout(()=>{s.style.width="100%"},100),setTimeout(()=>{o.textContent="Processing complete!",setTimeout(()=>{this.hideModal("processing-modal"),t&&t()},1e3)},4e3)}};var Be=class{constructor(e){this.manager=e,this.popperInstance=null,this.activeHighlightConfig=null}showTutorialToast({step:e,onSkip:t,onNext:i,gameState:a}){let s=this.manager.cache.tutorialToastContainer,o=s.querySelector("#tt-arrow"),r=e.anchorElement==="body",n;r?n=this.manager.cache.tutorialAnchorOverlay:(n=document.querySelector(e.anchorElement),n||(this.manager.logger.error("UITutorialManager",`Anchor element "${e.anchorElement}" not found for step "${e.stepId}". Defaulting to overlay.`),n=this.manager.cache.tutorialAnchorOverlay)),this.popperInstance&&(this.popperInstance.destroy(),this.popperInstance=null);let l=e.text;if(l.includes("{shipName}")){let y=a.player.activeShipId,g=y?f.SHIPS[y].name:"your ship";l=l.replace(/{shipName}/g,g)}if(l.includes("{playerName}")){let y=a.player.name||"Captain";l=l.replace(/{playerName}/g,y)}this.manager.cache.tutorialToastText.innerHTML=l;let c=e.size?.width||"auto",d=e.size?.height||"auto";if(s.style.width=c,s.style.height=d,r){let y=e.positionX??50,g=e.positionY??50;s.style.left=`${y}%`,s.style.top=`${g}%`,s.style.transform="translate(-50%, -50%)",o.style.display="none",s.removeAttribute("data-popper-placement")}else{s.style.left="",s.style.top="",s.style.transform="",o.style.display="block";let y={placement:"auto",modifiers:[{name:"offset",options:{offset:[0,10]}},{name:"preventOverflow",options:{padding:{top:60,bottom:60,left:10,right:10}}},{name:"flip",options:{fallbackPlacements:["top","bottom","left","right"]}},{name:"arrow",options:{element:"#tt-arrow",padding:5}}]},g=e.popperOptions?.modifiers?.find(T=>T.name==="offset"),S=y.modifiers.filter(T=>T.name!=="offset");g?S.push(g):S.push(y.modifiers.find(T=>T.name==="offset")),e.popperOptions?.modifiers;let b={placement:e.placement||e.popperOptions?.placement||y.placement,modifiers:S};this.popperInstance=Popper.createPopper(n,s,b)}s.classList.remove("hidden");let h=e.completion.type==="INFO";this.manager.cache.tutorialToastNextBtn.classList.toggle("hidden",!h),h&&(this.manager.cache.tutorialToastNextBtn.onclick=i);let p=!1;this.manager.cache.tutorialToastSkipBtn.style.display=p?"block":"none",this.manager.cache.tutorialToastSkipBtn.onclick=t,this.manager.cache.tutorialToastText.scrollTop=0,this.manager.debugService&&this.manager.debugService.setActiveTutorialStep(e)}hideTutorialToast(){this.manager.cache.tutorialToastContainer.classList.add("hidden"),this.popperInstance&&(this.popperInstance.destroy(),this.popperInstance=null),this.applyTutorialHighlight(null),this.manager.debugService&&this.manager.debugService.clearActiveTutorialStep()}updateTutorialPopper(e){let t=this.manager.cache.tutorialToastContainer,i=t.querySelector("#tt-arrow"),{isOverlayAnchor:a,width:s,height:o,percentX:r,percentY:n,placement:l,distance:c,skidding:d}=e;if(t.style.width=s>0?`${s}px`:"auto",t.style.height=o>0?`${o}px`:"auto",a)this.popperInstance&&(this.popperInstance.destroy(),this.popperInstance=null,t.removeAttribute("data-popper-placement"),t.style.transform=""),t.style.left=`${r}%`,t.style.top=`${n}%`,t.style.transform="translate(-50%, -50%)",i.style.display="none";else{t.style.left="",t.style.top="",t.style.transform="",i.style.display="block";let h={placement:l,modifiers:[{name:"offset",options:{offset:[d,c]}},{name:"preventOverflow",options:{padding:{top:60,bottom:60,left:10,right:10}}},{name:"flip",options:{fallbackPlacements:["top","bottom","left","right"]}},{name:"arrow",options:{element:"#tt-arrow",padding:5}}]};this.popperInstance?this.popperInstance.setOptions(h).catch(p=>{this.manager.logger.error("UITutorialManager","Error updating Popper options:",p)}):this.manager.logger.warn("UITutorialManager","Popper instance needed but not found during update. Re-trigger toast if anchor type changed.")}}applyTutorialHighlight(e){this.activeHighlightConfig=e,this._renderHighlightsFromConfig(this.activeHighlightConfig)}_renderHighlightsFromConfig(e){let t=this.manager.cache.tutorialHighlightOverlay;if(t){if(t.innerHTML="",!e){t.classList.add("hidden");return}t.classList.remove("hidden"),e.forEach(i=>{let a=document.createElement("div");a.className="tutorial-cue",a.style.left=`${i.x}px`,a.style.top=`${i.y}px`,a.style.width=`${i.width}px`,a.style.height=`${i.height}px`,a.style.transform=`rotate(${i.rotation}deg)`,a.style.opacity=i.style.opacity,i.style.animation!=="None"&&a.classList.add(`anim-${i.style.animation.toLowerCase()}`);let s="";i.type==="Shape"?s=`
                    <svg width="100%" height="100%" viewBox="0 0 ${i.width} ${i.height}" preserveAspectRatio="none" style="overflow: visible;">
                        ${i.shapeType==="Rectangle"?`<rect x="0" y="0" width="100%" height="100%" rx="${i.style.borderRadius}" ry="${i.style.borderRadius}" style="fill:${i.style.fill}; stroke:${i.style.stroke}; stroke-width:${i.style.strokeWidth}px;" />`:`<ellipse cx="50%" cy="50%" rx="50%" ry="50%" style="fill:${i.style.fill}; stroke:${i.style.stroke}; stroke-width:${i.style.strokeWidth}px;" />`}
                    </svg>`:i.type==="Arrow"?s=`
                    <svg width="100%" height="100%" viewBox="0 0 100 50" preserveAspectRatio="none" style="overflow: visible;">
                        <defs>
                            <marker id="arrowhead-player" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="${i.style.stroke}" />
                            </marker>
                        </defs>
                        <line x1="0" y1="25" x2="90" y2="25" stroke="${i.style.stroke}" stroke-width="${i.style.strokeWidth}" marker-end="url(#arrowhead-player)" />
                    </svg>
                `:i.type==="Spotlight"&&(a.style.borderRadius="50%",a.style.boxShadow=`0 0 0 9999px rgba(0,0,0,0.7), 0 0 ${i.style.glowIntensity||20}px ${i.style.glowIntensity||10}px ${i.style.glowColor||i.style.stroke}`),a.innerHTML=s;let o=a.querySelector("svg");o&&i.style.animation!=="None"&&(o.classList.add(`anim-${i.style.animation.toLowerCase()}`),o.style.setProperty("--glow-color",i.style.glowColor||i.style.stroke),o.style.setProperty("--anim-speed",`${i.style.animationSpeed}s`),o.style.setProperty("--glow-intensity",`${i.style.glowIntensity}px`)),t.appendChild(a)})}}showSkipTutorialModal(e){this.manager.cache.skipTutorialModal.classList.remove("hidden");let i=()=>{e(),this.manager.hideModal("skip-tutorial-modal")},a=()=>{this.manager.hideModal("skip-tutorial-modal")};this.manager.cache.skipTutorialConfirmBtn.onclick=i,this.manager.cache.skipTutorialCancelBtn.onclick=a}showTutorialLogModal({seenBatches:e,onSelect:t}){let i=document.getElementById("tutorial-log-modal"),a=document.getElementById("tutorial-log-list");if(!i||!a){this.manager.logger.error("UITutorialManager","Tutorial log modal elements not found in DOM.");return}a.innerHTML="",e.length===0?a.innerHTML='<li class="text-gray-400 p-2 text-center">No tutorials viewed yet.</li>':e.forEach(s=>{let o=f.TUTORIAL_DATA[s];if(o){let r=document.createElement("li");r.innerHTML=`<button class="btn w-full text-center">${o.title}</button>`,r.onclick=()=>{i.classList.remove("visible"),t(s)},a.appendChild(r)}}),i.classList.add("visible")}};function hi(m,e,t,i){return`<div class="market-scroll-panel">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">${f.COMMODITIES.filter(o=>o.tier<=m.player.revealedTier).map(o=>Ui(o,m,t,i)).join("")}</div>
            </div>`}function Ui(m,e,t,i){let{player:a,market:s,currentLocationId:o,tutorials:r,uiState:n}=e,l=a.inventories[a.activeShipId]?.[m.id],c=t(e,m.id,!1),d=t(e,m.id,!0),h=t(e,m.id,!0),p=s.galacticAverages[m.id],y=s.inventory[o]?.[m.id],g=!m.licenseId||a.unlockedLicenseIds.includes(m.licenseId),S=r.activeBatchId==="intro_missions"&&r.activeStepId==="mission_2_2",b=r.activeBatchId==="intro_missions"&&r.activeStepId==="mission_2_3",T=S&&m.id!==E.PLASTEEL||b,A=`data-tooltip="${m.lore}"`,_=l&&l.quantity>0?l.quantity:"0",L=n.marketCardMinimized[m.id],N=V.getCommodityImage(m.name,a.visualSeed),O="",F="";N&&(O=`background-image: url('${N}');`,F=" has-custom-art");let B,D="";if(g){let U;d<c?U=`
                <div class="price-container flex flex-col justify-center h-full">
                     <span class="text-xs text-gray-400 line-through text-right leading-none" style="opacity: 0.7;">${I(c)}</span>
                     <p id="price-display-${m.id}" class="font-roboto-mono font-bold text-green-400 text-right leading-tight" data-action="${w.SHOW_PRICE_GRAPH}" data-good-id="${m.id}" data-base-price="${d}">${I(d)}</p>
                </div>
            `:U=`<p id="price-display-${m.id}" class="font-roboto-mono font-bold price-text" data-action="${w.SHOW_PRICE_GRAPH}" data-good-id="${m.id}" data-base-price="${d}">${I(d)}</p>`;let W=ve({price:d,sellPrice:h,galacticAvg:p,playerItem:l}),j=l&&l.quantity>0?`<div class="avg-cost-display" id="avg-cost-${m.id}">Avg. Cost: ${I(l.avgCost,!1)}</div>`:"",Z=`
             <div class="transaction-controls" data-mode="${i[m.id]?.mode||"buy"}" data-good-id="${m.id}" ${T?"disabled":""}>
                <div class="toggle-switch" data-action="toggle-trade-mode" data-good-id="${m.id}">
                    <div class="toggle-thumb"></div>
                    <div class="toggle-labels"><span class="label-buy">Buy</span><span class="label-sell">Sell</span></div>
                </div>
                <div class="qty-stepper">
                    <button class="qty-down" data-action="decrement" data-good-id="${m.id}">\u25BC</button>
                    <input type="number" value="0" id="qty-${m.id}" min="0">
                    <button class="qty-up" data-action="increment" data-good-id="${m.id}">\u25B2</button>
                </div>
                <div class="action-group">
                    <button class="btn confirm-btn" data-action="confirm-trade" data-good-id="${m.id}">Confirm</button>
                    <button class="btn max-btn" data-action="set-max-trade" data-good-id="${m.id}">Max</button>
                </div>
            </div>`,Y=l?.quantity>0?` (${l.quantity})`:"";D=`<button class="card-toggle-btn" data-action="${w.TOGGLE_MARKET_CARD_VIEW}" data-good-id="${m.id}">${L?"+":"\u2212"}</button>`,B=`
            <div class="max-view-content">
                <p class="font-bold commodity-name"><span class="commodity-name-tooltip" ${A}>${m.name}</span></p>
                <p class="avail-text">Avail: <span id="m-stock-${m.id}">${y.quantity}</span>, Own: <span id="p-inv-${m.id}">${_}</span></p>
                
                ${U}
                
                <div id="effective-price-display-${m.id}" class="effective-price-display"></div>
                
                <div class="indicator-container" id="indicators-${m.id}">${W}</div>

                ${j}

                ${Z}
            </div>

            <div class="min-view-content">
                <p class="font-bold commodity-name-min">${m.name}${Y}</p>
                <p class="tier-text-min">Tier ${m.tier} | ${m.cat}</p>
            </div>
        `}else{let U=`TIER ${m.tier} LICENSE`;B=`
            <div class="license-locked-content" data-action="${w.ACQUIRE_LICENSE}" data-license-id="${m.licenseId}">
                <div class="license-locked-tier-watermark">TIER ${m.tier}</div>
                
                <div class="sci-fi-lock-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-16 h-16">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
                    </svg>
                </div>
                 <p class="license-required-text">${U}</p>
            </div>
        `}return`
    <div class="item-card-container ${L?"minimized":""}" id="item-card-container-${m.id}">
        ${D}
        <div class="rounded-lg border ${m.styleClass}${F} transition-colors shadow-md" style="${O}">
            ${B}
        </div>
    </div>`}var Ye=class{constructor(e){this.manager=e,this.marketTransactionState={},this.marketScrollPosition=0}resetMarketTransactionState(){this.marketTransactionState={}}updateMarketScreen(e){if(e.activeScreen!==x.MARKET)return;let t=this.manager.cache.marketScreen.querySelector(".market-scroll-panel");this.manager.lastKnownState&&this.manager.lastKnownState.activeScreen===x.MARKET&&this.manager.lastKnownState.currentLocationId===e.currentLocationId&&t?this.marketScrollPosition=t.scrollTop:this.marketScrollPosition=0,this._saveMarketTransactionState(),this.manager.cache.marketScreen.innerHTML=hi(e,this.manager.isMobile,this.getItemPrice.bind(this),this.marketTransactionState),this._restoreMarketTransactionState();let i=this.manager.cache.marketScreen.querySelector(".market-scroll-panel");i&&(i.scrollTop=this.marketScrollPosition)}getItemPrice(e,t,i=!1){return!this.manager.simulationService||!this.manager.simulationService.marketService?e.market.prices[e.currentLocationId]?.[t]||0:this.manager.simulationService.marketService.getPrice(e.currentLocationId,t,!0)}_saveMarketTransactionState(){if(!this.manager.lastKnownState||this.manager.lastKnownState.activeScreen!==x.MARKET)return;this.manager.cache.marketScreen.querySelectorAll(".transaction-controls").forEach(t=>{let i=t.dataset.goodId,a=t.querySelector("input"),s=t.dataset.mode;a&&(this.marketTransactionState[i]={quantity:a.value,mode:s})})}_restoreMarketTransactionState(){for(let e in this.marketTransactionState){let t=this.marketTransactionState[e],i=this.manager.cache.marketScreen.querySelector(`.transaction-controls[data-good-id="${e}"]`);if(i){let a=i.querySelector("input");a&&(a.value=t.quantity,i.setAttribute("data-mode",t.mode),this.updateMarketCardDisplay(e,parseInt(t.quantity,10)||0,t.mode))}}}updateMarketCardPrice(e,t){let i=this.manager.cache.marketScreen.querySelector(`#price-display-${e}`);if(i){i.dataset.basePrice=t;let a=i.closest(".item-card-container").querySelector(".transaction-controls");a&&a.dataset.mode==="buy"&&(i.textContent=I(t))}}updateMarketCardDisplay(e,t,i){let a=this.manager.cache.marketScreen.querySelector(`#price-display-${e}`),s=this.manager.cache.marketScreen.querySelector(`#effective-price-display-${e}`),o=this.manager.cache.marketScreen.querySelector(`#indicators-${e}`),r=this.manager.cache.marketScreen.querySelector(`#avg-cost-${e}`);if(!a||!s||!o||!this.manager.lastKnownState)return;let n=this.manager.lastKnownState,l=parseInt(a.dataset.basePrice,10),c=n.player.inventories[n.player.activeShipId]?.[e];if(r&&r.classList.toggle("visible",i==="sell"),i==="buy")a.textContent=I(l),a.className="font-roboto-mono font-bold price-text",s.textContent="",o.innerHTML=ve({price:l,sellPrice:this.getItemPrice(n,e,!0),galacticAvg:n.market.galacticAverages[e],playerItem:c});else{let{effectivePricePerUnit:d,netProfit:h}=this._calculateSaleDetails(e,t);if(t>0){let p=`\u232C ${h>=0?"+":""}${I(h,!1)}`;a.textContent=p,s.textContent=`(${I(l,!1)}/unit)`,a.className=`font-roboto-mono font-bold ${h>=0?"profit-text":"loss-text"}`}else a.textContent="\u232C +0",a.className="font-roboto-mono font-bold profit-text",s.textContent="";o.innerHTML=ve({price:l,sellPrice:d||this.getItemPrice(n,e,!0),galacticAvg:n.market.galacticAverages[e],playerItem:c})}}_calculateSaleDetails(e,t){let i=this.manager.lastKnownState;if(!i)return{totalPrice:0,effectivePricePerUnit:0,netProfit:0};let a=this.getItemPrice(i,e,!0),o=i.player.inventories[i.player.activeShipId]?.[e]?.avgCost||0,r=a,n=Math.floor(r*t),l=o*t,c=n-l;if(c>0){let d=(i.player.activePerks[P.TRADEMASTER]?f.PERKS[P.TRADEMASTER].profitBonus:0)+(i.player.statModifiers?.profitBonus||0);c+=c*d}return{totalPrice:n,effectivePricePerUnit:r,netProfit:c}}renderPriceGraph(e,t,i){let a=t.market.priceHistory[t.currentLocationId]?.[e];if(!a||a.length<2)return'<div class="text-gray-400 text-sm p-4">No Data Available!</div>';let s=f.COMMODITIES.find(O=>O.id===e),o=(s.basePriceRange[0]+s.basePriceRange[1])/2,r=280,n=140,l=35,c=a.map(O=>O.price),d=i?.avgCost>0?i.avgCost:null,h=[...c,o];d&&h.push(d);let p=Math.min(...h),y=Math.max(...h),g=y-p>0?y-p:1,S=O=>O/(a.length-1)*(r-l*2)+l,b=O=>n-l-(O-p)/g*(n-l*2.5),T=`<svg width="${r}" height="${n}" xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="#0c101d" />`;T+='<g class="grid-lines" stroke="#1f2937" stroke-width="1">',T+=`<line x1="${l}" y1="${b(y)}" x2="${l}" y2="${n-l}" /><line x1="${l}" y1="${n-l}" x2="${r-l}" y2="${n-l}" />`,T+="</g>";let A=b(o);if(T+=`<line x1="${l}" y1="${A}" x2="${r-l}" y2="${A}" stroke="#facc15" stroke-width="1" stroke-dasharray="3 3" />`,T+=`<text x="${r-l+4}" y="${A+3}" fill="#facc15" font-size="10" font-family="Roboto Mono" text-anchor="start">Avg: ${I(o,!1)}</text>`,d){let O=b(d);T+=`<line x1="${l}" y1="${O}" x2="${r-l}" y2="${O}" stroke="#34d399" stroke-width="1" stroke-dasharray="3 3" />`,T+=`<text x="${r-l+4}" y="${O+3}" fill="#34d399" font-size="10" font-family="Roboto Mono" text-anchor="start">Paid: ${I(d,!1)}</text>`}let _=a.map((O,F)=>`${S(F)},${b(O.price)}`).join(" ");T+=`<polyline fill="none" stroke="#60a5fa" stroke-width="2" points="${_}" />`;let L=a[0].day,N=a[a.length-1].day;return T+=`<text x="${l}" y="${n-l+15}" fill="#9ca3af" font-size="10" font-family="Roboto Mono" text-anchor="start">Day ${L}</text>`,T+=`<text x="${r-l}" y="${n-l+15}" fill="#9ca3af" font-size="10" font-family="Roboto Mono" text-anchor="end">Day ${N}</text>`,T+=`<text x="${l-8}" y="${b(p)+3}" fill="#9ca3af" font-size="10" font-family="Roboto Mono" text-anchor="end">${I(p,!1)}</text>`,T+=`<text x="${l-8}" y="${b(y)+3}" fill="#9ca3af" font-size="10" font-family="Roboto Mono" text-anchor="end">${I(y,!1)}</text>`,T+="</svg>",T}renderFinanceGraph(e){let t=e.player.creditHistory||[];if(!t||t.length<2)return'<div class="text-gray-400 text-sm p-4">No Financial Data Available</div>';let i=280,a=140,s=35,o=t.map(S=>S.value),r=Math.min(...o),n=Math.max(...o),l=n-r>0?n-r:1,c=S=>S/(t.length-1)*(i-s*2)+s,d=S=>a-s-(S-r)/l*(a-s*2.5),h=`<svg width="${i}" height="${a}" xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="#0c101d" />`;h+='<g class="grid-lines" stroke="#1f2937" stroke-width="1">',h+=`<line x1="${s}" y1="${d(n)}" x2="${s}" y2="${a-s}" />`,h+=`<line x1="${s}" y1="${a-s}" x2="${i-s}" y2="${a-s}" />`,h+="</g>";let p=t.map((S,b)=>`${c(b)},${d(S.value)}`).join(" ");h+=`<polyline fill="none" stroke="#10b981" stroke-width="2" points="${p}" />`;let y=t[0].day,g=t[t.length-1].day;return h+=`<text x="${s}" y="${a-s+15}" fill="#9ca3af" font-size="10" font-family="Roboto Mono" text-anchor="start">Day ${y}</text>`,h+=`<text x="${i-s}" y="${a-s+15}" fill="#9ca3af" font-size="10" font-family="Roboto Mono" text-anchor="end">Day ${g}</text>`,h+=`<text x="${s-8}" y="${d(r)+3}" fill="#9ca3af" font-size="10" font-family="Roboto Mono" text-anchor="end">${I(r,!1)}</text>`,h+=`<text x="${s-8}" y="${d(n)+3}" fill="#9ca3af" font-size="10" font-family="Roboto Mono" text-anchor="end">${I(n,!1)}</text>`,h+="</svg>",h}};var Ve=class{constructor(e){this.manager=e}handleMissionTabSwitch(e){e!=="terminal"&&e!=="log"||(this.manager.lastKnownState.uiState.activeMissionTab=e,this.manager.render())}handleTrackMission(e){if(!e)return;let t=this.manager.lastKnownState;t.missions.trackedMissionId=e,this.manager.render()}renderStickyBar(e){let t=this.manager.cache.missionStickyBar,i=t.querySelector(".sticky-content"),a=this.manager.cache.stickyObjectiveText,s=this.manager.cache.stickyObjectiveProgress,o=e.missions.trackedMissionId||e.missions.activeMissionIds[0];if(o&&e.missions.activeMissionIds.includes(o)){let r=f.MISSIONS[o];if(!r.objectives||r.objectives.length===0){t.style.display="none";return}let n=e.missions.missionProgress[r.id]||{objectives:{}},l,c=0,d=1,h=null;r.objectives&&(h=r.objectives[0],l=h.id||h.goodId,n.objectives[l]?(c=n.objectives[l].current,d=n.objectives[l].target):(c=0,d=h.quantity||h.value||1));let p=this._getObjectiveLabel(h),y=`[${c}/${d}]`,g=0;if(h)if(["have_fuel_tank","HAVE_FUEL_TANK"].includes(h.type))y=`[${c}]`,g=Math.min(100,c/(d||100)*100);else if(["have_hull_pct","HAVE_HULL_PCT"].includes(h.type)){let _=h.comparator||">=";y=`[${c}% / ${_}${d}%]`,g=Math.min(100,c)}else if(["have_cargo_pct","HAVE_CARGO_PCT"].includes(h.type)){let _=h.comparator||">=";y=`[${c}% / ${_}${d}%]`,g=Math.min(100,c)}else g=Math.min(100,c/d*100);a.textContent=`${p}`,s.textContent=y;let S=`host-${r.host.toLowerCase().replace(/[^a-z0-N]/g,"")}`,b=!r.completion.locationId||r.completion.locationId===e.currentLocationId,A=n.isCompletable&&b?"mission-turn-in":"";i.className=`sticky-content ${S} ${A}`,i.style.background=`linear-gradient(90deg, var(--theme-border) ${g}%, rgba(0, 0, 0, 0.9) ${g}%)`,t.style.display="block"}else t.style.display="none"}_getObjectiveLabel(e){return e?e.type==="have_item"||e.type==="DELIVER_ITEM"?`Deliver ${f.COMMODITIES.find(i=>i.id===(e.goodId||e.target))?.name||"Item"}`:e.type==="travel_to"||e.type==="TRAVEL_TO"?`Travel to ${f.MARKETS.find(i=>i.id===e.target)?.name||"Location"}`:e.type==="wealth_gt"||e.type==="WEALTH_CHECK"?"Earn Credits":["have_fuel_tank","HAVE_FUEL_TANK"].includes(e.type)?"Fuel Tank":["have_hull_pct","HAVE_HULL_PCT"].includes(e.type)?"Hull Status":["have_cargo_pct","HAVE_CARGO_PCT"].includes(e.type)?"Cargo Usage":"Objective":"Objective"}flashObjectiveProgress(){let e=this.manager.cache.stickyObjectiveProgress;e&&(e.classList.add("objective-progress-flash"),setTimeout(()=>{e.classList.remove("objective-progress-flash")},700))}showMissionModal(e){let t=f.MISSIONS[e];if(!t)return;let{missions:i,currentLocationId:a}=this.manager.lastKnownState,s=i.activeMissionIds.includes(e),o=i.missionProgress[e],r=o?o.isCompletable:!1,n=!t.completion.locationId||t.completion.locationId===a;s&&r&&n?this._showMissionCompletionModal(t):this._showMissionDetailsModal(t)}_showMissionDetailsModal(e){let{missions:t,tutorials:i}=this.manager.lastKnownState,a=t.activeMissionIds.includes(e.id),s=!1;!a&&t.activeMissionIds.length>=4&&(s=!0),e.id==="mission_tutorial_02"&&i.activeBatchId==="intro_missions"&&i.activeStepId!=="mission_2_4"&&(s=!0);let o={dismissOutside:!0,customSetup:(r,n)=>{let l=r.querySelector(".modal-content");l.className="modal-content sci-fi-frame flex flex-col items-center text-center";let c=`host-${e.host.toLowerCase().replace(/[^a-z0-N]/g,"")}`;l.classList.add(c),r.querySelector("#mission-modal-type").textContent=e.type;let d=r.querySelector("#mission-modal-objectives"),h='<h6 class="font-bold text-sm uppercase tracking-widest text-gray-400 text-center">OBJECTIVES:</h6><ul class="list-disc list-inside text-gray-300">'+e.objectives.map(g=>`<li>${this._getObjectiveDescription(g)}</li>`).join("")+"</ul>";d.innerHTML=h,d.style.display="block";let p=r.querySelector("#mission-modal-rewards");if(e.rewards&&e.rewards.length>0){let g=e.rewards.map(S=>S.type==="credits"?`<span class="credits-text-pulsing">${I(S.amount,!0)}</span>`:S.type.toUpperCase()).join(", ");p.innerHTML=`<p class="font-roboto-mono text-sm text-gray-400 mb-1">REWARDS:</p><p class="font-orbitron text-xl text-yellow-300">${g}</p>`,p.style.display="block"}else p.innerHTML="",p.style.display="none";let y=r.querySelector("#mission-modal-buttons");if(a){let g=e.isAbandonable!==!1;y.innerHTML=`<button class="btn w-full bg-red-800/80 hover:bg-red-700/80 border-red-500" data-action="abandon-mission" data-mission-id="${e.id}" ${g?"":"disabled"}>Abandon Mission</button>`}else{let g=s&&t.activeMissionIds.length>=4?"Mission Log Full (4/4)":"Accept";y.innerHTML=`<button class="btn w-full" data-action="accept-mission" data-mission-id="${e.id}" ${s?"disabled":""}>${g}</button>`}}};e.id==="mission_tutorial_01"&&i.activeStepId==="mission_1_1"&&(s=!0),this.manager.queueModal("mission-modal",e.name,e.description,null,o)}_getObjectiveDescription(e){if(e.type==="have_item"||e.type==="DELIVER_ITEM"){let t=f.COMMODITIES.find(i=>i.id===(e.goodId||e.target))?.name||"Item";return`Deliver ${e.quantity||1}x ${t}`}return e.type==="travel_to"||e.type==="TRAVEL_TO"?`Travel to ${f.MARKETS.find(i=>i.id===e.target)?.name||"Location"}`:e.type==="wealth_gt"||e.type==="WEALTH_CHECK"?`Amass ${I(e.value)} Credits`:"Complete Objective"}_showMissionCompletionModal(e){let t={dismissOutside:!0,customSetup:(i,a)=>{let s=i.querySelector(".modal-content");s.className="modal-content sci-fi-frame flex flex-col items-center text-center";let o=`host-${e.host.toLowerCase().replace(/[^a-z0-N]/g,"")}`;s.classList.add(o),i.querySelector("#mission-modal-title").textContent=e.completion.title,i.querySelector("#mission-modal-type").textContent="OBJECTIVES MET",i.querySelector("#mission-modal-description").innerHTML=e.completion.text;let r=i.querySelector("#mission-modal-objectives");r.style.display="none";let n=i.querySelector("#mission-modal-rewards");if(e.rewards&&e.rewards.length>0){let c=e.rewards.map(d=>d.type==="credits"?`<span class="credits-text-pulsing">${I(d.amount,!0)}</span>`:d.type.toUpperCase()).join(", ");n.innerHTML=`<p class="font-roboto-mono text-sm text-gray-400 mb-1">REWARDS:</p><p class="font-orbitron text-xl text-green-300">${c}</p>`,n.style.display="block"}else n.innerHTML="",n.style.display="none";let l=i.querySelector("#mission-modal-buttons");l.innerHTML=`<button class="btn w-full btn-pulse-green" data-action="complete-mission" data-mission-id="${e.id}">${e.completion.buttonText}</button>`}};this.manager.queueModal("mission-modal",e.completion.title,e.completion.text,null,t)}handleSetIntelTab(e){let t=e.dataset.target;t&&this.manager.simulationService&&this.manager.simulationService.setIntelTab(t)}updateIntelTab(e){let t=this.manager.cache.intelScreen;if(!t)return;let i=t.querySelector(".sub-nav-bar");if(!i)return;t.querySelectorAll(".sub-nav-button").forEach(o=>o.classList.remove("active")),t.querySelectorAll(".intel-tab-content").forEach(o=>o.classList.remove("active"));let a=t.querySelector(`.sub-nav-button[data-target="${e}"]`),s=t.querySelector(`#${e}`);a&&a.classList.add("active"),s&&s.classList.add("active"),e==="intel-market-content"?i.classList.add("market-active"):i.classList.remove("market-active")}handleShowIntelOffer(e){let{packetId:t,locationId:i,price:a}=e.dataset,s=this._findIntelPacket(t,i);if(!s)return;let o=f.MARKETS.find(d=>d.id===s.dealLocationId)?.name||"a distant market",r;if(s.messageKey)r=le[s.messageKey];else if(s.messageIndex!==void 0){let d=le[s.locationId];s.fallbackMsg&&(d=le[s.fallbackMsgSource]),d||(this.manager.logger.warn("UIMissionControl",`SaveCompat: No message array for ${s.locationId}, using fallback.`),d=le.CORP_FAILURE_01),r=d?d[s.messageIndex]:null}let n=(r?.sample||"Intel available at [location name].").replace("[location name]",o),l=parseInt(a,10),c=`
            <button class="btn btn-module btn-module-credit" 
                    data-action="buy_intel" 
                    data-packet-id="${s.id}" 
                    data-location-id="${i}" 
                    data-price="${l}">
                Purchase Intel (<span class="credits-text-pulsing">${I(l,!0)}</span>)
            </button>`;this.manager.queueModal("event-modal","Intel Offer",n,null,{theme:i,dismissOutside:!0,footer:c})}handleBuyIntel(e,t){let{packetId:i,locationId:a,price:s}=e.dataset,o=parseInt(s,10);if(this.manager.intelService.purchaseIntel(i,a,o)){this.manager.hideModal("event-modal"),t&&this.manager.createFloatingText(`-${I(o,!1)}`,t.clientX,t.clientY,"#f87171");let n=this._findIntelPacket(i,a);n&&this._showIntelDetailsModal(n,n.pricePaid,a)}else this.manager.hideModal("event-modal"),this.manager.queueModal("event-modal","Purchase Failed","Unable to purchase intel. You may already have an active deal or insufficient credits.")}handleShowIntelDetails(e){let{packetId:t,locationId:i}=e.dataset,a=this._findIntelPacket(t,i);if(!a)return;let s=a.pricePaid||this.manager.intelService.calculateIntelPrice(a);this._showIntelDetailsModal(a,s,i)}_findIntelPacket(e,t){let i=this.manager.lastKnownState;if(i.intelMarket[t]){let a=i.intelMarket[t].find(s=>s.id===e);if(a)return a}for(let a of Object.keys(i.intelMarket)){let s=i.intelMarket[a].find(o=>o.id===e);if(s)return s}return this.manager.logger.error("UIMissionControl",`_findIntelPacket: Could not find packet ${e} anywhere.`),null}_showIntelDetailsModal(e,t,i){let a,s=!1;e.messageKey?(a=le[e.messageKey]?.details||"No details found.",s=!0):e.messageIndex!==void 0?(this.manager.logger.warn("UIMissionControl",`SaveCompat: Found old packet with messageIndex ${e.messageIndex}`),a="Details for this expired intel packet are no longer available in the new system."):a={CORPORATE_LIQUIDATION:{details:"PACKET DECRYPTED: A [commodity name] surplus at [location name] allows for purchase at [discount amount %] below galactic average. This price is locked for [durationDays] days. A minor Corporate State is quietly liquidating assets to meet quarterly quotas. This is a standard, low-risk procurement opportunity. This intel was secured for [\u232C credit price]."},SUPPLY_CHAIN_SHOCK:{details:"DATA UNLOCKED: [commodity name] is available at [location name] for [discount amount %] off standard pricing. This window is open for [durationDays] days. A Merchant's Guild freighter was damaged, forcing them to offload their cargo here at a loss. Their misfortune is your gain. This access was [\u232C credit price]."}}[e.messageKey]?.details||"Packet is corrupted. No message data found.";let o=this._formatIntelDetails(a,e,t,s);this.manager.queueModal("event-modal","Intel Unlocked",o,null,{theme:i,dismissInside:!0,dismissOutside:!0,customSetup:(r,n)=>{let l=r.querySelector("#event-button-container");if(l){l.innerHTML=`
                        <button class="btn btn-pulse-green w-full" id="intel-navigate-btn">
                            NAVIGATE TO ${e.dealLocationId?"TARGET":"SYSTEM"}
                        </button>`;let c=l.querySelector("#intel-navigate-btn");c&&c.addEventListener("click",()=>{this.manager.simulationService&&this.manager.simulationService.setScreen($.SHIP,x.NAVIGATION),e.dealLocationId&&setTimeout(()=>{this.manager.showLaunchModal(e.dealLocationId)},100),n()})}}})}_formatIntelDetails(e,t,i,a){let s=f.MARKETS.find(p=>p.id===t.dealLocationId)?.name||"an unknown location",o=f.COMMODITIES.find(p=>p.id===t.commodityId)?.name||"a mystery commodity",r=`${Math.floor(t.discountPercent*100)}%`,n=i?I(-i,!0):"???",l=this.manager.intelService.getCurrentDay(),c=Math.max(0,(t.expiryDay||0)-l),d;c===0?d="less than a day":c===1?d="1 day":d=`${c} days`;let h=e.replace(/\[location name\]/g,s).replace(/\[commodity name\]/g,o).replace(/\[discount amount %\]/g,r);return h=h.replace(/\[durationDays\]\s*days/g,d),h=h.replace(/\[durationDays\]/g,d),h=h.replace(/<span class="credits-text-pulsing"> \[credit price\]<\/span>/g,`<span class="text-glow-red">${n}</span>`),h=h.replace(/\[ credit price\]/g,`<span class="text-glow-red">${n}</span>`),h}};var qe=class{constructor(e){this.manager=e}updateHangarScreen(e){let{uiState:t,player:i}=e,a=this.manager.cache.hangarScreen;if(!a)return;let s=a.querySelector("#hangar-carousel");if(!s)return;let r=t.hangarShipyardToggleState==="hangar"?t.hangarActiveIndex||0:t.shipyardActiveIndex||0;s.style.transform=`translateX(-${r*100}%)`;let n=2;s.querySelectorAll(".carousel-page").forEach((h,p)=>{let y=Math.abs(r-p),g=h.querySelector("img"),S=h.querySelector("span");if(g)if(y>n)g.hasAttribute("src")&&(g.removeAttribute("src"),g.style.opacity="0",g.removeAttribute("data-tried-fallback"),S&&(S.style.display="flex"));else{let b=h.dataset.shipId;if(b){let T=V.getShipImage(b,i.visualSeed);(!g.hasAttribute("src")||!g.src.includes(T))&&(g.src=T,g.onload=()=>{g.style.opacity="1"},S&&(S.style.display="none"))}}}),this._renderHangarPagination(e);let c=a.querySelector("#hangar-pagination-wrapper"),d=a.querySelector(".pagination-dot.active");if(c&&d){let h=c.clientWidth,p=d.offsetLeft,y=d.offsetWidth,g=p-h/2+y/2;c.scrollTo({left:g,behavior:"smooth"})}}_renderHangarPagination(e){let{uiState:t,player:i,currentLocationId:a}=e,s=this.manager.cache.hangarScreen;if(!s)return;let o=s.querySelector("#hangar-pagination");if(!o)return;let r=t.hangarShipyardToggleState==="hangar",l=(r?i.ownedShipIds:this.manager.simulationService._getShipyardInventory().map(([b])=>b)).length;if(l<=1){o.innerHTML="";return}let c=r?t.hangarActiveIndex||0:t.shipyardActiveIndex||0,d=-1;r&&(d=i.ownedShipIds.indexOf(i.activeShipId));let p=f.MARKETS.find(b=>b.id===a)?.navTheme||{borderColor:"#7a9ac0"},y=6,g=[];if(l<=y+1)for(let b=0;b<l;b++)g.push({index:b,isActive:b===c,isHalf:!1,isBoarded:b===d});else{let b,T,A=c<y-1,_=c>l-y;A?(b=0,T=y):_?(b=l-y,T=l):(b=c-Math.floor(y/2)+1,T=c+Math.ceil(y/2)),b>0&&g.push({isHalf:!0,jump:"prev"});for(let L=b;L<T;L++)g.push({index:L,isActive:L===c,isHalf:!1,isBoarded:L===d});T<l&&g.push({isHalf:!0,jump:"next"})}let S=g.map(b=>{let T=`
                --theme-color-primary: ${p.borderColor};
                --theme-glow-color: ${p.borderColor};
            `;if(b.isHalf)return`<div class="pagination-dot half" style="${T}" data-action="${w.SET_HANGAR_PAGE}" data-jump-direction="${b.jump}"></div>`;{let A=b.isBoarded?"boarded":"";return`<div class="pagination-dot ${b.isActive?"active":""} ${A}" style="${T}" data-action="${w.SET_HANGAR_PAGE}" data-index="${b.index}"></div>`}}).join("");o.innerHTML=S}showShipDetailModal(e,t,i){let{player:a,tutorials:s}=e,o=f.SHIPS[t],r;if(i==="shipyard"){let c=a.credits>=o.price,d=s.activeBatchId==="intro_hangar"&&s.activeStepId==="hangar_1",h=!c||d;r=`
                <div class="ship-card p-4 flex flex-col space-y-3">
                    <div class="flex justify-between items-start">
                        <div>
                             <h3 class="text-xl font-orbitron text-cyan-300">${o.name}</h3>
                            <p class="text-sm text-gray-400">Class ${o.class}</p>
                         </div>
                        <div class="text-right">
                             <p class="text-lg font-bold text-cyan-300">${I(o.price)}</p>
                        </div>
                    </div>
                     <p class="text-sm text-gray-400 flex-grow text-left">${o.lore}</p>
                    <div class="grid grid-cols-3 gap-x-4 text-sm font-roboto-mono text-center pt-2">
                        <div><span class="text-gray-500">Hull:</span> <span class="text-green-400">${o.maxHealth}</span></div>
                        <div><span class="text-gray-500">Fuel:</span> <span class="text-sky-400">${o.maxFuel}</span></div>
                        <div><span class="text-gray-500">Cargo:</span> <span class="text-amber-400">${o.cargoCapacity}</span></div>
                    </div>
                     <button class="btn w-full mt-2" data-action="${w.BUY_SHIP}" data-ship-id="${t}" ${h?"disabled":""}>Purchase</button>
                </div>`}else{let c=a.shipStates[t],d=a.inventories[t],h=X(d),p=t===a.activeShipId,y=a.ownedShipIds.length>1&&!p,g=0;c.upgrades&&c.upgrades.forEach(A=>{let _=M.getDefinition(A);_&&(g+=_.value)});let S=Math.floor((o.price+g)*G.SHIP_SELL_MODIFIER),b=(c.upgrades||[]).map(A=>{let _=M.getDefinition(A),L=_?_.name:A,N=_?_.description:"",O=_&&(_.pillColor||_.color)||"#94a3b8",F=1;A.endsWith("_3")||A.endsWith("_III")?F=3:A.endsWith("_2")||A.endsWith("_II")?F=2:A.endsWith("_4")?F=4:A.endsWith("_5")&&(F=5);let B=this._adjustColor(O,-40),D=F>1?`2px solid ${B}`:`1px solid ${O}`,U=O;if(F===3){let W=this._adjustColor(O,30),j=this._adjustColor(O,-80);U=`linear-gradient(135deg, ${W} 0%, ${O} 40%, ${j} 100%)`}else F===2?U=`linear-gradient(to bottom, ${O}, ${this._adjustColor(O,-20)})`:F>=4&&(U=`linear-gradient(45deg, ${O}, ${this._adjustColor(O,40)})`);return`<span class="attribute-pill inline-block px-2 py-0.5 rounded text-xs font-bold mr-1 mb-1 cursor-help" 
                              title="${N}"
                              style="background: ${U}; border: ${D}; color: #0f172a; box-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                            ${L}
                        </span>`}).join(""),T=b?`<div class="mt-2 flex flex-wrap justify-center">${b}</div>`:"";r=`
                 <div class="ship-card p-4 flex flex-col space-y-3 ${p?"border-yellow-400":""}">
                    <h3 class="text-xl font-orbitron text-center ${p?"text-yellow-300":"text-cyan-300"}">${o.name}</h3>
                    <p class="text-sm text-gray-400 text-center">Class ${o.class}</p>
                    <p class="text-sm text-gray-400 flex-grow text-left my-2">${o.lore}</p>
                    <div class="grid grid-cols-3 gap-x-4 text-sm font-roboto-mono text-center pt-2">
                        <div><span class="text-gray-500">Hull</span><div class="text-green-400">${Math.floor(c.health)}/${o.maxHealth}</div></div>
                        <div><span class="text-gray-500">Fuel</span><div class="text-sky-400">${Math.floor(c.fuel)}/${o.maxFuel}</div></div>
                        <div><span class="text-gray-500">Cargo</span><div class="text-amber-400">${h}/${o.cargoCapacity}</div></div>
                    </div>
                    ${T}
                      <div class="grid grid-cols-2 gap-2 mt-2">
                        ${p?'<button class="btn" disabled>ACTIVE</button>':`<button class="btn" data-action="${w.SELECT_SHIP}" data-ship-id="${t}">Board</button>`}
                        <button class="btn" data-action="${w.SELL_SHIP}" data-ship-id="${t}" ${y?"":"disabled"}>Sell<br>\u232C ${I(S,!1)}</button>
                    </div>
                 </div>`}let n=this.manager.cache.shipDetailModal,l=n.querySelector("#ship-detail-content");l.innerHTML=r,n.classList.remove("hidden"),n.classList.add("modal-visible")}showUpgradeInstallationModal(e,t,i,a,s){let o=M.getDefinition(e);if(!o)return;let r=a.upgrades||[],n=r.length>=3,l=t+i,c=l>0?"Purchase Upgrade":"Install Upgrade",h=`<p class="mb-2">Install <span class="font-bold" style="color: ${o.pillColor||o.color||"#fff"}">${o.name}</span>?</p>`;l>0&&(h+=`<p class="text-base text-gray-400">Total Cost: <span class="credits-text-pulsing">${I(l,!0)}</span></p>`,i>0&&(h+=`<p class="text-xs text-gray-500 font-mono">Installation Fee: ${I(i)}</p>`)),h+=`<p class="mt-4 italic text-sm text-gray-500">${o.description}</p>`,this.manager.queueModal("event-modal",c,h,null,{dismissOutside:!0,customSetup:(p,y)=>{let g=p.querySelector("#event-button-container"),S=p.querySelector("#event-description"),b=()=>{g.className="flex justify-center gap-4 w-full mt-4",g.innerHTML=`
                        <button id="confirm-install-btn" class="btn btn-pulse-green">Confirm</button>
                        <button id="cancel-install-btn" class="btn">Cancel</button>
                    `;let _=p.querySelector("#confirm-install-btn");_.onclick=()=>{n?T():(y(),s(-1))},p.querySelector("#cancel-install-btn").onclick=y},T=()=>{let _=p.querySelector("#event-title");_.textContent="Upgrade Capacity Full";let L=r.map((N,O)=>{let F=M.getDefinition(N),B=F&&(F.pillColor||F.color)||"#fff",D=F?F.name:N,U=F&&F.description||"Unknown Effect",W=F?I(F.value,!0):"0";return`<button class="btn btn-sm border border-gray-600 hover:border-red-500 w-full text-left px-4 py-3 bg-gray-800 flex justify-between items-center" data-idx="${O}">
                                    <div class="flex flex-col overflow-hidden">
                                        <span class="font-bold" style="color: ${B}">${D}</span>
                                        <div class="marquee-container text-xs text-gray-400 mt-1">
                                            <span class="marquee-content">${U}</span>
                                        </div>
                                    </div>
                                    <div class="text-right flex-shrink-0 ml-4">
                                        <span class="text-xs text-gray-500 block">Value</span>
                                        <span class="font-mono font-bold text-cyan-300 text-glow-cyan text-sm">${W}</span>
                                    </div>
                                </button>`}).join("");S.innerHTML=`
                        <p class="mb-4 text-orange-400">Ship systems are at maximum capacity (3/3).</p>
                        <p class="mb-4 text-sm text-gray-300">Select an existing upgrade to dismantle and replace:</p>
                        <div class="flex flex-col gap-2 w-full max-w-sm mx-auto">
                            ${L}
                        </div>
                    `,g.innerHTML='<button id="cancel-replace-btn" class="btn w-full mt-2">Cancel</button>',p.querySelector("#cancel-replace-btn").onclick=y,S.querySelectorAll("button[data-idx]").forEach(N=>{N.onclick=()=>{let O=parseInt(N.dataset.idx,10);A(O)}})},A=_=>{let L=r[_],N=M.getDefinition(L),O=p.querySelector("#event-title");O.textContent="Confirm Replacement";let F=N&&(N.pillColor||N.color)||"#fff",B=N?N.name:L;S.innerHTML=`
                        <p class="mb-4 text-red-400 font-bold">WARNING: Destructive Action</p>
                        <p class="mb-2">Replacing <span class="font-bold" style="color: ${F}">${B}</span> will <span class="font-bold text-red-500">permanently</span> destroy it.</p>
                        <p class="text-sm text-gray-400">You will receive no credits for the dismantled part.</p>
                    `,g.className="flex gap-4 w-full mt-4",g.innerHTML=`
                        <button id="final-confirm-btn" class="btn bg-red-600 hover:bg-red-500 text-white flex-1">Dismantle & Install</button>
                        <button id="final-cancel-btn" class="btn flex-1">Cancel</button>
                    `,p.querySelector("#final-confirm-btn").onclick=()=>{y(),s(_)},p.querySelector("#final-cancel-btn").onclick=y};b()}})}async runShipTransactionAnimation(e,t="is-dematerializing"){let i=this._getActiveShipTerminalElement();if(!i){this.manager.logger.warn("UIHangarControl",`No element to animate for ${e}. Skipping animation.`);return}await Yt(i,t)}_getActiveShipTerminalElement(){let e=this.manager.lastKnownState;if(!e)return null;let t=this.manager.cache.hangarScreen;if(!t)return null;let i=t.querySelector("#hangar-carousel");if(!i)return null;let s=e.uiState.hangarShipyardToggleState==="hangar"?e.uiState.hangarActiveIndex||0:e.uiState.shipyardActiveIndex||0,r=i.querySelectorAll(".carousel-page")[s];return r?r.querySelector("#ship-terminal"):null}_adjustColor(e,t){if(!e||!e.startsWith("#"))return"#94a3b8";let i=e.replace("#",""),a=Math.max(0,Math.min(255,parseInt(i.substring(0,2),16)+t)),s=Math.max(0,Math.min(255,parseInt(i.substring(2,4),16)+t)),o=Math.max(0,Math.min(255,parseInt(i.substring(4,6),16)+t)),r=a.toString(16).padStart(2,"0"),n=s.toString(16).padStart(2,"0"),l=o.toString(16).padStart(2,"0");return`#${r}${n}${l}`}};var ft=`
    <h3 class="text-2xl font-orbitron mb-4 text-center">End-User License Agreement (EULA) for Orbital Trading</h3>
    <p class="text-sm text-center text-gray-400 mb-4">Last Updated: November 6, 2025</p>
    <p>This End-User License Agreement ("EULA" or "Agreement") is a binding legal contract between you (either an individual or a single entity, hereafter "You," "Your," or "Licensee") and Devon P. Casey (hereafter "Licensor," "Developer," "We," "Us," or "Our") for the software application known as Orbital Trading, including any and all associated media, printed materials, and "online" or electronic documentation (collectively, the "Software").</p>
    <p>BY INSTALLING, COPYING, DOWNLOADING, OR OTHERWISE USING THE SOFTWARE, YOU AGREE TO BE BOUND BY THE TERMS OF THIS EULA.</p>
    <p>IF YOU DO NOT AGREE TO THE TERMS OF THIS EULA, DO NOT INSTALL OR USE THE SOFTWARE. YOU MUST PROMPTLY DELETE ALL COPIES OF THE SOFTWARE IN YOUR POSSESSION.</p>
    <p>IF YOU ARE A MINOR (BELOW THE AGE OF LEGAL MAJORITY IN YOUR JURISDICTION), YOUR PARENT OR LEGAL GUARDIAN MUST READ AND AGREE TO THIS EULA ON YOUR BEHALF.</p>
    <h4 class="text-xl font-orbitron mt-4 mb-2">1. GRANT OF LICENSE</h4>
    <p>Subject to your strict and ongoing compliance with all terms and conditions of this Agreement, Licensor grants You a limited, non-exclusive, non-transferable, non-sublicensable, revocable license to install and use one (1) copy of the Software solely for Your own personal, non-commercial entertainment use on a single device (e.g., computer or mobile device) that You own or control.</p>
    <p>This Software is licensed, not sold. This license confers no title or ownership in the Software and should not be construed as a sale of any rights in the Software.</p>
    <h4 class="text-xl font-orbitron mt-4 mb-2">2. LICENSE RESTRICTIONS</h4>
    <p>Your right to use the Software is limited to the grant above, and You may not, under any circumstances, do any of the following:</p>
    <ul class="list-disc list-outside ml-6 space-y-2">
        <li>a. Copy, modify, adapt, translate, or create derivative works based on the Software, in whole or in part;</li>
        <li>b. Sell, rent, lease, sublicense, distribute, publicly display, publicly perform, or otherwise transfer or commercially exploit the Software or any of its components;</li>
        <li>c. Reverse engineer, decompile, disassemble, or otherwise attempt to derive or discover the source code of the Software, except and only to the extent that such activity is expressly permitted by applicable law notwithstanding this limitation;</li>
        <li>d. Use the Software for any commercial purpose (including, but not limited to, use at a cyber cafe, in a commercial arcade, or for any paid service) without the prior written consent of Licensor;</li>
        <li>e. Remove, alter, or obscure any copyright, trademark, or other proprietary rights notices on or in the Software;</li>
        <li>f. Use any cheats, exploits, automation software (bots), hacks, mods, or any unauthorized third-party software designed to modify or interfere with the Software experience;</li>
        <li>g. Use the Software to violate any applicable law, rule, or regulation;</li>
        <li>h. Scrape, data mine, or otherwise extract any data from the Software or its underlying servers or databases;</li>
        <li>i. Interfere with or disrupt the Software or any server or network used to support or provide the Software, including any hacking or "denial of service" attacks.</li>
    </ul>
    <p>Any use of the Software in violation of these License Restrictions is a material breach of this Agreement and may result in the immediate termination of your license and subject You to civil and/or criminal liability.</p>
    <h4 class="text-xl font-orbitron mt-4 mb-2">3. OWNERSHIP AND INTELLECTUAL PROPERTY</h4>
    <p>You agree and acknowledge that all title, ownership rights, and intellectual property (IP) rights in and to the Software (including, but not limited to, all code, computer graphics, visual elements, audio, music, sound effects, themes, characters, character names, stories, dialogue, locations, and artwork) are and shall remain the exclusive property of Devon P. Casey.</p>
    <p>Copyright (c) 2025 Devon P. Casey. All Rights Reserved.</p>
    <p>All rights not expressly granted to You in this EULA are reserved by Licensor.</p>
    <p>This Agreement grants You no title, ownership, or other IP interest in the Software.</p>
    <h4 class="text-xl font-orbitron mt-4 mb-2">4. VIRTUAL GOODS AND IN-GAME CURRENCY</h4>
    <p>The Software may include virtual in-game currency, items, commodities, ships, or other virtual content ("Virtual Goods").</p>
    <ul class="list-disc list-outside ml-6 space-y-2">
        <li>a.  License, Not Ownership:  You acknowledge that Virtual Goods are licensed to You as part of the Software and are not sold. You have no ownership right or property interest in any Virtual Goods, regardless of whether they were "earned" through gameplay or "purchased" with real money.</li>
        <li>b.  No Real-World Value:  Virtual Goods have no monetary value, are not real currency, and cannot be redeemed, sold, transferred, or exchanged for real-world money or any item of monetary value.</li>
        <li>c.  Licensor's Rights:  Licensor has the absolute right to manage, regulate, control, modify, and/or eliminate Virtual Goods at any time, in its sole discretion, with or without notice. Licensor shall have no liability to You or any third party for the exercise of such rights.</li>
        <li>d. No Refunds:  All purchases of Virtual Goods are final and non-refundable, except as required by applicable law.</li>
    </ul>
    <h4 class="text-xl font-orbitron mt-4 mb-2">5. FEEDBACK AND SUGGESTIONS</h4>
    <p>If You provide Licensor with any ideas, suggestions, bug reports, or other feedback regarding the Software ("Feedback"), You hereby grant Licensor a perpetual, irrevocable, worldwide, non-exclusive, royalty-free, fully paid-up, transferable, and sublicensable license to use, reproduce, modify, distribute, and otherwise exploit such Feedback for any purpose whatsoever (including for commercial purposes) without any obligation to provide compensation, credit, or attribution to You.</p>
    <h4 class="text-xl font-orbitron mt-4 mb-2">6. CODE OF CONDUCT</h4>
    <p>While using the Software, You agree to comply with all applicable laws and to not:</p>
    <ul class="list-disc list-outside ml-6 space-y-2">
        <li>a. Harass, threaten, bully, defame, or otherwise abuse another user or Licensor's staff;</li>
        <li>b. Transmit or post any content that is hateful, abusive, racially or ethnically offensive, obscene, or illegal;</li>
        <li>c. Impersonate any person, including any employee or representative of Licensor;</li>
        <li>d. Disrupt the normal flow of gameplay or dialogue, or otherwise act in a manner that negatively affects other users' experience.</li>
    </ul>
    <h4 class="text-xl font-orbitron mt-4 mb-2">7. UPDATES AND MODIFICATIONS</h4>
    <p>Licensor may, from time to time, provide updates, patches, or other modifications to the Software. You agree that Licensor may deploy and install these modifications remotely. You may be required to install such updates to continue using the Software. Licensor reserves the right to modify, suspend, or discontinue the Software, or any feature or part thereof, at any time with or without notice to You. Licensor shall not be liable to You or any third party for any such modification, suspension, or discontinuance.</p>
    <h4 class="text-xl font-orbitron mt-4 mb-2">8. TERMINATION</h4>
    <p>This EULA is effective until terminated.</p>
    <ul class="list-disc list-outside ml-6 space-y-2">
        <li>a.  Termination by You:  You may terminate this EULA at any time by permanently deleting, destroying, and uninstalling all copies of the Software in Your possession or control.</li>
        <li>b.  Termination by Licensor:  Licensor may terminate this EULA immediately and without prior notice if You fail to comply with any term or condition of this Agreement.</li>
        <li>c.  Effect of Termination:  Upon termination for any reason, all licenses granted to You herein shall immediately cease. You must immediately and permanently delete all copies of the Software. All provisions of this EULA that by their nature should survive termination shall survive, including, without limitation, Sections 2, 3, 4, 5, 8(c), 9, 10, 11, 12, and 13. NO REFUNDS WILL BE GRANTED UPON TERMINATION.</li>
    </ul>
    <h4 class="text-xl font-orbitron mt-4 mb-2">9. DISCLAIMER OF WARRANTIES</h4>
    <p>TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, THE SOFTWARE IS PROVIDED "AS IS" AND "AS AVAILABLE," WITH ALL FAULTS AND WITHOUT WARRANTY OF ANY KIND. LICENSOR HEREBY DISCLAIMS ALL WARRANTIES AND CONDITIONS, WHETHER EXPRESS, IMPLIED, OR STATUTORY, INCLUDING, BUT NOT LIMITED TO, ANY IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT, AND NON-INFRINGEMENT OF THIRD-PARTY RIGHTS. LICENSOR DOES NOT WARRANT THAT THE SOFTWARE WILL MEET YOUR REQUIREMENTS, THAT ITS OPERATION WILL BE UNINTERRUPTED OR ERROR-FREE, THAT DEFECTS WILL BE CORRECTED, OR THAT THE SOFTWARE IS FREE OF VIRUSES OR OTHER HARMFUL COMPONENTS.</p>
    <h4 class="text-xl font-orbitron mt-4 mb-2">10. LIMITATION OF LIABILITY</h4>
    <p>TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, IN NO EVENT SHALL LICENSOR (DEVON P. CASEY) OR HIS AFFILIATES BE LIABLE FOR ANY SPECIAL, INCIDENTAL, INDIRECT, CONSEQUENTIAL, OR PUNITIVE DAMAGES WHATSOEVER (INCLUDING, BUT NOT LIMITED TO, DAMAGES FOR LOSS OF PROFITS, LOSS OF DATA, BUSINESS INTERRUPTION, PERSONAL INJURY, OR LOSS OF PRIVACY) ARISING OUT OF OR IN ANY WAY RELATED TO THE USE OF OR INABILITY TO USE THE SOFTWARE, EVEN IF LICENSOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</p>
    <p>IN NO EVENT SHALL THE TOTAL LIABILITY OF LICENSOR TO YOU FOR ALL DAMAGES (EXCEPT AS MAY BE REQUIRED BY APPLICABLE LAW IN CASES OF PERSONAL INJURY) EXCEED THE AMOUNT ACTUALLY PAID BY YOU FOR THE SOFTWARE OR ONE UNITED STATES DOLLAR (USD $1.00), WHICHEVER IS GREATER.</p>
    <h4 class="text-xl font-orbitron mt-4 mb-2">11. INDEMNIFICATION</h4>
    <p>You agree to indemnify, defend, and hold harmless Licensor (Devon P. Casey) and his employees, agents, and affiliates from and against any and all claims, losses, damages, liabilities, costs, and expenses (including reasonable attorneys' fees) arising out of or relating to Your breach of this EULA or Your misuse of the Software.</p>
    <h4 class="text-xl font-orbitron mt-4 mb-2">12. GOVERNING LAW AND DISPUTE RESOLUTION</h4>
    <ul class="list-disc list-outside ml-6 space-y-2">
        <li>a. Governing Law:  This EULA shall be governed by and construed in accordance with the laws of the State of California, USA, without regard to its conflict of law principles.</li>
        <li>b.  Informal Negotiation:  To expedite resolution and control the cost of any dispute, You and Licensor agree to first attempt to negotiate any dispute informally for at least thirty (30) days before initiating any arbitration or court proceeding. Such informal negotiations commence upon written notice from one party to the other.</li>
        <li>c.  Binding Arbitration:  If a dispute cannot be resolved through informal negotiations, any claim, dispute, or controversy (excluding claims for injunctive or other equitable relief) shall be resolved by binding arbitration conducted by a single neutral arbitrator from the American Arbitration Association (AAA) under its Commercial Arbitration Rules. The arbitration shall take place in Santa Clara County, California. The arbitrator's decision shall be final and binding and may be entered as a judgment in any court of competent jurisdiction.</li>
        <li>d.  CLASS ACTION AND JURY TRIAL WAIVER:  YOU AND LICENSOR AGREE THAT ANY PROCEEDINGS TO RESOLVE OR LITIGATE ANY DISPUTE WILL BE CONDUCTED SOLELY ON AN INDIVIDUAL BASIS. NEITHER YOU NOR LICENSOR WILL SEEK TO HAVE ANY DISPUTE HEARD AS A CLASS ACTION, PRIVATE ATTORNEY GENERAL ACTION, OR IN ANY OTHER PROCEEDING IN WHICH EITHER PARTY ACTS OR PROPOSES TO ACT IN A REPRESENTATIVE CAPACITY. YOU AND LICENSOR BOTH EXPRESSLY WAIVE ANY RIGHT TO A TRIAL BY JURY.</li>
    </ul>
    <h4 class="text-xl font-orbitron mt-4 mb-2">13. GENERAL PROVISIONS</h4>
    <ul class="list-disc list-outside ml-6 space-y-2">
        <li>a.  Severability:  If any provision of this EULA is held to be invalid, illegal, or unenforceable, the validity, legality, and enforceability of the remaining provisions shall not be affected or impaired.</li>
        <li>b.  Entire Agreement:  This EULA constitutes the entire agreement between You and Licensor regarding the Software and supersedes all prior or contemporaneous understandings, agreements, or representations, whether written or oral.</li>
        <li>c.  Amendment:  Licensor reserves the right, at its sole discretion, to amend this EULA at any time. If We amend this EULA, We will post the amended EULA within the Software or on our website. Your continued use of the Software after such posting shall constitute Your acceptance of the amended EULA.</li>
        <li>d.  No Waiver:  The failure of Licensor to exercise or enforce any right or provision of this EULA shall not constitute a waiver of such right or provision.</li>
        <li>e.  Contact:  If You have any questions concerning this EULA, please contact Licensor at: devon_casey@outlook.com .</li>
    </ul>
`;var ui={story_so_far:{title:"Story So Far...",content:`
            <p>The year 2140 is the result of a single, massive corporate takeover. A century ago, the "Ad Astra Initiative" released advanced technology to all of humanity, a gift from the new Human-AI Alliance on Earth designed to kickstart our expansion into the stars. It was a promise of a new beginning, an open-source key to the solar system, ensuring the survival of all Earth life, both organic and synthetic.</p>
        
            <p>But a gift to everyone is a business opportunity for the few. The hyper-corporations, already positioned in space, immediately patented the most efficient manufacturing processes and proprietary components for this new technology. This maneuver ensured that while anyone could build a Folded-Space Drive, only the corporations could supply the high-performance parts needed to make it truly effective, creating a system-wide technological dependency that persists to this day. This technological monopoly created the "Drive-Divide," the central pillar of the new class system. Nearly all ships run on older, less efficient hardware. Very few ships employ these coveted Folded-Space Drives.</p>
            <p>The major hubs beyond Earth are sovereign, corporate-run territories where law is policy and your rights are listed in an employment contract. These scattered colonies are fierce rivals, engaged in constant economic warfare, all propped up by the interstellar supply lines maintained by the Merchant's Guild. For them, you are just another cog in the great machine of commerce.</p>
            <p>In a system owned by corporations, possessing your own ship is the only true form of freedom. Every credit earned, every successful trade, is a bet on your own skill and a step toward true sovereignty on the razor's edge of a cargo manifest.</p>
        `}};var yt={...ui};var We=class{constructor(e){this.manager=e}showRandomEventModal(e,t){let i=e.template?.title||e.title||"Unknown Event",a=e.template?.description||e.scenario||"No description available.";this.manager.queueModal("random-event-modal",i,a,null,{nonDismissible:!0,contentClass:"text-center",customSetup:(s,o)=>{let r=s.querySelector("#random-event-choices-container");r.innerHTML="",e.choices.forEach(n=>{let l=document.createElement("button");l.className="btn w-full p-4 hover:bg-slate-700 mb-2 event-choice-btn",n.disabled&&(l.disabled=!0,l.classList.add("opacity-50","cursor-not-allowed"));let c=(n.text||n.title||"Option").match(/^(.*?)\s*(\(.*\))?$/),d=c?c[1]:n.text||n.title,h=c&&c[2]?c[2]:"",p="text-gray-400";if(h){let y=h.toLowerCase();y.includes("space")?p="text-req-yellow":y.includes("delay")?p="text-delay-blue":["credit","hull","fuel","ice","plasteel","processor","propellant","cybernetic","wealth","scrap","premium"].some(g=>y.includes(g))&&(p="text-cost-orange")}l.innerHTML=`
                        <span class="choice-header">${d}</span>
                        ${h?`<span class="choice-subtext ${p}">${h}</span>`:""}
                    `,n.tooltip&&l.setAttribute("title",n.tooltip),l.onclick=()=>{t(n.id),o()},r.appendChild(l)})}})}showAgeEventModal(e,t){let i=document.getElementById("age-event-modal");i.classList.add("dismiss-disabled"),document.getElementById("age-event-title").innerHTML=e.title,document.getElementById("age-event-description").innerHTML=e.description;let a=document.getElementById("age-event-button-container");a.innerHTML="",e.choices.forEach(s=>{let o=document.createElement("button");o.className="perk-button",o.innerHTML=`<h4>${s.title}</h4><p>${s.description}</p>`,o.onclick=()=>{this.manager.hideModal("age-event-modal"),t(s)},a.appendChild(o)}),i.classList.remove("hidden"),i.classList.add("modal-visible")}showLoreModal(e){let t=this.manager.cache.loreModal,i=this.manager.cache.loreModalContent;if(!t||!i){this.manager.logger.error("UIEventControl","Lore modal elements not cached or found in DOM.");return}let a=yt[e];a?i.innerHTML=a.content:(this.manager.logger.error("UIEventControl",`No lore content found for ID: ${e}`),i.innerHTML="<p>Error: Lore content not found.</p>"),i.scrollTop=0,t.classList.remove("hidden"),t.classList.add("modal-visible");let s=o=>{(o.target.closest("#lore-modal-content")||o.target.id==="lore-modal")&&(this.manager.hideModal("lore-modal"),t.removeEventListener("click",s))};t.addEventListener("click",s)}showEulaModal(){let e=this.manager.cache.eulaModal,t=this.manager.cache.eulaModalContent;if(!e||!t){this.manager.logger.error("UIEventControl","EULA modal elements not cached or found in DOM.");return}ft?t.innerHTML=ft:(this.manager.logger.error("UIEventControl","EULA_CONTENT is not defined or empty."),t.innerHTML="<p>Error: EULA content not found.</p>"),t.scrollTop=0,e.classList.remove("hidden"),e.classList.add("modal-visible");let i=a=>{(a.target.closest("#eula-modal-content")||a.target.id==="eula-modal")&&(this.manager.hideModal("eula-modal"),e.removeEventListener("click",i))};e.addEventListener("click",i)}showLaunchModal(e){let t=this.manager.lastKnownState;if(!t)return;let i=f.MARKETS.find(g=>g.id===e);if(!i)return;let a=i.navTheme,s=t.TRAVEL_DATA[t.currentLocationId]?.[e],o=t.player.shipStates[t.player.activeShipId];if(!s)return;let r=t.player.revealedTier||1,l=(t.player.inventories[t.player.activeShipId]||{})[E.FOLDED_DRIVES]?.quantity||0,c=r>=7&&l>0,d="";c&&(d=`
                <div class="mt-4 flex flex-col items-center justify-center text-center space-y-1">
                    <div class="flex items-center justify-center space-x-2">
                        <input type="checkbox" id="fold-space-checkbox" class="w-5 h-5 cursor-pointer" style="accent-color: ${a.borderColor};">
                        <label for="fold-space-checkbox" class="text-sm font-orbitron font-bold cursor-pointer select-none" style="color: ${a.borderColor};">
                            FOLD SPACE
                        </label>
                    </div>
                    <div class="text-xs font-roboto-mono" style="color: ${a.borderColor}; opacity: 0.9;">
                        (1x Folded Drive)
                    </div>
                </div>
            `);let h=`
            <div class="launch-modal-wrapper panel-border" style="background: ${a.gradient}; color: ${a.textColor}; border-color: ${a.borderColor}; --theme-glow-color: ${a.borderColor};">
                <div class="flex-shrink-0">
                    <h3 class="font-orbitron">${i.name}</h3>
                     <p class="flavor-text italic">${i.launchFlavor}</p>
                </div>

                <div class="flex-grow flex items-center justify-center flex-col">
                     <button id="btn-launch-travel" class="btn-launch-glow" data-action="travel" data-location-id="${e}" style="--launch-glow-color: ${a.borderColor};">Launch</button>
                     ${d}
                </div>

                <div class="travel-info-text" id="launch-travel-info">
                     <p>Travel Time: ${s.time} Days</p>
                    <p>Fuel: ${Math.floor(o.fuel)} / ${s.fuelCost} required</p>
                </div>
            </div>`,p=this.manager.cache.launchModal;if(this.manager.cache.launchModalContent.innerHTML=h,p.classList.remove("hidden"),c){let g=p.querySelector("#fold-space-checkbox"),S=p.querySelector("#launch-travel-info"),b=p.querySelector("#btn-launch-travel");g&&S&&b&&g.addEventListener("change",T=>{let A=T.target.checked;b.dataset.useFoldedDrive=A?"true":"false",A?S.innerHTML=`
                            <p class="font-bold animate-pulse" style="color: ${a.borderColor};">Travel Time: INSTANT (Warp)</p>
                            <p style="color: ${a.borderColor};">Fuel: 0 (Folded Space)</p>
                        `:S.innerHTML=`
                            <p>Travel Time: ${s.time} Days</p>
                            <p>Fuel: ${Math.floor(o.fuel)} / ${s.fuelCost} required</p>
                        `})}requestAnimationFrame(()=>{p.classList.add("modal-visible");let g=p.querySelector(".launch-modal-wrapper");g&&requestAnimationFrame(()=>{g.classList.add("is-glowing")})});let y=g=>{g.target.id==="launch-modal"&&(this.manager.hideModal("launch-modal"),p.removeEventListener("click",y))};p.addEventListener("click",y)}showMapDetailModal(e){let t=f.MARKETS.find(g=>g.id===e);if(!t)return;let i=this.manager.cache.mapDetailModal,a=i.querySelector(".modal-content"),s=i.querySelector("#map-modal-content-container"),o=t.navTheme;a.style.background=o.gradient,a.style.setProperty("--theme-glow-color",o.borderColor),i.dataset.theme=e;let r=[],n=[];if(t.availabilityModifier)for(let[g,S]of Object.entries(t.availabilityModifier)){let b=f.COMMODITIES.find(T=>T.id===g);if(b){let T={name:b.name,style:Se(b.styleClass)};S<1?r.push(T):S>1&&n.push(T)}}let l=g=>g.map(S=>`<span class="commodity-tag" style="border-color: ${S.style.hex}; background-color: ${S.style.hex}20; color: ${S.style.hex};">${S.name}</span>`).join(""),c=M.getStationQuirks(e),d="";c.length>0?d=c.map(g=>`<p class="font-roboto-mono imprinted-text-embedded" style="color: #facc15;">${M.getDefinition(g).description}</p>`).join(""):d=`<p class="font-roboto-mono imprinted-text-embedded">${t.specialty||"None reported"}</p>`;let p=`
            ${`<div class="map-navigate-btn" data-action="navigate-to-poi" data-location-id="${e}">NAVIGATE \u276F\u276F</div>`}
            <div class="text-center">
                <h3 class="text-3xl font-orbitron" style="color: ${o.textColor};">${t.name}</h3>
                 <p class="text-lg italic imprinted-text">${t.launchFlavor}</p>
            </div>

            <div class="my-4 space-y-3">
                <div class="map-intel-block">
                    <h5 class="font-bold imprinted-text" style="color: ${o.textColor}; opacity: 0.7;">Fuel Price</h5>
                    <p class="font-roboto-mono imprinted-text-embedded"><span class="credits-text-pulsing">${I(t.fuelPrice,!0)}</span>/unit</p>
                 </div>
                <div class="map-intel-block">
                    <h5 class="font-bold imprinted-text" style="color: ${o.textColor}; opacity: 0.7;">Station Details</h5>
                    ${d}
                </div>
          </div>
            
             <div class="text-center">
                 <div>
                    <h5 class="font-bold imprinted-text">Exports:</h5>
                    <div>${n.length>0?l(n):'<span class="text-gray-400">CLASSIFIED</span>'}</div>
                </div>
                <div class="mt-2">
                     <h5 class="font-bold imprinted-text">Needs:</h5>
                     <div>${r.length>0?l(r):'<span class="text-gray-400">CLASSIFIED</span>'}</div>
                </div>
            </div>
        `;s.innerHTML=p,i.classList.remove("hidden"),i.classList.remove("is-glowing"),requestAnimationFrame(()=>{i.classList.add("modal-visible"),i.classList.add("is-glowing")});let y=g=>{(g.target.id==="map-detail-modal"||g.target.closest(".modal-content"))&&(this.hideMapDetailModal(),i.removeEventListener("click",y))};requestAnimationFrame(()=>{i.addEventListener("click",y)})}hideMapDetailModal(){let e=this.manager.cache.mapDetailModal;if(e){e.classList.remove("is-glowing"),delete e.dataset.theme;let t=e.__mapDetailCloseHandler;t&&(e.removeEventListener("click",t),delete e.__mapDetailCloseHandler)}this.manager.hideModal("map-detail-modal")}showCargoDetailModal(e,t){let i=f.COMMODITIES.find(s=>s.id===t),a=e.player.inventories[e.player.activeShipId]?.[t];!i||!a||this.manager.queueModal("cargo-detail-modal",null,null,null,{dismissInside:!0,dismissOutside:!0,footer:null,customSetup:(s,o)=>{let r=s.querySelector("#cargo-detail-content");r&&(r.innerHTML=ri(i,a))}})}createFloatingText(e,t,i,a="#fde047"){let s=document.createElement("div");s.textContent=e,s.className="floating-text",s.style.left=`${t-20}px`,s.style.top=`${i-40}px`,s.style.color=a,document.body.appendChild(s),setTimeout(()=>s.remove(),2450)}showStrandedModal(e,t,i){let a="Critical Failure: Stranded",s=`Event delays and route deviations have pushed your fuel requirements beyond your current reserves. <br><br>Your engines sputter and die, leaving you drifting in the void. After <span class="text-result-time">${t}</span> grueling days on emergency life support, a passing freighter tows you back to <b>${e}</b>.<br><br>The rescue fees have drained your remaining fuel. Your arbitrage run has failed.`,o=[{type:"EFF_FUEL",value:0},{type:"EFF_TRAVEL_TIME",value:t}];this.showEventResultModal(a,s,o,i)}showEventResultModal(e,t,i,a){let s,o,r,n=typeof a=="function"?a:null;Array.isArray(i)?(s=e||"System Alert",o=t||"",r=i):Array.isArray(t)?(s="System Alert",o=e||"",r=t,typeof i=="function"&&(n=i)):typeof e=="string"?(s=e,o=typeof t=="string"?t:"",r=[]):(console.warn("[UIEventControl] Invalid arguments passed to showEventResultModal",{titleOrText:e,textOrEffects:t,effectsOrUndefined:i}),s="System Alert",o="",r=[]);let l="";r&&r.length>0&&(l='<ul class="list-none text-lg text-gray-300 mt-6 space-y-3 text-center">',r.forEach(c=>{let d="",h="font-medium";switch(c.type){case"EFF_CREDITS":let p=c.value>0;d=`<span class="${h} ${p?"text-result-credit-gain":"text-result-credit-loss"}">Credits: ${p?"+":""}${I(c.value)}</span>`;break;case"EFF_FUEL":d=`<span class="${h} text-result-fuel">Fuel: ${c.value>0?"+":""}${Math.round(c.value)}</span>`;break;case"EFF_HULL":d=`<span class="${h} text-result-hull">Hull: ${c.value>0?"+":""}${Math.round(c.value)}</span>`;break;case"EFF_TRAVEL_TIME":case"EFF_MODIFY_TRAVEL":d=`<span class="${h} text-result-time">Travel Time: ${c.value>0?"+":""}${Math.round(c.value)} Days</span>`;break;case"EFF_ADD_ITEM":let S=c.addedItem||c.target,b=c.addedQty||Math.round(c.value);d=`<span class="${h} text-result-cargo">Received: ${b}x ${S}</span>`;break;case"EFF_REMOVE_ITEM":d=`<span class="${h} text-result-cargo">Removed: ${Math.round(c.value)}x ${c.target}</span>`;break;case"EFF_LOSE_RANDOM_CARGO":d=`<span class="${h} text-result-cargo">Cargo Lost: ${Math.round(c.value*100)}%</span>`;break;case"EFF_ADD_RANDOM_CARGO":c.addedItem&&c.addedQty?d=`<span class="${h} text-result-cargo">Received: ${c.addedQty}x ${c.addedItem}</span>`:d=`<span class="${h} text-gray-500">No salvage recovered.</span>`;break;case"EFF_ADD_UPGRADE":c.installedUpgrade?d=`<span class="${h} text-result-cargo">Installed: ${c.installedUpgrade}</span>`:d=`<span class="${h} text-gray-500">Upgrade already installed.</span>`;break;default:return}l+=`<li>${d}</li>`}),l+="</ul>"),this.manager.queueModal("event-result-modal",s,o+l,n,{dismissOutside:!1,dismissInside:!1,contentClass:"text-center",buttonText:"Continue"})}_renderCodexButtons(e){let t=e.querySelector("#lore-button-container");t&&(t.innerHTML=Object.entries(yt).map(([i,a])=>`<button class="btn btn-header" data-action="show_lore" data-lore-id="${i}">
                        ${a.title}
                    </button>`).join(""))}};var je=class{constructor(e){this.uiManager=e,this.refreshInterval=null}showDashboard(e){if(!e.solStation.unlocked)return;let i=this._buildDashboardHtml(e),a=document.getElementById("event-modal");a&&a.classList.contains("modal-hiding")&&(a.classList.add("hidden"),a.classList.remove("modal-hiding"),a.classList.remove("modal-visible"));let s=document.getElementById("sol-dashboard-root"),o=a&&!a.classList.contains("hidden");if(s&&o){s.outerHTML=i;let r=document.querySelector("#event-button-container button");r&&(r.innerHTML="Dismiss",r.onclick=()=>{this._stopRefreshLoop(),this.uiManager.hideModal("event-modal")})}else this.uiManager.queueModal("event-modal","",i,null,{width:"800px",dismissOutside:!0,specialClass:"sol-station-modal",buttonText:"Dismiss",buttonClass:"btn-dismiss-sm"});this._startRefreshLoop()}update(e){let t=document.getElementById("sol-dashboard-root");if(!t)return;let i=e.solStation,a=this._calculateProjections(e),s=i.stockpile,o=t.querySelector(".sol-health-bar-label span"),r=t.querySelector(".sol-health-fill"),n=t.querySelector('[data-id="output-entropy"]');o&&r&&(o.className=this._getHealthColorClass(i.health),o.textContent=`${i.health}%`,r.style.width=`${i.health}%`,r.style.backgroundColor=`var(${this._getHealthColorVar(i.health)})`),n&&(n.textContent=`${a.entropy.toFixed(2)}x`);let l=t.querySelector(".sol-am-fill"),c=t.querySelector(".sol-am-text"),d=t.querySelector('button[data-action="sol-claim-output"][data-type="antimatter"]'),h=150,p=Math.min(h,s.antimatter),y=p/h*100;l&&(l.style.width=`${y}%`),c&&(c.textContent=`${p.toFixed(2)} / ${h}`),d&&(d.disabled=p<1,d.style.opacity=p>=1?"1":"0.5");let g=t.querySelector('[data-id="stock-credits"]'),S=t.querySelector('button[data-action="sol-claim-output"][data-type="credits"]');g&&(g.textContent=I(Math.floor(s.credits))),S&&(S.disabled=s.credits<=0,S.style.opacity=s.credits>0?"1":"0.5"),t.querySelectorAll(".mode-btn").forEach(_=>{let N=_.dataset.mode===i.mode;_.classList.remove("active","inactive"),N?(_.classList.add("active"),_.disabled=!0):(_.classList.add("inactive"),_.disabled=!1)});let b=t.querySelector(".mode-description");b&&(b.innerHTML=this._getModeDescription(i.mode));let T=e.player.inventories[e.player.activeShipId];Object.entries(i.caches).filter(([_])=>_!==E.FOLDED_DRIVES).forEach(([_,L])=>{let N=t.querySelector(`.sol-cache-row[data-comm-id="${_}"]`);if(N){let O=N.querySelector(".sol-progress-fill"),F=N.querySelector(".sol-progress-text"),B=N.querySelector(".btn-deposit-all"),D=L.current/L.max*100,W=(T[_]?.quantity||0)>0&&L.current<L.max;O&&(O.style.width=`${D}%`),F&&(F.textContent=`${I(Math.floor(L.current),!1)} / ${I(L.max,!1)}`),B&&(B.disabled=!W,B.style.opacity=W?"1":"0.5")}})}_startRefreshLoop(){this.refreshInterval&&clearInterval(this.refreshInterval),this.refreshInterval=setInterval(()=>{let e=document.getElementById("sol-dashboard-root");if(!e||!document.body.contains(e)||e.closest(".hidden")){this._stopRefreshLoop();return}let t=this.uiManager.simulationService,i=t&&t.solStationService?t.solStationService.gameState:this.uiManager.lastKnownState;i&&this.update(i)},100)}_stopRefreshLoop(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}showOfficerRoster(e,t){let i=document.getElementById("sol-dashboard-root");if(!i)return;this._stopRefreshLoop();let a=t.solStation.roster||[],s=t.solStation.officers.map(d=>d.assignedOfficerId).filter(d=>d),o=a.filter(d=>!s.includes(d)),r="";o.length===0?r='<div class="text-center p-4 text-gray-400">No unassigned officers available.</div>':r=o.map(d=>{let h=ne[d];return h?`
                    <div class="roster-card" data-action="sol-assign-officer" data-slot-id="${e}" data-officer-id="${d}">
                        <div class="officer-info">
                            <div class="officer-name">${h.name}</div>
                            <div class="officer-role">${h.role}</div>
                        </div>
                        <div class="officer-buffs">
                            ${this._formatBuffs(h.buffs)}
                        </div>
                        <button type="button" class="btn btn-sm btn-action">ASSIGN</button>
                    </div>
                `:""}).join("");let n=t.solStation.officers.find(d=>d.slotId===parseInt(e)),l="";n&&n.assignedOfficerId&&(l=`
                <div class="roster-footer">
                    <button type="button" class="btn btn-red w-full" data-action="sol-assign-officer" data-slot-id="${e}" data-officer-id="null">
                        UNASSIGN CURRENT OFFICER
                    </button>
                </div>
            `),i.innerHTML=`
            <div class="sol-subview-header flex justify-center items-center mb-4">
                <div class="section-title mb-0">SELECT OFFICER (SLOT ${e})</div>
            </div>
            <div class="roster-list text-left">
                ${r}
            </div>
            ${l}
        `;let c=document.querySelector("#event-button-container button");c&&(c.innerHTML="&larr;",c.onclick=()=>this.showDashboard(t))}_buildDashboardHtml(e){let t=e.solStation,i=this._calculateProjections(e),a=t.stockpile,s=e.player.visualSeed,o=V.getCommodityImage("Antimatter",s),r=o?`background-image: url('${o}'); opacity: 1; filter: none;`:"",n="0 4px 6px rgba(0,0,0,0.9), 1px 1px 0 #000, -1px 1px 0 #000, 1px -1px 0 #000, -1px -1px 0 #000",l=150,c=Math.min(l,a.antimatter),d=c/l*100,h=c>=1,p=a.credits>0;return`
            <div id="sol-dashboard-root" class="sol-dashboard-container">
                
                <div class="sol-header-panel" style="display: flex; gap: 1rem; align-items: center; justify-content: space-between; margin-bottom: 0.75rem;">
                    <div class="sol-health-container" style="flex-grow: 1;">
                        <div class="sol-health-bar-label">STATION HEALTH: <span class="${this._getHealthColorClass(t.health)}">${t.health}%</span></div>
                        <div class="sol-health-track">
                            <div class="sol-health-fill" style="width: ${t.health}%; background-color: var(${this._getHealthColorVar(t.health)});"></div>
                        </div>
                    </div>
                    <div class="sol-entropy-readout" style="text-align: right;">
                        <div class="label" style="font-size: 0.7rem; color: #6b7280;">ENTROPY</div>
                        <div class="value text-red-400" data-id="output-entropy" style="font-size: 1.2rem; font-weight: bold;">${i.entropy.toFixed(2)}x</div>
                    </div>
                </div>

                <div class="sol-output-container">
                    <div class="section-title">STATION OUTPUT</div>
                    
                    <div class="sol-cache-row" style="display: flex; flex-direction: row; align-items: center; justify-content: space-between; height: auto; min-height: 70px; padding: 0.5rem; margin-bottom: 0.5rem;">
                        <div class="sol-cache-row-bg" style="${r}"></div>
                        
                        <div class="sol-cache-content-left" style="z-index: 2; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; margin-right: 0.5rem;">
                            <div class="sol-row-name" style="text-align: left; font-size: 1.1rem; margin-bottom: 4px; text-shadow: ${n}; white-space: nowrap; overflow: visible;">ANTIMATTER</div>
                            
                            <div class="sol-row-track-container" style="width: 100%;">
                                <div class="sol-progress-track" style="border: 1px solid #000; box-shadow: 0 0 4px rgba(0,0,0,0.5);">
                                    <div class="sol-am-fill" style="width: ${d}%; background-color: var(--tier-7-color, #a855f7); height: 100%;"></div>
                                    <div class="sol-am-text" style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; text-shadow: ${n}; font-weight: bold; font-family: 'Roboto Mono', monospace; font-size: 0.75rem;">${c.toFixed(2)} / ${l}</div>
                                </div>
                            </div>
                        </div>

                        <div class="sol-cache-action-right" style="z-index: 2; flex-shrink: 0;">
                            <button type="button" class="btn-deposit-all" 
                                    data-action="sol-claim-output"
                                    data-type="antimatter"
                                    style="height: 100%; border: 1px solid #000; box-shadow: 0 2px 5px rgba(0,0,0,0.5);"
                                    ${h?"":"disabled"}>
                                COLLECT
                            </button>
                        </div>
                    </div>

                    <div class="sol-credits-block">
                        <div class="credits-info">
                            <div class="label">CREDITS</div>
                            <div class="value" data-id="stock-credits">${I(Math.floor(a.credits))}</div>
                        </div>
                        <button type="button" class="btn-deposit-all" 
                                data-action="sol-claim-output"
                                data-type="credits"
                                style="background: linear-gradient(to bottom, #16a34a, #15803d); border-color: #16a34a;"
                                ${p?"":"disabled"}>
                            COLLECT
                        </button>
                    </div>
                </div>

                <div class="sol-mode-control" style="margin-top: 0.75rem;">
                    <div class="section-title">OPERATIONAL MODE</div>
                    <div class="mode-toggle-group">
                        ${this._renderModeButton("STABILITY",t.mode)}
                        ${this._renderModeButton("COMMERCE",t.mode)}
                        ${this._renderModeButton("PRODUCTION",t.mode)}
                    </div>
                    <div class="mode-description">
                        ${this._getModeDescription(t.mode)}
                    </div>
                </div>

                <div class="sol-cache-section" style="margin-top: 2rem;">
                    <div class="section-title">MAINTENANCE CACHES</div>
                    <div class="sol-cache-list">
                        ${this._renderCacheList(e)}
                    </div>
                </div>

                <div class="sol-officer-section">
                    <div class="section-title">DIRECTORATE ASSIGNMENTS</div>
                    <div class="officer-slot-container">
                        ${this._renderOfficerSlots(e)}
                    </div>
                </div>
            </div>
        `}_renderModeButton(e,t){let i=e===t,a=i?"active":"";return`
            <button type="button" class="mode-btn ${e.toLowerCase()} ${a}" 
                    data-action="sol-set-mode" 
                    data-mode="${e}"
                    ${i?"disabled":""}>
                ${e}
            </button>
        `}_getModeDescription(e){switch(e){case"STABILITY":return"<span style='color: #9ca3af;'>Low Entropy, Slow Generation</span>";case"COMMERCE":return"<span style='color: #fbbf24;'>High Entropy, High Income</span>";case"PRODUCTION":return"<span style='color: #a855f7;'>Max Entropy, Max Antimatter</span>";default:return""}}_renderCacheList(e){let t=e.solStation.caches,i=e.player.inventories[e.player.activeShipId],a=e.player.visualSeed;return Object.entries(t).filter(([s])=>s!==E.FOLDED_DRIVES).map(([s,o])=>{let r=f.COMMODITIES.find(g=>g.id===s);if(!r)return`<div class="sol-cache-row-error">Error: ${s}</div>`;let n=o.current/o.max*100,c=(i[s]?.quantity||0)>0&&o.current<o.max,d=`--tier-${r.tier||1}-color`,h=V.getCommodityImage(r.name,a),p=h?`background-image: url('${h}'); opacity: 1; filter: none;`:"",y="0 4px 6px rgba(0,0,0,0.9), 1px 1px 0 #000, -1px 1px 0 #000, 1px -1px 0 #000, -1px -1px 0 #000";return`
                    <div class="sol-cache-row" data-comm-id="${s}" style="display: flex; flex-direction: row; align-items: center; justify-content: space-between; height: auto; min-height: 70px; padding: 0.5rem;">
                        <div class="sol-cache-row-bg" style="${p}"></div>
                        
                        <div class="sol-cache-content-left" style="z-index: 2; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; margin-right: 0.5rem;">
                            <div class="sol-row-name" title="${r.name}" style="text-align: left; font-size: 1.1rem; margin-bottom: 4px; text-shadow: ${y}; white-space: nowrap; overflow: visible;">${r.name}</div>
                            
                            <div class="sol-row-track-container" style="width: 100%;">
                                <div class="sol-progress-track" style="border: 1px solid #000; box-shadow: 0 0 4px rgba(0,0,0,0.5);">
                                    <div class="sol-progress-fill" style="width: ${n}%; background-color: var(${d}, #fff);"></div>
                                    <div class="sol-threshold-marker" style="left: 20%;"></div>
                                    <div class="sol-progress-text" style="text-shadow: ${y}; font-weight: bold;">${I(Math.floor(o.current),!1)} / ${I(o.max,!1)}</div>
                                </div>
                            </div>
                        </div>

                        <div class="sol-cache-action-right" style="z-index: 2; flex-shrink: 0;">
                            <button type="button" class="btn-deposit-all" 
                                    data-action="sol-donate-all" 
                                    data-commodity-id="${s}"
                                    style="height: 100%; border: 1px solid #000; box-shadow: 0 2px 5px rgba(0,0,0,0.5);"
                                    ${c?"":"disabled"}>
                                DEPOSIT
                            </button>
                        </div>
                    </div>
                `}).join("")}_renderOfficerSlots(e){return e.solStation.officers.map(i=>{let a=i.assignedOfficerId,s=a?ne[a]:null;return s?`
                    <div class="officer-slot filled" data-action="sol-open-roster" data-slot-id="${i.slotId}">
                        <div class="slot-header">SLOT ${i.slotId}</div>
                        <div class="officer-name">${s.name}</div>
                        <div class="officer-role">${s.role}</div>
                        <div class="officer-buffs-mini">${this._formatBuffs(s.buffs,!0)}</div>
                    </div>
                `:`
                    <div class="officer-slot empty" data-action="sol-open-roster" data-slot-id="${i.slotId}">
                        <div class="slot-header">SLOT ${i.slotId}</div>
                        <div class="empty-label">+ ASSIGN</div>
                    </div>
                `}).join("")}_formatBuffs(e,t=!1){let i=[];return e.entropy!==0&&i.push(`<span class="buff-entropy">${e.entropy>0?"+":""}${Math.round(e.entropy*100)}% Decay</span>`),e.creditMult!==0&&i.push(`<span class="buff-credits">+${Math.round(e.creditMult*100)}% Credits</span>`),e.amMult!==0&&i.push(`<span class="buff-am">+${Math.round(e.amMult*100)}% AM</span>`),i.join(t?"<br>":" \u2022 ")}_calculateProjections(e){return this.uiManager&&this.uiManager.simulationService&&this.uiManager.simulationService.solStationService?this.uiManager.simulationService.solStationService.getProjectedOutput():{credits:0,antimatter:0,entropy:1}}_getHealthColorClass(e){return e>=80?"text-green-400":e>=50?"text-yellow-400":"text-red-500"}_getHealthColorVar(e){return e>=80?"--ot-green-base":e>=50?"--ot-yellow-base":"--ot-red-base"}};var Ke=class{constructor(e){this.logger=e,this.isMobile=window.innerWidth<=768,this.lastActiveScreenEl=null,this.lastKnownState=null,this.missionService=null,this.simulationService=null,this.newsTickerService=null,this.debugService=null,this.intelService=null,this.eventManager=null,this.intelMarketRenderer=null,this.effectsManager=new Fe,this.travelAnimationService=new Ue(this.isMobile),this.modalEngine=new Ge(this),this.tutorialManager=new Be(this),this.marketControl=new Ye(this),this.missionControl=new Ve(this),this.hangarControl=new qe(this),this.eventControl=new We(this),this.solStationControl=new je(this),this.activeGraphAnchor=null,this.activeGenericTooltipAnchor=null,this.activeGenericTooltipPosition="right",this.navStructure={[$.SHIP]:{label:"Ship",screens:{[x.MAP]:"Map",[x.NAVIGATION]:"Navigation",[x.CARGO]:"Cargo"}},[$.STARPORT]:{label:"Starport",screens:{[x.MARKET]:"Market",[x.SERVICES]:"Services",[x.HANGAR]:"Shipyard"}},[$.DATA]:{label:"Data",screens:{[x.MISSIONS]:"Missions",[x.FINANCE]:"Finance",[x.INTEL]:"Intel"}}},this._cacheDOM(),this.getItemPrice=this.marketControl.getItemPrice.bind(this.marketControl),window.addEventListener("resize",this._setAppHeight)}setMissionService(e){this.missionService=e}setSimulationService(e){this.simulationService=e}setNewsTickerService(e){this.newsTickerService=e}setDebugService(e){this.debugService=e}setEventManager(e){this.eventManager=e}setIntelService(e){this.intelService=e,this.intelMarketRenderer=new He(e)}_setAppHeight(){document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)}_cacheDOM(){this.cache={gameContainer:document.getElementById("game-container"),navBar:document.getElementById("nav-bar"),newsTickerBar:document.getElementById("news-ticker-bar"),topBarContainer:document.getElementById("top-bar-container"),subNavBar:document.getElementById("sub-nav-bar"),stickyBar:document.getElementById("sticky-bar"),mapScreen:document.getElementById(`${x.MAP}-screen`),navigationScreen:document.getElementById(`${x.NAVIGATION}-screen`),servicesScreen:document.getElementById(`${x.SERVICES}-screen`),marketScreen:document.getElementById(`${x.MARKET}-screen`),cargoScreen:document.getElementById(`${x.CARGO}-screen`),hangarScreen:document.getElementById(`${x.HANGAR}-screen`),missionsScreen:document.getElementById(`${x.MISSIONS}-screen`),financeScreen:document.getElementById(`${x.FINANCE}-screen`),intelScreen:document.getElementById(`${x.INTEL}-screen`),graphTooltip:document.getElementById("graph-tooltip"),genericTooltip:document.getElementById("generic-tooltip"),processingModal:document.getElementById("processing-modal"),shipDetailModal:document.getElementById("ship-detail-modal"),launchModal:document.getElementById("launch-modal"),launchModalContent:document.getElementById("launch-modal-content"),cargoDetailModal:document.getElementById("cargo-detail-modal"),cargoDetailContent:document.getElementById("cargo-detail-content"),mapDetailModal:document.getElementById("map-detail-modal"),loreModal:document.getElementById("lore-modal"),loreModalContent:document.getElementById("lore-modal-content"),eulaModal:document.getElementById("eula-modal"),eulaModalContent:document.getElementById("eula-modal-content"),tutorialAnchorOverlay:document.getElementById("tutorial-anchor-overlay"),tutorialToastContainer:document.getElementById("tutorial-toast-container"),tutorialToastText:document.getElementById("tutorial-toast-text"),tutorialToastSkipBtn:document.getElementById("tutorial-toast-skip-btn"),tutorialToastNextBtn:document.getElementById("tutorial-toast-next-btn"),skipTutorialModal:document.getElementById("skip-tutorial-modal"),skipTutorialConfirmBtn:document.getElementById("skip-tutorial-confirm-btn"),skipTutorialCancelBtn:document.getElementById("skip-tutorial-cancel-btn"),tutorialHighlightOverlay:document.getElementById("tutorial-highlight-overlay"),missionStickyBar:document.getElementById("mission-sticky-bar"),stickyObjectiveText:document.getElementById("sticky-objective-text"),stickyObjectiveProgress:document.getElementById("sticky-objective-progress")}}render(e){if(!e||!e.player)return;this.missionService&&this.missionService.checkTriggers(!0);let t=this.lastKnownState;this.lastKnownState=e,!(e.introSequenceActive&&!e.tutorials.activeBatchId)&&(this._applyTheme(e),this._renderNewsTicker(),this.renderNavigation(e),this.renderActiveScreen(e,t),this.missionControl.renderStickyBar(e))}_applyTheme(e){let t=f.MARKETS.find(i=>i.id===e.currentLocationId);t?(this.cache.topBarContainer.setAttribute("data-location-theme",t.id),this.cache.gameContainer.className=`game-container ${t.bg}`,t.navTheme&&t.navTheme.borderColor?(document.documentElement.style.setProperty("--theme-border-color",t.navTheme.borderColor),document.documentElement.style.setProperty("--theme-gradient",t.navTheme.gradient),document.documentElement.style.setProperty("--theme-text-color",t.navTheme.textColor),this.cache.newsTickerBar&&(this.cache.newsTickerBar.style.backgroundImage=t.navTheme.gradient,this.cache.newsTickerBar.style.borderTopColor=t.navTheme.borderColor,this.cache.newsTickerBar.style.borderBottomColor=t.navTheme.borderColor,this.cache.newsTickerBar.style.backgroundColor="transparent")):this._resetTheme()):this._resetTheme()}_resetTheme(){document.documentElement.style.removeProperty("--theme-border-color"),document.documentElement.style.removeProperty("--theme-gradient"),document.documentElement.style.removeProperty("--theme-text-color"),this.cache.newsTickerBar&&(this.cache.newsTickerBar.style.backgroundImage="",this.cache.newsTickerBar.style.borderTopColor="",this.cache.newsTickerBar.style.borderBottomColor="",this.cache.newsTickerBar.style.backgroundColor="")}_renderNewsTicker(){if(!this.newsTickerService||!this.cache.newsTickerBar||!this.newsTickerService.isDirty)return;let e=this.newsTickerService.getTickerContentHtml();if(!e){this.cache.newsTickerBar.innerHTML="",this.newsTickerService.isDirty=!1;return}let t=`<div class="ticker-block">${e}</div>`;this.cache.newsTickerBar.innerHTML=`<div class="news-ticker-content">${t}</div>`;let i=this.cache.newsTickerBar.querySelector(".news-ticker-content");if(i){let s=i.getBoundingClientRect().width;i.innerHTML=t+t;let r=Math.max(20,s/50);i.style.animationDuration=`${r}s`}this.newsTickerService.isDirty=!1}renderNavigation(e){let{player:t,currentLocationId:i,activeNav:a,activeScreen:s,lastActiveScreen:o,introSequenceActive:r,tutorials:n,subNavCollapsed:l}=e,{navLock:c}=n,d=f.MARKETS.find(D=>D.id===i),h=t.activeShipId?f.SHIPS[t.activeShipId]:null,p=t.activeShipId?t.shipStates[t.activeShipId]:null,y=t.activeShipId?t.inventories[t.activeShipId]:null,g=d?.navTheme||{gradient:"linear-gradient(135deg, #4a5568, #2d3748)",textColor:"#f0f0f0"},S=t.credits>=Number.MAX_SAFE_INTEGER,b=S?"\u232C MAXIMUM CREDITS \u232C":I(t.credits),T=S?"text-glow-gold":"credits-text-pulsing",A=S?"context-bar max-credits-active":"context-bar",_=Bt(e.day),L=`
            <div class="${A}" style="background: ${g.gradient}; color: ${g.textColor};">
                <span class="location-name-text">${d?.name||"In Transit"}</span>
                <span class="date-text">${_}</span>
                <span class="credit-text ${T}">${b}</span>
            </div>`,N=Object.keys(this.navStructure).map(D=>{let U=D===a,W=o[D]||Object.keys(this.navStructure[D].screens)[0],j=c&&c.navId!==D,z=r||j,Z=U?`background: ${g.gradient}; color: ${g.textColor};`:"";return`<div class="tab ${U?"active":""} ${z?"disabled":""}" 
                          style="${Z}" data-action="${w.SET_SCREEN}" data-nav-id="${D}" data-screen-id="${W}">${this.navStructure[D].label}</div>`}).join(""),O="";if(h&&p&&y){let D=X(y),U=p.health/h.maxHealth*100,W=p.fuel/h.maxFuel*100,j=D/h.cargoCapacity*100;O=`
                 <div class="status-pod">
                    <div class="status-bar-group hull-group" data-action="toggle-tooltip">
                        <span class="status-bar-label">H</span>
                        <div class="status-bar"><div class="fill hull-fill" style="width: ${U}%;"></div></div>
                         <div class="status-tooltip">${Math.floor(p.health)}/${h.maxHealth} Hull</div>
                    </div>
                    <div class="status-bar-group fuel-group" data-action="toggle-tooltip">
                        <span class="status-bar-label">F</span>
                        <div class="status-bar"><div class="fill fuel-fill" style="width: ${W}%;"></div></div>
                         <div class="status-tooltip">${Math.floor(p.fuel)}/${h.maxFuel} Fuel</div>
                    </div>
                    <div class="status-bar-group cargo-group" data-action="toggle-tooltip">
                        <span class="status-bar-label">C</span>
                        <div class="status-bar"><div class="fill cargo-fill" style="width: ${j}%;"></div></div>
                        <div class="status-tooltip">${D}/${h.cargoCapacity} Cargo</div>
                    </div>
                </div>`}let F=`<div class="nav-wrapper">${N}${O}</div>`,B=Object.keys(this.navStructure).map(D=>{let U=this.navStructure[D].screens,W=D===a,j=Object.keys(U).map(z=>{let Z=c&&c.screenId!==z,Y=z===s,J=r||Z,q=Y?"sub-nav-active":"",ee=w.SET_SCREEN,re="";return Y&&(re=`style="background: ${g.gradient}; color: ${g.textColor}; opacity: 1; font-weight: 700;"`),`<a href="#" class="${J?"disabled":""} ${q}" ${re} data-action="${ee}" data-nav-id="${D}" data-screen-id="${z}" draggable="false">${U[z]}</a>`}).join("");return`<div class="nav-sub ${!W||l?"hidden":""}" id="${D}-sub">${j}</div>`}).join("");this.cache.navBar.innerHTML=L+F,this.cache.subNavBar.innerHTML=B}renderActiveScreen(e,t){let i=this.cache[`${e.activeScreen}Screen`];switch(this.lastActiveScreenEl&&this.lastActiveScreenEl!==i&&this.lastActiveScreenEl.classList.remove("active-screen"),i&&(i.classList.add("active-screen"),this.lastActiveScreenEl=i),e.activeScreen){case x.MAP:this.cache.mapScreen.innerHTML=ei(),requestAnimationFrame(()=>ti(this));break;case x.NAVIGATION:this.cache.navigationScreen.innerHTML=ii(e);break;case x.SERVICES:this.cache.servicesScreen.innerHTML=si(e,this.simulationService),this.eventManager&&this.eventManager.holdEventHandler.bindHoldEvents();break;case x.MARKET:this.marketControl.updateMarketScreen(e);break;case x.CARGO:this.cache.cargoScreen.innerHTML=oi(e);break;case x.HANGAR:(!t||t.activeScreen!==x.HANGAR||t.uiState.hangarShipyardToggleState!==e.uiState.hangarShipyardToggleState||t.player.activeShipId!==e.player.activeShipId||t.player.ownedShipIds.length!==e.player.ownedShipIds.length||t.tutorials.activeStepId!==e.tutorials.activeStepId)&&(this.cache.hangarScreen.innerHTML=Jt(e,this.simulationService)),this.hangarControl.updateHangarScreen(e);break;case x.MISSIONS:this.cache.missionsScreen.innerHTML=li(e,this.missionService);break;case x.FINANCE:this.cache.financeScreen.innerHTML=ci(e);break;case x.INTEL:if((!t||t.activeScreen!==x.INTEL)&&(this.cache.intelScreen.innerHTML=di()),this.eventControl._renderCodexButtons(this.cache.intelScreen),this.intelMarketRenderer){let s=this.cache.intelScreen.querySelector("#intel-market-content");s&&this.intelMarketRenderer.render(s,e)}this.missionControl.updateIntelTab(e.uiState.activeIntelTab);break}}updateServicesScreen(e){if(e.activeScreen!==x.SERVICES)return;let{player:t}=e,i=f.SHIPS[t.activeShipId],a=t.shipStates[t.activeShipId],s=this.cache.servicesScreen.querySelector("#fuel-bar"),o=this.cache.servicesScreen.querySelector("#refuel-btn");if(s&&o){let l=a.fuel/i.maxFuel*100;s.style.width=`${l}%`,o.disabled=a.fuel>=i.maxFuel}let r=this.cache.servicesScreen.querySelector("#repair-bar"),n=this.cache.servicesScreen.querySelector("#repair-btn");if(r&&n){let l=a.health/i.maxHealth*100;r.style.width=`${l}%`,n.disabled=a.health>=i.maxHealth}}queueModal(...e){this.modalEngine.queueModal(...e)}hideModal(...e){this.modalEngine.hideModal(...e)}processModalQueue(...e){this.modalEngine.processModalQueue(...e)}getModalIdFromEvent(...e){return this.modalEngine.getModalIdFromEvent(...e)}isClickInside(...e){return this.modalEngine.isClickInside(...e)}showProcessingAnimation(...e){this.modalEngine.showProcessingAnimation(...e)}showTutorialToast(...e){this.tutorialManager.showTutorialToast(...e)}hideTutorialToast(...e){this.tutorialManager.hideTutorialToast(...e)}updateTutorialPopper(...e){this.tutorialManager.updateTutorialPopper(...e)}applyTutorialHighlight(...e){this.tutorialManager.applyTutorialHighlight(...e)}showSkipTutorialModal(...e){this.tutorialManager.showSkipTutorialModal(...e)}showTutorialLogModal(...e){this.tutorialManager.showTutorialLogModal(...e)}updateMarketScreen(...e){this.marketControl.updateMarketScreen(...e)}updateMarketCardPrice(...e){this.marketControl.updateMarketCardPrice(...e)}updateMarketCardDisplay(...e){this.marketControl.updateMarketCardDisplay(...e)}resetMarketTransactionState(...e){this.marketControl.resetMarketTransactionState(...e)}_calculateSaleDetails(...e){return this.marketControl._calculateSaleDetails(...e)}renderStickyBar(...e){this.missionControl.renderStickyBar(...e)}flashObjectiveProgress(...e){this.missionControl.flashObjectiveProgress(...e)}showMissionModal(...e){this.missionControl.showMissionModal(...e)}handleSetIntelTab(...e){this.missionControl.handleSetIntelTab(...e)}updateIntelTab(...e){this.missionControl.updateIntelTab(...e)}handleShowIntelOffer(...e){this.missionControl.handleShowIntelOffer(...e)}handleBuyIntel(...e){this.missionControl.handleBuyIntel(...e)}handleShowIntelDetails(...e){this.missionControl.handleShowIntelDetails(...e)}updateHangarScreen(...e){this.hangarControl.updateHangarScreen(...e)}showShipDetailModal(...e){this.hangarControl.showShipDetailModal(...e)}showUpgradeInstallationModal(...e){this.hangarControl.showUpgradeInstallationModal(...e)}runShipTransactionAnimation(...e){this.hangarControl.runShipTransactionAnimation(...e)}showRandomEventModal(...e){this.eventControl.showRandomEventModal(...e)}showAgeEventModal(...e){this.eventControl.showAgeEventModal(...e)}showLoreModal(...e){this.eventControl.showLoreModal(...e)}showEulaModal(...e){this.eventControl.showEulaModal(...e)}showLaunchModal(...e){this.eventControl.showLaunchModal(...e)}showMapDetailModal(...e){this.eventControl.showMapDetailModal(...e)}hideMapDetailModal(...e){this.eventControl.hideMapDetailModal(...e)}showCargoDetailModal(...e){this.eventControl.showCargoDetailModal(...e)}createFloatingText(...e){this.eventControl.createFloatingText(...e)}showEventResultModal(...e){this.eventControl.showEventResultModal(...e)}showSolStationDashboard(...e){this.solStationControl.showDashboard(...e)}showOfficerRoster(...e){this.solStationControl.showOfficerRoster(...e)}triggerEffect(e,t){this.effectsManager.trigger(e,t)}showTravelAnimation(e,t,i,a,s){this.travelAnimationService.play(e,t,i,a,s)}showGameContainer(){this.cache.gameContainer.classList.remove("hidden"),this._setAppHeight(),requestAnimationFrame(()=>this._setAppHeight())}getTooltipContent(e){let t=e.target.closest("[data-tooltip]");return t?t.dataset.tooltip:null}showGraph(e,t){this.activeGraphAnchor=e;let i=this.cache.graphTooltip,a=e.dataset.action;if(a===w.SHOW_PRICE_GRAPH){let s=e.dataset.goodId,o=t.player.inventories[t.player.activeShipId][s];i.innerHTML=this.marketControl.renderPriceGraph(s,t,o)}else a===w.SHOW_FINANCE_GRAPH&&(i.innerHTML=this.marketControl.renderFinanceGraph(t));i.style.display="block",this.updateGraphTooltipPosition()}hideGraph(){this.activeGraphAnchor&&(this.cache.graphTooltip.style.display="none",this.activeGraphAnchor=null)}updateGraphTooltipPosition(){if(!this.activeGraphAnchor)return;let e=this.cache.graphTooltip;if(e.style.display==="none")return;let t=this.activeGraphAnchor.closest(".item-card-container").getBoundingClientRect(),i=e.offsetHeight,a=t.top-i-10,s=t.left;a<10&&(a=t.bottom+10),e.style.left=`${s}px`,e.style.top=`${a}px`}showGenericTooltip(e,t,i="right"){this.activeGenericTooltipAnchor=e,this.activeGenericTooltipPosition=i;let a=this.cache.genericTooltip;a.innerHTML=t,a.style.display="block",this.updateGenericTooltipPosition()}hideGenericTooltip(){this.activeGenericTooltipAnchor&&(this.cache.genericTooltip.style.display="none",this.activeGenericTooltipAnchor=null)}updateGenericTooltipPosition(){if(!this.activeGenericTooltipAnchor)return;let e=this.cache.genericTooltip,t=this.activeGenericTooltipAnchor.getBoundingClientRect(),i=e.offsetWidth,a=e.offsetHeight,s,o;this.activeGenericTooltipPosition==="top"?(s=t.left+t.width/2-i/2,o=t.top-a-10,o<10&&(o=t.bottom+10)):(s=t.right+10,o=t.top+t.height/2-a/2,o<10&&(o=t.bottom+10)),s<10&&(s=10),s+i>window.innerWidth-10&&(s=window.innerWidth-i-10),e.style.left=`${s}px`,e.style.top=`${o}px`}showShipTransactionConfirmation(e,t,i){let a=f.SHIPS[e];if(!a)return;let s=`var(--class-${a.class.toLowerCase()}-color)`,o="";a.class==="Z"?o="glow-text-z":a.class==="O"?o="glow-text-o":a.class==="S"&&(o="glow-text-s");let r=`<span class="${o}" style="color: ${s}; font-weight: bold;">${a.name}</span>`,n,l,c,d;if(t==="buy")n="Confirm Purchase",c=a.price,d=I(c,!0),l=`Are you sure you want to purchase the ${r}?`,l+=`<br><br>Cost: <span class="credits-text-pulsing">${d}</span>`;else{n="Confirm Sale";let h=this.lastKnownState.player.shipStates[e],p=0;h&&h.upgrades&&h.upgrades.forEach(y=>{let g=M.getDefinition(y);g&&(p+=g.value)}),c=Math.floor((a.price+p)*G.SHIP_SELL_MODIFIER),d=I(c,!0),l=`Are you sure you want to sell the ${r}?`,l+=`<br><br>Income: <span class="credits-text-pulsing">+${d}</span>`}this.queueModal("event-modal",n,l,null,{dismissOutside:!0,customSetup:(h,p)=>{let y=h.querySelector("#event-button-container");y.innerHTML=`
                    <button id="confirm-transaction-btn" class="btn btn-pulse-green">Confirm</button>
                    <button id="cancel-transaction-btn" class="btn">Cancel</button>
                 `;let g=h.querySelector("#confirm-transaction-btn"),S=h.querySelector("#cancel-transaction-btn");g.onclick=()=>{p(),setTimeout(i,50)},S.onclick=p}})}};var Xe=class{constructor(e,t,i,a){this.gameState=e,this.simulationService=t,this.uiManager=i,this.tutorialService=a}async handle(e,t){let i=this.gameState.getState();if(t.hasAttribute("disabled"))return;let{action:a,...s}=t.dataset,o=null;switch(a){case w.BUY_SHIP:{let{shipId:r}=s;if(!r)return;e.stopPropagation();let n=e.target;this.uiManager.showShipTransactionConfirmation(r,"buy",async()=>{await this.uiManager.runShipTransactionAnimation(r),await this.simulationService.buyShip(r,{target:n}),this.tutorialService.checkState({type:"ACTION",action:w.BUY_SHIP})});break}case w.SELL_SHIP:{let{shipId:r}=s;if(!r)return;e.stopPropagation();let n=e.target;this.uiManager.showShipTransactionConfirmation(r,"sell",async()=>{await this.uiManager.runShipTransactionAnimation(r),await this.simulationService.sellShip(r,{target:n})});break}case w.SELECT_SHIP:{let{shipId:r}=s;if(!r)return;e.stopPropagation(),await this.simulationService.boardShip(r,e);break}case"set-services-tab":{let r=s.target;r&&(r==="supply"||r==="tuning")&&this.gameState.setState({uiState:{...i.uiState,servicesTab:r}});break}case"install_upgrade":{let{upgradeId:r}=s;if(!r)return;let n=M.getDefinition(r),l=this.gameState.player,c=l.activeShipId,d=f.SHIPS[c],h=l.shipStates[c],p=n.value,y=M.getInstallationFee(d?d.price:0),g=p+y;if(l.credits<g){this.uiManager.queueModal("event-modal","Insufficient Funds","You cannot afford this upgrade and installation fee.");return}this.uiManager.showUpgradeInstallationModal(r,p,y,h,S=>{g>0&&(this.gameState.player.credits-=g,this.uiManager.createFloatingText(`-${I(g,!1)}`,e.clientX,e.clientY,"#f87171")),S!==-1&&h.upgrades.splice(S,1),this.simulationService.playerActionService.executeInstallUpgrade(c,r),this.gameState.uiState.hangarShipyardToggleState="hangar";let b=this.gameState.player.ownedShipIds.indexOf(c);this.gameState.uiState.hangarActiveIndex=b!==-1?b:0,this.simulationService.setScreen($.STARPORT,x.HANGAR)});break}case"show_ship_lore":{let r=i.uiState.hangarShipyardToggleState==="hangar",n=r?i.uiState.hangarActiveIndex||0:i.uiState.shipyardActiveIndex||0,l;if(r){let c=i.player.ownedShipIds;l=c[n]||c[0]}else{let c=this.simulationService._getShipyardInventory();if(c&&c.length>0){let d=Math.min(n,c.length-1),h=c[d];l=h?h[0]:null}}if(l&&f.SHIPS[l]){let c=f.SHIPS[l],d=`
                        <div class="ship-lore-modal-wrapper">
                            <div class="ship-lore-text">
                                ${c.lore||c.description}
                            </div>
                        </div>
                    `;this.uiManager.queueModal("event-modal",c.name,d,null,{dismissInside:!0,dismissOutside:!0,footer:null,contentClass:"text-left"})}break}case w.TOGGLE_HANGAR_MODE:this.uiManager.hideGenericTooltip(),s.mode&&this.gameState.uiState.hangarShipyardToggleState!==s.mode&&(this.gameState.uiState.hangarShipyardToggleState=s.mode,this.gameState.setState({}));break;case w.SET_HANGAR_PAGE:{let r=this.gameState.uiState.hangarShipyardToggleState==="hangar",n=r?this.gameState.uiState.hangarActiveIndex:this.gameState.uiState.shipyardActiveIndex,c=(r?i.player.ownedShipIds:this.simulationService._getShipyardInventory()).length,d,h=5;if(s.jumpDirection?s.jumpDirection==="next"?d=Math.min(c-1,n+h):d=Math.max(0,n-h):d=parseInt(s.index,10),isNaN(d))return;let p=document.getElementById("hangar-carousel");if(p){let y=Math.abs(d-n),g=Math.min(.8,.2+y*.1);p.style.transitionDuration=`${g}s`,this.simulationService.setHangarCarouselIndex(d,r?"hangar":"shipyard"),setTimeout(()=>{p&&(p.style.transitionDuration="")},g*1e3)}else this.simulationService.setHangarCarouselIndex(d,r?"hangar":"shipyard");break}case w.SET_SCREEN:{this.uiManager.hideGenericTooltip();let r=e.target.tagName==="A"&&t.contains(e.target);(s.navId==="missions"||s.navId===$.MISSIONS)&&(t.id==="mission-sticky-bar"||t.closest("#mission-sticky-bar")||t.closest(".sticky-content"))&&(i.uiState.activeMissionTab="log",this.gameState.setState({})),s.navId===i.activeNav&&!r?(this.gameState.subNavCollapsed=!this.gameState.subNavCollapsed,this.uiManager.render(this.gameState.getState())):(this.gameState.subNavCollapsed=!1,this.simulationService.setScreen(s.navId,s.screenId)),o={type:"ACTION",action:w.SET_SCREEN,navId:s.navId,screenId:s.screenId};break}case w.TRAVEL:{this.uiManager.hideModal("launch-modal");let r=s.useFoldedDrive==="true";this.simulationService.travelTo(s.locationId,r),o={type:"ACTION",action:w.TRAVEL};break}case"navigate-to-poi":{let{locationId:r}=s;if(!r)return;this.uiManager.hideMapDetailModal(),this.simulationService.setScreen($.SHIP,x.NAVIGATION),setTimeout(()=>{this.uiManager.showLaunchModal(r)},100);break}case"switch-mission-tab":{let r=s.target;(r==="terminal"||r==="log")&&this.gameState.setState({uiState:{...i.uiState,activeMissionTab:r}});break}case"track-mission":{e.stopPropagation();let r=s.missionId;if(!r)return;let n=i.missions;this.gameState.setState({missions:{...n,trackedMissionId:r}});break}case"set-intel-tab":this.uiManager.handleSetIntelTab(t);break;case"show_intel_offer":this.uiManager.handleShowIntelOffer(t);break;case"buy_intel":this.uiManager.handleBuyIntel(t,e);break;case"show_intel_details":this.uiManager.handleShowIntelDetails(t);break;case"show-mission-modal":this.uiManager.showMissionModal(s.missionId),o={type:"ACTION",action:"show-mission-modal"};break;case"show_cargo_detail":this.uiManager.showCargoDetailModal(i,s.goodId);break;case"show-launch-modal":this.uiManager.showLaunchModal(s.locationId);break;case"show-map-modal":this.uiManager.showMapDetailModal(s.locationId);break;case"close-map-modal":this.uiManager.hideMapDetailModal();break;case"show_eula_modal":e.preventDefault(),this.uiManager.showEulaModal();break;case"accept-mission":this.simulationService.missionService.acceptMission(s.missionId),this.uiManager.hideModal("mission-modal"),this.uiManager.missionControl&&this.gameState.setState({uiState:{...this.gameState.getState().uiState,activeMissionTab:"log"}}),o={type:"ACTION",action:"accept-mission",missionId:s.missionId};break;case"abandon-mission":this.simulationService.missionService.abandonMission(s.missionId),this.uiManager.hideModal("mission-modal");break;case"complete-mission":this.simulationService.missionService.completeMission(s.missionId),this.uiManager.hideModal("mission-modal"),o={type:"ACTION",action:"complete-mission"};break;case w.PAY_DEBT:this.simulationService.payOffDebt(e);break;case w.TAKE_LOAN:this.simulationService.takeLoan(JSON.parse(s.loanDetails),e);break;case w.PURCHASE_INTEL:this.logger.warn("ActionClickHandler","Obsolete ACTION_IDS.PURCHASE_INTEL called.");break;case w.ACQUIRE_LICENSE:this._handleAcquireLicense(s.licenseId,e);break;case w.TOGGLE_MARKET_CARD_VIEW:s.goodId&&(this.gameState.uiState.marketCardMinimized[s.goodId]=!this.gameState.uiState.marketCardMinimized[s.goodId],this.gameState.setState({}));break;case"open-sol-dashboard":this.uiManager.showSolStationDashboard(i);break;case"sol-set-mode":{e.preventDefault();let r=s.mode;r&&(e.stopPropagation(),this.simulationService.solStationService.setMode(r),this.uiManager.solStationControl.update(this.gameState.getState()));break}case"sol-donate-all":{e.preventDefault();let r=s.commodityId,l=this.gameState.solStation.caches[r],c=this.gameState.player.inventories[this.gameState.player.activeShipId];if(!l||!c)return;let d=c[r]?.quantity||0,h=l.max-l.current,p=Math.min(d,h);if(p>0){let y=this.simulationService.solStationService.donateToCache(r,p);y.success?(this.uiManager.createFloatingText(`-${p}`,e.clientX,e.clientY,"#ef4444"),this.uiManager.solStationControl.update(this.gameState.getState())):this.uiManager.createFloatingText(y.message,e.clientX,e.clientY,"#ef4444")}else this.uiManager.createFloatingText("No cargo or cache full",e.clientX,e.clientY,"#ef4444");break}case"sol-claim-output":{e.preventDefault();let r=s.type,n=this.gameState.solStation.stockpile,l="",c="#fff";if(r==="credits"){let h=Math.floor(n.credits);h>0&&(l=`+${h}`,c="#34d399")}else if(r==="antimatter"){let h=Math.floor(n.antimatter);h>=1&&(l=`+${h} Antimatter`,c="#a855f7")}let d=this.simulationService.solStationService.claimStockpile(r);d.success?(this.uiManager.createFloatingText(l||d.message,e.clientX,e.clientY,c),this.uiManager.solStationControl.update(this.gameState.getState())):this.uiManager.createFloatingText(d.message,e.clientX,e.clientY,"#9ca3af");break}case"sol-open-roster":{let r=s.slotId;this.uiManager.showOfficerRoster(r,i);break}case"sol-assign-officer":{e.preventDefault();let r=s.slotId,n=s.officerId==="null"?null:s.officerId;this.simulationService.solStationService.assignOfficer(r,n)&&this.uiManager.showSolStationDashboard(this.gameState.getState());break}}o&&this.tutorialService.checkState(o)}_handleAcquireLicense(e,t){let i=f.LICENSES[e];if(i)if(i.type==="purchase"){let a=`${i.description}<br><br>Cost: <span class="text-glow-red">${I(-i.cost,!0)}</span>`;this.uiManager.queueModal("event-modal",`Purchase ${i.name}?`,a,null,{dismissOutside:!0,customSetup:(s,o)=>{let r=s.querySelector("#event-button-container");r.innerHTML=`
                        <button id="confirm-license-purchase" class="btn btn-pulse-green">Confirm</button>
                        <button id="cancel-license-purchase" class="btn">Cancel</button>
                    `,s.querySelector("#confirm-license-purchase").onclick=()=>{let n=this.simulationService.purchaseLicense(e);n.success?t&&this.uiManager.createFloatingText(`-${I(i.cost,!1)}`,t.clientX,t.clientY,"#f87171"):n.error==="INSUFFICIENT_FUNDS"&&this.uiManager.queueModal("event-modal","Purchase Failed",`You cannot afford the ${I(i.cost)} fee for this license.`),o()},s.querySelector("#cancel-license-purchase").onclick=o}})}else i.type==="mission"&&this.uiManager.queueModal("event-modal",i.name,i.guidanceText)}};var ze=class{constructor(e,t,i){this.gameState=e,this.simulationService=t,this.uiManager=i}handleInput(e){let t=e.target.closest('.transaction-controls input[type="number"]');if(t){let i=t.closest(".transaction-controls"),{goodId:a,mode:s}=i.dataset,o=parseInt(t.value,10)||0;this.uiManager.updateMarketCardDisplay(a,o,s),this._updateMaxButtonState(i,o,s,a)}}handleClick(e,t){let{action:i}=t.dataset;switch(i){case"toggle-trade-mode":case"confirm-trade":case"set-max-trade":case w.INCREMENT:case w.DECREMENT:this._performMarketAction(t,i,e);break}}_performMarketAction(e,t,i){let a=e.closest(".transaction-controls");if(!a)return;let{goodId:s,mode:o}=a.dataset,r=a.querySelector("input"),n=this.gameState.getState();switch(t){case"toggle-trade-mode":{let l=o==="buy"?"sell":"buy";a.dataset.mode=l;let c=parseInt(r.value)||0;this.uiManager.updateMarketCardDisplay(s,c,l),this._updateMaxButtonState(a,c,l,s);break}case"confirm-trade":{let l=parseInt(r.value)||0;if(l<=0)return;let c=o==="buy"?this.simulationService.buyItem(s,l):this.simulationService.sellItem(s,l);if(c){let d=o==="buy"?this.uiManager.getItemPrice(n,s)*l:c,h=o==="buy"?`-${I(d,!1)}`:`+${I(d,!1)}`,p=o==="buy"?"#f87171":"#34d399";if(this.uiManager.createFloatingText(h,i.clientX,i.clientY,p),o==="sell"){let y={type:"ACTION",action:"sell-item",goodId:s};this.simulationService.tutorialService.checkState(y)}}break}case"set-max-trade":{let l=this.simulationService._getActiveShip(),c=this.simulationService._getActiveInventory();if(o==="sell")r.value=c[s]?.quantity||0;else{let h=this.uiManager.getItemPrice(n,s),p=l.cargoCapacity-X(c),y=h>0?Math.floor(n.player.credits/h):1/0,g=n.market.inventory[n.currentLocationId][s].quantity;r.value=Math.max(0,Math.min(p,y,g))}let d=parseInt(r.value)||0;this.uiManager.updateMarketCardDisplay(s,d,o),this._updateMaxButtonState(a,d,o,s);break}case w.INCREMENT:case w.DECREMENT:{let l=parseInt(r.value)||0,c=t===w.INCREMENT?l+1:Math.max(0,l-1);r.value=c,this.uiManager.updateMarketCardDisplay(s,c,o),this._updateMaxButtonState(a,c,o,s);break}}}_updateMaxButtonState(e,t,i,a){let s=this.gameState.getState(),o=this.simulationService._getActiveShip(),r=this.simulationService._getActiveInventory(),n;if(i==="sell")n=r[a]?.quantity||0;else{let c=this.uiManager.getItemPrice(s,a),d=o.cargoCapacity-X(r),h=c>0?Math.floor(s.player.credits/c):1/0,p=s.market.inventory[s.currentLocationId][a].quantity;n=Math.max(0,Math.min(d,h,p))}let l=e.querySelector(".max-btn");t>0&&t===n?l.classList.add("pressed"):l.classList.remove("pressed")}};var Qe=class{constructor(e,t){this.playerActionService=e,this.uiManager=t,this.refuelBtn=null,this.repairBtn=null,this.isRefueling=!1,this.isRepairing=!1,this.holdInterval=400,this.lastTickTime=0,this.animationFrameId=null,this.activeElementId=null,this.stopTimers={fuel:null,repair:null},this._boundHandleInteractionStart=this._handleInteractionStart.bind(this),this._boundHandleInteractionStop=this._handleInteractionStop.bind(this),this._boundHandlePointerMove=this._handlePointerMove.bind(this),this._boundLoop=this._loop.bind(this),this._boundStartRefueling=this._startRefueling.bind(this),this._boundStopRefueling=this._stopRefueling.bind(this),this._boundStartRepairing=this._startRepairing.bind(this),this._boundStopRepairing=this._stopRepairing.bind(this),this._boundStopStepperHold=this._stopStepperHold.bind(this),this.isStepperHolding=!1,this.stepperInitialDelay=400,this.stepperRepeatRate=1e3/7,this.stepperTimeout=null,this.stepperInterval=null,this.stepperStartTime=null,this.stepperTarget=null}bindHoldEvents(){document.body.removeEventListener("pointerdown",this._boundHandleInteractionStart),document.body.addEventListener("pointerdown",this._boundHandleInteractionStart),window.removeEventListener("pointerup",this._boundHandleInteractionStop,{capture:!0}),window.addEventListener("pointerup",this._boundHandleInteractionStop,{capture:!0}),window.removeEventListener("pointercancel",this._boundHandleInteractionStop,{capture:!0}),window.addEventListener("pointercancel",this._boundHandleInteractionStop,{capture:!0}),window.removeEventListener("pointermove",this._boundHandlePointerMove),window.addEventListener("pointermove",this._boundHandlePointerMove,{passive:!1}),document.body.removeEventListener("mousedown",this._boundHandleInteractionStart),document.body.removeEventListener("touchstart",this._boundHandleInteractionStart),window.removeEventListener("mouseup",this._boundHandleInteractionStop,{capture:!0}),window.removeEventListener("touchend",this._boundHandleInteractionStop,{capture:!0}),window.removeEventListener("touchcancel",this._boundHandleInteractionStop,{capture:!0}),window.removeEventListener("touchmove",this._boundHandlePointerMove)}_handleInteractionStart(e){if(this.activeElementId||this.stepperTarget)return;let t=e.target.closest("#refuel-btn");if(t&&!t.disabled){this._startRefueling(e);return}let i=e.target.closest("#repair-btn");if(i&&!i.disabled){this._startRepairing(e);return}let a=e.target.closest(".qty-stepper button");if(a&&!a.disabled){e.pointerType==="touch"&&e.preventDefault(),this._startStepperHold(e,a);return}}_handleInteractionStop(e){this.activeElementId==="refuel-btn"?this._stopRefueling():this.activeElementId==="repair-btn"?this._stopRepairing():this.stepperTarget&&this._stopStepperHold()}_handlePointerMove(e){if(this.activeElementId!=="refuel-btn"&&this.activeElementId!=="repair-btn"||e.pointerType!=="touch")return;let t=document.elementFromPoint(e.clientX,e.clientY);if(!t){this.activeElementId==="refuel-btn"&&this._stopRefueling(),this.activeElementId==="repair-btn"&&this._stopRepairing();return}if(t.classList.contains("floating-text"))return;let i=document.getElementById(this.activeElementId);t===i||i&&i.contains(t)||(this.activeElementId==="refuel-btn"&&this._stopRefueling(),this.activeElementId==="repair-btn"&&this._stopRepairing())}_loop(e){if(!this.isRefueling&&!this.isRepairing){this.animationFrameId=null;return}let t=!1;if(e-this.lastTickTime>=this.holdInterval){this.lastTickTime=e;let i=0;if(this.refuelBtn=document.getElementById("refuel-btn"),this.repairBtn=document.getElementById("repair-btn"),this.isRefueling)if(i=this.playerActionService.refuelTick(),this._applyVisuals("fuel"),i>0&&this.refuelBtn){let a=this.refuelBtn.getBoundingClientRect();this.uiManager.createFloatingText(`-${I(i,!1)}`,a.left+a.width/2,a.top,"#f87171"),t=!0}else this.isRefueling=!1;if(this.isRepairing)if(i=this.playerActionService.repairTick(),this._applyVisuals("repair"),i>0&&this.repairBtn){let a=this.repairBtn.getBoundingClientRect();this.uiManager.createFloatingText(`-${I(i,!1)}`,a.left+a.width/2,a.top,"#f87171"),setTimeout(()=>{this.uiManager.createFloatingText("+1 Day",a.left+a.width/2,a.top-20,"#60a5fa")},150),t=!0}else this.isRepairing=!1;t||(!this.isRefueling&&this.activeElementId==="refuel-btn"&&this._removeVisualsWithDelay("fuel"),!this.isRepairing&&this.activeElementId==="repair-btn"&&this._removeVisualsWithDelay("repair"))}this.isRefueling||this.isRepairing?this.animationFrameId=requestAnimationFrame(this._boundLoop):this.animationFrameId=null}_applyVisuals(e){e==="fuel"&&this.stopTimers.fuel&&(clearTimeout(this.stopTimers.fuel),this.stopTimers.fuel=null),e==="repair"&&this.stopTimers.repair&&(clearTimeout(this.stopTimers.repair),this.stopTimers.repair=null);let t=document.getElementById("refuel-btn"),i=document.getElementById("repair-btn"),a=e==="fuel"?t:i,s=e==="fuel"?"fuel-bar":"repair-bar";if(a){a.classList.add("holding");let o=a.closest(".service-module");o&&o.classList.add("active-service");let r=document.getElementById(s);if(r){r.classList.add("filling");let n=r.closest(".progress-bar-container");n&&n.classList.add("active-pulse")}}}_removeVisualsWithDelay(e){e==="fuel"?(this.stopTimers.fuel&&clearTimeout(this.stopTimers.fuel),this.stopTimers.fuel=setTimeout(()=>{this._removeVisuals("fuel"),this.stopTimers.fuel=null},400)):e==="repair"&&(this.stopTimers.repair&&clearTimeout(this.stopTimers.repair),this.stopTimers.repair=setTimeout(()=>{this._removeVisuals("repair"),this.stopTimers.repair=null},400))}_removeVisuals(e){let t=document.getElementById("refuel-btn"),i=document.getElementById("repair-btn"),a=e==="fuel"?t:i,s=e==="fuel"?"fuel-bar":"repair-bar";if(a){a.classList.remove("holding");let o=a.closest(".service-module");o&&o.classList.remove("active-service");let r=document.getElementById(s);if(r){r.classList.remove("filling");let n=r.closest(".progress-bar-container");n&&n.classList.remove("active-pulse")}}}_startRefueling(e){if(!(e.button&&e.button!==0)&&(e.pointerType==="touch"&&e.preventDefault(),this.refuelBtn=e.target.closest("#refuel-btn"),!!this.refuelBtn)){try{this.refuelBtn.setPointerCapture(e.pointerId)}catch{}this.activeElementId=this.refuelBtn.id,this.isRefueling=!0,this._applyVisuals("fuel"),this.lastTickTime=performance.now()-this.holdInterval,this.animationFrameId||(this.animationFrameId=requestAnimationFrame(this._boundLoop))}}_stopRefueling(){if(this.activeElementId!=="refuel-btn")return;let e=document.getElementById(this.activeElementId);if(e&&e.hasPointerCapture(1))try{}catch{}this.activeElementId=null,this.isRefueling=!1,this._removeVisualsWithDelay("fuel")}_startRepairing(e){if(!(e.button&&e.button!==0)&&(e.pointerType==="touch"&&e.preventDefault(),this.repairBtn=e.target.closest("#repair-btn"),!!this.repairBtn)){try{this.repairBtn.setPointerCapture(e.pointerId)}catch{}this.activeElementId=this.repairBtn.id,this.isRepairing=!0,this._applyVisuals("repair"),this.lastTickTime=performance.now()-this.holdInterval,this.animationFrameId||(this.animationFrameId=requestAnimationFrame(this._boundLoop))}}_stopRepairing(){this.activeElementId==="repair-btn"&&(this.activeElementId=null,this.isRepairing=!1,this._removeVisualsWithDelay("repair"))}_startStepperHold(e,t){this._stopStepperHold(),this.isStepperHolding=!1;let i=t.closest(".transaction-controls");if(!i)return;try{t.setPointerCapture(e.pointerId)}catch{}e.preventDefault();let a=t.closest(".qty-stepper"),s=i.querySelector("input"),o=t.classList.contains("qty-up")?1:-1;this.stepperTarget={input:s,direction:o,element:a,button:t,pointerId:e.pointerId},this.stepperTimeout=setTimeout(()=>{this.isStepperHolding=!0,this.stepperStartTime=Date.now(),this.stepperTarget&&this.stepperTarget.element&&this.stepperTarget.element.classList.add("stepper-active"),this._stepperTick(),this.stepperInterval=setInterval(()=>this._stepperTick(),this.stepperRepeatRate)},this.stepperInitialDelay)}_stopStepperHold(){if(this.stepperTarget){if(this.stepperTarget.button&&this.stepperTarget.button.hasPointerCapture(this.stepperTarget.pointerId))try{this.stepperTarget.button.releasePointerCapture(this.stepperTarget.pointerId)}catch{}clearTimeout(this.stepperTimeout),clearInterval(this.stepperInterval),this.stepperTarget.element&&this.stepperTarget.element.classList.remove("stepper-active"),this.stepperTimeout=null,this.stepperInterval=null,this.stepperStartTime=null,this.stepperTarget=null}}_stepperTick(){if(!this.stepperTarget){this._stopStepperHold();return}let{input:e,direction:t}=this.stepperTarget,i=(Date.now()-this.stepperStartTime)/1e3,a=1;i>5?a=25:i>2&&(a=5);let s=parseInt(e.value,10)||0;s+=a*t,e.value=Math.max(0,s),e.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))}};var Je=class{constructor(e,t){this.gameState=e,this.simulationService=t,this.isScrolling=!1,this.scrollTimeout=null,this.rafId=null,this.state={isDragging:!1,startX:0,startTranslate:0,currentTranslate:0,activeCarousel:null,containerWidth:0,pageCount:0,currentIndex:0,moved:!1}}handleWheel(e){if(this.isScrolling)return;let t=e.deltaY>0?"next":"prev",i=this.gameState.getState(),a=i.uiState.hangarShipyardToggleState,s=a==="hangar"?i.uiState.hangarActiveIndex||0:i.uiState.shipyardActiveIndex||0,o=t==="next"?s+1:s-1;this._preloadForTarget(o,a),this.simulationService.cycleHangarCarousel(t),this.isScrolling=!0,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.isScrolling=!1},300)}handleDragStart(e){let t=e.target.closest(".carousel-container"),i=t?t.querySelector("#hangar-carousel"):null;if(e.target.closest("[data-action]")||!i||i.children.length<=1){this.state.isDragging=!1;return}e.preventDefault();let a=this.gameState.getState(),s=a.uiState.hangarShipyardToggleState==="hangar";this.state.isDragging=!0,this.state.activeCarousel=i,this.state.startX=e.pageX??e.touches[0].pageX,this.state.containerWidth=i.parentElement.offsetWidth,this.state.pageCount=i.children.length,this.state.currentIndex=s?a.uiState.hangarActiveIndex||0:a.uiState.shipyardActiveIndex||0,this.state.startTranslate=-this.state.currentIndex*this.state.containerWidth,this.state.currentTranslate=this.state.startTranslate,this.state.moved=!1,i.style.transitionDuration="0s",document.body.style.cursor="grabbing"}handleDragMove(e){if(!this.state.isDragging)return;e.preventDefault();let i=(e.pageX??e.touches[0].pageX)-this.state.startX;this.state.currentTranslate=this.state.startTranslate+i,Math.abs(i)>10&&(this.state.moved=!0),this.state.activeCarousel&&(this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.state.activeCarousel&&(this.state.activeCarousel.style.transform=`translateX(${this.state.currentTranslate}px)`)}))}handleDragEnd(){if(!this.state.isDragging)return;this.rafId&&cancelAnimationFrame(this.rafId);let{activeCarousel:e,startTranslate:t,currentTranslate:i,currentIndex:a,containerWidth:s,pageCount:o}=this.state;if(this.state.isDragging=!1,document.body.style.cursor="default",!e)return;e.style.transitionDuration="";let r=i-t,n=a,l=s/4;r<-l&&a<o-1?n++:r>l&&a>0&&n--;let c=this.gameState.uiState.hangarShipyardToggleState;this._preloadForTarget(n,c),this.simulationService.setHangarCarouselIndex(n,c),setTimeout(()=>{this.state.moved=!1},50)}_preloadForTarget(e,t){let a=this.gameState.getState().player,s=[];t==="hangar"?s=a.ownedShipIds:this.simulationService._getShipyardInventory&&(s=this.simulationService._getShipyardInventory().map(([o])=>o)),V.preloadBuffer(s,e,5,a.visualSeed)}wasMoved(){return this.state.moved}};var Ze=class{constructor(e,t){this.gameState=e,this.uiManager=t,this.activeTooltipTarget=null,this.activeStatusTooltip=null}handleClick(e){let t=e.target.closest("[data-action]");if(this.activeStatusTooltip&&!this.uiManager.isClickInside(e,'[data-action="toggle-tooltip"]')&&(this.activeStatusTooltip.classList.remove("visible"),this.activeStatusTooltip=null),this.uiManager.isClickInside(e,"#graph-tooltip, #generic-tooltip")){this.uiManager.hideGraph(),this.uiManager.hideGenericTooltip(),this.activeTooltipTarget=null;return}if(t){let{action:i}=t.dataset;switch(i){case"toggle-tooltip":this._toggleStatusTooltip(t);return;case"show-attribute-tooltip":if(e.stopPropagation(),e.preventDefault(),this.activeTooltipTarget===t)this.uiManager.hideGenericTooltip(),this.activeTooltipTarget=null;else{let a=t.dataset.attributeId,s=M.getDefinition(a);if(s){let o=`<span class="font-roboto-mono text-xs text-gray-200 leading-tight">${s.description}</span>`;this.uiManager.showGenericTooltip(t,o,"top"),this.activeTooltipTarget=t}}return;case w.SHOW_PRICE_GRAPH:case w.SHOW_FINANCE_GRAPH:this.uiManager.isMobile&&(this.uiManager.hideGenericTooltip(),this.activeTooltipTarget===t?(this.uiManager.hideGraph(),this.activeTooltipTarget=null):(this.uiManager.showGraph(t,this.gameState.getState()),this.activeTooltipTarget=t));break}}this.activeTooltipTarget&&t!==this.activeTooltipTarget&&(this.uiManager.hideGraph(),this.uiManager.hideGenericTooltip(),this.activeTooltipTarget=null),this.uiManager.isMobile&&this._handleMobileTooltip(e),this._handleLoreAndTutorialLog(e)}handleMouseOver(e){if(this.uiManager.isMobile)return;let t=e.target.closest(`[data-action="${w.SHOW_PRICE_GRAPH}"], [data-action="${w.SHOW_FINANCE_GRAPH}"]`);t&&this.uiManager.showGraph(t,this.gameState.getState())}handleMouseOut(e){if(this.uiManager.isMobile)return;e.target.closest(`[data-action="${w.SHOW_PRICE_GRAPH}"], [data-action="${w.SHOW_FINANCE_GRAPH}"]`)&&this.uiManager.hideGraph()}_toggleStatusTooltip(e){let t=e.querySelector(".status-tooltip");t&&(this.activeStatusTooltip===t?(t.classList.remove("visible"),this.activeStatusTooltip=null):(this.activeStatusTooltip&&this.activeStatusTooltip.classList.remove("visible"),t.classList.add("visible"),this.activeStatusTooltip=t))}_handleMobileTooltip(e){let t=e.target.closest("[data-tooltip]");t&&!t.closest('[data-action="toggle-tooltip"]')&&(this.uiManager.hideGraph(),this.activeTooltipTarget===t?(this.uiManager.hideGenericTooltip(),this.activeTooltipTarget=null):(this.uiManager.showGenericTooltip(t,t.dataset.tooltip),this.activeTooltipTarget=t))}_handleLoreAndTutorialLog(e){let t=e.target.closest(".tutorial-container"),i=e.target.closest(".lore-container"),a=document.querySelector(".lore-tooltip.visible, .tutorial-tooltip.visible");a&&!e.target.closest(".lore-tooltip, .tutorial-tooltip")&&a.classList.remove("visible"),i&&i.querySelector(".lore-tooltip")?.classList.toggle("visible"),t&&this.uiManager.showTutorialLogModal({seenBatches:this.gameState.tutorials.seenBatchIds,onSelect:s=>this.tutorialService.triggerBatch(s)})}};var et=class{constructor(e,t,i,a,s=null,o){this.gameState=e,this.simulationService=t,this.uiManager=i,this.tutorialService=a,this.debugService=s,this.logger=o,this.actionClickHandler=new Xe(e,t,i,a),this.marketEventHandler=new ze(e,t,i),this.holdEventHandler=new Qe(this.simulationService.playerActionService,i),this.carouselEventHandler=new Je(e,t),this.tooltipHandler=new Ze(e,i),this.marketActions=new Set(["toggle-trade-mode","confirm-trade","set-max-trade",w.INCREMENT,w.DECREMENT])}bindEvents(){document.body.addEventListener("click",i=>this._handleClick(i)),document.body.addEventListener("dblclick",i=>i.preventDefault()),document.body.addEventListener("mouseover",i=>this.tooltipHandler.handleMouseOver(i)),document.body.addEventListener("mouseout",i=>this.tooltipHandler.handleMouseOut(i)),document.addEventListener("keydown",i=>this._handleKeyDown(i)),document.body.addEventListener("input",i=>this.marketEventHandler.handleInput(i)),document.body.addEventListener("contextmenu",i=>i.preventDefault()),document.body.addEventListener("wheel",i=>{i.target.closest(".carousel-container")&&(i.preventDefault(),this.carouselEventHandler.handleWheel(i))},{passive:!1});let e=i=>{let a=i.target.closest("[data-action]");a||this.uiManager.hideGenericTooltip(),!(a||i.target.closest(".qty-stepper button"))&&this.carouselEventHandler.handleDragStart(i)};document.body.addEventListener("mousedown",e),document.body.addEventListener("touchstart",i=>{let a=i.target.closest("[data-action]");(i.target.closest("#refuel-btn")||i.target.closest("#repair-btn")||i.target.closest(".carousel-container"))&&!a&&i.preventDefault(),e(i)},{passive:!1});let t=()=>{this.carouselEventHandler.handleDragEnd()};document.body.addEventListener("mouseup",t),document.body.addEventListener("mouseleave",t),document.body.addEventListener("touchend",t),document.body.addEventListener("touchcancel",t),document.body.addEventListener("mousemove",i=>this.carouselEventHandler.handleDragMove(i)),document.body.addEventListener("touchmove",i=>{this.carouselEventHandler.state.isDragging&&i.preventDefault(),this.carouselEventHandler.handleDragMove(i)},{passive:!1}),window.addEventListener("resize",()=>this.uiManager.render(this.gameState.getState())),this.uiManager.cache.missionStickyBar&&this.uiManager.cache.missionStickyBar.addEventListener("click",()=>{this.simulationService.setScreen($.DATA,x.MISSIONS)}),this.holdEventHandler.bindHoldEvents()}async _handleClick(e){if(this.carouselEventHandler.wasMoved()||this.holdEventHandler.isStepperHolding){this.holdEventHandler.isStepperHolding&&(this.holdEventHandler.isStepperHolding=!1),e.preventDefault();return}let t=this.gameState.getState(),i=e.target.closest("[data-action]");if(this.tooltipHandler.handleClick(e),i){let s=i.dataset.action;if(s===w.DEBUG_SIMPLE_START){this.debugService&&this.debugService.simpleStart();return}if(s==="show_lore"){e.preventDefault();let o=i.dataset.loreId;o&&this.uiManager.showLoreModal(o);return}this.marketActions.has(s)?this.marketEventHandler.handleClick(e,i):await this.actionClickHandler.handle(e,i);return}if(t.introSequenceActive&&!t.tutorials.activeBatchId){this.simulationService.handleIntroClick(e);return}if(t.isGameOver)return;let a=this.uiManager.getModalIdFromEvent(e);a&&a!=="lore-modal"&&this.uiManager.hideModal(a)}_handleKeyDown(e){this.gameState.isGameOver||e.ctrlKey||e.metaKey||(e.key==="`"||e.key==="&")&&this.debugService&&this.debugService.toggleVisibility()}};var tt=class{constructor(e,t,i,a,s){this.gameState=e,this.uiManager=t,this.simulationService=i,this.logger=s,this.activeBatchId=null,this.activeStepId=null,this.screenToNavMap={};for(let o in a)for(let r in a[o].screens)this.screenToNavMap[r]=o}checkState(e=null){if(this.activeBatchId&&this.activeStepId){let i=f.TUTORIAL_DATA[this.activeBatchId].steps.find(a=>a.stepId===this.activeStepId);i&&this._matchesCondition(i.completion,e)&&this.advanceStep();return}for(let t in f.TUTORIAL_DATA){let i=f.TUTORIAL_DATA[t],a=this.gameState.tutorials.seenBatchIds.includes(t),s=this.gameState.tutorials.skippedTutorialBatches.includes(t);if(!a&&!s){let o=e||{type:ae.SCREEN_LOAD,screenId:this.gameState.activeScreen};if(this._matchesCondition(i.trigger,o)){this.triggerBatch(t);break}}}}triggerBatch(e,t=null){if(!f.TUTORIAL_DATA[e])return;let i=f.TUTORIAL_DATA[e];if(i.trigger.type===ae.SCREEN_LOAD){let s=i.trigger.screenId;if(this.gameState.activeScreen!==s){let o=this.screenToNavMap[s];o&&this.simulationService.setScreen(o,s)}}this.activeBatchId=e,this.gameState.tutorials.activeBatchId=e,this.gameState.tutorials.seenBatchIds.includes(e)||this.gameState.tutorials.seenBatchIds.push(e),this.logger.info.system("Tutorial",this.gameState.day,"TUTORIAL_START",`Starting tutorial batch: ${e}`),this.gameState.setState(this.gameState),this.uiManager.render(this.gameState.getState());let a=t||i.steps[0].stepId;this._displayStep(a)}skipActiveTutorial(){this.activeBatchId&&(this.gameState.tutorials.skippedTutorialBatches.includes(this.activeBatchId)||this.gameState.tutorials.skippedTutorialBatches.push(this.activeBatchId),this.logger.info.player(this.gameState.day,"TUTORIAL_SKIP",`Skipped tutorial: ${this.activeBatchId}`),this._endBatch(),this.gameState.setState(this.gameState))}advanceStep(){if(!this.activeStepId||!this.activeBatchId)return;let t=f.TUTORIAL_DATA[this.activeBatchId].steps.find(i=>i.stepId===this.activeStepId);if(this.uiManager.hideTutorialToast(),t&&t.nextStepId)this._displayStep(t.nextStepId);else{let i=this.activeBatchId;this._endBatch(),this.gameState.introSequenceActive&&i?.startsWith("intro_")&&this.simulationService._continueIntroSequence(i)}}_displayStep(e){if(!this.activeBatchId)return;let t=f.TUTORIAL_DATA[this.activeBatchId],i=t.steps.find(a=>a.stepId===e);if(!i){this._endBatch();return}if(i.hasOwnProperty("navLock"))this.gameState.tutorials.navLock=i.navLock;else if(t.navLock){let a=this.gameState.activeScreen,s=this.screenToNavMap[a];this.gameState.tutorials.navLock={navId:s,screenId:a}}else this.gameState.tutorials.navLock=null;this.activeStepId=e,this.gameState.tutorials.activeStepId=e,this.logger.info.system("Tutorial",this.gameState.day,"STEP_DISPLAY",`Displaying step: ${e}`),this.uiManager.showTutorialToast({step:i,onSkip:()=>this.uiManager.showSkipTutorialModal(()=>this.skipActiveTutorial()),onNext:()=>this.advanceStep(),gameState:this.gameState.getState()}),this.uiManager.render(this.gameState.getState())}_endBatch(){this.logger.info.system("Tutorial",this.gameState.day,"TUTORIAL_END",`Ending tutorial batch: ${this.activeBatchId}`),this.uiManager.hideTutorialToast(),this.activeBatchId=null,this.activeStepId=null,this.gameState.tutorials.activeBatchId=null,this.gameState.tutorials.activeStepId=null,this.gameState.tutorials.navLock=null}_matchesCondition(e,t){return!e||!t?!1:Array.isArray(e)?e.every(i=>this._matchesSingleCondition(i,t)):this._matchesSingleCondition(e,t)}_matchesSingleCondition(e,t){if(e.type!==t.type)return!1;switch(e.type){case ae.SCREEN_LOAD:return e.screenId===t.screenId;case ae.ACTION:return e.action===w.SET_SCREEN&&t.action===w.SET_SCREEN?e.navId===t.navId&&e.screenId===t.screenId:e.action===t.action;case ae.INFO:return!0;default:return!1}}};var it=class{evaluate(e,t,i){let a=0,s=e.quantity!==void 0?e.quantity:e.value,o=s!==void 0?s:1,r=!1,n=e.comparator||">=",l=c=>i?i.getEffectiveShipStats(c):f.SHIPS[c];switch(e.type){case"have_item":case"DELIVER_ITEM":let c=t.player.activeShipId,d=t.player.inventories[c],h=e.goodId||e.target;d&&d[h]&&(a=d[h].quantity||0);break;case"have_credits":case"WEALTH_CHECK":a=t.player.credits;break;case"have_fuel_tank":case"HAVE_FUEL_TANK":let p=t.player.shipStates[t.player.activeShipId];p&&(a=Math.floor(p.fuel));break;case"have_hull_pct":case"HAVE_HULL_PCT":let y=t.player.activeShipId,g=t.player.shipStates[y],S=l(y);g&&S&&S.maxHealth>0?a=Math.floor(g.health/S.maxHealth*100):a=0;break;case"have_cargo_pct":case"HAVE_CARGO_PCT":let b=t.player.activeShipId,T=l(b),A=t.player.inventories[b];if(T&&A&&T.cargoCapacity>0){let D=Object.values(A).reduce((U,W)=>U+(W.quantity||0),0);a=Math.floor(D/T.cargoCapacity*100)}else a=0;break;case"travel_to":case"TRAVEL_TO":let _=e.target;a=t.currentLocationId===_?1:0;break;case"have_ship":case"OWN_SHIP":let N=e.target;a=t.player.ownedShipIds.includes(N)?1:0;break;case"mission_complete":case"MISSION_COMPLETE":let F=e.target;a=t.missions.completedMissionIds.includes(F)?1:0;break;default:console.warn(`[MissionObjectiveEvaluator] Unknown objective type: ${e.type}`);break}switch((typeof a!="number"||isNaN(a))&&(a=0),n){case">=":a>=o&&(a=o,r=!0);break;case"<=":a<=o&&(r=!0);break;case"==":a===o&&(r=!0);break;default:console.warn(`[MissionObjectiveEvaluator] Unknown comparator: ${n}`),a>=o&&(r=!0)}return{current:a,target:o,isMet:r}}};var at=class{check(e,t){switch(e.type){case"mission_completed":return t.missions.completedMissionIds.includes(e.missionId||e.value);case"mission_not_completed":return!t.missions.completedMissionIds.includes(e.missionId||e.value);case"revealed_tier":return t.player.revealedTier>=(e.tier||e.value);case"wealth_gt":return t.player.credits>=e.value;case"location_is":return t.currentLocationId===e.value;case"location_is_not":return t.currentLocationId!==e.value;case"has_ship":return t.player.ownedShipIds.includes(e.value);default:return console.warn(`[MissionTriggerEvaluator] Unknown trigger type: ${e.type}`),!1}}checkAll(e,t){return!e||e.length===0?!0:e.every(i=>this.check(i,t))}};var st=class{constructor(e,t,i){this.gameState=e,this.uiManager=t,this.logger=i,this.simulationService=null,this.objectiveEvaluator=new it,this.triggerEvaluator=new at}setSimulationService(e){this.simulationService=e}arePrerequisitesMet(e){let t=f.MISSIONS[e];if(!t)return!1;let i=t.triggers||t.prerequisites;return this.triggerEvaluator.checkAll(i,this.gameState)}getAvailableMissions(){let{activeMissionIds:e,completedMissionIds:t}=this.gameState.missions;return Object.values(f.MISSIONS).filter(i=>!e.includes(i.id)&&!t.includes(i.id)&&i.type!=="DEBUG"&&this.arePrerequisitesMet(i.id))}injectTestMissions(){let e=Date.now(),t=[{id:`test_station_delivery_${e}`,name:"[TEST] Station Delivery",type:"DELIVERY",host:"STATION",description:"Simple delivery test. Deliver 1 Water Ice.",triggers:[],objectives:[{id:"obj_deliver_ice",type:"DELIVER_ITEM",goodId:"water_ice",quantity:1}],providedCargo:[{goodId:"water_ice",quantity:1}],completion:{locationId:null,title:"Delivery Success",text:"Station delivery logic verified.",buttonText:"Close"},rewards:[{type:"credits",amount:100}]},{id:`test_guild_travel_${e}`,name:"[TEST] Guild Travel",type:"TRAVEL",host:"GUILD",description:"Simple travel test. Travel to any location.",triggers:[],objectives:[{id:"obj_travel_luna",type:"TRAVEL_TO",target:"loc_luna"}],completion:{locationId:null,title:"Travel Success",text:"Guild travel logic verified.",buttonText:"Close"},rewards:[{type:"item",goodId:"propellant",quantity:10}]},{id:`test_syndicate_wealth_${e}`,name:"[TEST] Syndicate Wealth",type:"WEALTH",host:"SYNDICATE",description:"Simple wealth check. Have > 1 Credit.",triggers:[],objectives:[{id:"obj_wealth_check",type:"WEALTH_CHECK",value:1}],completion:{locationId:null,title:"Wealth Success",text:"Syndicate wealth logic verified.",buttonText:"Pay Up"},rewards:[{type:"credits",amount:666}]},{id:`test_unknown_cargo_${e}`,name:"[TEST] Unknown Protocol (Item)",type:"STATUS",host:"UNKNOWN",description:"Tests checking CARGO for Propellant (Item).",triggers:[],objectives:[{id:"obj_check_prop",type:"have_item",goodId:"propellant",quantity:1}],completion:{locationId:null,title:"Cargo Verified",text:"Inventory item check successful.",buttonText:"End"},rewards:[{type:"credits",amount:5e3}]},{id:`test_unknown_tank_${e}`,name:"[TEST] Unknown Protocol (Tank)",type:"STATUS",host:"UNKNOWN",description:"Tests checking SHIP TANK for Fuel Level.",triggers:[],objectives:[{id:"obj_check_tank",type:"have_fuel_tank",value:10}],completion:{locationId:null,title:"Tank Verified",text:"Ship fuel tank logic verified.",buttonText:"Ignite"},rewards:[{type:"credits",amount:5e3}]},{id:`test_maintenance_std_${e}`,name:"[TEST] Maintenance Standard",type:"INSPECTION",host:"GUILD",description:"Requires Hull Integrity >= 90%. Repair if needed.",triggers:[],objectives:[{id:"obj_check_hull",type:"HAVE_HULL_PCT",value:90,comparator:">="}],completion:{locationId:null,title:"Inspection Passed",text:"Your ship meets Guild safety standards.",buttonText:"OK"},rewards:[{type:"credits",amount:250}]},{id:`test_ghost_run_${e}`,name:"[TEST] Ghost Run",type:"SMUGGLING",host:"SYNDICATE",description:"Requires Empty Cargo Hold (0% Usage). Sell everything.",triggers:[],objectives:[{id:"obj_check_cargo_pct",type:"HAVE_CARGO_PCT",value:0,comparator:"<="}],completion:{locationId:null,title:"Ghost Run Complete",text:"You arrived clean. Good work.",buttonText:"Vanish"},rewards:[{type:"credits",amount:2e3}]}];t.forEach(i=>{f.MISSIONS[i.id]=i}),this.logger.warn("MissionService",`Injected ${t.length} Test Missions into Mission Terminal.`),this.uiManager&&this.uiManager.render(this.gameState.getState())}acceptMission(e,t=!1){let i=f.MISSIONS[e];if(!t){if(this.gameState.missions.activeMissionIds.length>=4){this.logger.warn("MissionService",`Cannot accept ${e}: Mission log full (4/4).`);return}if(!i||!this.arePrerequisitesMet(e))return}this.gameState.missions.activeMissionIds.includes(e)||(this.gameState.missions.activeMissionIds.push(e),this.gameState.missions.missionProgress[e]={objectives:{},isCompletable:!1},this.gameState.missions.trackedMissionId||(this.gameState.missions.trackedMissionId=e),this.logger.info.player(this.gameState.day,"MISSION_ACCEPT",`Accepted mission: ${e} ${t?"(FORCED)":""}`),this.simulationService&&this.simulationService.grantMissionCargo(e),this.checkTriggers(),!i.objectives||i.objectives.length===0?this.completeMission(e,t):this.uiManager.render(this.gameState.getState()))}abandonMission(e){if(!(!e||!this.gameState.missions.activeMissionIds.includes(e))){if(this.gameState.missions.activeMissionIds=this.gameState.missions.activeMissionIds.filter(t=>t!==e),this.gameState.missions.missionProgress[e]&&(this.gameState.missions.missionProgress[e].isCompletable=!1),this.gameState.missions.trackedMissionId===e){let t=this.gameState.missions.activeMissionIds[0];this.gameState.missions.trackedMissionId=t||null}this.logger.info.player(this.gameState.day,"MISSION_ABANDON",`Abandoned mission: ${e}`),this.gameState.setState({}),this.uiManager.render(this.gameState.getState())}}checkTriggers(e=!1){let{activeMissionIds:t}=this.gameState.missions;if(!t||t.length===0)return;let i=!1;t.forEach(a=>{let s=f.MISSIONS[a];if(!s)return;let o=!0,r=!1;this.gameState.missions.missionProgress[a]||(this.gameState.missions.missionProgress[a]={objectives:{},isCompletable:!1});let n=this.gameState.missions.missionProgress[a];s.objectives?s.objectives.forEach(l=>{let c=this.objectiveEvaluator.evaluate(l,this.gameState,this.simulationService),d=l.id||l.goodId;n.objectives[d]||(n.objectives[d]={current:0,target:c.target}),n.objectives[d].current!==c.current&&(n.objectives[d].current=c.current,n.objectives[d].target=c.target,r=!0),c.isMet||(o=!1)}):o=!0,n.isCompletable!==o&&(n.isCompletable=o,i=!0,o&&!e&&this.logger.info.player(this.gameState.day,"OBJECTIVES_MET",`All objectives for mission ${a} are met.`)),r&&(i=!0)}),i&&!e&&(this.gameState.setState({}),this.uiManager.render(this.gameState.getState()),this.uiManager.flashObjectiveProgress())}completeMission(e,t=!1){if(!this.gameState.missions.activeMissionIds.includes(e))return;let i=f.MISSIONS[e],a=this.gameState.missions.missionProgress[e],s=a?a.isCompletable:!1,o=!i.objectives||i.objectives.length===0;if(!s&&!o&&!t)return;let r=this.gameState.player.inventories[this.gameState.player.activeShipId];if(i.objectives&&i.objectives.forEach(n=>{if((n.type==="have_item"||n.type==="DELIVER_ITEM")&&r){let l=n.goodId||n.target;if(r[l]){let c=n.quantity||1,d=Math.min(r[l].quantity,c);r[l].quantity-=d}}}),this.simulationService&&this.simulationService._grantRewards(i.rewards,i.name),this.logger.info.player(this.gameState.day,"MISSION_COMPLETE",`Completed mission: ${e} ${t?"(FORCED)":""}`),this.gameState.missions.completedMissionIds.push(e),this.gameState.missions.activeMissionIds=this.gameState.missions.activeMissionIds.filter(n=>n!==e),this.gameState.missions.missionProgress[e]&&(this.gameState.missions.missionProgress[e].isCompletable=!1),this.gameState.missions.trackedMissionId===e){let n=this.gameState.missions.activeMissionIds[0];this.gameState.missions.trackedMissionId=n||null}this.gameState.setState({}),this.uiManager.render(this.gameState.getState())}};var se={DEBUG:4,INFO:3,WARN:2,ERROR:1,NONE:0},he={player:"#60a5fa",system:"#4ade80",state:"#facc15",warn:"#f59e0b",error:"#f87171",group:"#d4d4d8"},Gi=100,ce=se.INFO,ot=[];function be(m){ot.push(m),ot.length>Gi&&ot.shift()}function St(m,e,t,i,a,s,o=null){if(m>ce)return;let r=`[${e}] [Day ${t}] ${i}: ${a}`;be(r),console.log(`%c[${e}] %c[Day ${t}] %c${i}: %c${a}`,`color: ${s}; font-weight: bold;`,"color: #9ca3af;","color: #e5e7eb; font-weight: bold;","color: inherit;",o||""),o&&console.dir(o)}var Ie={setLevel:m=>{let e=se[m.toUpperCase()];typeof e<"u"?(ce=e,console.log(`%c[Logger] Log level set to: ${m}`,`color: ${he.state}; font-weight: bold;`)):Ie.warn("LoggingService",`Attempted to set invalid log level: ${m}`)},getLogHistory:()=>ot.join(`
`),info:{player:(m,e,t,i=null)=>St(se.INFO,"Player",m,e,t,he.player,i),system:(m,e,t,i,a=null)=>St(se.INFO,m,e,t,i,he.system,a),state:(m,e,t,i=null)=>St(se.INFO,"Game",m,e,t,he.state,i)},warn:(m,e)=>{if(se.WARN>ce)return;let t=`[${m}] WARN: ${e}`;be(t),console.warn(`%c[${m}] WARN:`,`color: ${he.warn}; font-weight: bold;`,e)},error:(m,e,t=null)=>{if(se.ERROR>ce)return;let i=`[${m}] ERROR: ${e}`;be(i),console.error(`%c[${m}] ERROR:`,`color: ${he.error}; font-weight: bold;`,e,t||"")},group:m=>{se.DEBUG>ce||(be(`--- GROUP START: ${m} ---`),console.groupCollapsed(`%c${m}`,`color: ${he.group}; font-style: italic;`))},groupEnd:()=>{se.DEBUG>ce||(console.groupEnd(),be("--- GROUP END ---"))},time:m=>{se.DEBUG>ce||console.time(m)},timeEnd:m=>{se.DEBUG>ce||console.timeEnd(m)}};var R={IDLE:"IDLE",MAINTENANCE:"MAINTENANCE",SELLING_HELD_CARGO:"SELLING_HELD_CARGO",SEEKING_MANIPULATION:"SEEKING_MANIPULATION",PREPARING_CRASH:"PREPARING_CRASH",EXECUTING_CRASH:"EXECUTING_CRASH",EXECUTING_EXPLOIT:"EXECUTING_EXPLOIT",SELLING_EXPLOITED_GOODS:"SELLING_EXPLOITED_GOODS",TIME_WASTER:"TIME_WASTER",SEEKING_DEPLETION:"SEEKING_DEPLETION",EXECUTING_DEPLETION:"EXECUTING_DEPLETION",WAITING_FOR_HIKE:"WAITING_FOR_HIKE",EXPLOITING_HIKE:"EXPLOITING_HIKE"},oe={MIXED:"MIXED",HONEST_TRADER:"HONEST_TRADER",MANIPULATOR:"MANIPULATOR",DEPLETE_ONLY:"DEPLETE_ONLY",PROSPECTOR:"PROSPECTOR"},rt=class{constructor(e,t,i){this.gameState=e,this.simulationService=t,this.logger=i,this.isRunning=!1,this.stopRequested=!1,this.botState=R.IDLE,this.activeStrategy=oe.MIXED,this.MIN_PROFIT_MARGIN=.15,this.currentObjective=null,this.plannedObjectives=[],this.metrics={totalTrades:0,profitableTrades:0,totalNetProfit:0,totalFuelCost:0,totalRepairCost:0,daysSimulated:0,profitByGood:{},objectivesStarted:0,objectivesCompleted:0,objectivesAborted:0,strategyUsed:oe.MIXED},this.simulationStartDay=0}async runSimulation({daysToRun:e,strategy:t},i){if(this.isRunning){this.logger.warn("Bot","AUTOTRADER-01 is already running.");return}this.isRunning=!0,this.stopRequested=!1,this.botState=R.IDLE,this.activeStrategy=t||oe.MIXED;let a=this.gameState.day,s=a+e;for(this.simulationStartDay=a,this.metrics={totalTrades:0,profitableTrades:0,totalNetProfit:0,totalFuelCost:0,totalRepairCost:0,daysSimulated:0,profitByGood:{},objectivesStarted:0,objectivesCompleted:0,objectivesAborted:0,strategyUsed:this.activeStrategy},this.logger.info.system("Bot",a,"SIMULATION_START",`Starting advanced simulation for ${e} days using strategy: ${this.activeStrategy}.`);this.gameState.day<s&&!this.stopRequested;)await this._decideNextAction(),i(this.gameState.day,s),await new Promise(o=>setTimeout(o,10));this._logSummaryReport(),this.logger.info.system("Bot",this.gameState.day,"SIMULATION_END","Simulation finished."),this.isRunning=!1}stop(){this.stopRequested=!0}async _decideNextAction(){if(!this._handleAgeEventChoice())switch(this.botState!==R.MAINTENANCE&&(!this.currentObjective||this.currentObjective.type!=="REFUEL_FOR_TRAVEL")&&this._needsMaintenance()&&(this.logger.info.system("Bot",this.gameState.day,"MAINTENANCE","Low resources detected. Switching to maintenance state."),this.botState=R.MAINTENANCE),this.botState){case R.IDLE:await this._evaluateOpportunities();break;case R.MAINTENANCE:await this._executeMaintenance();break;case R.SELLING_HELD_CARGO:await this._executeSellHeldCargo();break;case R.SEEKING_MANIPULATION:await this._findCrashOpportunity();break;case R.PREPARING_CRASH:await this._executePreparation();break;case R.EXECUTING_CRASH:await this._executeCrash();break;case R.EXECUTING_EXPLOIT:await this._executeExploit();break;case R.SELLING_EXPLOITED_GOODS:await this._executeSellExploited();break;case R.TIME_WASTER:await this._executeTimeWaster();break;case R.SEEKING_DEPLETION:await this._findDepletionOpportunity();break;case R.EXECUTING_DEPLETION:await this._executeDepletion();break;case R.WAITING_FOR_HIKE:await this._executeWait();break;case R.EXPLOITING_HIKE:await this._executeExploitHike();break}}async _evaluateOpportunities(){let e=this._findBestSellLocationForHeldCargo();if(e){this.currentObjective={type:"SELL_HELD_CARGO",...e},this.botState=R.SELLING_HELD_CARGO,this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE",`[HELD CARGO]: Found profitable sale for ${e.quantity}x ${e.goodId} @ ${e.sellLocationId}. Profit: ${I(e.estimatedProfit)}.`),this.metrics.objectivesStarted++;return}if(this.activeStrategy===oe.MIXED||this.activeStrategy===oe.MANIPULATOR){let t=this._findReadySelfExploit();if(t){this.currentObjective=t,this.botState=R.EXECUTING_EXPLOIT,this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE",`Found self-created exploit: Buy ${t.goodId} @ ${t.exploitLocationId}`),this.metrics.objectivesStarted++;return}}if(this.currentObjective){if(this.currentObjective.type==="CRASH"&&this._isCrashPlanStillValid()){this.botState=R.PREPARING_CRASH,this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE",`Continuing persistent CRASH loop for ${this.currentObjective.goodId}.`);return}else if(this.currentObjective.type!=="CRASH"&&this.currentObjective.type!=="SIMPLE_TRADE"){let t=this.currentObjective.goodId,i=this._findCrashOpportunity(t);if(i&&i.goodId&&i.buyFromLocationId&&i.crashLocationId){this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE",`Re-validating and repeating CRASH loop for ${i.goodId}.`),this.currentObjective=i,this.botState=R.PREPARING_CRASH,this.metrics.objectivesStarted++;return}else this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE",`Failed to re-validate loop for ${t}. Plan is no longer viable.`)}}switch(this.currentObjective=null,this.activeStrategy){case oe.HONEST_TRADER:this.botState=R.TIME_WASTER,this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE","Strategy: HONEST_TRADER. Seeking simple trade.");break;case oe.MANIPULATOR:this.botState=R.SEEKING_MANIPULATION,this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE","Strategy: MANIPULATOR. Seeking new market crash opportunity.");break;case oe.DEPLETE_ONLY:this.botState=R.SEEKING_DEPLETION,this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE","Strategy: DEPLETE_ONLY. Seeking new depletion opportunity.");break;case oe.PROSPECTOR:let t=this._findBestSimpleTrade();t?(this.currentObjective={...t,type:"SIMPLE_TRADE",hasGoods:!1},this.botState=R.TIME_WASTER,this.metrics.objectivesStarted++,this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE",`[PROSPECTOR]: Found simple trade. Buy ${t.goodId} @ ${t.buyLocationId} -> Sell @ ${t.sellLocationId}. Margin: ${(t.profitPerUnit/t.buyPrice*100).toFixed(1)}%. Est. PPD: ${I(t.estimatedPPD)}.`)):(this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE",`[PROSPECTOR]: No simple trades found meeting ${this.MIN_PROFIT_MARGIN*100}% margin. Falling back to manipulation.`),this.botState=R.SEEKING_MANIPULATION);break;case oe.MIXED:default:Math.random()<.25?(this.botState=R.SEEKING_DEPLETION,this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE","Strategy: MIXED. Seeking new depletion opportunity.")):(this.botState=R.SEEKING_MANIPULATION,this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE","Strategy: MIXED. Seeking new market crash opportunity."));break}}async _executeMaintenance(){let e=this.simulationService._getActiveShip();if(!e){this.botState=R.IDLE;return}let t=this.gameState.player.shipStates[e.id];if(this.currentObjective&&this.currentObjective.type==="REFUEL_FOR_TRAVEL"){let{needed:s,nextState:o,originalObjective:r}=this.currentObjective;if(s>e.maxFuel&&t.fuel===e.maxFuel){this.logger.error("Bot",`MAINTENANCE_FAIL: Objective requires ${s} fuel, but ship max is ${e.maxFuel}. Ship is full. Aborting objective to prevent loop.`),this.currentObjective=null,this.botState=R.IDLE,this.metrics.objectivesAborted++;return}if(t.fuel<s){this.logger.info.system("Bot",this.gameState.day,"MAINTENANCE",`Executing local refuel to get ${s} fuel.`),this._botRefuel(s);return}else{this.logger.info.system("Bot",this.gameState.day,"MAINTENANCE","Local refuel complete. Resuming original objective."),this.currentObjective=r,this.botState=o;return}}let i=t.fuel/e.maxFuel*100,a=t.health/e.maxHealth*100;if(i<30){if(this.gameState.currentLocationId===v.JUPITER)this.logger.info.system("Bot",this.gameState.day,"MAINTENANCE","Arrived at Jupiter. Refueling."),this._botRefuel(e.maxFuel);else{let s=this.gameState.getState(),o=s.TRAVEL_DATA[s.currentLocationId][v.JUPITER],r=o?o.fuelCost||0:9999;t.fuel<r?(this.logger.warn("Bot",`Stranded at ${s.currentLocationId}. Buying expensive local fuel just to reach Jupiter.`),this._botRefuel(r+5)):(this.logger.info.system("Bot",this.gameState.day,"MAINTENANCE",`Fuel ${i.toFixed(0)}%. Traveling to Jupiter.`),this.simulationService.travelService.initiateTravel(v.JUPITER))}return}if(a<30){this.gameState.currentLocationId!==v.LUNA?(this.logger.info.system("Bot",this.gameState.day,"MAINTENANCE",`Hull ${a.toFixed(0)}%. Traveling to Luna.`),this.simulationService.travelService.initiateTravel(v.LUNA)):(this.logger.info.system("Bot",this.gameState.day,"MAINTENANCE","Arrived at Luna. Repairing."),this._botRepair());return}this.logger.info.system("Bot",this.gameState.day,"MAINTENANCE","Maintenance complete. Resuming operations."),this.botState=R.IDLE}async _executeSellHeldCargo(){let{goodId:e,sellLocationId:t,quantity:i}=this.currentObjective,a=this.gameState.getState(),s=this.simulationService._getActiveShip();if(a.currentLocationId!==t){this.logger.info.system("Bot",a.day,"SELL_HELD",`Traveling to ${t} to sell ${i}x ${e}`);let r=a.TRAVEL_DATA[a.currentLocationId][t],n=r?r.fuelCost||0:9999;if(s.fuel<n){this.logger.warn("Bot",`SELL_HELD_FAIL: Not enough fuel (${s.fuel}) to travel to ${t} (needs ${n}). Forcing maintenance.`);let l=this.currentObjective;this.currentObjective={type:"REFUEL_FOR_TRAVEL",needed:n+5,nextState:R.SELLING_HELD_CARGO,originalObjective:l},this.botState=R.MAINTENANCE;return}this.simulationService.travelService.initiateTravel(t);return}let o=this.simulationService._getActiveInventory()[e]?.quantity||0;if(o>0){let r=this.simulationService._getActiveInventory()[e]?.avgCost||0,l=this.simulationService.playerActionService.sellItem(e,o)-r*o;this.logger.info.system("Bot",a.day,"SELL_HELD_SELL",`Sold ${o}x ${e}. Profit: ${I(l)}`),this.metrics.totalTrades++,this.metrics.totalNetProfit+=l,l>0&&this.metrics.profitableTrades++,this.metrics.profitByGood[e]||(this.metrics.profitByGood[e]=0),this.metrics.profitByGood[e]+=l,this.metrics.objectivesCompleted++}else this.logger.warn("Bot",`SELL_HELD_FAIL: Arrived at ${t} but have no ${e} to sell.`),this.metrics.objectivesAborted++;this.currentObjective=null,this.botState=R.IDLE}async _findCrashOpportunity(e=null){let t=this.gameState.getState(),i=f.COMMODITIES.filter(s=>s.tier<=t.player.revealedTier&&s.tier>1);if(e&&(i=i.filter(s=>s.id===e)),i.length===0)return e||(this.botState=R.TIME_WASTER),null;let a=[];for(let s of i){let o=this._findCheapestMarket(s.id);if(!o)continue;let r=this._findBestCrashTarget(s.id,o.id);if(!r)continue;let n=s.tier*(r.price-o.price);n>0&&a.push({potential:n,plan:{type:"CRASH",goodId:s.id,buyFromLocationId:o.id,crashLocationId:r.id}})}if(a.length>0){a.sort((r,n)=>n.potential-r.potential);let s=a.slice(0,5).map(r=>r.plan),o=s[Math.floor(Math.random()*s.length)];if(e)return o;this.currentObjective=o,this.botState=R.PREPARING_CRASH,this.metrics.objectivesStarted++,this.logger.info.system("Bot",this.gameState.day,"PLAN",`New crash plan (1 of ${s.length}): Buy ${o.goodId} @ ${o.buyFromLocationId}, Crash @ ${o.crashLocationId}`)}else return e||(this.botState=R.TIME_WASTER,this.logger.info.system("Bot",this.gameState.day,"PLAN","No good crash plans. Running simple trade.")),null}async _executePreparation(){let{goodId:e,buyFromLocationId:t}=this.currentObjective,i=this.gameState.getState();if(i.currentLocationId!==t){this.logger.info.system("Bot",i.day,"PREP",`Traveling to ${t} to buy ${e}`);let o=this.simulationService._getActiveShip(),r=i.TRAVEL_DATA[i.currentLocationId][t],n=r?r.fuelCost||0:9999;if(o.fuel<n){this.logger.warn("Bot",`PREP_FAIL: Not enough fuel (${o.fuel}) to travel to ${t} (needs ${n}). Forcing maintenance.`);let l=this.currentObjective;this.currentObjective={type:"REFUEL_FOR_TRAVEL",needed:n+5,nextState:R.PREPARING_CRASH,originalObjective:l},this.botState=R.MAINTENANCE;return}this.simulationService.travelService.initiateTravel(t);return}let a=i.market.prices[t][e],s=this._calculateMaxBuy(e,a);s>0?(this.simulationService.playerActionService.buyItem(e,s),this.logger.info.system("Bot",i.day,"PREP_BUY",`Bought ${s}x ${e} @ ${I(a)}`),this.botState=R.EXECUTING_CRASH):(this.logger.warn("Bot",`PREP_FAIL: Arrived at ${t} but could not buy ${e}. Aborting.`),this.currentObjective=null,this.botState=R.IDLE,this.metrics.objectivesAborted++)}async _executeCrash(){let{goodId:e,crashLocationId:t}=this.currentObjective,i=this.gameState.getState();if(i.currentLocationId!==t){this.logger.info.system("Bot",i.day,"CRASH",`Traveling to ${t} to crash ${e}`);let s=this.simulationService._getActiveShip(),o=i.TRAVEL_DATA[i.currentLocationId][t],r=o?o.fuelCost||0:9999;if(s.fuel<r){this.logger.warn("Bot",`CRASH_FAIL: Not enough fuel (${s.fuel}) to travel to ${t} (needs ${r}). Forcing maintenance.`);let n=this.currentObjective;this.currentObjective={type:"REFUEL_FOR_TRAVEL",needed:r+5,nextState:R.EXECUTING_CRASH,originalObjective:n},this.botState=R.MAINTENANCE;return}this.simulationService.travelService.initiateTravel(t);return}let a=this.simulationService._getActiveInventory()[e]?.quantity||0;if(a>0){let s=this.simulationService._getActiveInventory()[e]?.avgCost||0,r=this.simulationService.playerActionService.sellItem(e,a)-s*a;this.logger.info.system("Bot",i.day,"CRASH_SELL",`CRASHED: Sold ${a}x ${e}. Profit: ${I(r)}`),this.metrics.totalTrades++,this.metrics.totalNetProfit+=r,r>0&&this.metrics.profitableTrades++,this.metrics.profitByGood[e]||(this.metrics.profitByGood[e]=0),this.metrics.profitByGood[e]+=r;let n=this.gameState.market.inventory[t][e];this.plannedObjectives.push({goodId:e,locationId:t,priceLockEndDay:n.priceLockEndDay,crashedOnDay:this.gameState.day}),this.currentObjective.type="EXPLOIT",this.currentObjective.exploitLocationId=this.currentObjective.crashLocationId,delete this.currentObjective.buyFromLocationId,delete this.currentObjective.crashLocationId,this.botState=R.EXECUTING_EXPLOIT}else this.logger.warn("Bot",`CRASH_FAIL: Arrived at ${t} but have no ${e} to sell. Aborting.`),this.currentObjective=null,this.botState=R.IDLE,this.metrics.objectivesAborted++}async _executeExploit(){let{goodId:e,exploitLocationId:t}=this.currentObjective,i=this.gameState.getState();if(i.currentLocationId!==t){this.logger.info.system("Bot",i.day,"EXPLOIT",`Traveling to ${t} to buy cheap ${e}`);let o=this.simulationService._getActiveShip(),r=i.TRAVEL_DATA[i.currentLocationId][t],n=r?r.fuelCost||0:9999;if(o.fuel<n){this.logger.warn("Bot",`EXPLOIT_FAIL: Not enough fuel (${o.fuel}) to travel to ${t} (needs ${n}). Forcing maintenance.`);let l=this.currentObjective;this.currentObjective={type:"REFUEL_FOR_TRAVEL",needed:n+5,nextState:R.EXECUTING_EXPLOIT,originalObjective:l},this.botState=R.MAINTENANCE;return}this.simulationService.travelService.initiateTravel(t);return}let a=i.market.prices[t][e],s=this._calculateMaxBuy(e,a);if(s>0){this.simulationService.playerActionService.buyItem(e,s),this.logger.info.system("Bot",i.day,"EXPLOIT_BUY",`EXPLOITED: Bought ${s}x ${e} @ ${I(a)}`);let o=this._findBestSellLocation(e,t);o?(this.logger.info.system("Bot",i.day,"EXPLOIT_PLAN",`Goods secured. Now traveling to ${o.id} to sell.`),this.currentObjective.type="SELL_EXPLOITED",this.currentObjective.sellToLocationId=o.id,this.botState=R.SELLING_EXPLOITED_GOODS):(this.logger.warn("Bot",`EXPLOIT_FAIL: No market found to sell ${e}. Dumping objective.`),this.currentObjective=null,this.botState=R.IDLE,this.metrics.objectivesAborted++)}else this.logger.warn("Bot",`EXPLOIT_FAIL: Arrived at ${t} but could not buy ${e}.`),this.currentObjective=null,this.botState=R.IDLE,this.metrics.objectivesAborted++;this.plannedObjectives=this.plannedObjectives.filter(o=>!(o.goodId===e&&o.locationId===t))}async _executeSellExploited(){let{goodId:e,sellToLocationId:t}=this.currentObjective,i=this.gameState.getState();if(i.currentLocationId!==t){this.logger.info.system("Bot",i.day,"SELL_EXPLOIT",`Traveling to ${t} to sell ${e}`);let s=this.simulationService._getActiveShip(),o=i.TRAVEL_DATA[i.currentLocationId][t],r=o?o.fuelCost||0:9999;if(s.fuel<r){this.logger.warn("Bot",`SELL_EXPLOIT_FAIL: Not enough fuel (${s.fuel}) to travel to ${t} (needs ${r}). Forcing maintenance.`);let n=this.currentObjective;this.currentObjective={type:"REFUEL_FOR_TRAVEL",needed:r+5,nextState:R.SELLING_EXPLOITED_GOODS,originalObjective:n},this.botState=R.MAINTENANCE;return}this.simulationService.travelService.initiateTravel(t);return}let a=this.simulationService._getActiveInventory()[e]?.quantity||0;if(a>0){let s=this.simulationService._getActiveInventory()[e]?.avgCost||0,r=this.simulationService.playerActionService.sellItem(e,a)-s*a;this.logger.info.system("Bot",i.day,"SELL_EXPLOIT_SELL",`Sold ${a}x ${e}. Profit: ${I(r)}`),this.metrics.totalTrades++,this.metrics.totalNetProfit+=r,r>0&&this.metrics.profitableTrades++,this.metrics.profitByGood[e]||(this.metrics.profitByGood[e]=0),this.metrics.profitByGood[e]+=r}else this.logger.warn("Bot",`SELL_EXPLOIT_FAIL: Arrived at ${t} but have no ${e} to sell.`);this.botState=R.IDLE,this.metrics.objectivesCompleted++}async _executeTimeWaster(){if(!this.currentObjective||this.currentObjective.type!=="SIMPLE_TRADE"){let n=this._findBestSimpleTrade();if(n)this.currentObjective={...n,type:"SIMPLE_TRADE",hasGoods:!1},this.metrics.objectivesStarted++,this.logger.info.system("Bot",this.gameState.day,"OBJECTIVE",`[TRADE]: New simple trade. Buy ${n.goodId} @ ${n.buyLocationId} -> Sell @ ${n.sellLocationId}. Margin: ${(n.profitPerUnit/n.buyPrice*100).toFixed(1)}%. Est. PPD: ${I(n.estimatedPPD)}.`);else{this.logger.info.system("Bot",this.gameState.day,"TIME_WASTER","No profitable simple trades found. Waiting 1 day."),this.simulationService.timeService.advanceDays(1),this.botState=R.IDLE;return}}let{goodId:e,buyLocationId:t,sellLocationId:i,buyPrice:a,hasGoods:s}=this.currentObjective,o=this.gameState.getState(),r=this.simulationService._getActiveShip();if(!s){if(o.currentLocationId!==t){this.logger.info.system("Bot",o.day,"TRADE_BUY",`Traveling to ${t} to buy ${e}`);let c=o.TRAVEL_DATA[o.currentLocationId][t],d=c?c.fuelCost||0:9999;if(r.fuel<d){this.logger.warn("Bot",`TIME_WASTER_FAIL: Not enough fuel (${r.fuel}) to travel to ${t} (needs ${d}). Forcing maintenance.`);let h=this.currentObjective;this.currentObjective={type:"REFUEL_FOR_TRAVEL",needed:d+5,nextState:R.TIME_WASTER,originalObjective:h},this.botState=R.MAINTENANCE;return}this.simulationService.travelService.initiateTravel(t);return}let n=o.market.inventory[o.currentLocationId][e].quantity;if(n<=0){this.logger.warn("Bot",`TIME_WASTER_FAIL: Arrived at ${t} but ${e} is now out of stock. Aborting.`),this.currentObjective=null,this.botState=R.IDLE,this.metrics.objectivesAborted++;return}let l=this._calculateMaxBuy(e,a);if(l>0)this.simulationService.playerActionService.buyItem(e,l),this.logger.info.system("Bot",o.day,"TRADE_BUY",`Bought ${l}x ${e} @ ${I(a)}`),this.currentObjective.hasGoods=!0;else{this.logger.warn("Bot",`TIME_WASTER_FAIL: Arrived at ${t} but could not buy ${e} (Price: ${I(a)}, Stock: ${n}). Aborting.`),this.currentObjective=null,this.botState=R.IDLE,this.metrics.objectivesAborted++;return}}if(this.currentObjective.hasGoods){if(o.currentLocationId!==i){this.logger.info.system("Bot",o.day,"TRADE_SELL",`Traveling to ${i} to sell ${e}`);let l=o.TRAVEL_DATA[o.currentLocationId][i],c=l?l.fuelCost||0:9999;if(r.fuel<c){this.logger.warn("Bot",`TIME_WASTER_FAIL: Not enough fuel (${r.fuel}) to travel to ${i} (needs ${c}). Forcing maintenance.`);let d=this.currentObjective;this.currentObjective={type:"REFUEL_FOR_TRAVEL",needed:c+5,nextState:R.TIME_WASTER,originalObjective:d},this.botState=R.MAINTENANCE;return}this.simulationService.travelService.initiateTravel(i);return}let n=this.simulationService._getActiveInventory()[e]?.quantity||0;if(n>0){let l=this.simulationService._getActiveInventory()[e]?.avgCost||0,d=this.simulationService.playerActionService.sellItem(e,n)-l*n;this.logger.info.system("Bot",o.day,"TRADE_SELL",`Sold ${n}x ${e}. Profit: ${I(d)}`),this.metrics.totalTrades++,this.metrics.totalNetProfit+=d,d>0&&this.metrics.profitableTrades++,this.metrics.profitByGood[e]||(this.metrics.profitByGood[e]=0),this.metrics.profitByGood[e]+=d,this.metrics.objectivesCompleted++}else this.logger.warn("Bot",`TIME_WASTER_FAIL: Arrived at ${i} but have no ${e} to sell.`),this.metrics.objectivesAborted++;this.currentObjective=null,this.botState=R.IDLE}}async _findDepletionOpportunity(){let e=this.gameState.getState(),t=this.simulationService._getActiveShip();if(!t){this.botState=R.IDLE;return}let i=f.COMMODITIES.filter(s=>s.tier<=e.player.revealedTier&&s.tier>1),a=[];for(let s of i)for(let o of f.MARKETS){if(!e.player.unlockedLocationIds.includes(o.id))continue;let r=e.market.inventory[o.id][s.id];if(e.day<=r.depletionBonusDay+365)continue;let[n,l]=s.canonicalAvailability,c=o.availabilityModifier?.[s.id]??1,d=(n+l)/2*c,h=r.marketPressure;h>0&&(h=0);let p=1-Math.min(.5,h*.5),g=Math.max(1,d*p)*.08,S=r.quantity,b=e.market.prices[o.id][s.id];S>=g&&e.player.credits>=S*b&&t.cargoCapacity>=S&&a.push({potential:s.tier*S,plan:{type:"DEPLETE",goodId:s.id,locationId:o.id,amountToBuy:S}})}if(a.length>0){a.sort((r,n)=>n.potential-r.potential);let s=a.slice(0,5).map(r=>r.plan),o=s[Math.floor(Math.random()*s.length)];this.currentObjective=o,this.botState=R.EXECUTING_DEPLETION,this.metrics.objectivesStarted++,this.logger.info.system("Bot",this.gameState.day,"PLAN",`New depletion plan (1 of ${s.length}): Buy out ${o.amountToBuy}x ${o.goodId} at ${o.locationId}`)}else this.activeStrategy===oe.DEPLETE_ONLY?(this.logger.info.system("Bot",this.gameState.day,"PLAN","No depletion opportunities. Waiting 1 day."),this.simulationService.timeService.advanceDays(1),this.botState=R.IDLE):this.botState=R.SEEKING_MANIPULATION}async _executeDepletion(){let{goodId:e,locationId:t,amountToBuy:i}=this.currentObjective,a=this.gameState.getState();if(a.currentLocationId!==t){this.logger.info.system("Bot",a.day,"DEPLETE",`Traveling to ${t} to buy out ${e}`);let r=this.simulationService._getActiveShip(),n=a.TRAVEL_DATA[a.currentLocationId][t],l=n?n.fuelCost||0:9999;if(r.fuel<l){this.logger.warn("Bot",`DEPLETE_FAIL: Not enough fuel (${r.fuel}) to travel to ${t} (needs ${l}). Forcing maintenance.`);let c=this.currentObjective;this.currentObjective={type:"REFUEL_FOR_TRAVEL",needed:l+5,nextState:R.EXECUTING_DEPLETION,originalObjective:c},this.botState=R.MAINTENANCE;return}this.simulationService.travelService.initiateTravel(t);return}let s=this.simulationService.playerActionService.buyItem(e,i);if(!s||s<i){this.logger.warn("Bot",`DEPLETE_FAIL: Failed to buy out ${e} at ${t}. Aborting.`),this.currentObjective=null,this.botState=R.IDLE,this.metrics.objectivesAborted++;return}this.logger.info.system("Bot",a.day,"DEPLETE_BUY",`Successfully bought out ${i}x ${e}. Depletion bonus triggered.`);let o=this._findBestSellLocation(e,t);if(o){let r=this.simulationService._getActiveShip(),n=a.TRAVEL_DATA[a.currentLocationId][o.id],l=n?n.fuelCost||0:9999;if(r.fuel<l){this.logger.warn("Bot",`DEPLETE_FAIL: Not enough fuel (${r.fuel}) to travel to sell location ${o.id} (needs ${l}). Forcing maintenance.`);let c=this.currentObjective;this.currentObjective={type:"REFUEL_FOR_TRAVEL",needed:l+5,nextState:R.EXECUTING_DEPLETION,originalObjective:c},this.botState=R.MAINTENANCE;return}this.simulationService.travelService.initiateTravel(o.id);return}this.currentObjective.waitStartDay=this.gameState.day,this.botState=R.WAITING_FOR_HIKE}async _executeWait(){this.gameState.day>this.currentObjective.waitStartDay+7?(this.logger.info.system("Bot",this.gameState.day,"DEPLETE","Wait complete. Price hike is active. Beginning exploitation."),this.botState=R.EXPLOITING_HIKE,this.currentObjective.exploitRuns=0):(this.simulationService.timeService.advanceDays(1),this.botState=R.WAITING_FOR_HIKE)}async _executeExploitHike(){let{goodId:e,locationId:t}=this.currentObjective,i=this.gameState.getState(),a=this._findCheapestMarket(e);if(!a||a.id===t){this.logger.warn("Bot",`HIKE_FAIL: No cheap market found to buy ${e}. Aborting exploit.`),this.currentObjective=null,this.botState=R.IDLE,this.metrics.objectivesAborted++;return}if(i.currentLocationId!==a.id){let l=this.simulationService._getActiveShip(),c=i.TRAVEL_DATA[i.currentLocationId][a.id],d=c?c.fuelCost||0:9999;if(l.fuel<d){this.logger.warn("Bot",`HIKE_FAIL: Not enough fuel (${l.fuel}) to travel to buy location ${a.id} (needs ${d}). Forcing maintenance.`);let h=this.currentObjective;this.currentObjective={type:"REFUEL_FOR_TRAVEL",needed:d+5,nextState:R.EXPLOITING_HIKE,originalObjective:h},this.botState=R.MAINTENANCE;return}this.simulationService.travelService.initiateTravel(a.id);return}let s=this._calculateMaxBuy(e,a.price);if(s>0&&this.simulationService.playerActionService.buyItem(e,s),i.currentLocationId!==t){let l=this.simulationService._getActiveShip(),c=i.TRAVEL_DATA[i.currentLocationId][t],d=c?c.fuelCost||0:9999;if(l.fuel<d){this.logger.warn("Bot",`HIKE_FAIL: Not enough fuel (${l.fuel}) to travel to hiked location ${t} (needs ${d}). Forcing maintenance.`);let h=this.currentObjective;this.currentObjective={type:"REFUEL_FOR_TRAVEL",needed:d+5,nextState:R.EXPLOITING_HIKE,originalObjective:h},this.botState=R.MAINTENANCE;return}this.simulationService.travelService.initiateTravel(t);return}let o=this.simulationService._getActiveInventory()[e]?.quantity||0,r=i.market.inventory[t][e].quantity;if(o>0&&r>0){let l=this.simulationService._getActiveInventory()[e]?.avgCost||0,d=this.simulationService.playerActionService.sellItem(e,o)-l*o;this.logger.info.system("Bot",i.day,"HIKE_EXPLOIT_SELL",`Sold ${o}x ${e} at hiked price. Profit: ${I(d)}`),this.metrics.totalTrades++,this.metrics.totalNetProfit+=d,d>0&&this.metrics.profitableTrades++,this.metrics.profitByGood[e]||(this.metrics.profitByGood[e]=0),this.metrics.profitByGood[e]+=d}else if(o>0&&r<=0){this.logger.warn("Bot",`HIKE_FAIL: Arrived at hiked market ${t} but stock is 0. Aborting sale and loop.`),this.currentObjective=null,this.botState=R.IDLE,this.metrics.objectivesAborted++;return}this.currentObjective.exploitRuns++;let n=i.market.inventory[t][e];this.currentObjective.exploitRuns<2&&i.day<n.depletionDay+7?this.botState=R.EXPLOITING_HIKE:(this.logger.info.system("Bot",i.day,"HIKE_COMPLETE","Depletion exploit complete."),this.currentObjective=null,this.botState=R.IDLE,this.metrics.objectivesCompleted++)}_isCrashPlanStillValid(){if(!this.currentObjective||this.currentObjective.type!=="CRASH")return!1;let{goodId:e,buyFromLocationId:t,crashLocationId:i}=this.currentObjective;if(!e||!t||!i)return!1;let a=this.gameState.getState(),s=a.market.prices[t][e];return a.market.prices[i][e]-s>0}_findReadySelfExploit(){let e=this.gameState.getState();this.plannedObjectives=this.plannedObjectives.filter(t=>t.priceLockEndDay>e.day);for(let t of this.plannedObjectives)if(e.day>t.crashedOnDay+7&&e.market.inventory[t.locationId][t.goodId].quantity>10)return{type:"EXPLOIT",goodId:t.goodId,exploitLocationId:t.locationId};return null}_findBestSellLocationForHeldCargo(){let e=this.gameState.getState(),t=this.simulationService._getActiveInventory();if(!t)return null;let i=null,a=0;for(let s in t){let o=t[s];if(o&&o.quantity>0){let r=o.avgCost,n=o.quantity,l=this._findBestSellLocation(s,e.currentLocationId);if(l){let c=(l.price-r)*n;c>a&&(a=c,i={goodId:s,quantity:n,avgCost:r,sellLocationId:l.id,sellPrice:l.price,estimatedProfit:c})}}}return i&&i.estimatedProfit>0?i:null}_findCheapestMarket(e){let t=this.gameState.getState(),i=null,a=1/0;for(let s of f.MARKETS){if(!t.player.unlockedLocationIds.includes(s.id))continue;let o=t.market.prices[s.id][e];o<a&&t.market.inventory[s.id][e].quantity>0&&(a=o,i={id:s.id,price:o})}return i}_findBestSellLocation(e,t){let i=this.gameState.getState(),a=null,s=-1/0;for(let o of f.MARKETS){if(o.id===t||!i.player.unlockedLocationIds.includes(o.id))continue;let r=i.market.inventory[o.id][e].quantity,n=i.market.prices[o.id][e];n>s&&r>0&&(s=n,a={id:o.id,price:n})}return a}_findBestCrashTarget(e,t){let i=this.gameState.getState(),a=null,s=1/0;for(let o of f.MARKETS){if(o.id===t||!i.player.unlockedLocationIds.includes(o.id))continue;let r=o.availabilityModifier?.[e]??1,n=i.market.prices[o.id][e];n<s&&(s=n,a={id:o.id,price:n})}return a}_findBestSimpleTrade(){let e=this.gameState.getState(),t=this.simulationService._getActiveShip();if(!t)return null;let i=t.cargoCapacity;if(i<=0)return null;let a=null,s=0,o=f.COMMODITIES.filter(n=>n.tier<=e.player.revealedTier),r=this.simulationService._getActiveInventory();for(let n of o)if(!(r[n.id]&&r[n.id].quantity>0))for(let l of f.MARKETS){if(!e.player.unlockedLocationIds.includes(l.id))continue;let c=e.market.inventory[l.id][n.id].quantity;if(!(c<=0))for(let d of f.MARKETS){if(l.id===d.id||!e.player.unlockedLocationIds.includes(d.id)||e.market.inventory[d.id][n.id].quantity<=0)continue;let p=e.market.prices[l.id][n.id],y=e.market.prices[d.id][n.id],g=y-p,S=p>0?g/p:0;if(g>0&&S>this.MIN_PROFIT_MARGIN){let b=e.TRAVEL_DATA[e.currentLocationId]?.[l.id]?.time||0,T=e.TRAVEL_DATA[l.id]?.[d.id]?.time||0;if(T===0)continue;let A=b+T+2,_=Math.min(i,c),N=g*_/A;N>s&&(s=N,a={goodId:n.id,buyLocationId:l.id,sellLocationId:d.id,buyPrice:p,sellPrice:y,profitPerUnit:g,estimatedPPD:N})}}}return a}_handleAgeEventChoice(){let e=document.getElementById("age-event-modal");if(!e||e.classList.contains("hidden"))return!1;let t=document.getElementById("age-event-title").textContent;this.logger.info.system("Bot",this.gameState.day,"EVENT_CHOICE",`Handling age event: ${t}`);let i=Array.from(e.querySelectorAll("button"));if(i.length===0)return!1;let a=["trademaster","merchant's guild","free ship","credits","profit"],s=["continue","ignore","dismiss","accept"],o=null;for(let r of i){let n=r.textContent.toLowerCase();if(a.some(l=>n.includes(l))){o=r;break}}if(!o)for(let r of i){let n=r.textContent.toLowerCase();if(s.some(l=>n.includes(l))){o=r;break}}return o||(this.logger.warn("Bot",`EVENT_CHOICE: No preferred keyword found for "${t}". Clicking first available button.`),o=i[0]),o.click(),!0}_logSummaryReport(){this.metrics.daysSimulated=this.gameState.day-this.simulationStartDay;let{totalTrades:e,profitableTrades:t,totalNetProfit:i,totalFuelCost:a,totalRepairCost:s,daysSimulated:o,strategyUsed:r,objectivesStarted:n,objectivesCompleted:l,objectivesAborted:c,profitByGood:d}=this.metrics,h=e>0?(t/e*100).toFixed(1):0,p=o>0?i/o:0,y="=== AUTO-TRADER PERFORMANCE SUMMARY ===";console.log(y),this.logger.info.system("Bot",this.gameState.day,"REPORT",y);let g=[`Strategy Run: ${r}`,`Days Simulated: ${o}`,`Final Credit Balance: ${I(this.gameState.player.credits)}`,"","--- Performance ---",`Total Net Profit: ${I(i)}`,`Profit Per Day: ${I(p)}`,`Objectives (Started/Completed/Aborted): ${n} / ${l} / ${c}`,`Total Trades Completed: ${e}`,`Profitable Trades: ${t} (${h}%)`,"","--- Costs ---",`Total Fuel Costs: ${I(a)}`,`Total Repair Costs: ${I(s)}`];for(let A of g)console.log(A),this.logger.info.system("Bot",this.gameState.day,"REPORT",`  ${A}`);let S="--- Profit Breakdown by Commodity ---";console.log(S),this.logger.info.system("Bot",this.gameState.day,"REPORT",`  ${S}`);let b=Object.keys(d).sort((A,_)=>d[_]-d[A]);if(b.length===0){let A="No commodity trades recorded.";console.log(A),this.logger.info.system("Bot",this.gameState.day,"REPORT",`    ${A}`)}else for(let A of b){let _=d[A],N=`${f.COMMODITIES.find(O=>O.id===A)?.name||A}: ${I(_)}`;console.log(N),this.logger.info.system("Bot",this.gameState.day,"REPORT",`    ${N}`)}let T="=======================================";console.log(T),this.logger.info.system("Bot",this.gameState.day,"REPORT",T)}_needsMaintenance(){let e=this.simulationService._getActiveShip();if(!e)return!1;let t=this.gameState.player.shipStates[e.id].fuel/e.maxFuel*100,i=this.gameState.player.shipStates[e.id].health/e.maxHealth*100;return t<30||i<30}_botRefuel(e=null){let t=this.simulationService._getActiveShip();if(!t)return;let a=(e===null?t.maxFuel:Math.min(t.maxFuel,e))-this.gameState.player.shipStates[t.id].fuel;if(a<=0)return;let o=f.MARKETS.find(c=>c.id===this.gameState.currentLocationId).fuelPrice/2;this.gameState.player.activePerks[P.VENETIAN_SYNDICATE]&&this.gameState.currentLocationId===v.VENUS&&(o*=1-f.PERKS[P.VENETIAN_SYNDICATE].fuelDiscount),o=Math.max(1,Math.round(o));let r=Math.ceil(a/5),n=r*o,l=r*5;if(this.gameState.player.credits>=n)this.gameState.player.credits-=n,this.gameState.player.shipStates[t.id].fuel=Math.min(t.maxFuel,this.gameState.player.shipStates[t.id].fuel+l),this.simulationService._logConsolidatedTransaction("fuel",-n,"Fuel Purchase"),this.metrics.totalFuelCost+=n;else{let c=Math.floor(this.gameState.player.credits/o);if(c>0){let d=c*o;this.gameState.player.credits-=d,this.gameState.player.shipStates[t.id].fuel+=c*5,this.simulationService._logConsolidatedTransaction("fuel",-d,"Fuel Purchase"),this.metrics.totalFuelCost+=d}}}_botRepair(){let e=this.simulationService._getActiveShip();if(!e)return;let t=e.maxHealth-this.gameState.player.shipStates[e.id].health;if(t<=0)return;let i=e.maxHealth*(G.REPAIR_AMOUNT_PER_TICK/100),a=i*G.REPAIR_COST_PER_HP;this.gameState.player.activePerks[P.VENETIAN_SYNDICATE]&&this.gameState.currentLocationId===v.VENUS&&(a*=1-f.PERKS[P.VENETIAN_SYNDICATE].repairDiscount),a=Math.max(1,Math.round(a));let o=Math.ceil(t/i)*a;if(this.gameState.player.credits>=o)this.gameState.player.credits-=o,this.gameState.player.shipStates[e.id].health=e.maxHealth,this.simulationService._logConsolidatedTransaction("repair",-o,"Hull Repairs"),this.metrics.totalRepairCost+=o;else{let r=Math.floor(this.gameState.player.credits/a);if(r>0){let n=r*a;this.gameState.player.credits-=n,this.gameState.player.shipStates[e.id].health+=r*i,this.simulationService._logConsolidatedTransaction("repair",-n,"Hull Repairs"),this.metrics.totalRepairCost+=n}}}_calculateMaxBuy(e,t){let i=this.gameState.getState(),a=this.simulationService._getActiveShip(),s=this.simulationService._getActiveInventory();if(!a||!s)return 0;let o=a.cargoCapacity-X(s),r=t>0?Math.floor(i.player.credits/t):1/0,n=i.market.inventory[i.currentLocationId][e].quantity;return Math.max(0,Math.min(o,r,n))}};var Bi={topCenter:[50,15],top34Center:[50,30],vertHorizCenter:[50,50],bottom34Center:[50,70],bottomCenter:[50,85],bottomLeft:[15,85],topLeft:[15,15]},Yi={debug_kitchen_sink:{id:"debug_kitchen_sink",name:"[DEBUG] Kitchen Sink Rewards",type:"DEBUG",host:"DEV",description:"Instantly completes to test multiple reward types (Credits, Items, Licenses).",triggers:[],objectives:[],completion:{locationId:null,title:"Debug Success",text:"You have received a bounty of debug rewards.",buttonText:"Claim Loot"},rewards:[{type:"credits",amount:5e4},{type:"item",goodId:"fuel",quantity:100},{type:"license",licenseId:"t2_license"}]},debug_obj_travel:{id:"debug_obj_travel",name:"[DEBUG] Travel Logic (Mars)",type:"DEBUG",host:"DEV",description:"Requires travel to Mars to verify location triggers.",triggers:[],objectives:[{type:"TRAVEL_TO",target:"loc_mars"}],completion:{locationId:"loc_mars",title:"Arrived at Mars",text:"Travel objective verified.",buttonText:"OK"},rewards:[{type:"credits",amount:100}]},debug_obj_wealth:{id:"debug_obj_wealth",name:"[DEBUG] Wealth Check (>10k)",type:"DEBUG",host:"DEV",description:"Requires player to have > 10,000 credits.",triggers:[],objectives:[{type:"WEALTH_CHECK",value:1e4}],completion:{locationId:null,title:"Wealth Verified",text:"You are wealthy enough.",buttonText:"OK"},rewards:[{type:"credits",amount:1}]},debug_obj_delivery:{id:"debug_obj_delivery",name:"[DEBUG] Delivery (Water Ice)",type:"DEBUG",host:"DEV",description:"Deliver 5 Water Ice. (Cargo provided on accept)",triggers:[],objectives:[{type:"DELIVER_ITEM",goodId:"water_ice",quantity:5}],providedCargo:[{goodId:"water_ice",quantity:5}],completion:{locationId:null,title:"Delivery Done",text:"Items deducted correctly?",buttonText:"OK"},rewards:[{type:"credits",amount:500}]}},nt=class{constructor(e,t,i,a){this.gameState=e,this.simulationService=t,this.uiManager=i,this.logger=a,this.gui=null,this.active=!1,this.diagActive=!1,this.diagElements={},this.actions={},this.debugState={creditsToAdd:1e5,creditsToReduce:1e5,targetAge:25,selectedLocation:this.gameState.currentLocationId,daysToAdvance:7,selectedRandomEvent:f.RANDOM_EVENTS[0]?.id||"",selectedAgeEvent:f.AGE_EVENTS[0]?.id||null,selectedMission:"debug_kitchen_sink",botDaysToRun:365,botStrategy:"MIXED",botProgress:"Idle",logLevel:"INFO",selectedUpgrade:null,selectedCommodityToAdd:E.WATER_ICE,quantityToAdd:10,alwaysTriggerEvents:!1,ttStepId:"None",ttAnchor:"N/A",ttPlacement:"auto",ttOffsetDistance:0,ttOffsetSkidding:0,ttPercentX:50,ttPercentY:50,ttWidth:0,ttHeight:0,ttGeneratedCode:""},this.bot=new rt(e,t,a),this.tutorialPositionalControllers={}}init(){this.gui||(Object.assign(f.MISSIONS,Yi),this.logger.warn("DebugService","Injected Ephemeral Debug Missions into DB.MISSIONS"),this._cacheDiagElements(),this.gui=new lil.GUI({draggable:!0,title:"Debug Menu"}),this.gui.domElement.id="debug-panel",this._registerDebugActions(),this.buildGui(),this._startDiagLoop())}handleKeyPress(e){}toggleVisibility(){this.gui&&(this.active=!this.active,this.gui.domElement.classList.toggle("debug-visible",this.active))}toggleDiagnosticOverlay(){this.diagActive=!this.diagActive;let e=document.getElementById("diagnostic-overlay");e&&e.classList.toggle("hidden",!this.diagActive)}generateBugReport(){let e=this.logger.getLogHistory(),t=this.gameState.getState();delete t.TRAVEL_DATA,delete t.market.priceHistory;let i=`
ORBITAL TRADING - BUG REPORT
==============================
Date: ${new Date().toISOString()}

--- GAME STATE SNAPSHOT ---
${JSON.stringify(t,null,2)}

--- RECENT LOG HISTORY ---
${e}
        `;navigator.clipboard.writeText(i.trim()).then(()=>{this.uiManager.createFloatingText("Bug Report Copied to Clipboard!",window.innerWidth/2,window.innerHeight/2,"#4ade80")}).catch(a=>{this.logger.error("DebugService","Failed to copy bug report.",a)})}_unlockEndgame(){let{player:e,solStation:t}=this.gameState;e.unlockedLocationIds.includes(v.MERCURY)||e.unlockedLocationIds.push(v.MERCURY),e.unlockedLocationIds.includes(v.SUN)||e.unlockedLocationIds.push(v.SUN),t&&(t.unlocked=!0)}godMode(){this.logger.warn("DebugService","GOD MODE ACTIVATED."),this.gameState.introSequenceActive=!1,this.simulationService.tutorialService.activeBatchId=null,this.simulationService.tutorialService.activeStepId=null,this.gameState.tutorials.activeBatchId=null,this.gameState.tutorials.activeStepId=null,this.gameState.tutorials.skippedTutorialBatches=Object.keys(f.TUTORIAL_DATA),this.gameState.player.credits=Number.MAX_SAFE_INTEGER,this.gameState.player.ownedShipIds=[],this.simulationService.addShipToHangar(Q.BEHEMOTH),this.gameState.player.activeShipId=Q.BEHEMOTH,this.gameState.player.revealedTier=7,this.gameState.player.unlockedLicenseIds=Object.keys(f.LICENSES),this.gameState.player.unlockedLocationIds=f.MARKETS.map(e=>e.id),this._unlockEndgame(),this.uiManager.showGameContainer(),this.simulationService.setScreen($.STARPORT,x.MARKET),this.simulationService.timeService.advanceDays(7),this.gameState.setState({})}simpleStart(){this.logger.warn("DebugService","SIMPLE START ACTIVATED."),this.gameState.introSequenceActive=!1,this.simulationService.tutorialService.activeBatchId=null,this.simulationService.tutorialService.activeStepId=null,this.gameState.tutorials.activeBatchId=null,this.gameState.tutorials.activeStepId=null,this.gameState.tutorials.skippedTutorialBatches=Object.keys(f.TUTORIAL_DATA),this.gameState.player.ownedShipIds=[],this.simulationService.addShipToHangar(Q.WANDERER),this.gameState.player.activeShipId=Q.WANDERER;let e=this.gameState.player.visualSeed;V.hydrateAllShips(e),V.hydrateAllCommodities(e),this.uiManager.showGameContainer(),this.simulationService.setScreen($.DATA,x.MISSIONS),this.simulationService.timeService.advanceDays(7),this.gameState.setState({})}skipToHangarTutorial(){this.logger.warn("DebugService","SKIP TO HANGAR TUTORIAL ACTIVATED."),this.gameState.introSequenceActive=!0,this.simulationService.tutorialService.activeBatchId=null,this.simulationService.tutorialService.activeStepId=null,this.gameState.tutorials.activeBatchId=null,this.gameState.tutorials.activeStepId=null,this.gameState.tutorials.skippedTutorialBatches=[],this.gameState.player.credits=25e3,this.gameState.player.ownedShipIds=[],this.gameState.player.activeShipId=null,this.gameState.player.shipStates={},this.gameState.player.inventories={},this.uiManager.showGameContainer(),this.simulationService.setScreen($.STARPORT,x.HANGAR),this.simulationService.tutorialService.triggerBatch("intro_hangar","hangar_1"),this.gameState.setState({})}deductHull(e){let t=this.simulationService._getActiveShip();if(t){let i=this.gameState.player.shipStates[t.id];i.health=Math.max(0,i.health-e),this.logger.warn("DebugService",`Deducted ${e} hull from ${t.name}.`),this.gameState.setState({})}}restoreHull(){let e=this.simulationService._getActiveShip();if(e){let t=this.gameState.player.shipStates[e.id];t.health=e.maxHealth,this.logger.warn("DebugService",`Restored hull for ${e.name}.`),this.gameState.setState({})}}destroyShip(){let e=this.simulationService._getActiveShip();if(e){let t=this.gameState.player.shipStates[e.id];t.health=0,this.logger.warn("DebugService",`Destroyed ${e.name}.`),this.simulationService.travelService._handleShipDestruction(e.id)}}deductFuel(e){let t=this.simulationService._getActiveShip();if(t){let i=this.gameState.player.shipStates[t.id];i.fuel=Math.max(0,i.fuel-e),this.logger.warn("DebugService",`Deducted ${e} fuel from ${t.name}.`),this.gameState.setState({})}}restoreFuel(){let e=this.simulationService._getActiveShip();if(e){let t=this.gameState.player.shipStates[e.id];t.fuel=e.maxFuel,this.logger.warn("DebugService",`Restored fuel for ${e.name}.`),this.gameState.setState({})}}removeAllCargo(){let e=this.simulationService._getActiveInventory();if(e){for(let t in e)e[t].quantity=0,e[t].avgCost=0;this.logger.warn("DebugService","All cargo removed from active ship."),this.gameState.setState({})}}giveItemToShip(){let e=this.simulationService._getActiveShip(),t=this.simulationService._getActiveInventory(),i=this.debugState.selectedCommodityToAdd,a=this.debugState.quantityToAdd;e&&t&&i&&(t[i]||(t[i]={quantity:0,avgCost:0}),t[i].quantity+=a,this.logger.warn("DebugService",`Added ${a}x ${i} to ${e.name}.`),this.uiManager.createFloatingText(`+${a} ${i}`,window.innerWidth/2,window.innerHeight/2,"#4ade80"),this.gameState.setState({}))}fillShipyard(){let{currentLocationId:e,day:t}=this.gameState;if(this.gameState.market.shipyardStock[e]){let i=Object.keys(f.SHIPS);this.gameState.market.shipyardStock[e]={day:t,shipsForSale:i},this.logger.warn("DebugService",`SHIPYARD FILLED: All ships added to ${e}.`),this.gameState.setState({})}else this.logger.error("DebugService",`Cannot fill shipyard: No stock object for ${e}.`)}installSelectedUpgrade(e){if(!e)return;let t=this.simulationService._getActiveShip();if(!t)return;let i=this.gameState.player.shipStates[t.id];i.upgrades||(i.upgrades=[]),i.upgrades.length<3?(i.upgrades.push(e),this.logger.info.system("DebugService",`Installed ${e} on ${t.name}`),this.gameState.setState({})):this.logger.warn("DebugService","Ship upgrade slots full (3/3). Remove one first.")}applyRandomUpgrades(){let e=this.simulationService._getActiveShip();if(!e)return;let t=this.gameState.player.shipStates[e.id];t.upgrades=[];let i=M.getAllUpgradeIds();if(i.length!==0){for(let a=0;a<3;a++){let s=i[Math.floor(Math.random()*i.length)];t.upgrades.push(s)}this.logger.info.system("DebugService",`Applied 3 random upgrades to ${e.name}`),this.gameState.setState({})}}removeAllUpgrades(){let e=this.simulationService._getActiveShip();if(!e)return;let t=this.gameState.player.shipStates[e.id];t.upgrades=[],this.logger.info.system("DebugService",`Removed all upgrades from ${e.name}`),this.gameState.setState({})}resetEconomyMemory(){let{market:e}=this.gameState;f.MARKETS.forEach(t=>{f.COMMODITIES.forEach(i=>{let a=e.inventory[t.id][i.id];a&&(a.marketPressure=0,a.lastPlayerInteractionTimestamp=0,a.priceLockEndDay=0,a.isDepleted=!1,a.depletionDay=0,a.depletionBonusDay=0)})}),this.uiManager.createFloatingText("Economic Memory Reset",window.innerWidth/2,window.innerHeight/2,"#facc15"),this.gameState.setState({})}sootheEconomy(){let{market:e}=this.gameState;f.MARKETS.forEach(t=>{f.COMMODITIES.forEach(i=>{let a=i.basePriceRange[0];e.prices[t.id][i.id]=a})}),this.uiManager.createFloatingText("Economy Soothed (Min Prices)",window.innerWidth/2,window.innerHeight/2,"#4ade80"),this.gameState.setState({})}riotEconomy(){let{market:e}=this.gameState;f.MARKETS.forEach(t=>{f.COMMODITIES.forEach(i=>{let a=i.basePriceRange[1];e.prices[t.id][i.id]=a})}),this.uiManager.createFloatingText("Economy Rioting (Max Prices)",window.innerWidth/2,window.innerHeight/2,"#ef4444"),this.gameState.setState({})}injectStock(){let{market:e}=this.gameState;f.MARKETS.forEach(t=>{f.COMMODITIES.forEach(i=>{let a=e.inventory[t.id][i.id];a&&(a.quantity+=100)})}),this.uiManager.createFloatingText("+100 Stock Injected System-Wide",window.innerWidth/2,window.innerHeight/2,"#facc15"),this.gameState.setState({})}fillSolCaches(){this.gameState.solStation&&this.gameState.solStation.caches&&(Object.values(this.gameState.solStation.caches).forEach(e=>{e.current=e.max}),this.uiManager.createFloatingText("Sol Caches Filled",window.innerWidth/2,window.innerHeight/2,"#facc15"),this.gameState.setState({}))}_registerDebugActions(){this.actions={godMode:{name:"God Mode",type:"button",handler:()=>this.godMode()},simpleStart:{name:"Simple Start",type:"button",handler:()=>this.simpleStart()},skipToHangarTutorial:{name:"Skip to Hangar Tutorial",type:"button",handler:()=>this.skipToHangarTutorial()},addCredits:{name:"Add Credits",type:"button",handler:()=>{this.gameState.player.credits=Math.min(Number.MAX_SAFE_INTEGER,this.gameState.player.credits+this.debugState.creditsToAdd),this.simulationService.timeService._checkMilestones(),this.gameState.setState({})}},reduceCredits:{name:"Reduce Credits",type:"button",handler:()=>{this.gameState.player.credits-=this.debugState.creditsToReduce,this.simulationService._checkGameOverConditions(),this.gameState.setState({})}},setAge:{name:"Set Age",type:"button",handler:()=>{this.gameState.player.playerAge=this.debugState.targetAge,this.logger.warn("DebugService",`Player age manually set to ${this.debugState.targetAge}.`),this.simulationService.timeService&&this.simulationService.timeService._handleBirthday(this.debugState.targetAge),this.gameState.setState({})}},payDebt:{name:"Pay Off Debt",type:"button",handler:()=>this.simulationService.playerActionService.payOffDebt()},teleport:{name:"Teleport",type:"button",handler:()=>{this.debugState.selectedLocation&&(this.gameState.currentLocationId=this.debugState.selectedLocation,this.gameState.setState({}))}},unlockAll:{name:"Unlock All",type:"button",handler:()=>{this.gameState.player.unlockedLocationIds=f.MARKETS.map(e=>e.id),this.gameState.player.revealedTier=7,this.gameState.player.unlockedLicenseIds=Object.keys(f.LICENSES),this._unlockEndgame(),this.gameState.setState({}),this.uiManager.createFloatingText("Unlocked: Maps, Licenses, Tiers, Sol Station",window.innerWidth/2,window.innerHeight/2,"#facc15")}},solTesting:{name:"Sol Testing",type:"button",handler:()=>{this.actions.unlockAll.handler(),this.actions.godMode.handler(),this.gameState.currentLocationId=v.SUN,this.simulationService.solStationService&&this.simulationService.solStationService.startRealTimeSimulation(),this.gameState.setState({}),this.uiManager.createFloatingText("Sol Testing Initiated",window.innerWidth/2,window.innerHeight/2,"#facc15")}},missionTest:{name:"Mission Test",type:"button",handler:()=>{this.simulationService&&this.simulationService.missionService&&(this.simulationService.missionService.injectTestMissions(),this.uiManager.createFloatingText("Test Missions Injected",window.innerWidth/2,window.innerHeight/2,"#facc15"))}},grantAllShips:{name:"Grant All Ships",type:"button",handler:()=>{Object.keys(f.SHIPS).forEach(e=>{this.gameState.player.ownedShipIds.includes(e)||this.simulationService.addShipToHangar(e)}),V.hydrateAllShips(this.gameState.player.visualSeed),this.gameState.setState({})}},cycleShipPics:{name:"Cycle Ship Pics",type:"button",handler:()=>{this.gameState.player.visualSeed=(this.gameState.player.visualSeed||0)+1,this.gameState.setState({}),this.logger.info.system("Debug",`Cycled ship visual variant. New Seed: ${this.gameState.player.visualSeed}`)}},advanceTime:{name:"Advance Days",type:"button",handler:()=>{this.simulationService.timeService.advanceDays(this.debugState.daysToAdvance),this.uiManager.render(this.gameState.getState())}},replenishStock:{name:"Replenish All Stock",type:"button",handler:()=>{this.simulationService.marketService.replenishMarketInventory(),this.gameState.setState({})}},triggerRandomEvent:{name:"Trigger Random Event",type:"button",handler:()=>{this.debugState.selectedRandomEvent&&this.simulationService.forceTriggerEvent(this.debugState.selectedRandomEvent)}},triggerAgeEvent:{name:"Trigger Age Event",type:"button",handler:()=>{let e=f.AGE_EVENTS.find(t=>t.id===this.debugState.selectedAgeEvent);e&&this.uiManager.showAgeEventModal(e,t=>this.simulationService._applyPerk(t))}},forceAcceptMission:{name:"Force Accept Mission",type:"button",handler:()=>{this.debugState.selectedMission&&this.simulationService.missionService.acceptMission(this.debugState.selectedMission,!0)}},forceCompleteMission:{name:"Force Complete Mission",type:"button",handler:()=>{this.simulationService.missionService.completeActiveMission(!0)}},startBot:{name:"Start AUTOTRADER-01",type:"button",handler:()=>{let e=this.gui.controllers.find(i=>i.property==="botProgress"),t={daysToRun:this.debugState.botDaysToRun,strategy:this.debugState.botStrategy};this.bot.runSimulation(t,(i,a)=>{e&&e.setValue(`${i} / ${a}`).updateDisplay()})}},stopBot:{name:"Stop AUTOTRADER-01",type:"button",handler:()=>this.bot.stop()},fillShipyard:{name:"Fill Shipyard w/ All Ships",type:"button",handler:()=>this.fillShipyard()},deductHull20:{name:"Deduct 20 Hull",type:"button",handler:()=>this.deductHull(20)},restoreHull:{name:"Restore Hull",type:"button",handler:()=>this.restoreHull()},destroyShip:{name:"Destroy Current Ship",type:"button",handler:()=>this.destroyShip()},deductFuel20:{name:"Deduct 20 Fuel",type:"button",handler:()=>this.deductFuel(20)},restoreFuel:{name:"Restore Fuel",type:"button",handler:()=>this.restoreFuel()},removeAllCargo:{name:"Remove All Cargo",type:"button",handler:()=>this.removeAllCargo()},giveItemToShip:{name:"Give Item",type:"button",handler:()=>this.giveItemToShip()},applyRandomUpgrades:{name:"Apply 3 Random Upgrades",type:"button",handler:()=>this.applyRandomUpgrades()},removeAllUpgrades:{name:"Remove All Upgrades",type:"button",handler:()=>this.removeAllUpgrades()},resetEconomyMemory:{name:"Reset Econ Memory",type:"button",handler:()=>this.resetEconomyMemory()},sootheEconomy:{name:"Bullish Economy (Soothe)",type:"button",handler:()=>this.sootheEconomy()},riotEconomy:{name:"Bearish Economy (Riot)",type:"button",handler:()=>this.riotEconomy()},injectStock:{name:"+100 Item Avail",type:"button",handler:()=>this.injectStock()},fillSolCaches:{name:"Fill Sol Caches",type:"button",handler:()=>this.fillSolCaches()},generateTutorialCode:{name:"Generate Code",type:"button",handler:()=>this._generateTutorialCode()},presetTopCenter:{name:"Top Center",type:"button",handler:()=>this._applyTutorialPreset("topCenter")},presetTop34Center:{name:"Top 3/4 Center",type:"button",handler:()=>this._applyTutorialPreset("top34Center")},presetVertHorizCenter:{name:"V/H Center",type:"button",handler:()=>this._applyTutorialPreset("vertHorizCenter")},presetBottom34Center:{name:"Bottom 3/4 Center",type:"button",handler:()=>this._applyTutorialPreset("bottom34Center")},presetBottomCenter:{name:"Bottom Center",type:"button",handler:()=>this._applyTutorialPreset("bottomCenter")},presetBottomLeft:{name:"Bottom Left",type:"button",handler:()=>this._applyTutorialPreset("bottomLeft")},presetTopLeft:{name:"Top Left",type:"button",handler:()=>this._applyTutorialPreset("topLeft")}}}_cacheDiagElements(){this.diagElements={winW:document.getElementById("diag-window-w"),winH:document.getElementById("diag-window-h"),visualVpW:document.getElementById("diag-visual-vp-w"),visualVpH:document.getElementById("diag-visual-vp-h"),gameW:document.getElementById("diag-game-container-w"),gameH:document.getElementById("diag-game-container-h"),bodyW:document.getElementById("diag-body-w"),bodyH:document.getElementById("diag-body-h"),pixelRatio:document.getElementById("diag-pixel-ratio"),displayMode:document.getElementById("diag-display-mode"),day:document.getElementById("diag-day"),navScreen:document.getElementById("diag-nav-screen"),tutorialBatch:document.getElementById("diag-tutorial-batch"),tutorialStep:document.getElementById("diag-tutorial-step")}}_startDiagLoop(){let e=()=>{this._updateDiagOverlay(),requestAnimationFrame(e)};requestAnimationFrame(e)}_updateDiagOverlay(){if(!this.diagActive)return;let e=this.gameState.getState(),t=document.getElementById("game-container");this.diagElements.winW.textContent=window.innerWidth,this.diagElements.winH.textContent=window.innerHeight,window.visualViewport&&(this.diagElements.visualVpW.textContent=Math.round(window.visualViewport.width),this.diagElements.visualVpH.textContent=Math.round(window.visualViewport.height)),this.diagElements.gameW.textContent=t.clientWidth,this.diagElements.gameH.textContent=t.clientHeight,this.diagElements.bodyW.textContent=document.body.clientWidth,this.diagElements.bodyH.textContent=document.body.clientHeight,this.diagElements.pixelRatio.textContent=window.devicePixelRatio.toFixed(2),this.diagElements.displayMode.textContent=window.matchMedia("(display-mode: standalone)").matches?"standalone":"browser",this.diagElements.day.textContent=e.day,this.diagElements.navScreen.textContent=`${e.activeNav} / ${e.activeScreen}`,this.diagElements.tutorialBatch.textContent=e.tutorials.activeBatchId||"none",this.diagElements.tutorialStep.textContent=e.tutorials.activeStepId||"none"}buildGui(){let e=this.gui.addFolder("Game Flow");e.add(this.actions.godMode,"handler").name(this.actions.godMode.name),e.add(this.actions.simpleStart,"handler").name(this.actions.simpleStart.name),e.add(this.actions.skipToHangarTutorial,"handler").name(this.actions.skipToHangarTutorial.name),e.add(this.actions.unlockAll,"handler").name("Unlock ALL"),e.add(this.actions.solTesting,"handler").name("Sol Testing"),e.add(this.actions.missionTest,"handler").name("Mission Test");let t=this.gui.addFolder("Player");t.add(this.debugState,"creditsToAdd").name("Credits Amount"),t.add(this.actions.addCredits,"handler").name("Add Credits"),t.add(this.debugState,"creditsToReduce",100,1e6,100).name("Credits to Reduce"),t.add(this.actions.reduceCredits,"handler").name("Reduce Credits"),t.add(this.actions.payDebt,"handler").name(this.actions.payDebt.name),t.add(this.debugState,"targetAge",18,1e3,1).name("Target Age"),t.add(this.actions.setAge,"handler").name("Set Age");let i=this.gui.addFolder("Ship");i.add(this.actions.cycleShipPics,"handler").name(this.actions.cycleShipPics.name);let a=f.COMMODITIES.reduce((S,b)=>({...S,[b.name]:b.id}),{});i.add(this.debugState,"selectedCommodityToAdd",a).name("Item Type"),i.add(this.debugState,"quantityToAdd",1,1e3,1).name("Quantity"),i.add(this.actions.giveItemToShip,"handler").name(this.actions.giveItemToShip.name);let s=f.MARKETS.reduce((S,b)=>({...S,[b.name]:b.id}),{});i.add(this.debugState,"selectedLocation",s).name("Location"),i.add(this.actions.teleport,"handler").name("Teleport"),i.add(this.actions.deductHull20,"handler").name(this.actions.deductHull20.name),i.add(this.actions.restoreHull,"handler").name(this.actions.restoreHull.name),i.add(this.actions.destroyShip,"handler").name(this.actions.destroyShip.name),i.add(this.actions.deductFuel20,"handler").name(this.actions.deductFuel20.name),i.add(this.actions.restoreFuel,"handler").name(this.actions.restoreFuel.name),i.add(this.actions.removeAllCargo,"handler").name(this.actions.removeAllCargo.name),i.add(this.actions.fillShipyard,"handler").name(this.actions.fillShipyard.name),i.add(this.actions.grantAllShips,"handler").name("Grant All Ships");let o=this.gui.addFolder("Game Attributes"),n=M.getAllUpgradeIds().reduce((S,b)=>{let T=M.getDefinition(b);return S[T?T.name:b]=b,S},{});o.add(this.debugState,"selectedUpgrade",n).name("Install Upgrade").onChange(S=>this.installSelectedUpgrade(S)),o.add(this.actions.applyRandomUpgrades,"handler").name("Apply 3 Random"),o.add(this.actions.removeAllUpgrades,"handler").name("Remove All");let l=this.gui.addFolder("World & Time");l.add(this.debugState,"daysToAdvance",1,365,1).name("Days to Advance"),l.add(this.actions.advanceTime,"handler").name("Advance Time"),this.economyFolder=this.gui.addFolder("Economy"),this.economyFolder.add(this.actions.replenishStock,"handler").name(this.actions.replenishStock.name),this.economyFolder.add(this.actions.resetEconomyMemory,"handler").name(this.actions.resetEconomyMemory.name),this.economyFolder.add(this.actions.sootheEconomy,"handler").name(this.actions.sootheEconomy.name),this.economyFolder.add(this.actions.riotEconomy,"handler").name(this.actions.riotEconomy.name),this.economyFolder.add(this.actions.injectStock,"handler").name(this.actions.injectStock.name),this.economyFolder.add(this.actions.fillSolCaches,"handler").name(this.actions.fillSolCaches.name);let c=this.gui.addFolder("Triggers"),d=f.RANDOM_EVENTS.reduce((S,b)=>({...S,[b.template.title]:b.id}),{});if(c.add(this.debugState,"selectedRandomEvent",d).name("Random Event"),c.add(this.actions.triggerRandomEvent,"handler").name("Force Trigger Event"),c.add(this.debugState,"alwaysTriggerEvents").name("Always Trigger (100%)").onChange(S=>{this.simulationService&&this.simulationService.travelService&&(this.simulationService.travelService.debugAlwaysTriggerEvents=S)}),f.AGE_EVENTS.length>0){let S=f.AGE_EVENTS.reduce((b,T)=>({...b,[T.title]:T.id}),{});c.add(this.debugState,"selectedAgeEvent",S).name("Age Event"),c.add(this.actions.triggerAgeEvent,"handler").name("Trigger Event")}let h=Object.values(f.MISSIONS).sort((S,b)=>{let T=S.id.startsWith("debug_"),A=b.id.startsWith("debug_");return T&&!A?-1:!T&&A?1:S.name.localeCompare(b.name)}).reduce((S,b)=>({...S,[b.name]:b.id}),{});c.add(this.debugState,"selectedMission",h).name("Mission"),c.add(this.actions.forceAcceptMission,"handler").name("Force Accept"),c.add(this.actions.forceCompleteMission,"handler").name("Force Complete");let p=this.gui.addFolder("Tutorial Tuner");p.domElement.classList.add("tutorial-tuner-folder"),p.add(this.debugState,"ttStepId").name("Step ID").listen().disable(),p.add(this.debugState,"ttAnchor").name("Anchor").listen().disable(),p.add(this.debugState,"ttWidth",0,800,10).name("Width (0=auto)").onChange(()=>this._handleTutorialTune()),p.add(this.debugState,"ttHeight",0,800,10).name("Height (0=auto)").onChange(()=>this._handleTutorialTune()),this.tutorialPositionalControllers.percentX=p.add(this.debugState,"ttPercentX",0,100,1).name("X %").onChange(()=>this._handleTutorialTune()),this.tutorialPositionalControllers.percentY=p.add(this.debugState,"ttPercentY",0,100,1).name("Y %").onChange(()=>this._handleTutorialTune()),this.tutorialPositionalControllers.placement=p.add(this.debugState,"ttPlacement").name("Placement (Elem)").onChange(()=>this._handleTutorialTune()),this.tutorialPositionalControllers.distance=p.add(this.debugState,"ttOffsetDistance",-500,500,1).name("Distance (Elem)").onChange(()=>this._handleTutorialTune()),this.tutorialPositionalControllers.skidding=p.add(this.debugState,"ttOffsetSkidding",-500,500,1).name("Skidding (Elem)").onChange(()=>this._handleTutorialTune());let y=p.addFolder("Position Presets");y.add(this.actions.presetTopCenter,"handler").name(this.actions.presetTopCenter.name),y.add(this.actions.presetTop34Center,"handler").name(this.actions.presetTop34Center.name),y.add(this.actions.presetVertHorizCenter,"handler").name(this.actions.presetVertHorizCenter.name),y.add(this.actions.presetBottom34Center,"handler").name(this.actions.presetBottom34Center.name),y.add(this.actions.presetBottomCenter,"handler").name(this.actions.presetBottomCenter.name),y.add(this.actions.presetBottomLeft,"handler").name(this.actions.presetBottomLeft.name),y.add(this.actions.presetTopLeft,"handler").name(this.actions.presetTopLeft.name),this.tutorialPositionalControllers.presetFolder=y,p.add(this.actions.generateTutorialCode,"handler").name(this.actions.generateTutorialCode.name),p.add(this.debugState,"ttGeneratedCode").name("Code").listen(),this._updateTutorialControlVisibility(!1);let g=this.gui.addFolder("Automation & Logging");g.add(this,"toggleDiagnosticOverlay").name("Toggle HUD Diagnostics"),g.add(this.debugState,"logLevel",["DEBUG","INFO","WARN","ERROR","NONE"]).name("Log Level").onChange(S=>this.logger.setLevel(S)),g.add(this,"generateBugReport").name("Generate Bug Report"),g.add(this.debugState,"botStrategy",["MIXED","HONEST_TRADER","MANIPULATOR","DEPLETE_ONLY","PROSPECTOR"]).name("Bot Strategy"),g.add(this.debugState,"botDaysToRun",1,1e4,1).name("Simulation Days"),g.add(this.actions.startBot,"handler").name(this.actions.startBot.name),g.add(this.actions.stopBot,"handler").name(this.actions.stopBot.name),g.add(this.debugState,"botProgress").name("Progress").listen(),this.gui.folders.forEach(S=>S.close())}_parseSize(e){if(!e||e==="auto")return 0;if(typeof e=="number")return e;if(typeof e=="string"){let t=parseInt(e,10);return isNaN(t)?0:t}return 0}_applyTutorialPreset(e){if(this.debugState.ttAnchor==="body"){let i=Bi[e];i?(this.debugState.ttPercentX=i[0],this.debugState.ttPercentY=i[1],this.tutorialPositionalControllers.percentX?.updateDisplay(),this.tutorialPositionalControllers.percentY?.updateDisplay()):this.logger.warn("DebugService",`Preset key "${e}" not found for percentage presets.`)}else this.logger.warn("DebugService","Offset presets not yet defined for element anchors.");this._handleTutorialTune()}_updateTutorialControlVisibility(e){let t=(i,a)=>{i&&i.show(a)};t(this.tutorialPositionalControllers.percentX,e),t(this.tutorialPositionalControllers.percentY,e),t(this.tutorialPositionalControllers.placement,!e),t(this.tutorialPositionalControllers.distance,!e),t(this.tutorialPositionalControllers.skidding,!e),this.tutorialPositionalControllers.presetFolder&&this.tutorialPositionalControllers.presetFolder.show(e)}setActiveTutorialStep(e){this.logger.info.system("DebugService",`Setting active tutorial step: ${e.stepId}`);let t=e.anchorElement==="body";if(this.debugState.ttGeneratedCode="",this.debugState.ttStepId=e.stepId,this.debugState.ttAnchor=e.anchorElement,this.debugState.ttWidth=this._parseSize(e.size?.width)||0,this.debugState.ttHeight=this._parseSize(e.size?.height)||0,t)this.debugState.ttPercentX=e.positionX??50,this.debugState.ttPercentY=e.positionY??50,this.debugState.ttPlacement="auto",this.debugState.ttOffsetDistance=0,this.debugState.ttOffsetSkidding=0;else{let i=e.popperOptions?.modifiers?.find(o=>o.name==="offset"),a=0,s=0;typeof i?.options?.offset=="function"?(this.logger.warn("DebugService",`Offset function used for ${e.stepId}. Tuner defaults to [0, 10].`),s=10):Array.isArray(i?.options?.offset)?(a=i.options.offset[0]||0,s=i.options.offset[1]||0):s=10,this.debugState.ttPlacement=e.placement||e.popperOptions?.placement||"auto",this.debugState.ttOffsetDistance=s,this.debugState.ttOffsetSkidding=a,this.debugState.ttPercentX=50,this.debugState.ttPercentY=50}this._updateTutorialControlVisibility(t),Object.values(this.tutorialPositionalControllers).forEach(i=>{i&&typeof i.updateDisplay=="function"&&i.updateDisplay()}),this.gui.controllers.find(i=>i.property==="ttWidth")?.updateDisplay(),this.gui.controllers.find(i=>i.property==="ttHeight")?.updateDisplay()}clearActiveTutorialStep(){this.logger.info.system("DebugService","Clearing active tutorial step."),this.debugState.ttStepId="None",this.debugState.ttAnchor="N/A",this.debugState.ttPlacement="auto",this.debugState.ttOffsetDistance=0,this.debugState.ttOffsetSkidding=0,this.debugState.ttPercentX=50,this.debugState.ttPercentY=50,this.debugState.ttWidth=0,this.debugState.ttHeight=0,this.debugState.ttGeneratedCode="",this._updateTutorialControlVisibility(!1)}_handleTutorialTune(){if(!this.uiManager)return;let e=this.debugState.ttAnchor==="body";this.logger.info.system("DebugService",`Tune event (Overlay: ${e}): X%=${this.debugState.ttPercentX}, Y%=${this.debugState.ttPercentY}, Place=${this.debugState.ttPlacement}, Dist=${this.debugState.ttOffsetDistance}, Skid=${this.debugState.ttOffsetSkidding}`),this.uiManager.updateTutorialPopper({isOverlayAnchor:e,width:Number(this.debugState.ttWidth)||0,height:Number(this.debugState.ttHeight)||0,percentX:Number(this.debugState.ttPercentX)||50,percentY:Number(this.debugState.ttPercentY)||50,placement:this.debugState.ttPlacement,distance:Number(this.debugState.ttOffsetDistance)||0,skidding:Number(this.debugState.ttOffsetSkidding)||0})}_generateTutorialCode(){this.logger.info.system("DebugService","Generating tutorial code...");let e=this.debugState.ttAnchor==="body",t=this.debugState.ttWidth>0||this.debugState.ttHeight>0,i=this.debugState.ttWidth>0?`'${this.debugState.ttWidth}px'`:"'auto'",a=this.debugState.ttHeight>0?`'${this.debugState.ttHeight}px'`:"'auto'",s=t?`
size: { width: ${i}, height: ${a} },`:"",o="";e?(o=`
anchorElement: 'body',`,(this.debugState.ttPercentX!==50||this.debugState.ttPercentY!==50)&&(o+=`
positionX: ${this.debugState.ttPercentX},
positionY: ${this.debugState.ttPercentY},`)):(this.debugState.ttAnchor!=="body"&&(o=`
anchorElement: '${this.debugState.ttAnchor}',`),o+=`
placement: '${this.debugState.ttPlacement}',
popperOptions: {
    modifiers: [
        { name: 'offset', options: { offset: [${this.debugState.ttOffsetSkidding}, ${this.debugState.ttOffsetDistance}] } }
        // Add other modifiers here if needed in the future
    ]
}`);let r=`// --- ${this.debugState.ttStepId} ---${s}${o}`;r=r.replace(/,\s*(\}|$)/g,"$1"),this.debugState.ttGeneratedCode=r}};var vt={loc_sun:["Proximity alert: Solar flare activity increasing.","Shield integrity at 98%. Acceptable parameters.","Living on the edge of the inferno: Humanity's hottest outpost.","Hazard Pay Update: External maintenance bonus tripled this week.","Solar harvesting arrays operating at peak efficiency.","Warning: EVA activity is prohibited.","Radiation storm passing. Comm disruptions expected.","The view is magnificent,  you have the proper filters.","Sol Station: The hottest posting in the fleet.","Remember: Thermal management is everyone's responsibility."],loc_mercury:["Sub-surface mining: Dig deep to escape the heat.","The surface is for machines. The tunnels are for people.","Mercury Mining Corp: We extract value and pass it on to you.","Water recycling is mandatory. Violators will be desiccated.","Solar shade maintenance scheduled for 1400 hours.","We need Ice. We pay in refined heavy metals.","Seismic activity detected in Sector 7 deep mines.","The days are long, but the work never stops.","New vein discovered in Deep Mine Sector 9.","Refined metals available for immediate export."],loc_venus:["Breathe easy in the floating cities of Venus.","Great minds meet here... and whisper.","Got a problem? The Venetian Syndicate has a solution... for a price.","Enjoy the view from the opulent circles of Aphrodite Prime.","Venusian atmospheric processors are working at 110% capacity today.","Pressure-shielding inspections are mandatory for all surface-level maintenance crews.",`"What's said on Venus, stays on Venus." - Unofficial motto.`,"Our labs are patenting the future; are you investing?","Trade in secrets, not just cargo. You're on Venus, after all.","Don't let the clouds fool you; the opportunities are clear.","Acid-proof your hull today at a local dry-dock.","Need information? Ask the right people in the City of Whispers.","You're at the system's premier destination for high-tech research.",'Corporate espionage is just "competitive intelligence" here.',"See the beauty of the acidic storms from our secure viewports.","The price of knowledge is high, but the profits are higher.","You're among the elite. You've made it to Venus.","Our floating cities: A miracle of engineering above a crushing hell.","Venusian science leads the system in processor and bio-ware."],loc_earth:["The blue jewel of the system welcomes you home.","Breathe real, unfiltered air. Enjoy your stay on Earth.","The Terran Alliance ensures peace and prosperity for all.","While you're here, visit the cradle of civilization.",'"A ship from Earth is a ship that lasts." - Terran Shipyards.',"Our orbital traffic is busy, but our markets are busier.","Earth: The system's standard for quality and luxury.","Why settle for synthetic? Get real Terran-grown food while you're here.","The Terran Alliance reminds you: clean trade is good trade.","See the rebuilt wonders of the 21st century!","Welcome to Earth, the hub of power, wealth, and influence.","Don't miss Old Chicago, New Beijing, and Neo-Alexandria!","Earth sets the economic and cultural pace for the system.","Our deep-thought computation centers are the system's finest.","Terran markets pay top credit for exotic materials."],loc_luna:["Luna: The industrial heart of the Terran sphere.","Got hull damage? Lunar dry-docks offer the system's best repair rates.","Our Plasteel is forged in vacuum, and it shows.","Need Propellant? We refine it right here, 24/7.",'"We scar the dust so you can fly." - Lunar Mining Co.',"Check out the Sea of Tranquility Industrial Park.","Lunar-built ships are building the future.","The Helium-3 rush may be over, but the work never stops.","Enjoy the Earthrise from a dusty viewport on the surface.","Get your ship serviced while you enjoy low-G comforts.","Lunar manufacturing: Simple, reliable, and affordable.","Stop by a dry-dock for a quick patch-up; our crews are waiting.","You're on the grey frontier, where fortunes are still made.","Dust warnings in effect for sectors 4 through 9.","Need raw materials? You're in the right place.","The Moon: Earth's loyal, hardworking partner.","Our mass-drivers fire tons of Plasteel into orbit every hour.","Don't forget to clean your filters; the dust gets everywhere.",`"If it's not from Luna, is it even built to last?"`],loc_mars:["Mars needs you! And your cargo, of course.","Help build the future; your deliveries build Mars.",`You're on the "Red Frontier," watching a new world in the making.`,"Terraforming is a thirsty business; Hydroponics wanted!","Dust storm warnings are in effect for the Hellas Basin.","You're standing on the first corporate state, the first in freedom!","We're expanding! Many commodities are in high demand.","See the great Olympus Mons, the system's largest mountain.",'"Our independence was built on commerce." - Mars Gov.',"New colonial supply contracts are regularly posted at the terminal.","We're not just building a colony, we're building a nation.","Ship your Cryo-Pods here; help grow our population.","The Martian dream is alive and well.","Enjoy the red skies, red dust, and golden opportunities.","Our fledgling biodomes are always hungry for more expansion.","Watch your step; construction is everywhere.","The thin air is tough, but so are our people.","Here on Mars, corporate policy is the only law.","Invest in a terraforming project today!","Need a solid ship? Martian shipyards build the toughest vessels."],loc_belt:["You're in the Belt: Find your fortune, or find your end.",`"Rock-rich and law-poor." - A Belter's motto.`,"Water Ice is cheap, but life is cheaper.","Need a ship? Our local scrap-yards hide many gems.","Prospectors wanted: high risk, high reward.","Watch your navigation; these rocks are unforgiving.","Out here, a good sensor array is your best friend..","Ice-haulers needed in sector 14-B.","Don't ask where the cargo came from.","A thousand hidden outposts, a million opportunities.","In the Belt, you can keep your transponder on... or off.","The Belt is no place for the faint of heart.","Countless rocks tumble in a silent, chaotic dance.","Need a scrappy craft? We build them tough enough for the Belt.","Raw materials, raw ambition. That's the Belt."],loc_exchange:["The Exchange: All goods, no questions.","Welcome to The Exchange. Check your morals at the airlock.","Need to move... sensitive cargo? We're your partners.","Comms are jammed for everyone's privacy.","Heed the security drones and yield to patrols.","High stakes, high rewards. Welcome to The Exchange.","At The Exchange, every credit is clean.","Don't ask, don't tell, just trade.","Prices are high, but discretion is absolute.","Find your next ship at The Exchange shipyards.","We trade in anything the corporations forbid.","The only law here is the law of supply and demand.","Fuel is a premium, but freedom is priceless.","You've arrived at the legendary black market. ","A hollow asteroid, a universe of opportunity.","We deal in rumors and secrets at The Exchange."],loc_jupiter:["The cheapest fuel in the system, guaranteed.","Enjoy the view from our orbital refineries.",'"We skim the giant so you can fly." - Jovian Fuel Co.',"Automated refineries are working constantly to keep you fueled.","You're at the essential pit-stop for all outer-system routes.","Don't get caught empty; top off while you're here.","Our fuel prices can't be beat!","The colossal sphere of Jupiter dominates every view.","Planning a long haul? Start with a full tank.","We specialize in one thing: cheap, high-grade Propellant.","Our exploration ships are built for the deep void.","The Great Red Spot: A baleful eye, a beautiful sight.","Need Atmo Processors? We build them big right here.","Gravity is high, but our prices are low.","The giant that fuels the whole system.","Radiation warnings in effect. Dock quickly.","Our automated systems mean fast, efficient refueling.",'"A full tank from Jupiter is a full wallet tomorrow."',"Come for the fuel, stay for the view."],loc_saturn:["Enjoy the majestic rings of Saturn.","You've arrived at the system's premier luxury destination.","Visit the opulent stations of the Ring-Dwellers.","Got luxury goods? Our markets pay top credit!","Bio-tech are in high demand on Saturn.","Relax in opulent zero-G luxury on your favorite ring today!",'"Give a ring, on a ring, with a view to remember." - Saturn Tourism Board.',"Our casinos are open always.","Experience the shadow of the rings.","Home of the best personal transport. Travel in style.","Bring us your exotic bio-wares, leave with a fortune.","You're at the jewel of the outer system.","Ice-harvesting rigs and luxury hotels, side-by-side.","This is where the wealthy come to play.","Forget the dust of the Belt; experience true opulence.","Our markets crave the finest things in life.","Corporate retreats and high-stakes tourism."],loc_uranus:["Uranus: Pushing the boundaries of science.","Need a boost? Our R&D labs offer component overclocking.","The pale, featureless orb holds deep secrets.","Report: Quantum phenomena studies are yielding strange results.","We build the system's largest craft. Reserve yours today.","Research outposts glitter like ice in the eternal twilight.","You're at the system's hub for theoretical physics.","Our ships are built for self-sufficiency.","Don't mind the strange sensor readings; it's just the science.","Welcome to the Tilted Planet at the edge of the known.","A silent, ice-cold world of opportunity.","We're hiring long-haul traders. Discretion is a must.",`"What is reality? We're working on it." - Uranus R&D.`,"The coldest, quietest, and strangest port in the system.","Our scientists are unlocking the secrets of the void."],loc_neptune:["You are in military-controlled space. Transponder required.","Supersonic winds and high-security stations.","Check out the military surplus shipyard. All sales final.",'"Monitor your engine wake when in port." - Neptune Patrol.',"Heavily armed patrols are for your protection.","The dark, stormy edge of the system.","Decommissioned frigates regularly for sale.","Have your clearance codes ready.","Welcome to the Dark Blue Pearl - beautiful, but dangerous.","Neptune's shipyards build for war, not for comfort.","Need a ship that can take a punch? Buy military surplus.","This is a restricted zone. Authorized traders only.","The winds here are fast, but our patrol ships are faster.","Shielded orbital stations offer refuge from the storm.",`"Obey the patrols, and you'll be fine."`,"Neptune: The armored fist of the outer system.","Our surplus sales are legendary. Get a frigate for cheap.","The last, stormy bastion of corporate law."],loc_kepler:["Kepler's Eye: We are watching the void.","Our Markets are astronomical.","You're looking at the single largest lens in human history.",'"We look for answers in the dark." - Kepler R&D.','"Staring into the infinite, always." - Kepler R&D.',"Our observatory consumes more power than a small city.","The furthest point of scientific ambition.",`"What's out there? Let's find out." - Kepler R&D`,"Our delicate sensor arrays are always expanding.","A colossal lens, a universe of data.","Kepler's Eye: The system's lonely sentinel.","Your cargo deliveries help fuel discovery.","Dock carefully; our sensor lattice is fragile.","The quietest station in the system.","See the system as you've never seen it before.","Kepler's Eye: What do the stars see when they look back?"],loc_pluto:["Pluto: The last stop.","Welcome to the fringe. Don't cause trouble.",'"We care not for your past, but your business."',"You're at the haven for outcasts, at the system's cold, dark edge.","Forbidden tech? We call it unregulated.","Our stations are carved from a mountains of nitrogen-ice.","Smugglers, outcasts, and pioneers are all welcome here.","Pluto: The furthest outpost from corporate law.","The light is dim, but the opportunities are bright.","Need supplies? We've got the strangest.","Pluto's tiny, frozen heart is a whisper in the dark.",`"It's cold, it's dark, and it's home." - Pluto Tourism Board`,"Need a place to lay low? You found it.",`"We have what the core worlds don't."`,"System jurisdiction ends here, but your stay doesn't have to."]};var Vi=15,qi={loc_venus:"var(--color-theme-venus)",loc_earth:"var(--color-theme-earth)",loc_luna:"var(--color-theme-luna)",loc_mars:"var(--color-theme-mars)",loc_belt:"var(--color-theme-belt)",loc_exchange:"var(--color-theme-exchange)",loc_jupiter:"var(--color-theme-jupiter)",loc_saturn:"var(--color-theme-saturn)",loc_uranus:"var(--color-theme-uranus)",loc_neptune:"var(--color-theme-neptune)",loc_kepler:"var(--color-theme-kepler)",loc_pluto:"var(--color-theme-pluto)"},lt=class{constructor(e){this.gameState=e,this.simulationService=null,this.marketService=null,this.messageQueue=[],this.isDirty=!0,this.welcomeMessagePlayed=!1}setServices(e,t){this.simulationService=e,this.marketService=t}pushMessage(e,t,i=!1,a=!1){if(e&&this.messageQueue.some(o=>o.text===e))return;let s={id:Date.now()+Math.random(),text:e,type:t,requiresLiveData:a};for(i?this.messageQueue.unshift(s):this.messageQueue.push(s);this.messageQueue.length>Vi;)this.messageQueue.shift();this.isDirty=!0}pulse(){}onLocationChange(e=null){let t=this.gameState.getState(),i=e||t.currentLocationId;this.messageQueue=[],this.generateWelcomeMessage(),this.generatePurchasedIntelMessage(),this.generateFreeIntelMessage(i);let a=this.selectLocationFlavorAds(i);a[0]&&this.pushMessage(a[0],"FLAVOR"),this.pushMessage("","STATUS",!1,!0),this.isDirty=!0}getTickerContentHtml(){this.messageQueue.length===0&&!this.welcomeMessagePlayed&&this.generateWelcomeMessage();let e='<span class="ticker-separator">//</span>';return`${this.messageQueue.map(i=>{let a=i.text,s="";return i.requiresLiveData&&i.type==="STATUS"&&(a=this.getLiveStatusText()),i.type==="FLAVOR"&&(s=`style="color: ${this.getLocationColor()};"`),`<span class="ticker-message" data-type="${i.type}" ${s}>${a}</span>`}).join(e)}${e}`}generateWelcomeMessage(){this.welcomeMessagePlayed||(this.pushMessage("Welcome to Orbital Trading","SYSTEM",!0),this.welcomeMessagePlayed=!0)}generateFreeIntelMessage(e){if(!this.marketService)return;let t=this.gameState.getState(),i=t.market.prices[e];if(!i)return;let a=f.COMMODITIES,s={commodityId:null,discount:0};for(let o of a){if(!o||!o.basePriceRange||o.tier>t.player.revealedTier)continue;let r=i[o.id];if(r===void 0)continue;let n=(o.basePriceRange[0]+o.basePriceRange[1])/2,l=(n-r)/n;l>s.discount&&(s={commodityId:o.id,discount:l})}if(s.discount>=.05){let o=a.find(c=>c.id===s.commodityId).name,r;s.discount>.5?r="tier5":s.discount>.3?r="tier4":s.discount>.2?r="tier3":s.discount>.1?r="tier2":r="tier1";let n=Xt[r],l=n[Math.floor(Math.random()*n.length)];l=l.replace("{Commodity Name}",o),this.pushMessage(l,"INTEL")}else this.pushMessage("Market conditions nominal.","INTEL")}generatePurchasedIntelMessage(){}selectLocationFlavorAds(e){let t=vt[e]||vt.loc_belt;if(t.length===0)return["",""];if(t.length===1)return[t[0],t[0]];let i=[...t].sort(()=>.5-Math.random());return[i[0],i[1]]}getLiveStatusText(){try{let e=this.gameState.getState(),t=e.player.activeShipId;if(!t)return"STATUS: NO ACTIVE SHIP";let i=f.SHIPS[t],a=e.player.shipStates[t];if(!i||!a)return"STATUS: DATA ERROR";let s=Math.round(a.fuel/i.maxFuel*100),o=Math.round(a.health/i.maxHealth*100),r=0,n=e.player.inventories[t];n&&(r=Object.values(n).reduce((c,d)=>c+d.quantity,0));let l=i.cargoCapacity;return`${i.name}: FUEL: ${s}% | CARGO: ${r}/${l} | HULL: ${o}%`}catch(e){return console.error("NewsTickerService Error generating status:",e),"STATUS: ERROR"}}getLocationColor(){let e=this.gameState.getState().currentLocationId;return qi[e]||"var(--color-text-primary)"}};var ct=()=>{let m=document.getElementById("game-container");if(!m)return;let e=window.visualViewport?window.visualViewport.height:window.innerHeight;document.documentElement.style.setProperty("--app-height",`${e}px`);let t=926;if(e<t){let i=e/t;m.style.height=`${t}px`,m.style.transform=`scale(${i})`,m.style.transformOrigin="top center",document.body.style.alignItems="flex-start"}else m.style.transform="none",m.style.height="100dvh",document.body.style.alignItems="center"};document.addEventListener("DOMContentLoaded",()=>{V.init().then(()=>{V.hydrateBootAssets()}).catch(l=>console.warn("[Main] Asset Locker failed to initialize:",l));let m=document.getElementById("splash-screen"),e=document.getElementById("start-game-btn"),t=document.getElementById("debug-start-btn"),i=!0,a=new Ke(Ie),s=document.getElementById("eula-checkbox"),o=document.getElementById("eula-container");m&&m.addEventListener("click",l=>{let c=l.target.closest("[data-action]");c&&c.dataset.action==="show_eula_modal"&&(l.preventDefault(),a.showEulaModal())}),o&&o.addEventListener("animationend",()=>{o.classList.remove("pulse-eula-warning")});let r=l=>{if(!s||!o){console.error("EULA elements not found!");return}if(!s.checked){o.classList.remove("pulse-eula-warning"),setTimeout(()=>{o.classList.add("pulse-eula-warning")},10);return}try{let c=new Ee;c.loadGame()&&V.hydrateGameAssets(c.getState())}catch(c){console.warn("[Main] Pre-flight hydration warning:",c)}m.classList.add("splash-screen-hiding"),m.addEventListener("animationend",()=>{m.style.display="none",l()},{once:!0})};ct(),window.visualViewport?(window.visualViewport.addEventListener("resize",ct),window.visualViewport.addEventListener("scroll",ct)):window.addEventListener("resize",ct),e.addEventListener("click",()=>{r(()=>n(!1,a,Ie))},{once:!1}),t.addEventListener("click",()=>{r(()=>n(!0,a,Ie))},{once:!1});function n(l=!1,c,d){let h=new Ee,p=new lt(h),y=new st(h,c,d),g=new Pe(h,c,d,p),S=new tt(h,c,g,c.navStructure,d),b=null;i&&(b=new nt(h,g,c,d),b.init(),c.setDebugService(b)),c.setNewsTickerService(p),c.setMissionService(y),c.setSimulationService(g),g.setTutorialService(S),g.setMissionService(y),y.setSimulationService(g);let T=new et(h,g,c,S,b,d);c.setEventManager(T),h.subscribe(()=>c.render(h.getState()));let A=h.loadGame();A||(l&&b?(h.startNewGame(""),b.simpleStart()):(h.startNewGame(""),g.timeService.advanceDays(7),g.startIntroSequence())),T.bindEvents(),window.game={gameState:h,simulationService:g,missionService:y,uiManager:c,eventManager:T},console.log("Game services exposed to window.game"),(A||l)&&(c.showGameContainer(),p.onLocationChange(),c.render(h.getState())),S.checkState({type:"SCREEN_LOAD",screenId:h.activeScreen}),V.hydrateGameAssets(h.getState())}});})();
